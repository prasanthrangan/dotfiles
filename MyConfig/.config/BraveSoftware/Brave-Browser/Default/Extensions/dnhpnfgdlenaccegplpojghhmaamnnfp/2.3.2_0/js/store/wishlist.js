(()=>{"use strict";class e extends Error{constructor(e){super(e),this.name="LoginError"}}class t extends Error{constructor(e){super(e),this.name="ServerOutageError"}}class s extends Error{constructor(e,t){super(t),this.code=e}}class r extends Error{constructor(e,t){super(e),this.featureName=t}}const n={LoginError:e,ServerOutageError:t,HTTPError:s,FeatureDependencyError:r};class a{static escape(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,(e=>t[e]))}static fragment(e){const t=document.createElement("template");return t.innerHTML=DOMPurify.sanitize(e),t.content}static element(e){return a.fragment(e).firstElementChild}static _getNode(e){let t=e;return null==t?(console.warn(`${t} is not an Element.`),null):("string"==typeof t&&(t=document.querySelector(t)),t instanceof Element?t:(console.warn(`${t} is not an Element.`),null))}static inner(e,t){const s=a._getNode(e);return s&&(s.innerHTML=DOMPurify.sanitize(t)),s}static replace(e,t){const s=a._getNode(e);return s&&(s.outerHTML=DOMPurify.sanitize(t)),s}static wrap(e,t,s=t){const r=a._getNode(t);if(!r)return null;const n=null===s?r.parentElement.lastElementChild:a._getNode(s),i=[r];for(let e=r;null!==e.nextElementSibling&&e!==n;e=e.nextElementSibling)i.push(e.nextElementSibling);const o=a.element(e);return r.replaceWith(o),o.append(...i),o}static adjacent(e,t,s){const r=a._getNode(e);return r&&r.insertAdjacentHTML(t,DOMPurify.sanitize(s)),r}static beforeBegin(e,t){a.adjacent(e,"beforebegin",t)}static afterBegin(e,t){a.adjacent(e,"afterbegin",t)}static beforeEnd(e,t){a.adjacent(e,"beforeend",t)}static afterEnd(e,t){a.adjacent(e,"afterend",t)}}class i{static clearSpecialSymbols(e){return e.replace(/[\u00AE\u00A9\u2122]/g,"")}static htmlToDOM(e){return a.fragment(e)}static htmlToElement(e){return a.element(e)}static getVariableFromText(e,t,s){let r;if("object"===s)r=new RegExp(`${t}\\s*=\\s*(\\{.+?\\});`);else if("array"===s)r=new RegExp(`${t}\\s*=\\s*(\\[.+?\\]);`);else if("int"===s)r=new RegExp(`${t}\\s*=\\s*(.+?);`);else{if("string"!==s)return null;r=new RegExp(`${t}\\s*=\\s*(\\".+?\\");`)}const n=e.match(r);return n?"int"===s?parseInt(n[1]):JSON.parse(n[1]):null}static getVariableFromDom(e,t,s=document){for(const r of s.querySelectorAll("script")){const s=i.getVariableFromText(r.textContent,e,t);if(null!==s)return s}return null}}class o{static get(e,t){const s=e.trim();return o.cache.has(s)?o.cache.get(s):t}static set(e,t,s=31536e3){let r=e.trim(),n=t.trim();o.cache.set(r,n),r=encodeURIComponent(r),n=encodeURIComponent(n),document.cookie=`${r}=${n}; max-age=${s}`}static remove(e){let t=e.trim();o.cache.delete(t),t=encodeURIComponent(t),document.cookie=`${t}; expires=Thu, 01 Jan 1970 00:00:00 GMT`}static init(){o.cache=new Map;for(let[e,t]of document.cookie.split(";").map((e=>e.split("="))))e=e.trim(),o.cache.set(e,decodeURIComponent(t))}}o.init();const c=Object.freeze({BACKGROUND:1,CONTENT_SCRIPT:2,OPTIONS:3});let l;if(browser.extension.getBackgroundPage){const e=browser.extension.getBackgroundPage();l=e===window?c.BACKGROUND:c.OPTIONS}else l=c.CONTENT_SCRIPT;class d{static isBackgroundScript(){return l===c.BACKGROUND}static isContentScript(){return l===c.CONTENT_SCRIPT}static isOptions(){return l===c.OPTIONS}}class u{static getCurrentSteamLanguage(){if(null!==this._currentSteamLanguage)return this._currentSteamLanguage;for(const e of document.querySelectorAll("script[src]")){const t=new URL(e.src).searchParams.get("l");if(t)return u._currentSteamLanguage=t,this._currentSteamLanguage}return d.isContentScript()&&(u._currentSteamLanguage=o.get("Steam_Language")||null),this._currentSteamLanguage}static getLanguageCode(e){return u.languages[e]||"en"}static isCurrentLanguageOneOf(e){return e.includes(u.getCurrentSteamLanguage())}}u._currentSteamLanguage=null,u.languages={english:"en",bulgarian:"bg",czech:"cs",danish:"da",dutch:"nl",finnish:"fi",french:"fr",greek:"el",german:"de",hungarian:"hu",italian:"it",japanese:"ja",koreana:"ko",norwegian:"no",polish:"pl",portuguese:"pt-PT",brazilian:"pt-BR",russian:"ru",romanian:"ro",schinese:"zh-CN",spanish:"es-ES",latam:"es-419",swedish:"sv-SE",tchinese:"zh-TW",thai:"th",turkish:"tr",ukrainian:"ua",vietnamese:"vi"};class g{static message(e){return browser.runtime.sendMessage(e)}static action(e,...t){return t.length?this.message({action:e,params:t}):this.message({action:e})}}class h{static getURL(e){return browser.runtime.getURL(e)}static get(e){return fetch(h.getURL(e))}static getJSON(e){return h.get(e).then((e=>e.json()))}static getText(e){return h.get(e).then((e=>e.text()))}}class _{static has(e){return Object.prototype.hasOwnProperty.call(this.cache,e)}static get(e){return void 0!==this.cache[e]||void 0===this.defaults?this.cache[e]:(void 0===this.defaults[e]&&console.warn('Unrecognized storage key "%s"',e),this.defaults[e])}static set(e,t){return this.cache[e]=t,this._adapter.set({[e]:t})}static import(e){for(const[t,s]of Object.entries(e))this.cache[t]=s;return this._adapter.set(e)}static remove(e){return void 0!==this.cache[e]&&delete this.cache[e],this._adapter.remove(e)}static keys(e=""){return Object.keys(this.cache).filter((t=>t.startsWith(e)))}static entries(){return Object.entries(this.cache)}static async clear(e=!1){let t;e||(t=(this.persistent??[]).reduce(((e,t)=>(e[t]=this.cache[t],e)),{})),await this._adapter.clear(),this.cache={},e||await this.import(t)}static async init(){const e=this._adapter===browser.storage.sync?"sync":"local",t=_.caches[e];return void 0!==t?(this.cache=t,this.cache):(_.caches[e]={},this.cache=_.caches[e],browser.storage.onChanged.addListener(((t,s)=>{if(e===s)for(const[e,{newValue:s}]of Object.entries(t))this.cache[e]=s})),Object.assign(this.cache,await this._adapter.get(null)))}static then(e,t){const s=this._initialized?Promise.resolve(this.cache):this.init();return this._initialized=!0,s.then(e,t)}static toJson(){return JSON.stringify(this.cache)}}_.caches={};const p={version:browser.runtime.getManifest().version,db_version:3};class m extends _{}m._adapter=browser.storage.sync||browser.storage.local,m.QUOTA_BYTES_PER_ITEM=browser.storage.sync?8192:5240832,m.defaults=Object.freeze({language:"english",version:p.version,version_show:!0,highlight_owned_color:"#00ce67",highlight_wishlist_color:"#0491bf",highlight_coupon_color:"#a26426",highlight_inv_gift_color:"#800040",highlight_inv_guestpass_color:"#513c73",highlight_notinterested_color:"#4f4f4f",highlight_collection_color:"#856d0e",highlight_waitlist_color:"#4c7521",tag_owned_color:"#00b75b",tag_wishlist_color:"#0383b4",tag_coupon_color:"#c27120",tag_inv_gift_color:"#b10059",tag_inv_guestpass_color:"#65449a",tag_notinterested_color:"#4f4f4f",tag_collection_color:"#856d0e",tag_waitlist_color:"#4c7521",highlight_owned:!0,highlight_wishlist:!0,highlight_coupon:!1,highlight_inv_gift:!1,highlight_inv_guestpass:!1,highlight_notinterested:!1,highlight_excludef2p:!1,highlight_collection:!0,highlight_waitlist:!0,tag_owned:!1,tag_wishlist:!1,tag_coupon:!1,tag_inv_gift:!1,tag_inv_guestpass:!1,tag_notinterested:!0,tag_collection:!1,tag_waitlist:!1,tag_short:!1,hidetmsymbols:!1,showlowestprice:!0,showlowestprice_onwishlist:!0,showlowestpricecoupon:!0,showallstores:!0,stores:[],override_price:"auto",showregionalprice:"mouse",regional_countries:["us","gb","ru","br","au","jp"],show_es_homepagetabs:!0,showmarkettotal:!1,showsteamrepapi:!0,showmcus:!0,showoc:!0,showhltb:!0,showyoutube:!0,showtwitch:!0,showpcgw:!0,showcompletionistme:!1,showprotondb:!1,showviewinlibrary:!1,showsteamcardexchange:!1,showitadlinks:!0,showsteamdb:!0,showbartervg:!1,showastatslink:!0,showyoutubegameplay:!0,showyoutubereviews:!0,showwsgf:!0,exfgls:!0,app_custom_link:[{enabled:!1,name:"Google",url:"google.com/search?q=[ID]+[NAME]",icon:"www.google.com/images/branding/product/ico/googleg_lodp.ico"}],customize_apppage:{recentupdates:!0,reviews:!0,about:!0,contentwarning:!0,steamchart:!0,steamspy:!0,surveys:!0,sysreq:!0,legal:!0,morelikethis:!0,recommendedbycurators:!0,customerreviews:!0},customize_frontpage:{featuredrecommended:!0,specialoffers:!0,trendingamongfriends:!0,discoveryqueue:!0,browsesteam:!0,curators:!0,morecuratorrecommendations:!0,recentlyupdated:!0,fromdevelopersandpublishersthatyouknow:!0,popularvrgames:!0,homepagetabs:!0,gamesstreamingnow:!0,under:!0,updatesandoffers:!0,homepagesidebar:!0},show_package_info:!1,show_steamchart_info:!0,show_steamspy_info:!0,show_early_access:!0,show_alternative_linux_icon:!1,show_itad_button:!1,skip_got_steam:!1,installsteam:"show",openinnewtab:!1,keepssachecked:!1,showemptywishlist:!0,user_notes_app:!0,user_notes_wishlist:!0,showwishliststats:!0,oneclickremovewl:!1,user_notes:{},user_notes_adapter:"synced_storage",replaceaccountname:!0,showlanguagewarning:!0,showlanguagewarninglanguage:"english",homepage_tab_selection:"remember",homepage_tab_last:null,send_age_info:!0,removebroadcasts:!1,mp4video:!1,horizontalscrolling:!0,showsupportinfo:!0,showdrm:!0,regional_hideworld:!1,showinvnav:!0,quickinv:!0,quickinv_diff:-.01,community_default_tab:"",showallachievements:!1,showallstats:!0,replacecommunityhublinks:!1,hideannouncementcomments:!1,showachinstore:!0,hideactivelistings:!1,showlowestmarketprice:!0,hidespamcomments:!1,spamcommentregex:"[\\u2500-\\u25FF]",wlbuttoncommunityapp:!0,removeguideslanguagefilter:!1,disablelinkfilter:!1,sortfriendsby:"default_ASC",sortreviewsby:"default_ASC",sortgroupsby:"default_ASC",show1clickgoo:!0,show_profile_link_images:"gray",show_custom_themes:!0,profile_pinned_bg:!1,profile_steamrepcn:!0,profile_steamgifts:!0,profile_steamtrades:!0,profile_bartervg:!0,profile_steamrep:!0,profile_steamdbcalc:!0,profile_astats:!0,profile_backpacktf:!0,profile_astatsnl:!0,profile_steamid:!0,profile_custom_link:[{enabled:!0,name:"Google",url:"google.com/search?q=[ID]",icon:"www.google.com/images/branding/product/ico/googleg_lodp.ico"}],fav_emoticons:[],group_steamgifts:!0,steamcardexchange:!0,purchase_dates:!0,show_badge_progress:!0,show_coupon:!0,show_wishlist_link:!0,show_wishlist_count:!0,show_progressbar:!0,show_backtotop:!1,profile_showcase_twitch:!0,profile_showcase_own_twitch:!1,profile_showcase_twitch_profileonly:!1,itad_import_library:!1,itad_import_wishlist:!1,add_to_waitlist:!1,context_steam_store:!1,context_steam_market:!1,context_itad:!1,context_bartervg:!1,context_steamdb:!1,context_steamdb_instant:!1,context_steam_keys:!1}),m.persistent=["user_notes","user_notes_adapter"];class f{static loadLocalization(e){return h.getJSON(`/localization/${e}.json`)}static init(){if(f._promise)return f._promise;let e=u.getCurrentSteamLanguage();const t=m.get("language");function s(e,t){for(const[r,n]of Object.entries(t))void 0!==e[r]?"object"==typeof n?s(e[r],n):""!==n&&(e[r]=n):console.warn("The key %s doesn't exist in the English localization file",r);return e}null===e?e=t:e!==t&&(m.set("language",e),g.action("clearpurchases"));const r=u.getLanguageCode(e),n=["en"];return null!==r&&"en"!==r&&n.push(r),f._promise=Promise.all(n.map((e=>f.loadLocalization(e)))).then((([e,t])=>(f.str=e,t&&s(f.str,t),f.str))),f._promise}static then(e,t){return f.init().then(e,t)}static getString(e){const t=e.split(".").reverse();let s=f.str;for(;t.length;){if("object"!=typeof s)return null;s=s[t.pop()]}return s}}f._promise=null;class w extends _{static async init(){return await super.init(),this===w?this.migrate():null}static async migrate(){const e=this.get("local_storage_migration");let t;if("store.steampowered.com"===location.hostname)t="store";else if("steamcommunity.com"===location.hostname)t="community";else{if(d.isContentScript())return null;t="extension"}return e[t]?null:(await Promise.all(Object.keys(w.defaults).map((async e=>{let t=localStorage.getItem(e);if(null!==t){try{t=JSON.parse(t)}catch(e){throw console.error("Can't parse value",t),e}await w.set(e,t),localStorage.removeItem(e)}}))),e[t]=!0,w.set("local_storage_migration",e))}}w._adapter=browser.storage.local,w.defaults=Object.freeze({access_token:null,lastItadImport:{from:null,to:null},login:{steamId:null,profilePath:null},storeCountry:null,expand_slider:!1,es_guide_tags:{},market_stats:{startListing:null,purchaseTotal:0,saleTotal:0},popular_refresh:!1,workshop_state:"",playback_hd:!1,show_review_section:!0,steampeek:!1,support_info:null,hide_login_warn_store:!1,hide_login_warn_community:!1,review_filters:{},local_storage_migration:{store:!1,community:!1,extension:!1}});class y{constructor(e){this._promise=new Promise((t=>{this._id=setTimeout((()=>{t()}),e)}))}then(e,t){if(this._promise)return this._promise.then(e,t);throw new Error("Timer has been cleared before")}clear(){clearTimeout(this._id),this._promise=null}}class v{constructor(e,t){this.onDone=e,this.duration=t,this.reset()}get running(){return this._running}reset(){void 0!==this._id&&clearTimeout(this._id),this._id=setTimeout((async()=>{await this.onDone(),this._running=!1}),this.duration),this._running=!0}}class b{static timer(e){return new y(e)}static resettableTimer(e,t){return new v(e,t)}static now(){return Math.trunc(Date.now()/1e3)}}class S{static parseId(e){if(!e)return null;return parseInt(e)||null}static getAppid(e){let t=e;if(!t)return null;if(t instanceof HTMLElement){const e=t.dataset.dsAppid;if(e)return S.parseId(e);if(t=t.href,!t)return null}const s=t.match(/(?:store\.steampowered|steamcommunity)\.com\/(?:app|games|market\/listings)\/(\d+)\/?/);return s&&S.parseId(s[1])}static getSubid(e){let t=e;if(!t)return null;if(t instanceof HTMLElement){const e=t.dataset.dsPackageid;if(e)return S.parseId(e);if(t=t.href,!t)return null}const s=t.match(/(?:store\.steampowered|steamcommunity)\.com\/sub\/(\d+)\/?/);return s&&S.parseId(s[1])}static getBundleid(e){let t=e;if(!t)return null;if(t instanceof HTMLElement){const e=t.dataset.dsBundleid;if(e)return S.parseId(e);if(t=t.href,!t)return null}const s=t.match(/(?:store\.steampowered|steamcommunity)\.com\/bundle\/(\d+)\/?/);return s&&S.parseId(s[1])}static trimStoreId(e){return Number(e.slice(e.indexOf("/")+1))}static getAppidImgSrc(e){let t=e;if(!t)return null;if(t instanceof HTMLImageElement&&(t=t.hasAttribute("src")?t.getAttribute("src"):t.dataset.imageUrl,!t))return null;const s=t.match(/(?:cdn\.(?:akamai|cloudflare)\.steamstatic\.com\/steam|steamcdn-a\.akamaihd\.net\/steam|steamcommunity\/public\/images)\/apps\/(\d+)\//);return s&&S.parseId(s[1])}static getAppidUriQuery(e){if(!e)return null;const t=e.match(/appid=(\d+)/);return t&&S.parseId(t[1])}static getAppids(e){const t=/(?:store\.steampowered|steamcommunity)\.com\/app\/(\d+)\/?/g,s=[];let r;for(;null!==(r=t.exec(e));){const e=S.parseId(r[1]);e&&s.push(e)}return s}static getAppidFromId(e){if(!e)return null;const t=e.match(/game_(\d+)/);return t&&S.parseId(t[1])}static getAppidFromGameCard(e){if(!e)return null;const t=e.match(/\/gamecards\/(\d+)/);return t&&S.parseId(t[1])}}const E=["contextMenus"];Object.freeze({context_steam_store:{persistent:!0,permissions:E},context_steam_market:{persistent:!0,permissions:E},context_itad:{persistent:!0,permissions:E},context_bartervg:{persistent:!0,permissions:E},context_steamdb:{persistent:!0,permissions:E},context_steamdb_instant:{persistent:!0,permissions:E},context_steam_keys:{persistent:!0,permissions:E}});class C{constructor(e,t=0,s=0){console.assert(3===[e,t,s].filter(Number.isInteger).length,`${e}.${t}.${s} must be integers`),this.major=e,this.minor=t,this.patch=s}static from(e){if(e instanceof C)return new C(e.major,e.minor,e.patch);if("string"==typeof e)return C.fromString(e);if(Array.isArray(e))return C.fromArray(e);throw new Error(`Could not construct a Version from ${e}`)}static fromArray(e){return new C(...e.map((e=>parseInt(e))))}static fromString(e){return C.fromArray(e.split("."))}static coerce(e){return e instanceof C?e:C.from(e)}toString(){return`${this.major}.${this.minor}.${this.patch}`}toArray(){return[this.major,this.minor,this.patch]}toJSON(){return this.toString()}isCurrent(){return this.isSameOrAfter(p.version)}isSame(e){const t=C.coerce(e);return this.major===t.major&&this.minor===t.minor&&this.patch===t.patch}isBefore(e){const t=C.coerce(e);return this.major<t.major||!(this.major>t.major)&&(this.minor<t.minor||!(this.minor>t.minor)&&this.patch<t.patch)}isSameOrBefore(e){return this.isSame(e)||this.isBefore(e)}isAfter(e){return C.coerce(e).isBefore(this)}isSameOrAfter(e){return C.coerce(e).isSameOrBefore(this)}}class k{static create(){m.get("show_progressbar")&&(a.afterEnd("#global_actions",`<div class="es_progress__wrap">\n                <div class="es_progress es_progress--complete" title="${f.str.ready.ready}">\n                    <div class="es_progress__bar">\n                        <div class="es_progress__value"></div>\n                    </div>\n                </div>\n            </div>`),k._progress=document.querySelector(".es_progress"))}static loading(){k._progress&&(k._progress.setAttribute("title",f.str.ready.loading),k.requests={initiated:0,completed:0},k._progress.classList.remove("es_progress--complete"),k._progress.querySelector(".es_progress__value").style.width="18px")}static startRequest(){k.requests&&(k.requests.initiated++,k.progress())}static finishRequest(){k.requests&&(k.requests.completed++,k.progress())}static progress(e){if(!k._progress)return;let t=e;if(!t){if(!k.requests)return;k.requests.initiated>0&&(t=100*k.requests.completed/k.requests.initiated)}t>100&&(t=100),k._progress.querySelector(".es_progress__value").style.width=`${t}px`,t>=100&&(k._progress.classList.add("es_progress--complete"),k._progress.setAttribute("title",f.str.ready.ready),k.requests=null)}static serverOutage(){k._progress&&(k._progress.classList.add("es_progress--warning"),k.requests=null,k._progress.parentElement.querySelector(".es_progress__warning, .es_progress__error")||a.afterEnd(k._progress,`<div class="es_progress__warning">${f.str.ready.server_outage}</div>`))}static failed(){if(!k._progress)return;const e=k._progress.parentElement.querySelector(".es_progress__warning");e&&(k._progress.classList.remove("es_progress--warning"),e.remove()),k._progress.classList.add("es_progress--error"),k.requests=null;const t=k._progress.parentElement.querySelector(".es_progress__error");t?t.textContent=f.str.ready.failed.replace("__amount__",++k._failedRequests):a.afterEnd(k._progress,`<div class="es_progress__error">${f.str.ready.failed.replace("__amount__",++k._failedRequests)}</div>`)}}k._progress=null,k._failedRequests=0;class $ extends g{static async message(e){let t;k.startRequest();try{return t=await super.message(e),k.finishRequest(),t}catch(e){const t=class{static parse(e){const t=e.match(/(.*):\s(.+)/);return{name:t[1]||"",msg:t[2]||""}}}.parse(e.message);throw"ServerOutageError"===t.name?k.serverOutage():$._errorHandlers.some((e=>e(t)))||k.failed(),e}}static registerErrorHandler(e){$._errorHandlers.push(e)}}$._errorHandlers=[];class A{static async getHttp(e,t={},s="text"){let r=e;const a={method:"GET",credentials:"include",headers:{origin:window.location.origin},referrer:window.location.origin+window.location.pathname,...t};let i;k.startRequest(),r.startsWith("//")&&(r=window.location.protocol+e,console.warn("Requesting URL without protocol, please update"));try{if(i=await A._fetchFn(r,a),!i.ok)throw new n.HTTPError(i.status,`HTTP ${i.status} ${i.statusText} for ${i.url}`)}catch(e){throw k.failed(),e}return k.finishRequest(),i[s]()}static post(e,t,s,r){return A.getHttp(e,Object.assign(s||{},{method:"POST",body:t}),r?"json":"text")}static getJson(e,t){return A.getHttp(e,t,"json")}static getBlob(e,t){return A.getHttp(e,t,"blob")}}A._fetchFn="undefined"!=typeof content&&content&&content.fetch||fetch.bind(window);class L{static get storeCountry(){const e=new URL(window.location.href);let t;return e.searchParams&&e.searchParams.has("cc")?t=e.searchParams.get("cc"):(t=L._storeCountry,t||(t=o.get("steamCountry"))),t||(console.warn("Failed to detect store country, falling back to US"),t="US"),t.substr(0,2)}static promise(){if(L._promise)return L._promise;const e=document.querySelector("#global_actions > a.user_avatar");let t;return e?(L.profileUrl=e.href,L.profilePath=e.pathname,t=$.action("login",L.profilePath).then((e=>{e&&(L.isSignedIn=!0,L.steamId=e.steamId)}))):t=$.action("logout"),L._promise=t.then((()=>$.action("storecountry"))).catch((({message:e})=>{console.error(e)})).then((e=>{if(e)return L._storeCountry=e,null;let t;if(window.location.hostname.endsWith("steampowered.com"))for(const e of document.getElementsByTagName("script")){const s=e.textContent.match(/GDynamicStore\.Init\(.+?, '([A-Z]{2})/);if(s){t=s[1];break}}else if("steamcommunity.com"===window.location.hostname){const e=document.querySelector("#webui_config,#application_config");e&&(t=JSON.parse(e.dataset.config).COUNTRY)}if(t)return L._storeCountry=t,$.action("storecountry",t).catch((({message:e})=>{console.error(e)}));throw new Error("Script with user store country not found")})).catch((e=>{console.group("Store country detection"),console.warn("Failed to detect store country from page"),console.error(e),console.groupEnd()})),L._promise}static then(e,t){return L.promise().then(e,t)}static get sessionId(){return L._sessionId||(L._sessionId=i.getVariableFromDom("g_sessionID","string")),L._sessionId}static getPurchaseDate(e,t){const s=i.clearSpecialSymbols(t);return $.action("purchases",s,e)}static async getUserToken(){const e=await A.getJson("/pointssummary/ajaxgetasyncconfig").catch((()=>!1));if(!e||!e.success)throw new Error("Failed to get webapi token");return e.data.webapi_token}}Promise.allSettled||(Promise.allSettled=e=>Promise.all(e.map((e=>e.then((e=>({status:"fulfilled",value:e}))).catch((e=>({status:"rejected",reason:e})))))));const x=Object.freeze({ACCOUNT:1,APP:2,BUNDLE:3,STORE_DEFAULT:4,FUNDS:5,REGISTER_KEY:6,SALE:7,SEARCH:8,STATS:9,STORE_FRONT:10,SUB:11,WISHLIST:12,AGECHECK:13,COMMUNITY_DEFAULT:14,WORKSHOP:15,PROFILE_ACTIVITY:16,GAMES:17,PROFILE_EDIT:18,BADGES:19,GAME_CARD:20,FRIENDS_THAT_PLAY:21,FRIENDS:22,MARKET_SEARCH:23,INVENTORY:24,MARKET_LISTING:25,MARKET_HOME:26,PROFILE_HOME:27,GROUP_HOME:28,GUIDES:29,COMMUNITY_APP:30,COMMUNITY_STATS:31,MY_WORKSHOP:32,SHARED_FILES:33,WORKSHOP_BROWSE:34,EDIT_GUIDE:35,RECOMMENDED:36,BOOSTER_CREATOR:37,TRADE_OFFER:38,FRIENDS_AND_GROUPS:39,POINTS_SHOP:40});class I{static clear(){return $.action("dynamicstore.clear")}static async getAppStatus(e){const t=Array.isArray(e);let s,r,n;t?(r=e.map((e=>S.trimStoreId(e))),s=$.action("dynamicstorestatus",r)):s=$.action("dynamicstorestatus",S.trimStoreId(e));const a=await s;if(t){n={};for(let t=0;t<e.length;++t){const s=r[t],i=e[t];n[i]={ignored:a[s].includes("ignored"),wishlisted:a[s].includes("wishlisted")},i.startsWith("app/")?n[i].owned=a[s].includes("ownedApps"):i.startsWith("sub/")&&(n[i].owned=a[s].includes("ownedPackages"))}}else n={ignored:a.includes("ignored"),wishlisted:a.includes("wishlisted")},e.startsWith("app/")?n.owned=a.includes("ownedApps"):e.startsWith("sub/")&&(n.owned=a.includes("ownedPackages"));return n}static async getRandomApp(){return await I._fetch(),$.action("dynamicStore.randomApp")}static _fetch(){return L.isSignedIn?Promise.resolve(null):I.clear()}static then(e,t){return I._promise||(I._promise=I._fetch()),I._promise.then(e,t)}}class T{static getCoupon(e){return $.action("coupon",e)}static async getAppStatus(e,t){function s(e,t){return{gift:e.includes("gifts"),guestPass:e.includes("passes"),coupon:Boolean(t)}}const r={giftsAndPasses:!0,coupons:!0,...t};if(!r.giftsAndPasses&&!r.coupons)return null;const n=Array.isArray(e);try{const[t,a]=await Promise.all([r.giftsAndPasses?$.action("hasgiftsandpasses",e):Promise.resolve(),r.coupons?$.action("hascoupon",e):Promise.resolve()]);if(n){const r={};for(const n of e)r[n]=s(t?t[n]:[],!!a&&a[n]);return r}return s(t||[],void 0!==a&&a)}catch(t){if(n){const t={};for(const r of e)t[r]=s([],!1);return t}return s([],!1)}}static hasInMarketInventory(e){return $.action("hasitem",e)}}class q{constructor(e){this.context=e}checkPrerequisites(){return!0}apply(){throw new Error("Stub")}logError(e,t,...s){console.group(this.constructor.name),console.error(t,...s),console.error(e),console.groupEnd()}}class O extends q{apply(){this.context.registerCallback(((...e)=>{this.callback(...e)})),"function"==typeof this.setup&&this.setup()}}(class{static init(){this._activeDropLists={},this._lastSelectHideTime=0,document.addEventListener("mousedown",(e=>{for(const t of Object.keys(this._activeDropLists))this._activeDropLists[t]&&!e.target.closest(`#${t}_container`)&&this._hide(t)}))}static _highlightItem(e,t,s){const r=document.querySelector(`#${e}_droplist`),n=document.querySelector(`#${e}_trigger`),i=r.getElementsByTagName("a");if(t>=0&&t<i.length){const o=i[t];void 0!==n.highlightedItem&&n.highlightedItem!==t&&(i[n.highlightedItem].className="inactive_selection"),n.highlightedItem=t,i[t].className="highlighted_selection";let c=i[t].offsetTop+i[t].clientHeight,l=r.scrollTop+r.clientHeight,d=!1;const u=i.length;let g=0;for(;l<c&&g++<u;)r.scrollTop+=i[t].clientHeight,l=r.scrollTop+r.clientHeight,d=!0;if(!d)for(g=0,c=i[t].offsetTop,l=r.scrollTop;l>c&&g++<u;)r.scrollTop-=i[t].clientHeight,l=r.scrollTop;if(s){a.inner(n,o.innerHTML);const t=document.querySelector(`#${e}`);t.value=o.id,t.dispatchEvent(new Event("change")),this._hide(e)}}}static _onFocus(e){this._activeDropLists[e]=!0}static _onBlur(e){document.querySelector(`#${e}_trigger`).classList.contains("activetrigger")||(this._activeDropLists[e]=!1)}static _hide(e){const t=document.querySelector(`#${e}_droplist`),s=document.querySelector(`#${e}_trigger`);this._lastSelectHideTime=Date.now(),s.className="trigger",t.className="dropdownhidden",this._activeDropLists[e]=!1,s.focus()}static _show(e){if(Date.now()-this._lastSelectHideTime<50)return;const t=document.querySelector(`#${e}_droplist`),s=document.querySelector(`#${e}_trigger`);s.className="activetrigger",t.className="dropdownvisible",this._activeDropLists[e]=!0,s.focus()}static _onTriggerClick(e){document.querySelector(`#${e}_trigger`).classList.contains("activetrigger")||this._show(e)}static get(e,t,s,r,n){const i=`sort_by_${e}`;let o=s.endsWith("_DESC");const c=a.element(`<div class="es-sortbox es-sortbox--${e}">\n                <div class="es-sortbox__label">${f.str.sort_by}</div>\n                <div id="${i}_container" class="es-sortbox__container">\n                    <input id="${i}" type="hidden" name="${e}" value="${s}">\n                    <a id="${i}_trigger" class="trigger"></a>\n                    <div class="es-dropdown">\n                        <ul id="${i}_droplist" class="dropdownhidden"></ul>\n                    </div>\n                </div>\n                <span class="es-sortbox__reverse">${o?"↑":"↓"}</span>\n            </div>`),l=c.querySelector(`#${i}`);function d(e){return e.replace(/(_ASC|_DESC)$/,"")}function u(e,t){const s=d(e);r(s,t),n&&m.set(n,`${s}_${t?"DESC":"ASC"}`)}l.addEventListener("change",(()=>{u(l.value.replace(`${i}_`,""),o)})),"default_ASC"!==s&&l.dispatchEvent(new Event("change"));const g=c.querySelector(".es-sortbox__reverse");g.addEventListener("click",(()=>{o=!o,g.textContent=o?"↑":"↓",u(l.value.replace(`${i}_`,""),o)}));const h=c.querySelector(`#${i}_trigger`);h.addEventListener("focus",(()=>this._onFocus(i))),h.addEventListener("blur",(()=>this._onBlur(i))),h.addEventListener("click",(()=>this._onTriggerClick(i)));const _=c.querySelector("ul"),p=d(s);for(let e=0;e<t.length;++e){const[s,r]=t[e];let n="inactive";s===p&&(l.value=s,h.textContent=r,n="highlighted"),a.beforeEnd(_,`<li>\n                    <a class="${n}_selection" tabindex="99999" id="${i}_${s}">${r}</a>\n                </li>`);const o=_.querySelector("li:last-child > a");o.addEventListener("mouseover",(()=>this._highlightItem(i,e,!1))),o.addEventListener("click",(()=>this._highlightItem(i,e,!0)))}return c}}).init();class P{static wrap(e,t){const s=t.parentNode;s.insertBefore(e,t),s.removeChild(t),e.append(t)}static remove(e){const t=document.querySelector(e);t&&t.remove()}static selectLastNode(e,t){const s=e.querySelectorAll(t);return 0===s.length?null:s[s.length-1]}static insertStylesheet(e){const t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=e,document.head.appendChild(t)}static insertScript({src:e,content:t},s,r,n=!0){const a=document.createElement("script");r&&(a.onload=r),s&&(a.id=s),e&&(a.src=e),t&&(a.textContent=t),n&&a.setAttribute("async",""),document.head.appendChild(a)}static insertCSS(e,t){const s=document.createElement("style");t&&(s.id=t),s.textContent=e,document.head.appendChild(s)}}class D{static create(e,t,s){let r=0;e.addEventListener("wheel",(e=>{e.preventDefault(),e.stopPropagation(),Date.now()-r<200||(r=Date.now(),e.deltaY>0?s.click():t.click())}))}}const N="https://augmentedsteam.com";class R{static _addMenu(){a.afterBegin("#global_action_menu",`<div id="es_menu">\n                <span id="es_pulldown" class="pulldown global_action_link">Augmented Steam</span>\n                <div id="es_popup" class="popup_block_new">\n                    <div class="popup_body popup_menu">\n                        <a class="popup_menu_item" target="_blank" href="${h.getURL("html/options.html")}">${f.str.thewordoptions}</a>\n                        <a class="popup_menu_item" id="es_clear_cache" href="#clear_cache">${f.str.clear_cache}</a>\n                        <div class="hr"></div>\n                        <a class="popup_menu_item" target="_blank" href="https://github.com/IsThereAnyDeal/AugmentedSteam">${f.str.contribute}</a>\n                        <a class="popup_menu_item" target="_blank" href="https://github.com/IsThereAnyDeal/AugmentedSteam/issues">${f.str.bug_feature}</a>\n                        <div class="hr"></div>\n                        <a class="popup_menu_item" target="_blank" href="${N}">${f.str.website}</a>\n                        <a class="popup_menu_item" target="_blank" href="https://isthereanydeal.com/">IsThereAnyDeal</a>\n                        <a class="popup_menu_item" target="_blank" href="https://discord.gg/yn57q7f">Discord</a>\n                    </div>\n                </div>\n            </div>`),document.querySelector("#es_pulldown").addEventListener("click",(()=>{G.runInPageContext((()=>{window.SteamFacade.showMenu("es_pulldown","es_popup","right","bottom",!0)}))})),document.querySelector("#es_menu").addEventListener("click",(e=>{e.stopPropagation()})),document.querySelector("#es_popup").addEventListener("click",(()=>{G.runInPageContext((()=>{window.SteamFacade.hideMenu("es_pulldown","es_popup")}))})),document.querySelector("#es_clear_cache").addEventListener("click",(async e=>{e.preventDefault(),await R.clearCache(),window.location.reload()}))}static _addBackToTop(){if(!m.get("show_backtotop"))return;P.remove("#BackToTop");const e=document.createElement("div");e.classList.add("es_btt"),e.textContent="▲",document.body.append(e),e.addEventListener("click",(()=>{window.scroll({top:0,left:0,behavior:"smooth"})})),window.addEventListener("scroll",(()=>{e.classList.toggle("is-visible",window.scrollY>=400)}))}static _bindLogout(){document.querySelector("a[href$='javascript:Logout();']").addEventListener("click",(()=>{R.clearCache()}))}static _addWarning(e,t){const s=a.element(`<div class="es_warn js-warn">\n                <div class="es_warn__cnt">\n                    <div>${e}</div>\n                    <div class="es_warn__control">\n                        <a class="es_warn__btn js-warn-close">${f.str.update.dont_show}</a>\n                        <a class="es_warn__btn js-warn-hide">${f.str.hide}</a>\n                    </div>\n                </div>\n            </div>`);s.querySelector(".js-warn-close").addEventListener("click",(()=>{t&&t(),s.closest(".js-warn").remove()})),s.querySelector(".js-warn-hide").addEventListener("click",(()=>{s.closest(".js-warn").remove()})),document.getElementById("global_header").insertAdjacentElement("afterend",s)}static _addLanguageWarning(){if(!m.get("showlanguagewarning"))return;const e=u.getCurrentSteamLanguage();if(!e)return;m.has("showlanguagewarninglanguage")||m.set("showlanguagewarninglanguage",e);const t=m.get("showlanguagewarninglanguage");e!==t&&f.loadLocalization(u.getLanguageCode(t)).then((s=>{R._addWarning(`${s.using_language.replace("__current__",s.options.lang[e]||e)}\n                <a href="#" id="es_reset_language_code">\n                ${s.using_language_return.replace("__base__",s.options.lang[t]||t)}\n                </a>`,(()=>{m.set("showlanguagewarning",!1)})),document.querySelector("#es_reset_language_code").addEventListener("click",(e=>{e.preventDefault(),G.runInPageContext((e=>{ChangeLanguage(e)}),[t])}))}))}static _handleInstallSteamButton(){const e=m.get("installsteam");if("hide"===e)P.remove("div.header_installsteam_btn");else if("replace"===e){const e=document.querySelector("div.header_installsteam_btn > a");e.textContent=f.str.viewinclient,e.href=`steam://openurl/${window.location.href}`,e.classList.add("es_steamclient_btn")}}static _addUsernameSubmenuLinks(){for(const e of document.querySelectorAll(".submenu_username"))a.afterEnd(e.querySelector("a"),`<a class="submenuitem" href="//steamcommunity.com/my/games/">${f.str.games}</a>`),a.afterEnd(e.querySelector("a:nth-child(2)"),`<a class="submenuitem" href="//store.steampowered.com/wishlist/">${f.str.wishlist}</a>`),a.beforeEnd(e,`<a class="submenuitem" href="//steamcommunity.com/my/recommended/">${f.str.reviews}</a>`)}static _cartLink(){for(const e of document.querySelectorAll(".submenu_store > .submenuitem[href='https://steamcommunity.com/my/wishlist/']"))a.afterEnd(e,`<a class="submenuitem" href="https://store.steampowered.com/cart/">${f.str.cart}</a>`)}static _disableLinkFilter(){function e(e=document){for(const t of e.querySelectorAll("a[href*='/linkfilter/']"))t.href=new URLSearchParams(t.search).get("url")}m.get("disablelinkfilter")&&(e(),new MutationObserver((t=>{for(const s of t)for(const t of s.addedNodes)t.nodeType===Node.ELEMENT_NODE&&e(t)})).observe(document,{childList:!0,subtree:!0}))}static _addRedeemLink(){a.beforeBegin("#account_language_pulldown",`<a class="popup_menu_item" href="https://store.steampowered.com/account/registerkey">${f.str.activate}</a>`)}static _replaceAccountName(){if(!m.get("replaceaccountname"))return;const e=document.querySelector("#account_dropdown .persona.online"),t=e.textContent.trim(),s=document.querySelector("#account_pulldown").textContent.trim();if(e.textContent=s,location.href.startsWith("https://store.steampowered.com/account")){const e=document.querySelector("h2.pageheader");e&&(e.textContent=e.textContent.replace(new RegExp(t,"i"),s))}/.*(id|profiles)\/.+/g.test(location.pathname)&&!location.pathname.includes(L.profilePath)||(document.title=document.title.replace(t,s))}static _launchRandomButton(){a.beforeEnd("#es_popup .popup_menu",`<div class="hr"></div>\n             <a id="es_random_game" class="popup_menu_item" style="cursor: pointer;">${f.str.launch_random}</a>`),document.querySelector("#es_random_game").addEventListener("click",(async()=>{const e=await I.getRandomApp();e&&$.action("appdetails",e).then((t=>{if(!t||!t.success)return;const s=t.data;let r,n=e;s.fullgame?(n=s.fullgame.appid,r=s.fullgame.name):r=s.name,G.runInPageContext(((e,t,s)=>{window.SteamFacade.showConfirmDialog(e,`<img src="//steamcdn-a.akamaihd.net/steam/apps/${t}/header.jpg">`,null,null,s).done((e=>{"OK"===e&&window.location.assign(`steam://run/${t}`),"SECONDARY"===e&&window.location.assign(`//store.steampowered.com/app/${t}`)}))}),[f.str.play_game.replace("__gamename__",r.replace("'","").trim()),n,f.str.visit_store])}))}))}static _skipGotSteam(){m.get("skip_got_steam")&&G.runInPageContext((()=>{window.ShowGotSteamModal=function(e){window.location.assign(e)}}))}static _keepSteamSubscriberAgreementState(){const e=document.querySelectorAll("#market_sell_dialog_accept_ssa,#market_buyorder_dialog_accept_ssa,#accept_ssa");for(const t of e)t.checked=m.get("keepssachecked"),t.addEventListener("click",(()=>{m.set("keepssachecked",!m.get("keepssachecked"))}))}static _defaultCommunityTab(){const e=m.get("community_default_tab");if(!e)return;const t=document.querySelectorAll("a[href^='https://steamcommunity.com/app/']");for(const s of t)s.classList.contains("apphub_sectionTab")||/^\/app\/[0-9]+\/?$/.test(s.pathname)&&(s.pathname.endsWith("/")||(s.pathname+="/"),s.pathname+=`${e}/`)}static _horizontalScrolling(){if(m.get("horizontalscrolling"))for(const e of document.querySelectorAll(".slider_ctn:not(.spotlight)"))D.create(e.parentNode.querySelector("#highlight_strip, .store_horizontal_autoslider_ctn"),e.querySelector(".slider_left"),e.querySelector(".slider_right"))}static addLoginWarning(e){if(R._loginWarningAdded||w.get(`hide_login_warn_${e}`))return;let t;if("store"===e)t="store.steampowered.com";else{if("community"!==e)return void console.warn("Unknown login warning type %s",e);t="steamcommunity.com"}R._addWarning(`${f.str.login_warning.replace("__link__",`<a href="https://${t}/login/">${t}</a>`)}`,(()=>{w.set(`hide_login_warn_${e}`,!0)})),R._loginWarningAdded=!0,console.warn("Are you logged into %s?",t)}static clearCache(){return $.action("cache.clear")}static init(){R._addBackToTop(),R._addMenu(),R._addLanguageWarning(),R._handleInstallSteamButton(),R._disableLinkFilter(),R._skipGotSteam(),R._keepSteamSubscriberAgreementState(),R._defaultCommunityTab(),R._horizontalScrolling(),R._cartLink(),L.isSignedIn&&(R._addUsernameSubmenuLinks(),R._addRedeemLink(),R._replaceAccountName(),R._launchRandomButton(),R._bindLogout())}}class M{static escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}}class j{constructor({id:e,abbr:t="USD",symbol:s="$",hint:r="Default Currency",multiplier:n=100,unit:a=1,format:{places:i=2,hidePlacesWhenZero:o=!1,symbolFormat:c="$",thousand:l=",",group:d=3,decimal:u=".",right:g=!1}}){Object.assign(this,{id:e,abbr:t,symbol:s,hint:r,multiplier:n,unit:a,format:{decimalPlaces:i,hidePlacesWhenZero:o,symbol:c,groupSeparator:l,groupSize:d,decimalSeparator:u,postfix:g}}),Object.freeze(this.format),Object.freeze(this)}valueOf(e){let t=e.trim().replace(this.format.groupSeparator,"");"."!==this.format.decimalSeparator&&(t=t.replace(this.format.decimalSeparator,".")),t=t.replace(/[^\d.]/g,"");const s=parseFloat(t);return Number.isNaN(s)?null:s}stringify(e,t=!0){const s=e<0?"-":"";let r,n=Math.abs(e).toFixed(this.format.decimalPlaces);[n,r]=n.split(".");const a=[];let i=n.length;for(;i>this.format.groupSize;i-=this.format.groupSize)a.unshift(n.substring(i-this.format.groupSize,i));return a.unshift(n.substring(0,i)),n=[s,a.join(this.format.groupSeparator)],this.format.decimalPlaces>0&&(!this.format.hidePlacesWhenZero||parseInt(r)>0)&&(n.push(this.format.decimalSeparator),n.push(r)),t&&(this.format.postfix?n.push(this.format.symbol):n.unshift(this.format.symbol)),n.join("")}placeholder(){let e=`1${this.format.groupSeparator}`,t=2;for(let s=0;s<this.format.groupSize;++s,++t)e+=t;if(0===this.format.decimalPlaces)return e;e+=this.format.decimalSeparator;for(let s=0;s<this.format.decimalPlaces;++s,++t)e+=t;return e}regExp(){let e=`^(?:\\d{1,${this.format.groupSize}}(?:${M.escapeRegExp(this.format.groupSeparator)}\\d{${this.format.groupSize}})+|\\d*)`;return this.format.decimalPlaces>0&&(e+=`(?:${M.escapeRegExp(this.format.decimalSeparator)}\\d{0,${this.format.decimalPlaces}})?`),e+="$",new RegExp(e)}}class F{static _getCurrencyFromDom(){const e=document.querySelector('meta[itemprop="priceCurrency"]');return e&&e.hasAttribute("content")?e.getAttribute("content"):null}static async _getCurrencyFromWallet(){const e=await G.runInPageContext((()=>"undefined"!=typeof g_rgWalletInfo&&g_rgWalletInfo?g_rgWalletInfo.wallet_currency:null),null,"walletCurrency");return e?F.currencyNumberToType(e):null}static async _getStoreCurrency(e){let t=F._getCurrencyFromDom();if(t||(t=await F._getCurrencyFromWallet(e)),!t)try{t=await $.action("currency")}catch(e){console.error(`Couldn't load currency${e}`)}return t||(t="USD"),t}static getRate(e,t){return e===t?1:F._rates[e]&&F._rates[e][t]?F._rates[e][t]:null}static getCurrencySymbolFromString(e){const t=e.match(/(?:R\$|S\$|\$|RM|kr|Rp|€|¥|£|฿|pуб|P|₫|₩|TL|₴|Mex\$|CDN\$|A\$|HK\$|NT\$|₹|SR|R |DH|CHF|CLP\$|S\/\.|COL\$|NZ\$|ARS\$|₡|₪|₸|KD|zł|QR|\$U)/);return t?t[0]:""}static currencyTypeToNumber(e){return F.fromType(e).id}static currencyNumberToType(e){return F.fromNumber(e).abbr}static fromType(e){return F._indices.abbr[e]||F._defaultCurrency}static fromNumber(e){return F._indices.id[e]||F._defaultCurrency}static async _loadCurrency(e){F.storeCurrency=await F._getStoreCurrency(e);const t=m.get("override_price");F.customCurrency="auto"===t?F.storeCurrency:t}static async _loadRates(){const e=[F.storeCurrency];F.customCurrency!==F.storeCurrency&&e.push(F.customCurrency),F._rates=await $.action("rates",e)}static async init(e){if(F._isInitialized)return;const t=await $.action("steam.currencies");for(let e of t)e=new j(e),F._indices.abbr[e.abbr]=e,F._indices.id[e.id]=e,e.symbol&&(F._indices.symbols[e.symbol]=e);F._defaultCurrency=F._indices.id[1];try{await F._loadCurrency(e),await F._loadRates()}catch(e){console.error("Failed to initialize Currency"),console.error(e)}F._isInitialized=!0}static then(e,t){return F.init().then(e,t)}}F._isInitialized=!1,F._indices={id:{},abbr:{},symbols:{}};class B{static async create(){await $.action("itad.isconnected")&&(a.afterBegin("#global_action_menu",`<div id="es_itad">\n                <img id="es_itad_logo" src="${h.getURL("img/itad.png")}">\n                <span id="es_itad_status">✓</span>\n            </div>`),document.querySelector("#es_itad").addEventListener("mouseenter",B.onHover),L.isSignedIn&&(m.get("itad_import_library")||m.get("itad_import_wishlist"))&&$.action("itad.import"))}static async onHover(){async function e(){const{from:e,to:t}=await $.action("itad.lastimport");let s=`<div>${f.str.itad.from}</div>\n                   <div>${e?new Date(1e3*e).toLocaleString():f.str.never}</div>`;(m.get("itad_import_library")||m.get("itad_import_wishlist"))&&(s+=`<div>${f.str.itad.to}</div>\n                        <div>${t?new Date(1e3*t).toLocaleString():f.str.never}</div>`),a.inner(".es-itad-hover__last-import",s)}if(!document.querySelector(".es-itad-hover")){a.afterEnd("#es_itad_status",`<div class="es-itad-hover">\n                    <div class="es-itad-hover__content">\n                        <h4>${f.str.itad.last_import}</h4>\n                        <div class="es-itad-hover__last-import"></div>\n                        <div class="es-itad-hover__sync-now">\n                            <span class="es-itad-hover__sync-now-text">${f.str.itad.sync_now}</span>\n                            <div class="loader"></div>\n                            <span class="es-itad-hover__sync-failed">&#10060;</span>\n                            <span class="es-itad-hover__sync-success">&#10003;</span>\n                        </div>\n                    </div>\n                    <div class="es-itad-hover__arrow"></div>\n                </div>`);const t=document.querySelector(".es-itad-hover"),s=document.querySelector(".es-itad-hover__sync-now");document.querySelector(".es-itad-hover__sync-now-text").addEventListener("click",(async()=>{let r;s.classList.remove("es-itad-hover__sync-now--failed","es-itad-hover__sync-now--success"),s.classList.add("es-itad-hover__sync-now--loading"),t.style.display="block";try{await $.action("itad.sync"),s.classList.add("es-itad-hover__sync-now--success"),await e(),r=1e3}catch(e){s.classList.add("es-itad-hover__sync-now--failed"),console.group("ITAD sync"),console.error("Failed to sync with ITAD"),console.error(e),console.groupEnd(),r=3e3}finally{b.timer(r).then((()=>{t.style.display=""})),s.classList.remove("es-itad-hover__sync-now--loading")}}))}await e()}static async getAppStatus(e,t){const s={waitlist:!0,collection:!0,...t};if(!s.collection&&!s.waitlist)return null;const r=Array.isArray(e),n=[],a=Promise.resolve(!!r&&{});await $.action("itad.isconnected")?(s.collection?n.push($.action("itad.incollection",e)):n.push(a),s.waitlist?n.push($.action("itad.inwaitlist",e)):n.push(a)):n.push(a,a);const[i,o]=await Promise.all(n);if(r){const t={};for(const s of e)t[s]={collected:i[s],waitlisted:o[s]};return t}return{collected:i,waitlisted:o}}}class z{static postMessage(e,t){window.postMessage({type:`es_${e}`,information:t},window.location.origin)}static onMessage(e){return new Promise((t=>{window.addEventListener("message",(function s(r){r.source===window&&r.data&&r.data.type&&r.data.type===`es_${e}`&&(t(r.data.information),window.removeEventListener("message",s))}))}))}static addMessageListener(e,t){window.addEventListener("message",(s=>{s.source===window&&s.data&&s.data.type&&s.data.type===`es_${e}`&&t(s.data.information)}))}}class H{constructor(e=0,t=F.storeCurrency){this.value=e,this.currency=t,Object.freeze(this)}formattedValue(){return F.fromType(this.currency).stringify(this.value,!1)}toString(){return F.fromType(this.currency).stringify(this.value)}add(e){let t=e;return e.currency!==this.currency&&(t=e.inCurrency(this.currency)),new H(this.value+t.value,this.currency)}inCurrency(e){if(this.currency===e)return new H(this.value,this.currency);const t=F.getRate(this.currency,e);if(!t)throw new Error(`Could not establish conversion rate between ${this.currency} and ${e}`);return new H(this.value*t,e)}static parseFromString(e,t=F.storeCurrency){let s=F.fromType(t).valueOf(e);return null!==s&&(s=new H(s,t)),s}}class W{constructor(){this.appids=[],this.subids=[],this.bundleids=[],this.priceCallback=null,this.bundleCallback=null,this._bundles=[]}_getApiParams(){const e={};!m.get("showallstores")&&m.get("stores").length>0&&(e.stores=m.get("stores").join(","));const t=L.storeCountry;return t&&(e.cc=t),e.appids=this.appids.join(","),e.subids=this.subids.join(","),e.bundleids=this.bundleids.join(","),m.get("showlowestpricecoupon")&&(e.coupon=!0),e.appids||e.subids||e.bundleids?e:null}_getPricingStrings(e,t,s){let r=t.toString();F.customCurrency!==F.storeCurrency&&(r+=` (${t.inCurrency(F.storeCurrency).toString()})`);const n=`<span class="itad-pricing__price">${r}</span>`;let a="";return e.cut>0&&(a=`<span class="itad-pricing__cut">-${e.cut}%</span> `),[n,a,s.store.replace("__store__",e.store)]}_processPrices(e,t,s){if(!this.priceCallback)return;const[r,n]=e.split("/"),i=document.createElement("div");i.classList.add("itad-pricing"),i.id=`es_price_${n}`;const o=f.str.pricing;let c=!1;const l=s.price,d=s.lowest,u=s.bundles.count,g=s.urls;if(l){let e;c=!0;let s="";if(m.get("showlowestpricecoupon")&&l.price_voucher){e=new H(l.price_voucher,t.currency);const r=a.escape(l.voucher);s=`${o.with_voucher.replace("__voucher__",`<span class="itad-pricing__voucher">${r}</span>`)} `}else e=new H(l.price,t.currency);e=e.inCurrency(F.customCurrency);const[r,n,d]=this._getPricingStrings(l,e,o);let u="";l.drm.length>0&&"Steam"!==l.store&&(u=`<span class="itad-pricing__drm">(${l.drm[0]})</span>`);const h=a.escape(g.info),_=a.escape(l.url.toString());a.beforeEnd(i,`<a href="${h}" target="_blank">${o.lowest_price}</a>`),a.beforeEnd(i,r),a.beforeEnd(i,`<a href="${_}" class="itad-pricing__main" target="_blank">${n}${s}${d} ${u}</a>`)}if(d){c=!0;const e=new H(d.price,t.currency).inCurrency(F.customCurrency),[s,r,n]=this._getPricingStrings(d,e,o),l=new Date(1e3*d.recorded).toLocaleDateString(),u=a.escape(g.history);a.beforeEnd(i,`<a href="${u}" target="_blank">${o.historical_low}</a>`),a.beforeEnd(i,s),a.beforeEnd(i,`<div class="itad-pricing__main">${r}${n} ${l}</div>`)}if(u>0){c=!0;const e=a.escape(g.bundles||g.bundle_history),t=o.bundle_count.replace("__count__",u);a.beforeEnd(i,`<a href="${e}" target="_blank">${o.bundled}</a>`),a.beforeEnd(i,`<div class="itad-pricing__bundled">${t}</div>`)}c&&this.priceCallback(r,n,i)}_processBundles(e,t){if(!this.bundleCallback)return;let s="";for(const r of t.bundles.live){const t=r.tiers;let n;r.expiry&&(n=new Date(1e3*r.expiry));const a=(new Date).getTime();if(n&&a>n)continue;const i=JSON.stringify({page:r.page||"",title:r.title||"",url:r.url||"",tiers:(()=>{const e=[];for(const s of Object.keys(t))e.push((t[s].games||[]).sort());return e})()});if(this._bundles.indexOf(i)>=0)continue;let o;this._bundles.push(i),r.page?s+=`<div class="game_area_purchase_game">\n                            <div class="game_area_purchase_platform"></div>\n                            <h1>${f.str.buy_package.replace("__package__",`${r.page} ${r.title}`)}</h1>`:s+=`<div class="game_area_purchase_game_wrapper">\n                            <div class="game_area_purchase_game"></div>\n                            <div class="game_area_purchase_platform"></div>\n                            <h1>${f.str.buy_package.replace("__package__",r.title)}</h1>`,n&&(s+=`<p class="game_purchase_discount_countdown">${f.str.bundle.offer_ends} ${n}</p>`),s+='<p class="package_contents">';const c=document.querySelector(".apphub_AppName").textContent;for(let r=0;r<t.length;++r){const n=r+1,a=t[r];if(s+="<b>",t.length>1){const t=a.note||f.str.bundle.tier.replace("__num__",n),r=new H(a.price,e.currency).inCurrency(F.customCurrency).toString();s+=f.str.bundle.tier_includes.replace("__tier__",t).replace("__price__",r).replace("__num__",a.games.length)}else s+=f.str.bundle.includes.replace("__num__",a.games.length);s+=":</b> ";const i=a.games.join(", ");i.includes(c)?(s+=i.replace(c,`<u>${c}</u>`),o=a.price):s+=i,s+="<br>"}s+="</p>",s+=`<div class="game_purchase_action">\n                            <div class="game_purchase_action_bg">\n                                <div class="btn_addtocart btn_packageinfo">\n                                    <a class="btn_blue_steamui btn_medium" href="${r.details}" target="_blank">\n                                        <span>${f.str.bundle.info}</span>\n                                    </a>\n                                </div>\n                            </div>\n                            <div class="game_purchase_action_bg">`,o&&o>0&&(o=new H(o,e.currency).inCurrency(F.customCurrency).toString(),s+=`<div class="game_purchase_price price" itemprop="price">${o}</div>`),s+=`<div class="btn_addtocart">\n                            <a class="btn_green_steamui btn_medium" href="${r.url}" target="_blank">\n                                <span>${f.str.buy}</span>\n                            </a>\n                        </div></div></div></div>`}s&&this.bundleCallback(s)}load(){const e=this._getApiParams();e&&$.action("prices",e).then((e=>{const t=e[".meta"];for(const[s,r]of Object.entries(e.data))this._processPrices(s,t,r),this._processBundles(t,r)}))}}let U=!1;window.addEventListener("unhandledrejection",(function(e){const t=e.reason;t&&t.error&&(e.preventDefault(),e.stopPropagation(),console.group("An error occurred in the background context."),console.error(t.localStack),console.error(t.stack),console.groupEnd())})),P.insertScript({content:`window.Messenger = ${z.toString()}`}),P.insertScript({content:`window.SteamFacade = ${class{static global(e){return window[e]}static globalSet(e,t){window[e]=t}static showDialog(e,t,s){ShowDialog(e,t,s)}static showConfirmDialog(e,t,s,r,n){return ShowConfirmDialog(e,t,s,r,n)}static showAlertDialog(e,t,s){return ShowAlertDialog(e,t,s)}static showBlockingWaitDialog(e,t){return ShowBlockingWaitDialog(e,t)}static showNicknameModal(){return ShowNicknameModal()}static dismissActiveModal(){CModal.DismissActiveModal()}static showMenu(e,t,s,r,n){return ShowMenu(e,t,s,r,n)}static hideMenu(e,t){return HideMenu(e,t)}static collapseLongStrings(e){return CollapseLongStrings(e)}static adjustVisibleAppTags(e){return AdjustVisibleAppTags($J(e))}static updatePlaytimeFilterValues(e,t){return UpdatePlaytimeFilterValues(e,t)}static bindAutoFlyoutEvents(){return BindAutoFlyoutEvents()}static sliderOnChange(e){return g_player.SliderOnChange(e)}static dynamicStoreInvalidateCache(){return GDynamicStore.InvalidateCache()}static dynamicStoreDecorateItems(e,t){return GDynamicStore.DecorateDynamicItems($J(e),t)}static onDynamicStoreReady(e){return GDynamicStore.OnReady(e)}static storeItemDataBindHover(e,t,s,r,n){GStoreItemData.BindHoverEvents($J(e),t,s,r,n)}static vTooltip(e,t=!1){const s="store.steampowered.com"===window.location.host;$J(e).v_tooltip({tooltipClass:s?"store_tooltip":"community_tooltip",dataName:t?"tooltipHtml":"tooltipText",defaultType:t?"html":"text",replaceExisting:!1})}static calculateFeeAmount(e,t){return CalculateFeeAmount(e,t)}static vCurrencyFormat(e,t){return v_currencyformat(e,t)}static toggleManageFriends(){return ToggleManageFriends()}static openFriendChatInWebChat(e){return OpenFriendChatInWebChat(e)}static submitGuide(){return SubmitGuide()}static initMiniprofileHovers(){return InitMiniprofileHovers()}static inviteUserToGroup(e,t,s){return InviteUserToGroup(e,t,s)}static getCheckedAccounts(e){return GetCheckedAccounts(e)}static execFriendAction(e,t){return ExecFriendAction(e,t)}static scrollOffsetForceRecalc(){CScrollOffsetWatcher.ForceRecalc()}static vSetCookie(e,t,s,r){V_SetCookie(e,t,s,r)}static checkAgeGateSubmit(e){CheckAgeGateSubmit(e)}static loadImageGroupOnScroll(e,t){LoadImageGroupOnScroll(e,t)}static showModalContent(e,t,s,r){ShowModalContent(e,t,s,r)}static firstPage(){return InventoryFirstPage()}static lastPage(){return InventoryLastPage()}static goToPage(){return InventoryGoToPage()}static reloadCommunityInventory(){return ReloadCommunityInventory()}static getMarketHashName(e){return GetMarketHashName(e)}static zoomYear(){pricehistory_zoomDays(g_plotPriceHistory,g_timePriceHistoryEarliest,g_timePriceHistoryLatest,365)}static zoomYearForSellDialog(){pricehistory_zoomDays(SellItemDialog.m_plotPriceHistory,SellItemDialog.m_timePriceHistoryEarliest,SellItemDialog.m_timePriceHistoryLatest,365)}static updateSelection(){return UpdateSelection()}static selectAll(){return SelectAll()}static selectNone(){return SelectNone()}static selectInverse(){return SelectInverse()}static jq(e){return $J(e)}static jqOnClick(e,t){$J(e).on("click",t)}static jqAjax(e){return $J.ajax(e)}static jqGet(e,t){return $J.get(e,t)}static jqPost(e,t){return $J.post(e,t)}static jqTrigger(e,t){return $J(e).trigger(t)}}.toString()}`}),$.registerErrorHandler((({name:e,msg:t})=>"LoginError"===e&&(R.addLoginWarning(t),k.finishRequest(),!0)));class G{static runInPageContext(e,t,s){const r=document.createElement("script");let n;const a=Array.isArray(t)?JSON.stringify(t):"[]";if(s){const t="msg_"+ ++G._msgCounter;n=z.onMessage(t),r.textContent=`(async () => { Messenger.postMessage("${t}", await (${e})(...${a})); })();`}else r.textContent=`(${e})(...${a});`;return document.documentElement.appendChild(r),r.parentNode.removeChild(r),n}async run(e){if(document.getElementById("global_header")){try{try{await m,function(){if(U)return;U=!0;const e={ALLOWED_URI_REGEXP:/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|chrome-extension|moz-extension|steam):|[^a-z]|[a-z+.-]+(?:[^a-z+.\-:]|$))/i};m.get("openinnewtab")&&(e.ADD_ATTR=["target"],DOMPurify.addHook("uponSanitizeAttribute",((e,t)=>{"target"===t.attrName&&("_blank"===t.attrValue?e.setAttribute("rel","noreferrer noopener"):t.keepAttr=!1)}))),DOMPurify.setConfig(e)}()}catch(e){console.error(e)}await Promise.all([w,f,L,F])}catch(e){return console.group("Augmented Steam initialization"),console.error("Failed to initiliaze Augmented Steam"),console.error(e),void console.groupEnd()}console.log(`%c Augmented %cSteam v${p.version} %c ${N}`,"background: #000000; color: #046eb2","background: #000000; color: #ffffff",""),k.create(),k.loading(),R.init(),class{static async checkVersion(e){const t=C.fromString(m.get("version"));if(C.fromString(p.version).isAfter(t)){let s=Promise.resolve();m.get("version_show")&&(s=this._showChangelog().catch((e=>{console.error("Failed to show changelog: %o",e)}))),await Promise.all([s,this._migrateSettings(t),e()])}m.set("version",p.version)}static async _showChangelog(){const e=(await h.getJSON("changelog.json"))[p.version];if(!e)throw new Error(`Can't find changelog for version ${p.version}`);const t=`<div class="es_changelog"><img src="${h.getURL("img/logo/as128.png")}"><div>${e}<p><a href="https://github.com/IsThereAnyDeal/AugmentedSteam/compare/v${m.get("version")}...v${p.version}">All changes on GitHub</a></p></div></div>`,s=document.querySelector("#itad_connect");function r(){s.replaceWith("✓")}G.runInPageContext(((e,t)=>{window.SteamFacade.showAlertDialog(e,t)}),[f.str.update.updated.replace("__version__",p.version),t]),C.fromString(p.version).isSame(new C(1,4))&&(await g.action("itad.isconnected")?r():s.addEventListener("click",(async()=>{await g.action("itad.authorize"),B.create(),r()})))}static _migrateSettings(e){if(e.isSameOrBefore("1.3.1")&&(g.action("cache.clear"),m.set("horizontalscrolling",m.get("horizontalmediascrolling")),m.remove("horizontalmediascrolling")),e.isSameOrBefore("1.4")&&m.remove("show_sysreqcheck"),e.isSame("1.4")&&$.action("migrate.notesToSyncedStorage"),e.isSameOrBefore("1.4.1")&&(m.set("profile_steamid",m.get("profile_permalink")),m.remove("profile_permalink")),e.isSameOrBefore("1.4.3")&&(m.remove("contscroll"),$.action("logout")),e.isSameOrBefore("1.4.7")){const e=w.get("fav_emoticons");Array.isArray(e)&&m.set("fav_emoticons",e)}if(e.isSameOrBefore("2.0.0")&&(m.remove("showfakeccwarning"),m.remove("hideaboutlinks")),e.isSameOrBefore("2.0.1")&&(m.remove("hide_dlcunownedgames"),m.remove("hide_wishlist"),m.remove("hide_cart"),m.remove("hide_notdiscounted"),m.remove("hide_mixed"),m.remove("hide_negative"),m.remove("hide_priceabove"),m.remove("priceabove_value"),m.remove("hide_owned"),m.remove("hide_ignored"),m.remove("highlight_notdiscounted"),m.remove("showallfriendsthatown"),m.has("showusernotes"))){const e=m.get("showusernotes");m.set("user_notes_app",e),m.set("user_notes_wishlist",e),m.remove("showusernotes")}if(e.isSameOrBefore("2.1.0")){m.remove("showcomparelinks");const e=m.get("profile_custom_link");for(const t of e)t.url&&!t.url.includes("[ID]")&&(t.url+="[ID]");m.set("profile_custom_link",e)}e.isSameOrBefore("2.2.1")&&$.action("migrate.cachestorage")}}.checkVersion(R.clearCache),B.create(),this._pageSpecificFeatures(),(new e).applyFeatures()}}_pageSpecificFeatures(){}}G._msgCounter=0;class J extends q{async apply(){return await G.runInPageContext((()=>new Promise((e=>{window.SteamFacade.onDynamicStoreReady((()=>{e()}))}))),null,!0),Promise.all([J.highlightTitle(this.context.appid),J.highlightAndTag()])}static highlightTitle(e){const t=document.querySelector(".apphub_AppName");return t?(t.dataset.dsAppid=e,J.highlightAndTag([t],!1)):null}static async highlightAndTag(e,t=!0,s={}){void 0===J._options&&(J._options={owned:m.get("highlight_owned")||m.get("tag_owned"),wishlisted:m.get("highlight_wishlist")||m.get("tag_wishlist"),ignored:m.get("highlight_notinterested")||m.get("tag_notinterested"),collected:m.get("highlight_collection")||m.get("tag_collection"),waitlisted:m.get("highlight_waitlist")||m.get("tag_waitlist"),gift:m.get("highlight_inv_gift")||m.get("tag_inv_gift"),guestPass:m.get("highlight_inv_guestpass")||m.get("tag_inv_guestpass"),coupon:m.get("highlight_coupon")||m.get("tag_coupon")});const r={...this._options,...s};if(!Object.values(r).some((e=>e)))return;const n=e||document.querySelectorAll(this._selector);if(0===n.length)return;const a=new Map;for(const e of n){let s=e;e.classList.contains("item")?s=e.querySelector(".info"):e.classList.contains("home_area_spotlight")?s=e.querySelector(".spotlight_content"):e.parentNode.classList.contains("steam_curator_recommendation")&&e.parentNode.classList.contains("big")?s=e.nextElementSibling:e.parentNode.parentNode.classList.contains("curations")?s=e.parentNode:(e.classList.contains("special_img_ctn")&&e.parentElement.classList.contains("special")||e.classList.contains("blotter_userstats_game"))&&(s=e.parentElement);const n=e.querySelector("a"),i=S.getAppid(e)||S.getAppid(n)||S.getAppidFromId(e.id),o=S.getSubid(e)||S.getSubid(n),c=S.getBundleid(e)||S.getBundleid(n);let l;if(i?l=`app/${i}`:c?l=`bundle/${c}`:o&&(l=`sub/${o}`),l&&(a.has(l)?a.get(l).push(s):a.set(l,[s])),t)try{r.owned&&null!==e.querySelector(".ds_owned_flag")&&this.highlightOwned(s),r.wishlisted&&null!==e.querySelector(".ds_wishlist_flag")&&this.highlightWishlist(s),r.ignored&&null!==e.querySelector(".ds_ignored_flag")&&this.highlightIgnored(s)}catch(e){console.error("Failed to highlight / tag node",e)}}const i=Array.from(a.keys());if(0===i.length)return;const o=i.map((e=>S.trimStoreId(e))),c=!t&&(r.owned||r.wishlisted||r.ignored),[l,d,u]=await Promise.all([c?I.getAppStatus(i):Promise.resolve(),B.getAppStatus(i,{waitlist:r.waitlisted,collection:r.collected}),T.getAppStatus(o,{giftsAndPasses:r.gift||r.guestPass,coupons:r.coupon})]),g=o.values();for(const[e,t]of a){const s=[];if(l&&(r.owned&&l[e].owned&&s.push(this.highlightOwned),r.wishlisted&&l[e].wishlisted&&s.push(this.highlightWishlist),r.ignored&&l[e].ignored&&s.push(this.highlightIgnored)),d&&(d[e].collected&&s.push(this.highlightCollection),d[e].waitlisted&&s.push(this.highlightWaitlist)),u){const e=g.next().value;r.gift&&u[e].gift&&s.push(this.highlightInvGift),r.guestPass&&u[e].guestPass&&s.push(this.highlightInvGuestpass),u[e].coupon&&s.push(this.highlightInvCoupon)}for(let e of s){e=e.bind(this);for(const s of t)try{e(s)}catch(e){console.error("Failed to highlight / tag node",e)}}}}static _addTag(e,t){if(!this._tagCssLoaded){this._tagCssLoaded=!0;const e=[];for(const t of this._types){const s=m.get(`tag_${t}_color`);e.push(`.es_tag_${t} { background-color: ${s}; }`)}P.insertCSS(e.join("\n"))}let s=e.querySelector(".es_tags");s||(s=document.createElement("div"),s.classList.add("es_tags"),m.get("tag_short")&&s.classList.add("es_tags_short"),e.classList.contains("tab_item")?e.querySelector(".tab_item_details").insertAdjacentElement("afterbegin",s):e.classList.contains("newonsteam_headercap")||e.classList.contains("comingsoon_headercap")?e.querySelector(".discount_block").insertAdjacentElement("beforebegin",s):e.classList.contains("search_result_row")?e.querySelector(".search_name > div").insertAdjacentElement("afterbegin",s):e.classList.contains("browse_tag_game")?e.querySelector(".browse_tag_game_price").insertAdjacentElement("afterend",s):e.classList.contains("game_area_dlc_row")?e.querySelector(".game_area_dlc_price").insertAdjacentElement("afterbegin",s):e.classList.contains("wishlist_row")?e.querySelector(".addedon").insertAdjacentElement("afterbegin",s):e.classList.contains("match")?e.querySelector(".match_price").insertAdjacentElement("afterbegin",s):e.classList.contains("recommendation_highlight")?e.querySelector(".highlight_description").insertAdjacentElement("afterbegin",s):e.classList.contains("similar_grid_item")?e.querySelector(".regular_price, .discount_block").append(s):e.classList.contains("recommendation_carousel_item")?e.querySelector(".buttons").insertAdjacentElement("beforebegin",s):e.classList.contains("friendplaytime_game")&&e.querySelector(".friendplaytime_buttons").insertAdjacentElement("beforebegin",s)),s.querySelector(`.es_tag_${t}`)||a.beforeEnd(s,`<span class="es_tag_${t}">${f.str.tag[t]}</span>`)}static _highlightNode(e,t){if(m.get("highlight_excludef2p")){let t=e.querySelector("[data-ds-tagids]")||e.closest("[data-ds-tagids]");if(t&&JSON.parse(t.dataset.dsTagids).includes(113))return;if(t=e.querySelector(".discount_final_price, .regular_price, .search_price, .game_area_dlc_price, .browse_tag_game_price"),t&&/\bFree\b/.test(t.textContent))return}if(e.classList.add("es_highlighted",`es_highlighted_${t}`),!this._highlightCssLoaded){this._highlightCssLoaded=!0;const e=[];for(const t of this._types){const s=m.get(`highlight_${t}_color`);e.push(`.es_highlighted_${t} {\n                        background: ${s} linear-gradient(135deg, rgba(0, 0, 0, 0.70) 10%, rgba(0, 0, 0, 0) 100%) !important;\n                    }\n                    .carousel_items .es_highlighted_${t}.price_inline, .curator_giant_capsule.es_highlighted_${t},\n                    .hero_capsule.es_highlighted_${t}, .blotter_userstatus_game.es_highlighted_${t} {\n                        outline: solid ${s};\n                    }\n                    #search_suggestion_contents .focus.es_highlighted_${t} {\n                        box-shadow: -5px 0 0 ${s};\n                    }\n                    .apphub_AppName.es_highlighted_${t} {\n                        background: none !important; color: ${s};\n                    }`)}P.insertCSS(e.join("\n"))}let s=e;if(s.classList.contains("cluster_capsule")?s=s.querySelector(".main_cap_content").parentNode:s.classList.contains("large_cap")?s=s.querySelector(".large_cap_content"):s.parentNode.classList.contains("steam_curator_recommendation")&&s.parentNode.classList.contains("big")&&(s=s.previousElementSibling),s.classList.contains("single")&&(s=s.querySelector(".gamelink")),s.parentNode.parentNode.classList.contains("apps_recommended_by_curators_v2")){let e=s.querySelectorAll(".ds_flag");e.forEach((e=>e.remove())),e=s.querySelectorAll(".ds_flagged"),e.forEach((e=>e.classList.remove("ds_flagged")))}else{(s.classList.contains("info")||s.classList.contains("spotlight_content"))&&(s=s.parentElement);let e=s.querySelector(".ds_flag");e&&e.remove(),e=s.querySelector(".ds_flagged"),e&&e.classList.remove("ds_flagged")}s.classList.remove("ds_flagged")}static _highlightItem(e,t){e.classList.add("es_highlight_checked"),m.get(`highlight_${t}`)&&this._highlightNode(e,t),m.get(`tag_${t}`)&&this._addTag(e,t)}static highlightOwned(e){this._highlightItem(e,"owned")}static highlightWishlist(e){this._highlightItem(e,"wishlist")}static highlightInvCoupon(e){this._highlightItem(e,"coupon")}static highlightInvGift(e){this._highlightItem(e,"inv_gift")}static highlightInvGuestpass(e){this._highlightItem(e,"inv_guestpass")}static highlightIgnored(e){this._highlightItem(e,"notinterested")}static highlightCollection(e){this._highlightItem(e,"collection")}static highlightWaitlist(e){this._highlightItem(e,"waitlist")}}J._highlightCssLoaded=!1,J._tagCssLoaded=!1,J._types=["notinterested","waitlist","wishlist","collection","owned","coupon","inv_guestpass","inv_gift"],J._selector=[".store_main_capsule","a.game_area_dlc_row","a.small_cap",".home_content_item",".home_content.single",".home_area_spotlight","a.search_result_row","a.match",".highlighted_app","div.recommendation_highlight","div.recommendation_carousel_item","div.friendplaytime_game",".recommendation_row",".friendactivity_tab_row",".friend_game_block",".recommendation",".curator_giant_capsule","div.carousel_items.curator_featured > div","div.item_ctn",".store_capsule",".newonsteam_headercap",".comingsoon_headercap",".home_marketing_message","div.dlc_page_purchase_dlc","div.home_area_spotlight","div.browse_tag_game","div.similar_grid_item",".tab_item",".special > .special_img_ctn",".special.special_img_ctn"].map((e=>`${e}:not(.es_highlighted)`)).join(",");class V extends q{apply(){V.show()}static async show(e){if(!m.get("show_early_access"))return;const t=e||document.querySelectorAll(this._selector);if(0!==t.length){if(!this._container){let e="img/overlay/early_access_banner_english.png";u.isCurrentLanguageOneOf(["brazilian","french","italian","japanese","koreana","polish","portuguese","russian","schinese","spanish","latam","tchinese","thai"])&&(e=`img/overlay/early_access_banner_${u.getCurrentSteamLanguage()}.png`);const t=h.getURL(e);this._container=a.element(`<span class="es_overlay_container">\n                    <span class="es_overlay">\n                        <img title="${f.str.early_access}" src="${t}">\n                    </span>\n                </span>`)}for(const e of await this.getEaNodes(t)){if(null!==e.querySelector(".es_overlay_container"))continue;e.classList.add("es_early_access");const t=e.querySelector("img");if(!t)continue;const s=this._container.cloneNode(!0);t.insertAdjacentElement("afterend",s),s.append(t)}}}static async getEaNodes(e){const t=new Map;for(const s of e){if(s.classList.add("es_ea_checked"),s.classList.contains("store_capsule")&&null!==s.querySelector(".capsule[id^=broadcast]"))continue;let e=S.getAppid(s)||S.getAppid(s.querySelector("a"))||S.getAppidImgSrc(s.querySelector("img"));e&&(e=String(e),t.has(e)?t.get(e).push(s):t.set(e,[s]))}if(0===t.size)return[];const s=await $.action("isea",Array.from(t.keys()));return Array.from(t).flatMap((([e,t])=>s[e]?t:[]))}}V._selector=[".tab_item",".quadscreenshot_carousel a",".newonsteam_headercap",".comingsoon_headercap",".store_capsule",".dailydeal_ctn",".special.special_img_ctn",".home_area_spotlight",".curator_giant_capsule",".home_content_item",".home_content.single",".highlighted_app_header","#curator_avatar_image",".curator_featured a",".search_result_row",".small_cap",".browse_tag_game_cap",".header_image",".similar_grid_capsule",".friend_game_block a[data-ds-appid]",".friendactivity_tab_row",".recommendation_app",".recommendation_carousel_item",".app_header",".friendplaytime_appheader"].map((e=>`${e}:not(.es_ea_checked)`)).join(",");class K extends q{checkPrerequisites(){return m.get("hidetmsymbols")}apply(){let e="title, .apphub_AppName, .breadcrumbs, h1, h4";function t(e){e&&e.innerHTML&&a.inner(e,e.innerHTML.replace(/[\u00AE\u00A9\u2122]/g,""))}this.context.type===x.STORE_DEFAULT?e+=".game_area_already_owned, .details_block, .game_description_snippet, .game_area_description p, .glance_details, .game_area_dlc_bubble game_area_bubble, .package_contents, .game_area_dlc_name, .tab_desc, .tab_item_name":e+=".game_suggestion, .appHubShortcut_Title, .apphub_CardContentNewsTitle, .apphub_CardTextContent, .apphub_CardContentAppName, .apphub_AppName";for(const s of document.querySelectorAll(e))t(s);const s=new MutationObserver((e=>{e.forEach((e=>{e.addedNodes.forEach((e=>{t(e)}))}))})),r=document.querySelectorAll("#game_select_suggestions,#search_suggestion_contents,.tab_content_ctn");for(const e of r)s.observe(e,{childList:!0,subtree:!0})}}class Y extends q{checkPrerequisites(){return m.get("show_alternative_linux_icon")}apply(){let e=`span.platform_img.linux { background-image: url(${h.getURL("img/alternative_linux_icon.png")}) !important; }`;this.context.type===x.STORE_FRONT&&(e+=".tab_item.focus .tab_item_details span.platform_img.linux { filter: brightness(20%); }"),P.insertCSS(e)}}class Q extends O{checkPrerequisites(){return L.isSignedIn}callback(e){const t={};return this.context.myWishlist&&(t.wishlisted=!1,t.waitlisted=!1),J.highlightAndTag(e,!1,t)}}class Z extends O{checkPrerequisites(){return m.get("showlowestprice_onwishlist")}setup(){this._cachedPrices={},window.addEventListener("scroll",(()=>{this._scrollResizeHandler()})),window.addEventListener("resize",(()=>{this._scrollResizeHandler()}))}_scrollResizeHandler(){const e=document.querySelectorAll(":hover");if(e.length){const t=e[e.length-1].closest(".wishlist_row");if(t){const e=t.querySelector(".itad-pricing");if(e)for(const s of this._getNodesBelow(t))s.style.top=`${parseInt(s.style.top)+e.getBoundingClientRect().height}px`}}}callback(e){const t=this._cachedPrices;for(const s of e){const e=s.dataset.appId;if(!e||void 0!==t[e])return;t[e]=null,s.addEventListener("mouseenter",(()=>{null===t[e]&&(t[e]=new Promise((t=>{const r=new W;r.appids=[e],r.priceCallback=(e,r,n)=>{s.insertAdjacentElement("beforeend",n);const a=s.querySelector(".itad-pricing");a.style.bottom=-a.getBoundingClientRect().height+"px",t()},r.load()}))),t[e].then((()=>{const e=s.querySelector(".itad-pricing").getBoundingClientRect().height;this._getNodesBelow(s).forEach((t=>{t.style.top=`${parseInt(t.style.top)+e}px`}))}))})),s.addEventListener("mouseleave",(()=>{t[e]&&t[e].then((()=>{const e=s.querySelector(".itad-pricing").getBoundingClientRect().height;this._getNodesBelow(s).forEach((t=>{t.style.top=parseInt(t.style.top)-e+"px"}))}))}))}}_getNodesBelow(e){return Array.from(document.querySelectorAll(".wishlist_row")).filter((t=>parseInt(t.style.top)>parseInt(e.style.top)))}}class X{static getAdapter(){if(void 0===X._adapter){let e=X.adapters[m.get("user_notes_adapter")];void 0===e&&(m.remove("user_notes_adapter"),e=X.adapters[m.defaults.user_notes_adapter]),X._adapter=new e}return X._adapter}static async changeAdapter(e){const t=X.getAdapter(),s=new X.adapters[e];return await s.import(await t.export()),await t.clear(),X._adapter=s,X._adapter}}class ee extends Error{constructor(e,...t){super(...t),this.name=this.constructor.name,this.ratio=e}}class te{constructor(e=!1,t=null){this.closeToFull=e,this.utilization=t}}X.adapters=Object.freeze({synced_storage:class{constructor(){this._notes=m.get("user_notes")}get(e){return this._notes[e]||null}async set(e,t){const s=this._notes[e];this._notes[e]=t;const r=this._getNotesSize()/m.QUOTA_BYTES_PER_ITEM;if(r>1)throw this._notes[e]=s,new ee(r,"Can't set this user note, out of capacity");return await m.set("user_notes",this._notes),new te(r>.85,r)}delete(e){return delete this._notes[e],m.set("user_notes",this._notes)}export(){return this._notes}import(e){const t=this._getNotesSize(e)/m.QUOTA_BYTES_PER_ITEM;if(t>1)throw new ee(t,"Import to synced storage failed, too much data for this adapter");return this._notes=e,m.set("user_notes",this._notes)}clear(){return m.remove("user_notes")}_getNotesSize(e=this._notes){return"user_notes".length+JSON.stringify(e).length}},idb:class{get(e){return g.action("notes.get",e)}set(e,t){return g.action("notes.set",e,t)}delete(e){return g.action("notes.delete",e)}export(){return g.action("notes.getall")}import(e){return g.action("notes.setall",e)}clear(){return g.action("notes.clear")}}});class se{constructor(){this._str=f.str.user_note,this._adapter=X.getAdapter(),this.noteModalTemplate='<div class="es_note_prompt newmodal_prompt_with_textarea gray_bevel fullwidth">\n                <textarea name="es_note_input" id="es_note_input" rows="6" cols="12">__note__</textarea>\n            </div>'}get(...e){return this._adapter.get(...e)}async set(...e){let t=null;try{t=await this._adapter.set(...e)}catch(t){if(t instanceof ee)return!!await this._showDialog(!0,t.ratio)&&this.set(...e);throw t}return t instanceof te&&t.closeToFull&&await this._showDialog(!1,t.utilization),!0}delete(...e){return this._adapter.delete(...e)}async showModalDialog(e,t,s,r){let n=await this.get(t)||"";G.runInPageContext(((e,t,s,r)=>{const n=new jQuery.Deferred;function a(){n.resolve(document.querySelector("#es_note_input").value.trim().replace(/\s\s+/g," "))}function i(){n.reject()}const o=[],c=_BuildDialogButton(s,!0);c.click(a),o.push(c);const l=_BuildDialogButton(r,!1);l.click(i),o.push(l);const d=_BuildDialog(e,t,o,i);_BindOnEnterKeyPressForDialog(d,n,a),n.always((()=>d.Dismiss()));const u=document.getElementById("es_note_input");u.focus(),u.setSelectionRange(0,u.textLength),u.addEventListener("keydown",(e=>{"Enter"!==e.key||e.shiftKey||c.trigger("click")})),n.promise(d),d.done((e=>{window.sessionStorage.removeItem("es_note_autosave"),window.Messenger.postMessage("noteClosed",e)})).fail((()=>{""!==u.value.trim()&&window.sessionStorage.setItem("es_note_autosave",u.value),window.Messenger.postMessage("noteClosed",null)})),d.Show()}),[this._str.add_for_game.replace("__gamename__",e),this.noteModalTemplate.replace("__note__",n||window.sessionStorage.getItem("es_note_autosave")||""),f.str.save,f.str.cancel]);const a=n;if(n=await z.onMessage("noteClosed"),null!==n&&n!==a){if(0===n.length)this.delete(t),s.textContent=this._str.add;else{if(!await this.set(t,n))return void window.sessionStorage.setItem("es_note_autosave",n);s.textContent=`"${n}"`}r(s,0!==n.length)}}async _showDialog(e,t){const s=this._str,r=`${(e?s.not_enough_space_desc:s.close_on_storage_desc).replace("__perc__",(100*t).toFixed(0))}\n            <br>\n            ${s.storage_warning_desc}`;let n;return G.runInPageContext(((e,t,s,r,n)=>{window.SteamFacade.showConfirmDialog(e,t,n,r).done((e=>window.Messenger.postMessage("storageOption",e))).fail((()=>window.Messenger.postMessage("storageOption",null)))}),[e?s.not_enough_space:s.close_on_storage,r,s.save_itad,s.save_synced_storage,s.save_local]),"OK"===await z.onMessage("storageOption")&&(n="idb",this._adapter=await X.changeAdapter("idb"),await m.set("user_notes_adapter","idb"),!0)}}class re extends O{checkPrerequisites(){return this.context.myWishlist&&m.get("user_notes_wishlist")}setup(){this._userNotes=new se,this._noteEl=a.element(`<div class="esi-note esi-note--wishlist ellipsis">${f.str.user_note.add}</div>`),document.addEventListener("click",(({target:e})=>{if(!e.classList.contains("esi-note"))return;const t=e.closest(".wishlist_row");this._userNotes.showModalDialog(t.querySelector("a.title").textContent.trim(),Number(t.dataset.appId),e,((e,t)=>{e.classList.toggle("esi-has-note",t)}))}))}callback(e){const t=e[e.length-1];for(const s of e){if(s.classList.contains("esi-has-note"))continue;const e=this._noteEl.cloneNode(!0),r=Number(s.dataset.appId);(async()=>{const n=await this._userNotes.get(r);null!==n&&(e.textContent=`"${n}"`,e.classList.add("esi-has-note")),s.querySelector(".mid_container").insertAdjacentElement("afterend",e),s.classList.add("esi-has-note"),s===t&&window.dispatchEvent(new Event("resize"))})()}}}class ne extends q{checkPrerequisites(){return m.get("showwishliststats")}async apply(){this._appInfo=await G.runInPageContext((()=>window.SteamFacade.global("g_rgAppInfo")),null,!0),a.beforeBegin("#wishlist_ctn",'<div id="esi-wishlist-chart-content"></div>'),z.addMessageListener("wlUpdate",(()=>{this._updateStats()})),G.runInPageContext((()=>{const e=window.CWishlistController.prototype.Update;window.CWishlistController.prototype.Update=function(...t){e.call(this,t),window.Messenger.postMessage("wlUpdate")}})),this._updateStats()}async _updateStats(){let e=0,t=0,s=0,r=0;const n=(await G.runInPageContext((()=>window.SteamFacade.global("g_Wishlist").rgVisibleApps),null,!0)).map((e=>this._appInfo[e]));for(const a of Object.values(n))a.subs.length>0?(e+=a.subs[0].price,a.subs[0].discount_pct>0&&s++):r++,t++;e=new H(e/100),a.inner("#esi-wishlist-chart-content",`<div class="esi-wishlist-stat"><span class="num">${e}</span>${f.str.wl.total_price}</div>\n            <div class="esi-wishlist-stat"><span class="num">${t}</span>${f.str.wl.in_wishlist}</div>\n            <div class="esi-wishlist-stat"><span class="num">${s}</span>${f.str.wl.on_sale}</div>\n            <div class="esi-wishlist-stat"><span class="num">${r}</span>${f.str.wl.no_price}</div>`)}}class ae{constructor(e){this.wl=e,this.notes=m.get("user_notes")||{}}toJson(){const e={version:"03",data:[]};for(const[t,s]of this.wl)e.data.push({gameid:["steam",`app/${t}`],title:s.name,url:`https://store.steampowered.com/app/${t}/`,type:s.type,release_date:s.release_string,note:this.notes[t]||null,price:s.subs[0]?s.subs[0].price:null,discount:s.subs[0]?s.subs[0].discount_pct:0});return JSON.stringify(e,null,4)}toText(e){const t=[],s=new DOMParser;for(const[r,n]of this.wl){let a="N/A",i="0%",o="N/A";if(n.subs[0]){const e=s.parseFromString(n.subs[0].discount_block,"text/html");a=e.querySelector(".discount_final_price").innerText,n.subs[0].discount_pct>0?(i=e.querySelector(".discount_pct").innerText,o=e.querySelector(".discount_original_price").innerText):o=e.querySelector(".discount_final_price").innerText}t.push(e.replace("%appid%",r).replace("%id%",`app/${r}`).replace("%url%",`https://store.steampowered.com/app/${r}/`).replace("%title%",n.name).replace("%release_date%",n.release_string).replace("%price%",a).replace("%discount%",i).replace("%base_price%",o).replace("%type%",n.type).replace("%note%",this.notes[r]||""))}return t.join("\n")}}ae.method=Object.freeze({download:Symbol("Download"),copyToClipboard:Symbol("Copy to clipboard")});class ie extends q{apply(){a.afterBegin("#cart_status_data",`<div class="es-wbtn" id="es_export_wishlist"><div>${f.str.export.wishlist}</div></div>`),document.querySelector("#es_export_wishlist").addEventListener("click",(async()=>{const e=await G.runInPageContext((()=>{const e=window.SteamFacade;return e.global("g_Wishlist").rgVisibleApps.map((t=>[t,e.global("g_rgAppInfo")[t]]))}),null,!0);this._showDialog(e)}))}_showDialog(e){function t(t){const s=document.querySelector("input[name='es_wexport_type']:checked").value,r=document.querySelector("#es-wexport-format").value,n=new ae(e);let a="",i="",o="";"json"===s?(a=n.toJson(),i="wishlist.json",o="application/json"):"text"===s&&r&&(a=n.toText(r),i="wishlist.txt",o="text/plain"),t===ae.method.copyToClipboard?class{static async set(e){try{return await navigator.clipboard.writeText(e),!0}catch{}function t(t){t.clipboardData.setData("text/plain",e),t.preventDefault()}document.addEventListener("copy",t);const s=document.execCommand("copy");return document.removeEventListener("copy",t),s}}.set(a):t===ae.method.download&&class{static download(e,t){const s=document.createElement("a");s.href="string"==typeof e?e:URL.createObjectURL(e),s.download=t,s.dispatchEvent(new MouseEvent("click"))}}.download(new Blob([a],{type:`${o};charset=UTF-8`}),i)}G.runInPageContext((e=>{window.SteamFacade.showConfirmDialog(e.wishlist,`<div id="es_export_form">\n                    <div class="es-wexport">\n                        <h2>${e.type}</h2>\n                        <div>\n                            <label class="es-wexport__label"><input type="radio" name="es_wexport_type" value="text" checked> ${e.text}</label>\n                            <label class="es-wexport__label"><input type="radio" name="es_wexport_type" value="json"> JSON</label>\n                        </div>\n                    </div>\n                    <div class="es-wexport es-wexport__format">\n                        <h2>${e.format}</h2>\n                        <div>\n                            <input type="text" id="es-wexport-format" class="es-wexport__input" value="%title%"><br>\n                            <div class="es-wexport__symbols">%title%, %id%, %appid%, %url%, %release_date%, %price%, %discount%, %base_price%, %type%, %note%</div>\n                        </div>\n                    </div>\n                </div>`,e.download,null,e.copy_clipboard)}),[f.str.export]);const[s,r]=document.querySelectorAll(".newmodal_buttons > .btn_medium");r.classList.replace("btn_darkblue_white_innerfade","btn_blue_steamui"),s.addEventListener("click",(()=>{t(ae.method.download)}),!0),r.addEventListener("click",(()=>{t(ae.method.copyToClipboard)}),!0);const n=document.querySelector(".es-wexport__format");for(const e of document.getElementsByName("es_wexport_type"))e.addEventListener("click",(({target:e})=>{n.classList.toggle("es-grayout","json"===e.value)}))}}class oe extends q{checkPrerequisites(){return this.context.myWishlist&&m.get("showemptywishlist")}apply(){a.afterBegin("#cart_status_data",`<div class="es-wbtn" id="es_empty_wishlist">${f.str.empty_wishlist.title}</div>`),document.getElementById("es_empty_wishlist").addEventListener("click",(async()=>{await G.runInPageContext((e=>{const t=window.SteamFacade,s=t.showConfirmDialog(e.title,e.confirm);return new Promise((r=>{s.done((s=>{"OK"===s&&(t.showBlockingWaitDialog(e.title,e.removing.replace("__cur__",1).replace("__total__",t.global("g_rgWishlistData").length)),r())}))}))}),[f.str.empty_wishlist],!0);const e=i.getVariableFromDom("g_rgWishlistData","array");if(!e)return void console.warn("Failed to find wishlist data for this wishlist");let t=1;const s=document.querySelector(".waiting_dialog_throbber").nextSibling;for(const{appid:r}of e){s.textContent=f.str.empty_wishlist.removing.replace("__cur__",t++).replace("__total__",e.length);const n=new FormData;n.append("sessionid",L.sessionId),n.append("appid",r);const a=`https://store.steampowered.com/wishlist/profiles/${L.steamId}/remove/`;await A.post(a,n)}I.clear(),location.reload()}))}}oe.dependencies=[ie];class ce extends O{checkPrerequisites(){return this.context.myWishlist}setup(){document.querySelector("#wishlist_ctn").classList.add("as_show_order_input"),G.runInPageContext((()=>{const e=window.g_rgAppInfo,t=window.g_Wishlist,s=window.CWishlistController.prototype;for(const r of["MoveToPosition","SaveOrder"]){const n=s[r];s[r]=function(...s){n.call(Object.assign(t,{rgAllApps:Array.from(t.rgAllApps).sort(((t,s)=>e[s].priority===e[t].priority?0:0===e[s].priority?-1:0===e[t].priority?1:e[t].priority-e[s].priority))}),...s)}}}))}callback(e){for(const t of e){if(null!==t.querySelector(".as_hover_handle"))continue;const e=t.querySelector(".hover_handle"),s=e.cloneNode(!0);s.classList.add("as_hover_handle"),s.draggable=!1,s.querySelector("img").remove(),e.insertAdjacentElement("afterend",s);const r=e.querySelector(".order_input"),n=s.querySelector(".order_input");n.addEventListener("change",(()=>{r.value=n.value,r.dispatchEvent(new Event("change"))}))}}}class le extends O{checkPrerequisites(){return this.context.myWishlist&&m.get("oneclickremovewl")}callback(e){for(const t of e){const e=t.querySelector(".delete");if(e.classList.contains("as-oneclickremove"))continue;const s=e.cloneNode(!0);s.classList.add("as-oneclickremove"),e.replaceWith(s),s.addEventListener("click",(()=>{G.runInPageContext((e=>{const t=window.SteamFacade;t.jqPost(`${t.global("g_strWishlistBaseURL")}remove/`,{appid:e,sessionid:t.global("g_sessionID")}),t.dynamicStoreInvalidateCache(),t.jq("#wishlist_ctn").removeClass("sorting"),delete g_rgAppInfo[e],g_Wishlist.rgAllApps=Object.keys(g_rgAppInfo),g_Wishlist.Update(!0)}),[t.dataset.appId])}))}}}(new class extends G{}).run(class extends class extends class{constructor(e,t){this._callbacks=[],this.type=e,this.features=t.map((e=>new e(this)))}applyFeatures(){return class{static async apply(e){for(this._promisesMap=new Map,this._stats={completed:0,failed:0,dependency:0};e.length>0;){const t=e.pop(),s=this._generateFeatureChain(t);null===s?e.unshift(t):this._promisesMap.set(t.constructor,s)}await Promise.allSettled(Array.from(this._promisesMap.values())),console.log("Feature loading complete, %i successfully loaded, %i failed to load, %i didn't load due to dependency errors",this._stats.completed,this._stats.failed,this._stats.dependency)}static _generateFeatureChain(e){let t=!0,s=Promise.resolve(!0);if(Array.isArray(e.constructor.dependencies)){for(const s of e.constructor.dependencies)if(!this._promisesMap.has(s)){t=!1;break}t&&(s=Promise.all(Array.from(this._promisesMap.entries()).filter((([t])=>e.constructor.dependencies.includes(t))).map((([,e])=>e))))}return t?s.then((t=>{let s=!0;return e.constructor.weakDependency||(s=Array.isArray(t)?t.every((e=>e)):t),s&&e.checkPrerequisites()})).then((async t=>(t&&(await e.apply(),++this._stats.completed),t))).catch((t=>{const s=e.constructor.name;if(t instanceof n.FeatureDependencyError)throw console.warn("Not applying feature %s due to an error in the dependency chain (namely %s)",s,t.featureName),++this._stats.dependency,t;throw console.group(s),console.error("Error while applying feature %s",s),console.error(t),console.groupEnd(),++this._stats.failed,new n.FeatureDependencyError("Failed to apply",s)})):null}}.apply(this.features)}registerCallback(e){this._callbacks.push(e)}triggerCallbacks(...e){for(const t of this._callbacks)t(...e)}}{constructor(e=x.STORE_DEFAULT,t=[]){t.push(J,V,K,Y),super(e,t),this._observeChanges()}_observeChanges(){const e=document.querySelector("#search_suggestion_contents");e&&new MutationObserver((e=>{this.decorateStoreCapsules(e[0].addedNodes)})).observe(e,{childList:!0});const t=document.querySelector(".tab_content_ctn");if(t)return void new MutationObserver((e=>{for(const{addedNodes:t}of e)if(t.length>1){const e=Array.from(t).filter((e=>e instanceof Element&&e.classList.contains("tab_item")));this.decorateStoreCapsules(e)}})).observe(t,{childList:!0,subtree:!0});const s=document.querySelector("#friendactivity_tabarea");if(s)return void new MutationObserver((e=>{for(const{addedNodes:t}of e)if(t.length>1){const e=Array.from(t).filter((e=>e instanceof Element&&null!==e.querySelector(".friendactivity_game_link")));this.decorateStoreCapsules(e)}})).observe(s,{childList:!0,subtree:!0});const r=document.querySelector(["#tag_browse_games_ctn","#RecommendationsRows","#CuratorsRows"].join(","));r&&new MutationObserver((e=>{for(const{addedNodes:t}of e)if(t.length>0&&t[0]instanceof Element){const e=t[0].querySelectorAll(".browse_tag_game, .store_capsule, .recommendation");this.decorateStoreCapsules(e)}})).observe(r,{childList:!0,subtree:!0})}decorateStoreCapsules(e,t){J.highlightAndTag(e,t),V.show(e)}}{constructor(){if("none"===document.getElementById("nothing_to_see_here").style.display)if(super(x.WISHLIST,[Q,Z,re,ne,oe,ie,ce,le,Y]),L.isSignedIn){const e=L.profileUrl.replace("steamcommunity.com/","store.steampowered.com/wishlist/").replace(/\/$/,""),t=new RegExp(`^${e}([/#]|$)`);this.myWishlist=t.test(window.location.href)||window.location.href.includes(`/profiles/${L.steamId}`)}else this.myWishlist=!1;else super(x.WISHLIST)}async applyFeatures(){const e=document.getElementById("throbber");"none"!==e.style.display&&await new Promise((t=>{new MutationObserver(((e,s)=>{s.disconnect(),t()})).observe(e,{attributes:!0})})),await super.applyFeatures();const t=document.querySelectorAll(".wishlist_row");0!==t.length&&(this.triggerCallbacks(t),window.dispatchEvent(new Event("resize"))),this._registerObserver()}_registerObserver(){const e=document.getElementById("wishlist_ctn");let t=null;const s=new Set;new MutationObserver((r=>{for(const e of r)1===e.addedNodes.length&&s.add(e.addedNodes[0]);null===t?t=b.resettableTimer((()=>{const t=Array.from(s).filter((t=>t.parentNode===e));s.clear(),this.triggerCallbacks(t)}),50):t.reset()})).observe(e,{childList:!0})}})})();
//# sourceMappingURL=wishlist.js.map