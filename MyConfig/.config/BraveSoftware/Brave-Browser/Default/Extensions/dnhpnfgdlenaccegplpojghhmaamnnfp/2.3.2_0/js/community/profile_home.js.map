{"version":3,"file":"js/community/profile_home.js","mappings":"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","sources":["webpack:///./src/js/Core/Errors/Errors.js","webpack:///./src/js/Core/Html/Html.js","webpack:///./src/js/Core/Html/HtmlParser.js","webpack:///./src/js/Core/Storage/CookieStorage.js","webpack:///./src/js/Core/Environment.js","webpack:///./src/js/Core/Localization/Language.js","webpack:///./src/js/Core/BackgroundSimple.js","webpack:///./src/js/Core/ExtensionResources.js","webpack:///./src/js/Core/Storage/Storage.js","webpack:///./src/js/Core/Info.js","webpack:///./src/js/Core/Storage/SyncedStorage.js","webpack:///./src/js/Core/Localization/Localization.js","webpack:///./src/js/Core/Storage/LocalStorage.js","webpack:///./src/js/Core/Utils/TimeUtils.js","webpack:///./src/js/Core/GameId.js","webpack:///./src/js/Core/Permissions.js","webpack:///./src/js/Core/Version.js","webpack:///./src/js/Content/Modules/Widgets/ProgressBar.js","webpack:///./src/js/Content/Modules/Background.js","webpack:///./src/js/Core/Errors/ErrorParser.js","webpack:///./src/js/Content/Modules/RequestData.js","webpack:///./src/js/Content/Modules/User.js","webpack:///./src/js/Content/Modules/Community/CommunityUtils.js","webpack:///./src/js/Content/Modules/SteamId.js","webpack:///./src/js/Content/Modules/Community/ProfileData.js","webpack:///./src/js/Content/Modules/Feature/FeatureManager.js","webpack:///./src/js/Content/Modules/Context/ContextType.js","webpack:///./src/js/Content/Modules/Data/DynamicStore.js","webpack:///./src/js/Content/Modules/Feature/Feature.js","webpack:///./src/js/Content/Modules/Widgets/SortBox.js","webpack:///./src/js/Content/Modules/DOMHelper.js","webpack:///./src/js/Content/Modules/Widgets/HorizontalScroller.js","webpack:///./src/js/config.js","webpack:///./src/js/Content/Modules/AugmentedSteam.js","webpack:///./src/js/Core/Utils/StringUtils.js","webpack:///./src/js/Content/Modules/CurrencyManager.js","webpack:///./src/js/Content/Modules/ITAD.js","webpack:///./src/js/Content/Modules/Messenger.js","webpack:///./src/js/setup.js","webpack:///./src/js/Content/Features/Page.js","webpack:///./src/js/Content/Modules/SteamFacade.js","webpack:///./src/js/Content/Modules/UpdateHandler.js","webpack:///./src/js/Content/Modules/Community/CommentHandler.js","webpack:///./src/js/Content/Features/Common/FHideTrademarks.js","webpack:///./src/js/Content/Features/Community/CCommunityBase.js","webpack:///./src/js/Content/Modules/Context/Context.js","webpack:///./src/js/Content/Features/Common/FEarlyAccess.js","webpack:///./src/js/Content/Features/Community/FFixAppImageNotFound.js","webpack:///./src/js/Content/Features/Community/ProfileHome/FCommunityProfileLinks.js","webpack:///./src/js/Content/Features/Community/ProfileHome/FWishlistProfileLink.js","webpack:///./src/js/Content/Features/Community/ProfileHome/FSupporterBadges.js","webpack:///./src/js/Content/Features/Community/ProfileHome/FCustomBackground.js","webpack:///./src/js/Content/Features/Community/ProfileHome/FProfileStoreLinks.js","webpack:///./src/js/Content/Features/Community/ProfileHome/FSteamRep.js","webpack:///./src/js/Content/Features/Community/ProfileHome/FProfileDropdownOptions.js","webpack:///./src/js/Content/Features/Community/ProfileHome/FInGameStoreLink.js","webpack:///./src/js/Content/Features/Community/ProfileHome/FCustomStyle.js","webpack:///./src/js/Content/Features/Community/ProfileHome/FTwitchShowcase.js","webpack:///./src/js/Content/Features/Community/ProfileHome/FChatDropdownOptions.js","webpack:///./src/js/Content/Features/Community/ProfileHome/FViewSteamId.js","webpack:///./src/js/Content/Modules/Clipboard.js","webpack:///./src/js/Content/Features/Community/ProfileHome/FPinnedBackground.js","webpack:///./src/js/Content/Features/Community/ProfileHome/PProfileHome.js","webpack:///./src/js/Content/Features/CommunityPage.js","webpack:///./src/js/Content/Features/Community/ProfileHome/CProfileHome.js"],"sourcesContent":["\r\nclass LoginError extends Error {\r\n    constructor(type) {\r\n        super(type);\r\n        this.name = \"LoginError\";\r\n    }\r\n}\r\n\r\nclass ServerOutageError extends Error {\r\n    constructor(msg) {\r\n        super(msg);\r\n        this.name = \"ServerOutageError\";\r\n    }\r\n}\r\n\r\nclass HTTPError extends Error {\r\n    constructor(code, message) {\r\n        super(message);\r\n        this.code = code;\r\n    }\r\n}\r\n\r\n\r\nclass FeatureDependencyError extends Error {\r\n    constructor(msg, featureName) {\r\n        super(msg);\r\n        this.featureName = featureName;\r\n    }\r\n}\r\n\r\nconst Errors = {\r\n    \"LoginError\": LoginError,\r\n    \"ServerOutageError\": ServerOutageError,\r\n    \"HTTPError\": HTTPError,\r\n    \"FeatureDependencyError\": FeatureDependencyError\r\n};\r\n\r\nexport {Errors};\r\n","// TODO Accept NodeLists to insert HTML for every node in the list\r\nclass HTML {\r\n\r\n    static escape(str) {\r\n\r\n        // @see https://stackoverflow.com/a/4835406\r\n        const map = {\r\n            \"&\": \"&amp;\",\r\n            \"<\": \"&lt;\",\r\n            \">\": \"&gt;\",\r\n            '\"': \"&quot;\",\r\n            \"'\": \"&#039;\"\r\n        };\r\n\r\n        return str.replace(/[&<>\"']/g, (m) => { return map[m]; });\r\n    }\r\n\r\n    static fragment(html) {\r\n        const template = document.createElement(\"template\");\r\n        template.innerHTML = DOMPurify.sanitize(html);\r\n        return template.content;\r\n    }\r\n\r\n    static element(html) {\r\n        return HTML.fragment(html).firstElementChild;\r\n    }\r\n\r\n    static _getNode(node) {\r\n        let _node = node;\r\n\r\n        if (typeof _node == \"undefined\" || _node === null) {\r\n            console.warn(`${_node} is not an Element.`);\r\n            return null;\r\n        }\r\n        if (typeof _node == \"string\") {\r\n            _node = document.querySelector(_node);\r\n        }\r\n        if (!(_node instanceof Element)) {\r\n            console.warn(`${_node} is not an Element.`);\r\n            return null;\r\n        }\r\n\r\n        return _node;\r\n    }\r\n\r\n    static inner(node, html) {\r\n        const _node = HTML._getNode(node);\r\n\r\n        if (_node) {\r\n            _node.innerHTML = DOMPurify.sanitize(html);\r\n        }\r\n        return _node;\r\n    }\r\n\r\n    static replace(node, html) {\r\n        const _node = HTML._getNode(node);\r\n\r\n        if (_node) {\r\n            _node.outerHTML = DOMPurify.sanitize(html);\r\n        }\r\n        return _node;\r\n    }\r\n\r\n    static wrap(wrapper, startEl, endEl = startEl) {\r\n        const _startEl = HTML._getNode(startEl);\r\n\r\n        if (!_startEl) { return null; }\r\n\r\n        const _endEl = endEl === null ? _startEl.parentElement.lastElementChild : HTML._getNode(endEl);\r\n\r\n        const wrappedNodes = [_startEl];\r\n        for (let cur = _startEl; cur.nextElementSibling !== null && cur !== _endEl; cur = cur.nextElementSibling) {\r\n            wrappedNodes.push(cur.nextElementSibling);\r\n        }\r\n\r\n        const _wrapper = HTML.element(wrapper);\r\n        _startEl.replaceWith(_wrapper);\r\n        _wrapper.append(...wrappedNodes);\r\n        return _wrapper;\r\n    }\r\n\r\n    static adjacent(node, position, html) {\r\n        const _node = HTML._getNode(node);\r\n\r\n        if (_node) {\r\n            _node.insertAdjacentHTML(position, DOMPurify.sanitize(html));\r\n        }\r\n        return _node;\r\n    }\r\n\r\n    static beforeBegin(node, html) {\r\n        HTML.adjacent(node, \"beforebegin\", html);\r\n    }\r\n\r\n    static afterBegin(node, html) {\r\n        HTML.adjacent(node, \"afterbegin\", html);\r\n    }\r\n\r\n    static beforeEnd(node, html) {\r\n        HTML.adjacent(node, \"beforeend\", html);\r\n    }\r\n\r\n    static afterEnd(node, html) {\r\n        HTML.adjacent(node, \"afterend\", html);\r\n    }\r\n}\r\n\r\nexport {HTML};\r\n","import {HTML} from \"./Html\";\r\n\r\nclass HTMLParser {\r\n\r\n    static clearSpecialSymbols(string) {\r\n        return string.replace(/[\\u00AE\\u00A9\\u2122]/g, \"\");\r\n    }\r\n\r\n    static htmlToDOM(html) {\r\n        return HTML.fragment(html);\r\n    }\r\n\r\n    static htmlToElement(html) {\r\n        return HTML.element(html);\r\n    }\r\n\r\n    static getVariableFromText(text, name, type) {\r\n        let regex;\r\n        if (type === \"object\") {\r\n            regex = new RegExp(`${name}\\\\s*=\\\\s*(\\\\{.+?\\\\});`);\r\n        } else if (type === \"array\") {\r\n            regex = new RegExp(`${name}\\\\s*=\\\\s*(\\\\[.+?\\\\]);`);\r\n        } else if (type === \"int\") {\r\n            regex = new RegExp(`${name}\\\\s*=\\\\s*(.+?);`);\r\n        } else if (type === \"string\") {\r\n            regex = new RegExp(`${name}\\\\s*=\\\\s*(\\\\\".+?\\\\\");`);\r\n        } else {\r\n            return null;\r\n        }\r\n\r\n        const m = text.match(regex);\r\n        if (m) {\r\n            if (type === \"int\") {\r\n                return parseInt(m[1]);\r\n            }\r\n            return JSON.parse(m[1]);\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    static getVariableFromDom(name, type, dom = document) {\r\n        for (const node of dom.querySelectorAll(\"script\")) {\r\n            const value = HTMLParser.getVariableFromText(node.textContent, name, type);\r\n\r\n            if (value !== null) {\r\n                return value;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n}\r\n\r\nexport {HTMLParser};\r\n","\r\nclass CookieStorage {\r\n\r\n    static get(name, defaultValue) {\r\n        const _name = name.trim();\r\n\r\n        if (!CookieStorage.cache.has(_name)) {\r\n            return defaultValue;\r\n        }\r\n        return CookieStorage.cache.get(_name);\r\n    }\r\n\r\n    static set(name, val, ttl = 60 * 60 * 24 * 365) {\r\n        let _name = name.trim();\r\n        let _val = val.trim();\r\n\r\n        CookieStorage.cache.set(_name, _val);\r\n\r\n        _name = encodeURIComponent(_name);\r\n        _val = encodeURIComponent(_val);\r\n        document.cookie = `${_name}=${_val}; max-age=${ttl}`;\r\n    }\r\n\r\n    static remove(name) {\r\n        let _name = name.trim();\r\n        CookieStorage.cache.delete(_name);\r\n        _name = encodeURIComponent(_name);\r\n        document.cookie = `${_name}; expires=Thu, 01 Jan 1970 00:00:00 GMT`;\r\n    }\r\n\r\n    static init() {\r\n        CookieStorage.cache = new Map();\r\n        for (let [key, val] of document.cookie.split(\";\").map(kv => kv.split(\"=\"))) {\r\n            key = key.trim();\r\n            CookieStorage.cache.set(key, decodeURIComponent(val));\r\n        }\r\n    }\r\n}\r\n\r\nCookieStorage.init();\r\n\r\nexport {CookieStorage};\r\n","\r\nconst ContextType = Object.freeze({\r\n    \"BACKGROUND\": 1,\r\n    \"CONTENT_SCRIPT\": 2,\r\n    \"OPTIONS\": 3,\r\n});\r\n\r\nlet currentContext;\r\nif (browser.extension.getBackgroundPage) {\r\n    const bgPage = browser.extension.getBackgroundPage();\r\n\r\n    currentContext = (bgPage === window)\r\n        ? ContextType.BACKGROUND\r\n        : ContextType.OPTIONS;\r\n} else {\r\n    currentContext = ContextType.CONTENT_SCRIPT;\r\n}\r\n\r\nclass Environment {\r\n\r\n    static isBackgroundScript() {\r\n        return currentContext === ContextType.BACKGROUND;\r\n    }\r\n\r\n    static isContentScript() {\r\n        return currentContext === ContextType.CONTENT_SCRIPT;\r\n    }\r\n\r\n    static isOptions() {\r\n        return currentContext === ContextType.OPTIONS;\r\n    }\r\n}\r\n\r\nexport {Environment};\r\n","import {CookieStorage} from \"../Storage/CookieStorage\";\r\nimport {Environment} from \"../Environment\";\r\n\r\nclass Language {\r\n\r\n    static getCurrentSteamLanguage() {\r\n        if (this._currentSteamLanguage !== null) {\r\n            return this._currentSteamLanguage;\r\n        }\r\n\r\n        for (const script of document.querySelectorAll(\"script[src]\")) {\r\n            const language = new URL(script.src).searchParams.get(\"l\");\r\n            if (language) {\r\n                Language._currentSteamLanguage = language;\r\n                return this._currentSteamLanguage;\r\n            }\r\n        }\r\n\r\n        // In a Content Context, we can check for a cookie\r\n        if (Environment.isContentScript()) {\r\n            Language._currentSteamLanguage = CookieStorage.get(\"Steam_Language\") || null;\r\n        }\r\n\r\n        return this._currentSteamLanguage;\r\n    }\r\n\r\n    static getLanguageCode(language) {\r\n        const code = Language.languages[language];\r\n        return code || \"en\";\r\n    }\r\n\r\n    static isCurrentLanguageOneOf(array) {\r\n        return array.includes(Language.getCurrentSteamLanguage());\r\n    }\r\n}\r\n\r\nLanguage._currentSteamLanguage = null;\r\nLanguage.languages = {\r\n    \"english\": \"en\",\r\n    \"bulgarian\": \"bg\",\r\n    \"czech\": \"cs\",\r\n    \"danish\": \"da\",\r\n    \"dutch\": \"nl\",\r\n    \"finnish\": \"fi\",\r\n    \"french\": \"fr\",\r\n    \"greek\": \"el\",\r\n    \"german\": \"de\",\r\n    \"hungarian\": \"hu\",\r\n    \"italian\": \"it\",\r\n    \"japanese\": \"ja\",\r\n    \"koreana\": \"ko\",\r\n    \"norwegian\": \"no\",\r\n    \"polish\": \"pl\",\r\n    \"portuguese\": \"pt-PT\",\r\n    \"brazilian\": \"pt-BR\",\r\n    \"russian\": \"ru\",\r\n    \"romanian\": \"ro\",\r\n    \"schinese\": \"zh-CN\",\r\n    \"spanish\": \"es-ES\",\r\n    \"latam\": \"es-419\",\r\n    \"swedish\": \"sv-SE\",\r\n    \"tchinese\": \"zh-TW\",\r\n    \"thai\": \"th\",\r\n    \"turkish\": \"tr\",\r\n    \"ukrainian\": \"ua\",\r\n    \"vietnamese\": \"vi\",\r\n};\r\n\r\nexport {Language};\r\n","\r\nclass BackgroundSimple {\r\n    static message(message) {\r\n        return browser.runtime.sendMessage(message);\r\n    }\r\n\r\n    static action(requested, ...params) {\r\n        if (!params.length) { return this.message({\"action\": requested}); }\r\n        return this.message({\"action\": requested, \"params\": params});\r\n    }\r\n}\r\n\r\nexport {BackgroundSimple};\r\n","\r\nclass ExtensionResources {\r\n\r\n    static getURL(pathname) {\r\n        return browser.runtime.getURL(pathname);\r\n    }\r\n\r\n    static get(pathname) {\r\n        return fetch(ExtensionResources.getURL(pathname));\r\n    }\r\n\r\n    static getJSON(pathname) {\r\n        return ExtensionResources.get(pathname).then(r => r.json());\r\n    }\r\n\r\n    static getText(pathname) {\r\n        return ExtensionResources.get(pathname).then(r => r.text());\r\n    }\r\n}\r\n\r\nexport {ExtensionResources};\r\n","class Storage {\r\n\r\n    static has(key) {\r\n        return Object.prototype.hasOwnProperty.call(this.cache, key);\r\n    }\r\n\r\n    static get(key) {\r\n        if (typeof this.cache[key] !== \"undefined\" || typeof this.defaults === \"undefined\") {\r\n            return this.cache[key];\r\n        }\r\n        if (typeof this.defaults[key] === \"undefined\") {\r\n            console.warn('Unrecognized storage key \"%s\"', key);\r\n        }\r\n        return this.defaults[key];\r\n    }\r\n\r\n    static set(key, value) {\r\n        this.cache[key] = value;\r\n        return this._adapter.set({[key]: value});\r\n    }\r\n\r\n    static import(entries) {\r\n        for (const [key, value] of Object.entries(entries)) {\r\n            this.cache[key] = value;\r\n        }\r\n        return this._adapter.set(entries);\r\n    }\r\n\r\n    static remove(key) {\r\n        if (typeof this.cache[key] !== \"undefined\") {\r\n            delete this.cache[key];\r\n        }\r\n        return this._adapter.remove(key);\r\n    }\r\n\r\n    static keys(prefix = \"\") {\r\n        return Object.keys(this.cache).filter(k => k.startsWith(prefix));\r\n    }\r\n\r\n    static entries() {\r\n        return Object.entries(this.cache);\r\n    }\r\n\r\n    static async clear(force = false) {\r\n\r\n        let tmp;\r\n        if (!force) {\r\n            tmp = (this.persistent ?? []).reduce((acc, option) => {\r\n                acc[option] = this.cache[option];\r\n                return acc;\r\n            }, {});\r\n        }\r\n\r\n        await this._adapter.clear();\r\n        this.cache = {};\r\n\r\n        if (!force) {\r\n            await this.import(tmp);\r\n        }\r\n    }\r\n\r\n    // load whole storage and make local copy\r\n    static async init() {\r\n\r\n        const area = this._adapter === browser.storage.sync ? \"sync\" : \"local\";\r\n        const cache = Storage.caches[area];\r\n\r\n        if (typeof cache !== \"undefined\") {\r\n            this.cache = cache;\r\n            return this.cache;\r\n        }\r\n\r\n        Storage.caches[area] = {};\r\n        this.cache = Storage.caches[area];\r\n\r\n        browser.storage.onChanged.addListener((changes, eventArea) => {\r\n\r\n            if (area !== eventArea) { return; }\r\n\r\n            for (const [key, {\"newValue\": val}] of Object.entries(changes)) {\r\n                this.cache[key] = val;\r\n            }\r\n        });\r\n\r\n        return Object.assign(this.cache, await this._adapter.get(null));\r\n    }\r\n\r\n    static then(onDone, onCatch) {\r\n        const promise = this._initialized ? Promise.resolve(this.cache) : this.init();\r\n        this._initialized = true;\r\n        return promise.then(onDone, onCatch);\r\n    }\r\n\r\n    static toJson() {\r\n        return JSON.stringify(this.cache);\r\n    }\r\n}\r\n\r\nStorage.caches = {};\r\n\r\nexport {Storage};\r\n","\r\nconst Info = {\r\n    \"version\": browser.runtime.getManifest().version,\r\n    \"db_version\": 3,\r\n};\r\n\r\nexport {Info};\r\n","import {Storage} from \"./Storage\";\r\nimport {Info} from \"../Info\";\r\n\r\n/*\r\n * browser.storage.sync limits\r\n * QUOTA_BYTES = 102400 // 100KB\r\n * QUOTA_BYTES_PER_ITEM = 8192 // 8KB\r\n * MAX_ITEMS = 512\r\n * MAX_WRITE_OPERATIONS_PER_HOUR = 1800\r\n * MAX_WRITE_OPERATIONS_PER_MINUTE = 120\r\n */\r\nclass SyncedStorage extends Storage {}\r\n\r\nSyncedStorage._adapter = browser.storage.sync || browser.storage.local;\r\n\r\n/*\r\n * 8KiB is the limit for storage.sync https://chromium.googlesource.com/chromium/src/+/refs/heads/main/extensions/common/api/storage.json#227\r\n * 5MiB is the limit for storage.local (overall size) https://chromium.googlesource.com/chromium/src/+/refs/heads/main/extensions/common/api/storage.json#227\r\n * 2KiB are subtracted in order to save some space for other configuration options\r\n */\r\nSyncedStorage.QUOTA_BYTES_PER_ITEM = browser.storage.sync ? 8192 : 5242880 - 2048;\r\n\r\nSyncedStorage.defaults = Object.freeze({\r\n    \"language\": \"english\",\r\n\r\n    \"version\": Info.version,\r\n    \"version_show\": true,\r\n\r\n    \"highlight_owned_color\": \"#00ce67\",\r\n    \"highlight_wishlist_color\": \"#0491bf\",\r\n    \"highlight_coupon_color\": \"#a26426\",\r\n    \"highlight_inv_gift_color\": \"#800040\",\r\n    \"highlight_inv_guestpass_color\": \"#513c73\",\r\n    \"highlight_notinterested_color\": \"#4f4f4f\",\r\n    \"highlight_collection_color\": \"#856d0e\",\r\n    \"highlight_waitlist_color\": \"#4c7521\",\r\n\r\n    \"tag_owned_color\": \"#00b75b\",\r\n    \"tag_wishlist_color\": \"#0383b4\",\r\n    \"tag_coupon_color\": \"#c27120\",\r\n    \"tag_inv_gift_color\": \"#b10059\",\r\n    \"tag_inv_guestpass_color\": \"#65449a\",\r\n    \"tag_notinterested_color\": \"#4f4f4f\",\r\n    \"tag_collection_color\": \"#856d0e\",\r\n    \"tag_waitlist_color\": \"#4c7521\",\r\n\r\n    \"highlight_owned\": true,\r\n    \"highlight_wishlist\": true,\r\n    \"highlight_coupon\": false,\r\n    \"highlight_inv_gift\": false,\r\n    \"highlight_inv_guestpass\": false,\r\n    \"highlight_notinterested\": false,\r\n    \"highlight_excludef2p\": false,\r\n    \"highlight_collection\": true,\r\n    \"highlight_waitlist\": true,\r\n\r\n    \"tag_owned\": false,\r\n    \"tag_wishlist\": false,\r\n    \"tag_coupon\": false,\r\n    \"tag_inv_gift\": false,\r\n    \"tag_inv_guestpass\": false,\r\n    \"tag_notinterested\": true,\r\n    \"tag_collection\": false,\r\n    \"tag_waitlist\": false,\r\n    \"tag_short\": false,\r\n\r\n    \"hidetmsymbols\": false,\r\n\r\n    \"showlowestprice\": true,\r\n    \"showlowestprice_onwishlist\": true,\r\n    \"showlowestpricecoupon\": true,\r\n    \"showallstores\": true,\r\n    \"stores\": [],\r\n    \"override_price\": \"auto\",\r\n    \"showregionalprice\": \"mouse\",\r\n    \"regional_countries\": [\"us\", \"gb\", \"ru\", \"br\", \"au\", \"jp\"],\r\n\r\n    \"show_es_homepagetabs\": true,\r\n    \"showmarkettotal\": false,\r\n    \"showsteamrepapi\": true,\r\n    \"showmcus\": true,\r\n    \"showoc\": true,\r\n    \"showhltb\": true,\r\n    \"showyoutube\": true,\r\n    \"showtwitch\": true,\r\n    \"showpcgw\": true,\r\n    \"showcompletionistme\": false,\r\n    \"showprotondb\": false,\r\n    \"showviewinlibrary\": false,\r\n    \"showsteamcardexchange\": false,\r\n    \"showitadlinks\": true,\r\n    \"showsteamdb\": true,\r\n    \"showbartervg\": false,\r\n    \"showastatslink\": true,\r\n    \"showyoutubegameplay\": true,\r\n    \"showyoutubereviews\": true,\r\n    \"showwsgf\": true,\r\n    \"exfgls\": true,\r\n    \"app_custom_link\": [\r\n        {\r\n            \"enabled\": false,\r\n            \"name\": \"Google\",\r\n            \"url\": \"google.com/search?q=[ID]+[NAME]\",\r\n            \"icon\": \"www.google.com/images/branding/product/ico/googleg_lodp.ico\"\r\n        },\r\n    ],\r\n\r\n    \"customize_apppage\": {\r\n        \"recentupdates\": true,\r\n        \"reviews\": true,\r\n        \"about\": true,\r\n        \"contentwarning\": true,\r\n        \"steamchart\": true,\r\n        \"steamspy\": true,\r\n        \"surveys\": true,\r\n        \"sysreq\": true,\r\n        \"legal\": true,\r\n        \"morelikethis\": true,\r\n        \"recommendedbycurators\": true,\r\n        \"customerreviews\": true\r\n    },\r\n\r\n    \"customize_frontpage\": {\r\n        \"featuredrecommended\": true,\r\n        \"specialoffers\": true,\r\n        \"trendingamongfriends\": true,\r\n        \"discoveryqueue\": true,\r\n        \"browsesteam\": true,\r\n        \"curators\": true,\r\n        \"morecuratorrecommendations\": true,\r\n        \"recentlyupdated\": true,\r\n        \"fromdevelopersandpublishersthatyouknow\": true,\r\n        \"popularvrgames\": true,\r\n        \"homepagetabs\": true,\r\n        \"gamesstreamingnow\": true,\r\n        \"under\": true,\r\n        \"updatesandoffers\": true,\r\n        \"homepagesidebar\": true\r\n    },\r\n\r\n    // 'show_keylol_links': false, // not in use, option is commented out\r\n    \"show_package_info\": false,\r\n    \"show_steamchart_info\": true,\r\n    \"show_steamspy_info\": true,\r\n    \"show_early_access\": true,\r\n    \"show_alternative_linux_icon\": false,\r\n    \"show_itad_button\": false,\r\n    \"skip_got_steam\": false,\r\n\r\n    \"installsteam\": \"show\",\r\n    \"openinnewtab\": false,\r\n    \"keepssachecked\": false,\r\n    \"showemptywishlist\": true,\r\n    \"user_notes_app\": true,\r\n    \"user_notes_wishlist\": true,\r\n    \"showwishliststats\": true,\r\n    \"oneclickremovewl\": false,\r\n    \"user_notes\": {},\r\n    \"user_notes_adapter\": \"synced_storage\",\r\n    \"replaceaccountname\": true,\r\n    \"showlanguagewarning\": true,\r\n    \"showlanguagewarninglanguage\": \"english\",\r\n    \"homepage_tab_selection\": \"remember\",\r\n    \"homepage_tab_last\": null,\r\n    \"send_age_info\": true,\r\n    \"removebroadcasts\": false,\r\n    \"mp4video\": false,\r\n    \"horizontalscrolling\": true,\r\n    \"showsupportinfo\": true,\r\n    \"showdrm\": true,\r\n    \"regional_hideworld\": false,\r\n    \"showinvnav\": true,\r\n    \"quickinv\": true,\r\n    \"quickinv_diff\": -0.01,\r\n    \"community_default_tab\": \"\",\r\n    \"showallachievements\": false,\r\n    \"showallstats\": true,\r\n    \"replacecommunityhublinks\": false,\r\n    \"hideannouncementcomments\": false,\r\n    \"showachinstore\": true,\r\n    \"hideactivelistings\": false,\r\n    \"showlowestmarketprice\": true,\r\n    \"hidespamcomments\": false,\r\n    \"spamcommentregex\": \"[\\\\u2500-\\\\u25FF]\",\r\n    \"wlbuttoncommunityapp\": true,\r\n    \"removeguideslanguagefilter\": false,\r\n    \"disablelinkfilter\": false,\r\n    \"sortfriendsby\": \"default_ASC\",\r\n    \"sortreviewsby\": \"default_ASC\",\r\n    \"sortgroupsby\": \"default_ASC\",\r\n    \"show1clickgoo\": true,\r\n    \"show_profile_link_images\": \"gray\",\r\n    \"show_custom_themes\": true,\r\n    \"profile_pinned_bg\": false,\r\n    \"profile_steamrepcn\": true,\r\n    \"profile_steamgifts\": true,\r\n    \"profile_steamtrades\": true,\r\n    \"profile_bartervg\": true,\r\n    \"profile_steamrep\": true,\r\n    \"profile_steamdbcalc\": true,\r\n    \"profile_astats\": true,\r\n    \"profile_backpacktf\": true,\r\n    \"profile_astatsnl\": true,\r\n    \"profile_steamid\": true,\r\n    \"profile_custom_link\": [\r\n        {\r\n            \"enabled\": true,\r\n            \"name\": \"Google\",\r\n            \"url\": \"google.com/search?q=[ID]\",\r\n            \"icon\": \"www.google.com/images/branding/product/ico/googleg_lodp.ico\"\r\n        },\r\n    ],\r\n    \"fav_emoticons\": [],\r\n    \"group_steamgifts\": true,\r\n    \"steamcardexchange\": true,\r\n    \"purchase_dates\": true,\r\n    \"show_badge_progress\": true,\r\n    \"show_coupon\": true,\r\n    \"show_wishlist_link\": true,\r\n    \"show_wishlist_count\": true,\r\n    \"show_progressbar\": true,\r\n    \"show_backtotop\": false,\r\n\r\n    \"profile_showcase_twitch\": true,\r\n    \"profile_showcase_own_twitch\": false,\r\n    \"profile_showcase_twitch_profileonly\": false,\r\n\r\n    \"itad_import_library\": false,\r\n    \"itad_import_wishlist\": false,\r\n    \"add_to_waitlist\": false,\r\n\r\n    \"context_steam_store\": false,\r\n    \"context_steam_market\": false,\r\n    \"context_itad\": false,\r\n    \"context_bartervg\": false,\r\n    \"context_steamdb\": false,\r\n    \"context_steamdb_instant\": false,\r\n    \"context_steam_keys\": false,\r\n});\r\nSyncedStorage.persistent = [\r\n    \"user_notes\",\r\n    \"user_notes_adapter\",\r\n];\r\n\r\nexport {SyncedStorage};\r\n","import {BackgroundSimple} from \"../BackgroundSimple\";\r\nimport {ExtensionResources} from \"../ExtensionResources\";\r\nimport {Language} from \"./Language\";\r\nimport {SyncedStorage} from \"../Storage/SyncedStorage\";\r\n\r\n\r\nclass Localization {\r\n\r\n    static loadLocalization(code) {\r\n        return ExtensionResources.getJSON(`/localization/${code}.json`);\r\n    }\r\n\r\n    static init() {\r\n        if (Localization._promise) { return Localization._promise; }\r\n\r\n        let currentSteamLanguage = Language.getCurrentSteamLanguage();\r\n        const storedSteamLanguage = SyncedStorage.get(\"language\");\r\n        if (currentSteamLanguage === null) {\r\n            currentSteamLanguage = storedSteamLanguage;\r\n        } else if (currentSteamLanguage !== storedSteamLanguage) {\r\n            SyncedStorage.set(\"language\", currentSteamLanguage);\r\n            BackgroundSimple.action(\"clearpurchases\");\r\n        }\r\n\r\n        function deepAssign(target, source) {\r\n\r\n            // Object.assign() but deep-assigning objects recursively\r\n            for (const [key, val] of Object.entries(source)) {\r\n                if (typeof target[key] === \"undefined\") {\r\n                    console.warn(\"The key %s doesn't exist in the English localization file\", key);\r\n                    continue;\r\n                }\r\n                if (typeof val === \"object\") {\r\n                    deepAssign(target[key], val);\r\n                } else if (val !== \"\") {\r\n                    target[key] = val;\r\n                }\r\n            }\r\n            return target;\r\n        }\r\n\r\n        const local = Language.getLanguageCode(currentSteamLanguage);\r\n        const codes = [\"en\"];\r\n        if (local !== null && local !== \"en\") {\r\n            codes.push(local);\r\n        }\r\n        Localization._promise = Promise.all(\r\n            codes.map(lc => Localization.loadLocalization(lc))\r\n        ).then(([english, local]) => {\r\n            Localization.str = english;\r\n            if (local) {\r\n                deepAssign(Localization.str, local);\r\n            }\r\n            return Localization.str;\r\n        });\r\n        return Localization._promise;\r\n    }\r\n\r\n    static then(onDone, onCatch) {\r\n        return Localization.init().then(onDone, onCatch);\r\n    }\r\n\r\n    static getString(key) {\r\n\r\n        // Source: http://stackoverflow.com/a/24221895\r\n        const path = key.split(\".\").reverse();\r\n        let current = Localization.str;\r\n\r\n        while (path.length) {\r\n            if (typeof current !== \"object\") {\r\n                return null;\r\n            }\r\n            current = current[path.pop()];\r\n        }\r\n        return current;\r\n    }\r\n}\r\n\r\nLocalization._promise = null;\r\n\r\n\r\nexport {Localization};\r\n","\r\nimport {Storage} from \"./Storage\";\r\nimport {Environment} from \"../Environment\";\r\n\r\nclass LocalStorage extends Storage {\r\n\r\n    static async init() {\r\n        await super.init();\r\n\r\n        if (this === LocalStorage) {\r\n            // TODO Remove after some versions\r\n            return this.migrate();\r\n        }\r\n        return null;\r\n    }\r\n\r\n    static async migrate() {\r\n\r\n        const migrationDone = this.get(\"local_storage_migration\");\r\n\r\n        let type;\r\n\r\n        if (location.hostname === \"store.steampowered.com\") {\r\n            type = \"store\";\r\n        } else if (location.hostname === \"steamcommunity.com\") {\r\n            type = \"community\";\r\n        } else if (Environment.isContentScript()) {\r\n            return null;\r\n        } else {\r\n            type = \"extension\";\r\n        }\r\n\r\n        if (migrationDone[type]) { return null; }\r\n\r\n        await Promise.all(Object.keys(LocalStorage.defaults).map(async key => {\r\n\r\n            let value = localStorage.getItem(key);\r\n            if (value === null) { return; }\r\n\r\n            try {\r\n                value = JSON.parse(value);\r\n            } catch (err) {\r\n                console.error(\"Can't parse value\", value);\r\n                throw err;\r\n            }\r\n\r\n            await LocalStorage.set(key, value);\r\n            localStorage.removeItem(key);\r\n        }));\r\n\r\n        migrationDone[type] = true;\r\n        return LocalStorage.set(\"local_storage_migration\", migrationDone);\r\n    }\r\n}\r\n\r\nLocalStorage._adapter = browser.storage.local;\r\n\r\nLocalStorage.defaults = Object.freeze({\r\n    \"access_token\": null,\r\n    \"lastItadImport\": {\"from\": null, \"to\": null},\r\n    \"login\": {\"steamId\": null, \"profilePath\": null},\r\n    \"storeCountry\": null,\r\n    \"expand_slider\": false,\r\n    \"es_guide_tags\": {}, // TODO remove prefix\r\n    \"market_stats\": {\"startListing\": null, \"purchaseTotal\": 0, \"saleTotal\": 0},\r\n    \"popular_refresh\": false,\r\n    \"workshop_state\": \"\",\r\n    \"playback_hd\": false,\r\n    \"show_review_section\": true,\r\n    \"steampeek\": false,\r\n    \"support_info\": null,\r\n    \"hide_login_warn_store\": false,\r\n    \"hide_login_warn_community\": false,\r\n    \"review_filters\": {},\r\n    \"local_storage_migration\": {\"store\": false, \"community\": false, \"extension\": false},\r\n});\r\n\r\nexport {LocalStorage};\r\n","class Timer {\r\n\r\n    constructor(duration) {\r\n        this._promise = new Promise(resolve => {\r\n            this._id = setTimeout(() => { resolve(); }, duration);\r\n        });\r\n    }\r\n\r\n    then(onSuccess, onFail) {\r\n        if (this._promise) {\r\n            return this._promise.then(onSuccess, onFail);\r\n        }\r\n\r\n        throw new Error(\"Timer has been cleared before\");\r\n    }\r\n\r\n    clear() {\r\n        clearTimeout(this._id);\r\n        this._promise = null;\r\n    }\r\n}\r\n\r\nclass ResettableTimer {\r\n\r\n    constructor(onDone, duration) {\r\n        this.onDone = onDone;\r\n        this.duration = duration;\r\n\r\n        this.reset();\r\n    }\r\n\r\n    get running() { return this._running; }\r\n\r\n    reset() {\r\n        if (typeof this._id !== \"undefined\") {\r\n            clearTimeout(this._id);\r\n        }\r\n\r\n        this._id = setTimeout(async() => {\r\n            await this.onDone();\r\n            this._running = false;\r\n        }, this.duration);\r\n\r\n        this._running = true;\r\n    }\r\n}\r\n\r\nclass TimeUtils {\r\n\r\n    static timer(duration) {\r\n        return new Timer(duration);\r\n    }\r\n\r\n    static resettableTimer(onDone, duration) {\r\n        return new ResettableTimer(onDone, duration);\r\n    }\r\n\r\n    static now() {\r\n        return Math.trunc(Date.now() / 1000);\r\n    }\r\n}\r\n\r\nexport {TimeUtils};\r\n","\r\nclass GameId {\r\n\r\n    static parseId(id) {\r\n        if (!id) { return null; }\r\n\r\n        const intId = parseInt(id);\r\n        if (!intId) { return null; }\r\n\r\n        return intId;\r\n    }\r\n\r\n    static getAppid(text) {\r\n        let _text = text;\r\n\r\n        if (!_text) { return null; }\r\n\r\n        if (_text instanceof HTMLElement) {\r\n            const appid = _text.dataset.dsAppid;\r\n            if (appid) { return GameId.parseId(appid); }\r\n            _text = _text.href;\r\n            if (!_text) { return null; }\r\n        }\r\n\r\n        // app, games (legacy official group page), market/listing\r\n        const m = _text.match(/(?:store\\.steampowered|steamcommunity)\\.com\\/(?:app|games|market\\/listings)\\/(\\d+)\\/?/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static getSubid(text) {\r\n        let _text = text;\r\n\r\n        if (!_text) { return null; }\r\n\r\n        if (_text instanceof HTMLElement) {\r\n            const subid = _text.dataset.dsPackageid;\r\n            if (subid) { return GameId.parseId(subid); }\r\n            _text = _text.href;\r\n            if (!_text) { return null; }\r\n        }\r\n\r\n        const m = _text.match(/(?:store\\.steampowered|steamcommunity)\\.com\\/sub\\/(\\d+)\\/?/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static getBundleid(text) {\r\n        let _text = text;\r\n\r\n        if (!_text) { return null; }\r\n\r\n        if (_text instanceof HTMLElement) {\r\n            const bundleid = _text.dataset.dsBundleid;\r\n            if (bundleid) { return GameId.parseId(bundleid); }\r\n            _text = _text.href;\r\n            if (!_text) { return null; }\r\n        }\r\n\r\n        const m = _text.match(/(?:store\\.steampowered|steamcommunity)\\.com\\/bundle\\/(\\d+)\\/?/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static trimStoreId(storeId) {\r\n        return Number(storeId.slice(storeId.indexOf(\"/\") + 1));\r\n    }\r\n\r\n    static getAppidImgSrc(text) {\r\n        let _text = text;\r\n\r\n        if (!_text) { return null; }\r\n\r\n        if (_text instanceof HTMLImageElement) {\r\n            if (_text.hasAttribute(\"src\")) {\r\n                _text = _text.getAttribute(\"src\");\r\n            } else {\r\n                _text = _text.dataset.imageUrl;\r\n            }\r\n            if (!_text) { return null; }\r\n        }\r\n\r\n        // TODO support Steam's CDN option\r\n        const m = _text.match(/(?:cdn\\.(?:akamai|cloudflare)\\.steamstatic\\.com\\/steam|steamcdn-a\\.akamaihd\\.net\\/steam|steamcommunity\\/public\\/images)\\/apps\\/(\\d+)\\//);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static getAppidUriQuery(text) {\r\n        if (!text) { return null; }\r\n        const m = text.match(/appid=(\\d+)/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static getAppids(text) {\r\n        const regex = /(?:store\\.steampowered|steamcommunity)\\.com\\/app\\/(\\d+)\\/?/g;\r\n        const res = [];\r\n        let m;\r\n        while ((m = regex.exec(text)) !== null) {\r\n            const id = GameId.parseId(m[1]);\r\n            if (id) {\r\n                res.push(id);\r\n            }\r\n        }\r\n        return res;\r\n    }\r\n\r\n    static getAppidFromId(text) {\r\n        if (!text) { return null; }\r\n        const m = text.match(/game_(\\d+)/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static getAppidFromGameCard(text) {\r\n        if (!text) { return null; }\r\n        const m = text.match(/\\/gamecards\\/(\\d+)/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n}\r\n\r\nexport {GameId};\r\n","import {SyncedStorage} from \"./Storage/SyncedStorage\";\r\n\r\nconst ctxPermissions = __BROWSER__ === \"firefox\" ? [] : [\"contextMenus\"];\r\n\r\nconst PermissionOptions = Object.freeze({\r\n    \"context_steam_store\": {\r\n        \"persistent\": true,\r\n        \"permissions\": ctxPermissions,\r\n    },\r\n    \"context_steam_market\": {\r\n        \"persistent\": true,\r\n        \"permissions\": ctxPermissions,\r\n    },\r\n    \"context_itad\": {\r\n        \"persistent\": true,\r\n        \"permissions\": ctxPermissions,\r\n    },\r\n    \"context_bartervg\": {\r\n        \"persistent\": true,\r\n        \"permissions\": ctxPermissions,\r\n    },\r\n    \"context_steamdb\": {\r\n        \"persistent\": true,\r\n        \"permissions\": ctxPermissions,\r\n    },\r\n    \"context_steamdb_instant\": {\r\n        \"persistent\": true,\r\n        \"permissions\": ctxPermissions,\r\n    },\r\n    \"context_steam_keys\": {\r\n        \"persistent\": true,\r\n        \"permissions\": ctxPermissions,\r\n    },\r\n});\r\n\r\nclass Permissions {\r\n\r\n    /**\r\n     * @return Promise\r\n     */\r\n    static contains(permissionList) {\r\n        return browser.permissions.contains({\"permissions\": permissionList});\r\n    }\r\n\r\n    /**\r\n     * @return Promise\r\n     */\r\n    static request(permissionList) {\r\n        return browser.permissions.request({\"permissions\": permissionList});\r\n    }\r\n\r\n    /**\r\n     * @return Promise\r\n     */\r\n    static remove(permissionList) {\r\n        if (permissionList.includes(\"contextMenus\")) {\r\n            browser.contextMenus.removeAll();\r\n        }\r\n        return browser.permissions.remove({\"permissions\": permissionList});\r\n    }\r\n\r\n    static async when(permission, onAdded, onRemoved) {\r\n        if (onAdded) {\r\n            if (await Permissions.contains([permission])) {\r\n                onAdded();\r\n            }\r\n\r\n            browser.permissions.onAdded.addListener(p => {\r\n                if (p.permissions.includes(permission)) {\r\n                    onAdded();\r\n                }\r\n            });\r\n        }\r\n\r\n        if (onRemoved) {\r\n            browser.permissions.onRemoved.addListener(p => {\r\n                if (p.permissions.includes(permission)) {\r\n                    onRemoved();\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    static requestOption(option) {\r\n        return Permissions.request(PermissionOptions[option].permissions);\r\n    }\r\n\r\n    static removeOption(optionToRemove) {\r\n\r\n        // If any of the permissions is in use by another option, don't remove.\r\n        const unusedPermissions = Permissions._getUnusedPermissions(optionToRemove);\r\n        if (unusedPermissions.length === 0) {\r\n            return Promise.resolve(true);\r\n        }\r\n\r\n        return Permissions.remove(unusedPermissions);\r\n    }\r\n\r\n    static _getUnusedPermissions(option) {\r\n        const used = new Set();\r\n        for (const [key, setup] of Object.entries(PermissionOptions)) {\r\n            if (option === key || (setup.persistent && !SyncedStorage.get(key))) {\r\n                continue;\r\n            }\r\n\r\n            for (const p of setup.permissions) {\r\n                used.add(p);\r\n            }\r\n        }\r\n\r\n        const unused = new Set();\r\n        for (const p of PermissionOptions[option].permissions) {\r\n            if (!used.has(p)) {\r\n                unused.add(p);\r\n            }\r\n        }\r\n\r\n        return Array.from(unused.values());\r\n    }\r\n}\r\n\r\nexport {PermissionOptions, Permissions};\r\n","import {Info} from \"./Info\";\r\n\r\nclass Version {\r\n\r\n    constructor(major, minor = 0, patch = 0) {\r\n        console.assert([major, minor, patch].filter(Number.isInteger).length === 3, `${major}.${minor}.${patch} must be integers`);\r\n        this.major = major;\r\n        this.minor = minor;\r\n        this.patch = patch;\r\n    }\r\n\r\n    static from(version) {\r\n        if (version instanceof Version) {\r\n            return new Version(version.major, version.minor, version.patch);\r\n        }\r\n        if (typeof version == \"string\") {\r\n            return Version.fromString(version);\r\n        }\r\n        if (Array.isArray(version)) {\r\n            return Version.fromArray(version);\r\n        }\r\n        throw new Error(`Could not construct a Version from ${version}`);\r\n    }\r\n\r\n    static fromArray(version) {\r\n        return new Version(...version.map(v => parseInt(v)));\r\n    }\r\n\r\n    static fromString(version) {\r\n        return Version.fromArray(version.split(\".\"));\r\n    }\r\n\r\n    static coerce(version) {\r\n        if (version instanceof Version) {\r\n            return version;\r\n        }\r\n        return Version.from(version);\r\n    }\r\n\r\n    toString() {\r\n        return `${this.major}.${this.minor}.${this.patch}`;\r\n    }\r\n\r\n    toArray() {\r\n        return [this.major, this.minor, this.patch];\r\n    }\r\n\r\n    toJSON() {\r\n        return this.toString();\r\n    }\r\n\r\n    isCurrent() {\r\n        return this.isSameOrAfter(Info.version);\r\n    }\r\n\r\n    isSame(version) {\r\n        const _version = Version.coerce(version);\r\n        return this.major === _version.major\r\n            && this.minor === _version.minor\r\n            && this.patch === _version.patch;\r\n    }\r\n\r\n    isBefore(version) {\r\n        const _version = Version.coerce(version);\r\n        if (this.major < _version.major) { return true; }\r\n        if (this.major > _version.major) { return false; }\r\n\r\n        // this.major == _version.major\r\n        if (this.minor < _version.minor) { return true; }\r\n        if (this.minor > _version.minor) { return false; }\r\n\r\n        // this.minor == _version.minor\r\n        if (this.patch < _version.patch) { return true; }\r\n        return false;\r\n    }\r\n\r\n    isSameOrBefore(version) {\r\n        return this.isSame(version) || this.isBefore(version);\r\n    }\r\n\r\n    isAfter(version) {\r\n        const _version = Version.coerce(version);\r\n        return _version.isBefore(this);\r\n    }\r\n\r\n    isSameOrAfter(version) {\r\n        const _version = Version.coerce(version);\r\n        return _version.isSameOrBefore(this);\r\n    }\r\n}\r\n\r\nexport {Version};\r\n","import {SyncedStorage} from \"../../../Core/Storage/SyncedStorage\";\r\nimport {HTML} from \"../../../Core/Html/Html\";\r\nimport {Localization} from \"../../../Core/Localization/Localization\";\r\n\r\nclass ProgressBar {\r\n    static create() {\r\n        if (!SyncedStorage.get(\"show_progressbar\")) { return; }\r\n\r\n        HTML.afterEnd(\"#global_actions\",\r\n            `<div class=\"es_progress__wrap\">\r\n                <div class=\"es_progress es_progress--complete\" title=\"${Localization.str.ready.ready}\">\r\n                    <div class=\"es_progress__bar\">\r\n                        <div class=\"es_progress__value\"></div>\r\n                    </div>\r\n                </div>\r\n            </div>`);\r\n        ProgressBar._progress = document.querySelector(\".es_progress\");\r\n    }\r\n\r\n    static loading() {\r\n        if (!ProgressBar._progress) { return; }\r\n\r\n        ProgressBar._progress.setAttribute(\"title\", Localization.str.ready.loading);\r\n\r\n        ProgressBar.requests = {\"initiated\": 0, \"completed\": 0};\r\n        ProgressBar._progress.classList.remove(\"es_progress--complete\");\r\n        ProgressBar._progress.querySelector(\".es_progress__value\").style.width = \"18px\";\r\n    }\r\n\r\n    static startRequest() {\r\n        if (!ProgressBar.requests) { return; }\r\n        ProgressBar.requests.initiated++;\r\n        ProgressBar.progress();\r\n    }\r\n\r\n    static finishRequest() {\r\n        if (!ProgressBar.requests) { return; }\r\n        ProgressBar.requests.completed++;\r\n        ProgressBar.progress();\r\n    }\r\n\r\n    static progress(value) {\r\n        if (!ProgressBar._progress) { return; }\r\n\r\n        let _value = value;\r\n\r\n        if (!_value) {\r\n            if (!ProgressBar.requests) { return; }\r\n            if (ProgressBar.requests.initiated > 0) {\r\n                _value = 100 * ProgressBar.requests.completed / ProgressBar.requests.initiated;\r\n            }\r\n        }\r\n        if (_value > 100) {\r\n            _value = 100;\r\n        }\r\n\r\n        ProgressBar._progress.querySelector(\".es_progress__value\").style.width = `${_value}px`;\r\n\r\n        if (_value >= 100) {\r\n            ProgressBar._progress.classList.add(\"es_progress--complete\");\r\n            ProgressBar._progress.setAttribute(\"title\", Localization.str.ready.ready);\r\n            ProgressBar.requests = null;\r\n        }\r\n    }\r\n\r\n    static serverOutage() {\r\n        if (!ProgressBar._progress) { return; }\r\n\r\n        ProgressBar._progress.classList.add(\"es_progress--warning\");\r\n        ProgressBar.requests = null;\r\n\r\n        if (!ProgressBar._progress.parentElement.querySelector(\".es_progress__warning, .es_progress__error\")) {\r\n            HTML.afterEnd(\r\n                ProgressBar._progress,\r\n                `<div class=\"es_progress__warning\">${Localization.str.ready.server_outage}</div>`\r\n            );\r\n        }\r\n    }\r\n\r\n    static failed() {\r\n        if (!ProgressBar._progress) { return; }\r\n\r\n        const warningNode = ProgressBar._progress.parentElement.querySelector(\".es_progress__warning\");\r\n        if (warningNode) {\r\n            ProgressBar._progress.classList.remove(\"es_progress--warning\"); // Errors have higher precedence\r\n            warningNode.remove();\r\n        }\r\n        ProgressBar._progress.classList.add(\"es_progress--error\");\r\n        ProgressBar.requests = null;\r\n\r\n        const nodeError = ProgressBar._progress.parentElement.querySelector(\".es_progress__error\");\r\n        if (nodeError) {\r\n            nodeError.textContent = Localization.str.ready.failed.replace(\"__amount__\", ++ProgressBar._failedRequests);\r\n        } else {\r\n            HTML.afterEnd(\r\n                ProgressBar._progress,\r\n                `<div class=\"es_progress__error\">${\r\n                    Localization.str.ready.failed.replace(\"__amount__\", ++ProgressBar._failedRequests)\r\n                }</div>`\r\n            );\r\n        }\r\n    }\r\n}\r\n\r\nProgressBar._progress = null;\r\nProgressBar._failedRequests = 0;\r\n\r\nexport {ProgressBar};\r\n","import {BackgroundSimple} from \"../../Core/BackgroundSimple\";\r\nimport {ErrorParser} from \"../../Core/Errors/ErrorParser\";\r\nimport {ProgressBar} from \"./Widgets/ProgressBar\";\r\n\r\nclass Background extends BackgroundSimple {\r\n    static async message(message) {\r\n        ProgressBar.startRequest();\r\n\r\n        let result;\r\n        try {\r\n            result = await super.message(message);\r\n            ProgressBar.finishRequest();\r\n            return result;\r\n        } catch (err) {\r\n            const errObj = ErrorParser.parse(err.message);\r\n\r\n            switch (errObj.name) {\r\n                case \"ServerOutageError\":\r\n                    ProgressBar.serverOutage();\r\n                    break;\r\n                default: {\r\n                    if (!Background._errorHandlers.some(handler => handler(errObj))) {\r\n                        ProgressBar.failed();\r\n                    }\r\n                }\r\n            }\r\n            throw err;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @callback registerErrorHandlerCallback\r\n     * @param {string} name - The error name\r\n     * @param {string} msg - The error message\r\n     * @returns {boolean} - Whether the error has been handled\r\n     */\r\n\r\n    /**\r\n     * @param {registerErrorHandlerCallback} handler - The callback that will (eventually) handle the error\r\n     */\r\n    static registerErrorHandler(handler) {\r\n        Background._errorHandlers.push(handler);\r\n    }\r\n}\r\nBackground._errorHandlers = [];\r\n\r\nexport {Background};\r\n","\r\n/**\r\n * Convenience class for passing errors between contexts.\r\n * Errors thrown in the context of a message callback on the background page are\r\n * {@link https://github.com/mozilla/webextension-polyfill/blob/87bdfa844da054d189ac28423cf01b64ebfe1e5b/src/browser-polyfill.js#L418\r\n *  cut down to only send the message of the error},\r\n * losing information about the type.\r\n */\r\nclass ErrorParser {\r\n\r\n    /**\r\n     * Takes an Error string and parses it by splitting it into name and message\r\n     * @param {String} errStr a string created by Error.prototype.toString\r\n     * @returns {{name: String, msg: String}} an object containing information about the error name and its message\r\n     */\r\n    static parse(errStr) {\r\n        const info = errStr.match(/(.*):\\s(.+)/);\r\n\r\n        return {\"name\": info[1] || \"\", \"msg\": info[2] || \"\"};\r\n    }\r\n}\r\n\r\nexport {ErrorParser};\r\n","import {ProgressBar} from \"./Widgets/ProgressBar\";\r\nimport {Errors} from \"../../Core/Errors/Errors\";\r\n\r\nclass RequestData {\r\n\r\n    static async getHttp(url, settings = {}, responseType = \"text\") {\r\n\r\n        let _url = url;\r\n        const _settings = {\r\n            \"method\": \"GET\",\r\n            \"credentials\": \"include\",\r\n            \"headers\": {\"origin\": window.location.origin},\r\n            \"referrer\": window.location.origin + window.location.pathname,\r\n            ...settings\r\n        };\r\n\r\n        ProgressBar.startRequest();\r\n\r\n        if (_url.startsWith(\"//\")) { // TODO remove when not needed\r\n            _url = window.location.protocol + url;\r\n            console.warn(\"Requesting URL without protocol, please update\");\r\n        }\r\n\r\n        let response;\r\n\r\n        try {\r\n            response = await RequestData._fetchFn(_url, _settings);\r\n\r\n            if (!response.ok) {\r\n                throw new Errors.HTTPError(response.status, `HTTP ${response.status} ${response.statusText} for ${response.url}`);\r\n            }\r\n        } catch (err) {\r\n            ProgressBar.failed();\r\n            throw err;\r\n        }\r\n\r\n        ProgressBar.finishRequest();\r\n\r\n        return response[responseType]();\r\n    }\r\n\r\n    static post(url, formData, settings, returnJSON) {\r\n        return RequestData.getHttp(url, Object.assign(settings || {}, {\r\n            \"method\": \"POST\",\r\n            \"body\": formData\r\n        }), returnJSON ? \"json\" : \"text\");\r\n    }\r\n\r\n    static getJson(url, settings) {\r\n        return RequestData.getHttp(url, settings, \"json\");\r\n    }\r\n\r\n    static getBlob(url, settings) {\r\n        return RequestData.getHttp(url, settings, \"blob\");\r\n    }\r\n}\r\n\r\n/**\r\n * In Firefox, the global fetch lies in the sandbox environment, thus we have to\r\n * access the fetch function of the content window.\r\n * See https://bugzilla.mozilla.org/show_bug.cgi?id=1579347#c5\r\n */\r\nRequestData._fetchFn\r\n    // eslint-disable-next-line no-undef\r\n    = (typeof content !== \"undefined\" && content && content.fetch) // content is only available in FF environments\r\n    || fetch.bind(window);\r\n\r\nexport {RequestData};\r\n","import {CookieStorage} from \"../../Core/Storage/CookieStorage\";\r\nimport {HTMLParser} from \"../../Core/Html/HtmlParser\";\r\nimport {Background} from \"./Background\";\r\nimport {RequestData} from \"./RequestData\";\r\n\r\nclass User {\r\n\r\n    static get storeCountry() {\r\n\r\n        const url = new URL(window.location.href);\r\n\r\n        let country;\r\n        if (url.searchParams && url.searchParams.has(\"cc\")) {\r\n            country = url.searchParams.get(\"cc\");\r\n        } else {\r\n            country = User._storeCountry;\r\n            if (!country) {\r\n                country = CookieStorage.get(\"steamCountry\");\r\n            }\r\n        }\r\n\r\n        if (!country) {\r\n            console.warn(\"Failed to detect store country, falling back to US\");\r\n            country = \"US\";\r\n        }\r\n\r\n        return country.substr(0, 2);\r\n    }\r\n\r\n    static promise() {\r\n        if (User._promise) { return User._promise; }\r\n\r\n        const avatarNode = document.querySelector(\"#global_actions > a.user_avatar\");\r\n        let loginPromise;\r\n\r\n        if (avatarNode) {\r\n            User.profileUrl = avatarNode.href;\r\n            User.profilePath = avatarNode.pathname;\r\n\r\n            loginPromise = Background.action(\"login\", User.profilePath)\r\n                .then(login => {\r\n                    if (!login) { return; }\r\n                    User.isSignedIn = true;\r\n                    User.steamId = login.steamId;\r\n                });\r\n        } else {\r\n            loginPromise = Background.action(\"logout\");\r\n        }\r\n\r\n        User._promise = loginPromise\r\n            .then(() => Background.action(\"storecountry\"))\r\n            .catch(({message}) => { console.error(message); })\r\n            .then(country => {\r\n                if (country) {\r\n                    User._storeCountry = country;\r\n                    return null;\r\n                }\r\n\r\n                let newCountry;\r\n\r\n                if (window.location.hostname.endsWith(\"steampowered.com\")) {\r\n\r\n                    // Search through all scripts in case the order gets changed or a new one gets added\r\n                    for (const script of document.getElementsByTagName(\"script\")) {\r\n                        const match = script.textContent.match(/GDynamicStore\\.Init\\(.+?, '([A-Z]{2})/);\r\n                        if (match) {\r\n                            newCountry = match[1];\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                } else if (window.location.hostname === \"steamcommunity.com\") {\r\n                    const config = document.querySelector(\"#webui_config,#application_config\");\r\n                    if (config) {\r\n                        newCountry = JSON.parse(config.dataset.config).COUNTRY;\r\n                    }\r\n                }\r\n\r\n                if (newCountry) {\r\n                    User._storeCountry = newCountry;\r\n                    return Background.action(\"storecountry\", newCountry)\r\n                        .catch(({message}) => { console.error(message); });\r\n                } else {\r\n                    throw new Error(\"Script with user store country not found\");\r\n                }\r\n\r\n            })\r\n            .catch(err => {\r\n                console.group(\"Store country detection\");\r\n                console.warn(\"Failed to detect store country from page\");\r\n                console.error(err);\r\n                console.groupEnd();\r\n            });\r\n\r\n        return User._promise;\r\n    }\r\n\r\n    static then(onDone, onCatch) {\r\n        return User.promise().then(onDone, onCatch);\r\n    }\r\n\r\n    static get sessionId() {\r\n        if (!User._sessionId) {\r\n            User._sessionId = HTMLParser.getVariableFromDom(\"g_sessionID\", \"string\");\r\n        }\r\n        return User._sessionId;\r\n    }\r\n\r\n    static getPurchaseDate(lang, appName) {\r\n        const _appName = HTMLParser.clearSpecialSymbols(appName);\r\n        return Background.action(\"purchases\", _appName, lang);\r\n    }\r\n\r\n    /*\r\n     * Retrieve user access token to use in new style WebAPI calls (Services)\r\n     * https://github.com/Revadike/UnofficialSteamWebAPI/wiki/Get-Points-Summary-Config\r\n     */\r\n    static async getUserToken() {\r\n        // Use relative URL, so it matches domain (works on any steam domain)\r\n        const response = await RequestData.getJson(\"/pointssummary/ajaxgetasyncconfig\").catch(() => false);\r\n        if (!response || !response.success) {\r\n            throw new Error(\"Failed to get webapi token\");\r\n        }\r\n\r\n        return response.data.webapi_token;\r\n    }\r\n}\r\n\r\nexport {User};\r\n","import {User} from \"../User\";\r\n\r\nexport class CommunityUtils {\r\n\r\n    static currentUserIsOwner() {\r\n        if (!User.isSignedIn) { return false; }\r\n\r\n        let profileLink = document.querySelector(\".profile_small_header_texture > a, .friends_header_avatar > a\").href;\r\n        if (!profileLink.endsWith(\"/\")) {\r\n            profileLink += \"/\";\r\n        }\r\n\r\n        return profileLink === User.profileUrl;\r\n    }\r\n\r\n    static makeProfileLink(id, link, name, iconType, iconUrl) {\r\n        const mainType = iconUrl ? \"none\" : iconType;\r\n        let html = `<div class=\"es_profile_link profile_count_link\">\r\n                    <a class=\"es_sites_icons es_${id}_icon es_${mainType}\" href=\"${link}\" target=\"_blank\">`;\r\n\r\n        if (iconType !== \"none\" && iconUrl) {\r\n            html += `<i class=\"es_sites_custom_icon es_${iconType}\" style=\"background-image: url('${iconUrl}');\"></i>`;\r\n        }\r\n\r\n        html += `<span class=\"count_link_label\">${name}</span>\r\n                 <span class=\"profile_count_link_total\">&nbsp;</span></a></div>`; // Steam spacing\r\n\r\n        return html;\r\n    }\r\n}\r\n","import {HTMLParser} from \"../../Core/Html/HtmlParser\";\r\n\r\nclass SteamId {\r\n\r\n    static getSteamId() {\r\n        if (SteamId._steamId) { return SteamId._steamId; }\r\n\r\n        if (document.querySelector(\"#reportAbuseModal\")) {\r\n            SteamId._steamId = document.querySelector(\"input[name=abuseID]\").value;\r\n        } else {\r\n            SteamId._steamId = HTMLParser.getVariableFromDom(\"g_steamID\", \"string\");\r\n        }\r\n\r\n        if (!SteamId._steamId) {\r\n            const profileData = HTMLParser.getVariableFromDom(\"g_rgProfileData\", \"object\");\r\n            SteamId._steamId = profileData.steamid;\r\n        }\r\n\r\n        return SteamId._steamId;\r\n    }\r\n}\r\n\r\nclass SteamIdDetail {\r\n\r\n    /*\r\n     * @see https://developer.valvesoftware.com/wiki/SteamID\r\n     */\r\n\r\n    constructor(steam64str) {\r\n        if (!steam64str) {\r\n            throw new Error(\"Missing first parameter 'steam64str'.\");\r\n        }\r\n\r\n        const [upper32, lower32] = this._getBinary(steam64str);\r\n        this._y = lower32 & 1;\r\n        this._accountNumber = (lower32 & (((1 << 31) - 1) << 1)) >> 1;\r\n        this._instance = (upper32 & ((1 << 20) - 1));\r\n        this._type = (upper32 & (((1 << 4) - 1) << 20)) >> 20;\r\n        this._universe = (upper32 & (((1 << 8) - 1) << 24)) >> 24;\r\n\r\n        this._steamId64 = steam64str;\r\n    }\r\n\r\n    _divide(str) {\r\n        const length = str.length;\r\n        const result = [];\r\n        let num = 0;\r\n        for (let i = 0; i < length; i++) {\r\n            num += Number(str[i]);\r\n\r\n            const r = Math.floor(num / 2);\r\n            num = ((num - (2 * r)) * 10);\r\n\r\n            if (r !== 0 || result.length !== 0) {\r\n                result.push(r);\r\n            }\r\n        }\r\n\r\n        return [result, num > 0 ? 1 : 0];\r\n    }\r\n\r\n    _getBinary(str) {\r\n        let upper32 = 0;\r\n        let lower32 = 0;\r\n        let index = 0;\r\n        let bit = 0;\r\n        let _str = str;\r\n        do {\r\n            [_str, bit] = this._divide(_str);\r\n\r\n            if (bit) {\r\n                if (index < 32) {\r\n                    lower32 |= (1 << index);\r\n                } else {\r\n                    upper32 |= (1 << (index - 32));\r\n                }\r\n            }\r\n\r\n            index++;\r\n        } while (_str.length > 0);\r\n\r\n        return [upper32, lower32];\r\n    }\r\n\r\n    get id2() {\r\n        return `STEAM_${this._universe}:${this._y}:${this._accountNumber}`;\r\n    }\r\n\r\n\r\n    get id3() {\r\n        const map = new Map(\r\n            [\r\n                [0, \"I\"], // invalid\r\n                [1, \"U\"], // individual\r\n                [2, \"M\"], // multiset\r\n                [3, \"G\"], // game server\r\n                [4, \"A\"], // anon game server\r\n                [5, \"P\"], // pending\r\n                [6, \"C\"], // content server\r\n                [7, \"g\"], // clan\r\n                // [8, \"T / L / C\"], // chat // TODO no idea what does this mean\r\n                [9, \"a\"] // anon user\r\n            ]\r\n        );\r\n\r\n        let type = null;\r\n        if (map.has(this._type)) {\r\n            type = map.get(this._type);\r\n        }\r\n\r\n        if (!type) {\r\n            return null;\r\n        }\r\n\r\n        return `[${type}:${this._universe}:${(this._accountNumber << 1) | this._y}]`;\r\n    }\r\n\r\n    get id64() {\r\n        return this._steamId64;\r\n    }\r\n}\r\n\r\nexport {SteamId, SteamIdDetail};\r\n","import {SteamId} from \"../SteamId\";\r\nimport {Background} from \"../Background\";\r\nimport {User} from \"../User\";\r\n\r\nexport class ProfileData {\r\n\r\n    static promise() {\r\n        if (!this._promise) {\r\n            const steamId = SteamId.getSteamId();\r\n\r\n            this._promise = Background.action(\"profile\", steamId)\r\n                .then(response => {\r\n                    this._data = response;\r\n                    return this._data;\r\n                });\r\n        }\r\n        return this._promise;\r\n    }\r\n\r\n    static then(onDone, onCatch) {\r\n        return this.promise().then(onDone, onCatch);\r\n    }\r\n\r\n    static getBadges() {\r\n        if (this._promise === null) { console.warn(\"ProfileData were not initialized\"); }\r\n        return this._data.badges;\r\n    }\r\n\r\n    static getSteamRep() {\r\n        if (this._promise === null) { console.warn(\"ProfileData were not initialized\"); }\r\n        return this._data.steamrep;\r\n    }\r\n\r\n    static getStyle() {\r\n        if (this._promise === null) { console.warn(\"ProfileData were not initialized\"); }\r\n        return this._data.style;\r\n    }\r\n\r\n    static getBgImg() {\r\n        if (this._promise === null) { console.warn(\"ProfileData were not initialized\"); }\r\n        if (!this._data.bg || !this._data.bg.img) { return \"\"; }\r\n\r\n        return this._data.bg.img;\r\n    }\r\n\r\n    static getBgImgUrl() {\r\n        const img = this.getBgImg();\r\n        if (!img) { return \"\"; }\r\n        return `https://steamcommunity.com/economy/image/${img}`;\r\n    }\r\n\r\n    static getBgAppid() {\r\n        if (this._promise === null) { console.warn(\"ProfileData were not initialized\"); }\r\n        return this._data.bg && this._data.bg.appid ? parseInt(this._data.bg.appid) : null;\r\n    }\r\n\r\n    static async clearOwn() {\r\n        if (!User.isSignedIn) { return null; }\r\n        await Background.action(\"clearownprofile\", User.steamId);\r\n        this._promise = null;\r\n        return this.promise();\r\n    }\r\n}\r\n\r\nProfileData._data = {};\r\n","import {Errors} from \"../../../Core/Errors/Errors\";\r\n\r\n// Polyfill from https://gist.github.com/davidbarral/d0d4da70fa9e6f615595d01f54276e0b#file-promises-js\r\nif (!Promise.allSettled) {\r\n    Promise.allSettled = promises => Promise.all(\r\n        promises.map(promise => promise\r\n            .then(value => ({\r\n                \"status\": \"fulfilled\",\r\n                value,\r\n            }))\r\n            .catch(reason => ({\r\n                \"status\": \"rejected\",\r\n                reason,\r\n            })))\r\n    );\r\n}\r\n\r\nclass FeatureManager {\r\n    static async apply(features) {\r\n\r\n        this._promisesMap = new Map();\r\n\r\n        this._stats = {\r\n            \"completed\": 0,\r\n            \"failed\": 0,\r\n            \"dependency\": 0,\r\n        };\r\n\r\n        while (features.length > 0) {\r\n\r\n            const feature = features.pop();\r\n            const promise = this._generateFeatureChain(feature);\r\n\r\n            if (promise === null) {\r\n                features.unshift(feature);\r\n            } else {\r\n                this._promisesMap.set(feature.constructor, promise);\r\n            }\r\n        }\r\n\r\n        await Promise.allSettled(Array.from(this._promisesMap.values()));\r\n\r\n        console.log(\r\n            \"Feature loading complete, %i successfully loaded, %i failed to load, %i didn't load due to dependency errors\",\r\n            this._stats.completed,\r\n            this._stats.failed,\r\n            this._stats.dependency\r\n        );\r\n    }\r\n\r\n    static _generateFeatureChain(feature) {\r\n\r\n        let ready = true;\r\n        let promise = Promise.resolve(true);\r\n\r\n        if (Array.isArray(feature.constructor.dependencies)) {\r\n\r\n            // Ensure that all dependencies have generated a dependency chain for themselves\r\n            for (const dep of feature.constructor.dependencies) {\r\n                if (this._promisesMap.has(dep)) { continue; }\r\n\r\n                ready = false;\r\n                break;\r\n            }\r\n\r\n            if (ready) {\r\n\r\n                // Promise that waits for all dependencies to finish executing\r\n                promise = Promise.all(\r\n                    Array.from(this._promisesMap.entries())\r\n                        .filter(([ftr]) => feature.constructor.dependencies.includes(ftr))\r\n                        .map(([, promise]) => promise)\r\n                );\r\n            }\r\n        }\r\n\r\n        if (!ready) { return null; }\r\n\r\n        return promise\r\n            .then(previousCheck => { // Check if the dependencies have all their prerequisites fulfilled\r\n                let prev = true;\r\n\r\n                if (!feature.constructor.weakDependency) {\r\n                    if (Array.isArray(previousCheck)) {\r\n                        prev = previousCheck.every(res => res);\r\n                    } else {\r\n                        prev = previousCheck;\r\n                    }\r\n                }\r\n\r\n                return prev && feature.checkPrerequisites();\r\n            })\r\n            .then(async fulfilled => { // If the feature's prerequisites are fulfilled, apply it\r\n                if (fulfilled) {\r\n                    await feature.apply();\r\n                    ++this._stats.completed;\r\n                }\r\n                return fulfilled;\r\n            })\r\n            .catch(err => {\r\n\r\n                const featureName = feature.constructor.name;\r\n\r\n                if (err instanceof Errors.FeatureDependencyError) {\r\n                    console.warn(\r\n                        \"Not applying feature %s due to an error in the dependency chain (namely %s)\",\r\n                        featureName,\r\n                        err.featureName\r\n                    );\r\n                    ++this._stats.dependency;\r\n                    throw err;\r\n                }\r\n\r\n                console.group(featureName);\r\n                console.error(\"Error while applying feature %s\", featureName);\r\n                console.error(err);\r\n                console.groupEnd();\r\n\r\n                ++this._stats.failed;\r\n                throw new Errors.FeatureDependencyError(\"Failed to apply\", featureName);\r\n            });\r\n\r\n    }\r\n}\r\n\r\nexport {FeatureManager};\r\n","\r\nexport default Object.freeze({\r\n    \"ACCOUNT\": 1,\r\n    \"APP\": 2,\r\n    \"BUNDLE\": 3,\r\n    \"STORE_DEFAULT\": 4,\r\n    \"FUNDS\": 5,\r\n    \"REGISTER_KEY\": 6,\r\n    \"SALE\": 7, // unused\r\n    \"SEARCH\": 8,\r\n    \"STATS\": 9,\r\n    \"STORE_FRONT\": 10,\r\n    \"SUB\": 11,\r\n    \"WISHLIST\": 12,\r\n    \"AGECHECK\": 13,\r\n    \"COMMUNITY_DEFAULT\": 14,\r\n    \"WORKSHOP\": 15,\r\n    \"PROFILE_ACTIVITY\": 16,\r\n    \"GAMES\": 17,\r\n    \"PROFILE_EDIT\": 18,\r\n    \"BADGES\": 19,\r\n    \"GAME_CARD\": 20,\r\n    \"FRIENDS_THAT_PLAY\": 21,\r\n    \"FRIENDS\": 22, // unused\r\n    \"MARKET_SEARCH\": 23,\r\n    \"INVENTORY\": 24,\r\n    \"MARKET_LISTING\": 25,\r\n    \"MARKET_HOME\": 26,\r\n    \"PROFILE_HOME\": 27,\r\n    \"GROUP_HOME\": 28,\r\n    \"GUIDES\": 29,\r\n    \"COMMUNITY_APP\": 30,\r\n    \"COMMUNITY_STATS\": 31,\r\n    \"MY_WORKSHOP\": 32,\r\n    \"SHARED_FILES\": 33,\r\n    \"WORKSHOP_BROWSE\": 34,\r\n    \"EDIT_GUIDE\": 35,\r\n    \"RECOMMENDED\": 36,\r\n    \"BOOSTER_CREATOR\": 37,\r\n    \"TRADE_OFFER\": 38,\r\n    \"FRIENDS_AND_GROUPS\": 39,\r\n    \"POINTS_SHOP\": 40,\r\n});\r\n\r\n","import {GameId} from \"../../../Core/GameId\";\r\nimport {Background} from \"../Background\";\r\nimport {User} from \"../User\";\r\n\r\nclass DynamicStore {\r\n\r\n    /*\r\n     * FIXME\r\n     *  1. Check usage of `await DynamicStore`, currently it does nothing\r\n     *  2. getAppStatus() is not properly waiting for initialization of the DynamicStore\r\n     *  3. There is no guarante that `User` is initialized before `_fetch()` is called\r\n     *  4. getAppStatus() should probably be simplified if we force array even when only one storeId was requested\r\n     */\r\n\r\n    static clear() {\r\n        return Background.action(\"dynamicstore.clear\");\r\n    }\r\n\r\n    static async getAppStatus(storeId) {\r\n        const multiple = Array.isArray(storeId);\r\n        let promise;\r\n        let trimmedIds;\r\n\r\n        if (multiple) {\r\n            trimmedIds = storeId.map(id => GameId.trimStoreId(id));\r\n            promise = Background.action(\"dynamicstorestatus\", trimmedIds);\r\n        } else {\r\n            promise = Background.action(\"dynamicstorestatus\", GameId.trimStoreId(storeId));\r\n        }\r\n\r\n        let statusList;\r\n        const dsStatusList = await promise;\r\n\r\n        if (multiple) {\r\n            statusList = {};\r\n            for (let i = 0; i < storeId.length; ++i) {\r\n                const trimmedId = trimmedIds[i];\r\n                const id = storeId[i];\r\n                statusList[id] = {\r\n                    \"ignored\": dsStatusList[trimmedId].includes(\"ignored\"),\r\n                    \"wishlisted\": dsStatusList[trimmedId].includes(\"wishlisted\"),\r\n                };\r\n                if (id.startsWith(\"app/\")) {\r\n                    statusList[id].owned = dsStatusList[trimmedId].includes(\"ownedApps\");\r\n                } else if (id.startsWith(\"sub/\")) {\r\n                    statusList[id].owned = dsStatusList[trimmedId].includes(\"ownedPackages\");\r\n                }\r\n            }\r\n        } else {\r\n            statusList = {\r\n                \"ignored\": dsStatusList.includes(\"ignored\"),\r\n                \"wishlisted\": dsStatusList.includes(\"wishlisted\"),\r\n            };\r\n            if (storeId.startsWith(\"app/\")) {\r\n                statusList.owned = dsStatusList.includes(\"ownedApps\");\r\n            } else if (storeId.startsWith(\"sub/\")) {\r\n                statusList.owned = dsStatusList.includes(\"ownedPackages\");\r\n            }\r\n        }\r\n\r\n        return statusList;\r\n    }\r\n\r\n    static async getRandomApp() {\r\n        await DynamicStore._fetch();\r\n        return Background.action(\"dynamicStore.randomApp\");\r\n    }\r\n\r\n    static _fetch() {\r\n        if (!User.isSignedIn) {\r\n            return DynamicStore.clear();\r\n        }\r\n        return Promise.resolve(null);\r\n    }\r\n\r\n    static then(onDone, onCatch) {\r\n        if (!DynamicStore._promise) {\r\n            DynamicStore._promise = DynamicStore._fetch();\r\n        }\r\n        return DynamicStore._promise.then(onDone, onCatch);\r\n    }\r\n}\r\n\r\nexport {DynamicStore};\r\n","\r\nclass Feature {\r\n\r\n    /**\r\n     * @param {Context} context\r\n     */\r\n    constructor(context) {\r\n        this.context = context;\r\n    }\r\n\r\n    checkPrerequisites() {\r\n        return true;\r\n    }\r\n\r\n    apply() {\r\n        throw new Error(\"Stub\");\r\n    }\r\n\r\n    logError(err, msg, ...args) {\r\n        console.group(this.constructor.name);\r\n        console.error(msg, ...args);\r\n        console.error(err);\r\n        console.groupEnd();\r\n    }\r\n}\r\n\r\nexport {Feature};\r\n","\r\n// Most of the code here comes from dselect.js\r\nimport {HTML} from \"../../../Core/Html/Html\";\r\nimport {Localization} from \"../../../Core/Localization/Localization\";\r\nimport {SyncedStorage} from \"../../../Core/Storage/SyncedStorage\";\r\n\r\nclass Sortbox {\r\n\r\n    static init() {\r\n        this._activeDropLists = {};\r\n        this._lastSelectHideTime = 0;\r\n\r\n        // Hide droplist when clicking outside\r\n        document.addEventListener(\"mousedown\", e => {\r\n            for (const key of Object.keys(this._activeDropLists)) {\r\n                if (this._activeDropLists[key] && !e.target.closest(`#${key}_container`)) {\r\n                    this._hide(key);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    static _highlightItem(id, index, bSetSelected) {\r\n        const droplist = document.querySelector(`#${id}_droplist`);\r\n        const trigger = document.querySelector(`#${id}_trigger`);\r\n        const rgItems = droplist.getElementsByTagName(\"a\");\r\n\r\n        if (index >= 0 && index < rgItems.length) {\r\n            const item = rgItems[index];\r\n\r\n            if (typeof trigger.highlightedItem !== \"undefined\" && trigger.highlightedItem !== index) {\r\n                rgItems[trigger.highlightedItem].className = \"inactive_selection\";\r\n            }\r\n\r\n            trigger.highlightedItem = index;\r\n            rgItems[index].className = \"highlighted_selection\";\r\n\r\n            let yOffset = rgItems[index].offsetTop + rgItems[index].clientHeight;\r\n            let curVisibleOffset = droplist.scrollTop + droplist.clientHeight;\r\n            let bScrolledDown = false;\r\n            const nMaxLoopIterations = rgItems.length;\r\n            let nLoopCounter = 0;\r\n\r\n            while (curVisibleOffset < yOffset && nLoopCounter++ < nMaxLoopIterations) {\r\n                droplist.scrollTop += rgItems[index].clientHeight;\r\n                curVisibleOffset = droplist.scrollTop + droplist.clientHeight;\r\n                bScrolledDown = true;\r\n            }\r\n\r\n            if (!bScrolledDown) {\r\n                nLoopCounter = 0;\r\n                yOffset = rgItems[index].offsetTop;\r\n                curVisibleOffset = droplist.scrollTop;\r\n                while (curVisibleOffset > yOffset && nLoopCounter++ < nMaxLoopIterations) {\r\n                    droplist.scrollTop -= rgItems[index].clientHeight;\r\n                    curVisibleOffset = droplist.scrollTop;\r\n                }\r\n            }\r\n\r\n            if (bSetSelected) {\r\n                HTML.inner(trigger, item.innerHTML);\r\n                const input = document.querySelector(`#${id}`);\r\n                input.value = item.id;\r\n                input.dispatchEvent(new Event(\"change\"));\r\n\r\n                this._hide(id);\r\n            }\r\n        }\r\n    }\r\n\r\n    static _onFocus(id) {\r\n        this._activeDropLists[id] = true;\r\n    }\r\n\r\n    static _onBlur(id) {\r\n        if (!document.querySelector(`#${id}_trigger`).classList.contains(\"activetrigger\")) {\r\n            this._activeDropLists[id] = false;\r\n        }\r\n    }\r\n\r\n    static _hide(id) {\r\n        const droplist = document.querySelector(`#${id}_droplist`);\r\n        const trigger = document.querySelector(`#${id}_trigger`);\r\n\r\n        this._lastSelectHideTime = Date.now();\r\n\r\n        trigger.className = \"trigger\";\r\n        droplist.className = \"dropdownhidden\";\r\n        this._activeDropLists[id] = false;\r\n        trigger.focus();\r\n    }\r\n\r\n    static _show(id) {\r\n        if (Date.now() - this._lastSelectHideTime < 50) { return; }\r\n\r\n        const droplist = document.querySelector(`#${id}_droplist`);\r\n        const trigger = document.querySelector(`#${id}_trigger`);\r\n\r\n        trigger.className = \"activetrigger\";\r\n        droplist.className = \"dropdownvisible\";\r\n        this._activeDropLists[id] = true;\r\n        trigger.focus();\r\n    }\r\n\r\n    static _onTriggerClick(id) {\r\n        if (!document.querySelector(`#${id}_trigger`).classList.contains(\"activetrigger\")) {\r\n            this._show(id);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * NOTE FOR ADDON REVIEWER:\r\n     * Elements returned by this function are already sanitized (calls to HTML class),\r\n     * so they can be safely inserted without being sanitized again.\r\n     * If we would sanitize them again, all event listeners would be lost due to\r\n     * DOMPurify only returning HTML strings.\r\n     */\r\n    static get(name, options, initialOption, changeFn, storageOption) {\r\n\r\n        const id = `sort_by_${name}`;\r\n        let reversed = initialOption.endsWith(\"_DESC\");\r\n\r\n        const arrowDown = \"\";\r\n        const arrowUp = \"\";\r\n\r\n        const box = HTML.element(\r\n            `<div class=\"es-sortbox es-sortbox--${name}\">\r\n                <div class=\"es-sortbox__label\">${Localization.str.sort_by}</div>\r\n                <div id=\"${id}_container\" class=\"es-sortbox__container\">\r\n                    <input id=\"${id}\" type=\"hidden\" name=\"${name}\" value=\"${initialOption}\">\r\n                    <a id=\"${id}_trigger\" class=\"trigger\"></a>\r\n                    <div class=\"es-dropdown\">\r\n                        <ul id=\"${id}_droplist\" class=\"dropdownhidden\"></ul>\r\n                    </div>\r\n                </div>\r\n                <span class=\"es-sortbox__reverse\">${reversed ? arrowUp : arrowDown}</span>\r\n            </div>`\r\n        );\r\n\r\n        const input = box.querySelector(`#${id}`);\r\n\r\n        function getTrimmedValue(val) { return val.replace(/(_ASC|_DESC)$/, \"\"); }\r\n\r\n        function onChange(val, reversed) {\r\n            const _val = getTrimmedValue(val);\r\n            changeFn(_val, reversed);\r\n            if (storageOption) { SyncedStorage.set(storageOption, `${_val}_${reversed ? \"DESC\" : \"ASC\"}`); }\r\n        }\r\n\r\n        input.addEventListener(\"change\", () => { onChange(input.value.replace(`${id}_`, \"\"), reversed); });\r\n\r\n        // Trigger changeFn for initial option\r\n        if (initialOption !== \"default_ASC\") {\r\n            input.dispatchEvent(new Event(\"change\"));\r\n        }\r\n\r\n        const reverseEl = box.querySelector(\".es-sortbox__reverse\");\r\n        reverseEl.addEventListener(\"click\", () => {\r\n            reversed = !reversed;\r\n            reverseEl.textContent = reversed ? arrowUp : arrowDown;\r\n            onChange(input.value.replace(`${id}_`, \"\"), reversed);\r\n        });\r\n\r\n        const trigger = box.querySelector(`#${id}_trigger`);\r\n        trigger.addEventListener(\"focus\", () => this._onFocus(id));\r\n        trigger.addEventListener(\"blur\", () => this._onBlur(id));\r\n        trigger.addEventListener(\"click\", () => this._onTriggerClick(id));\r\n\r\n        const ul = box.querySelector(\"ul\");\r\n        const trimmedOption = getTrimmedValue(initialOption);\r\n        for (let i = 0; i < options.length; ++i) {\r\n            const [key, text] = options[i];\r\n\r\n            let toggle = \"inactive\";\r\n            if (key === trimmedOption) {\r\n                input.value = key;\r\n                trigger.textContent = text;\r\n                toggle = \"highlighted\";\r\n            }\r\n\r\n            HTML.beforeEnd(ul,\r\n                `<li>\r\n                    <a class=\"${toggle}_selection\" tabindex=\"99999\" id=\"${id}_${key}\">${text}</a>\r\n                </li>`);\r\n\r\n            const a = ul.querySelector(\"li:last-child > a\");\r\n\r\n            // a.href = \"javascript:DSelectNoop()\";\r\n            a.addEventListener(\"mouseover\", () => this._highlightItem(id, i, false));\r\n            a.addEventListener(\"click\", () => this._highlightItem(id, i, true));\r\n        }\r\n\r\n        return box;\r\n    }\r\n}\r\n\r\nSortbox.init();\r\n\r\nexport {Sortbox};\r\n","\r\nclass DOMHelper {\r\n\r\n    static wrap(container, node) {\r\n        const parent = node.parentNode;\r\n        parent.insertBefore(container, node);\r\n        parent.removeChild(node);\r\n        container.append(node);\r\n    }\r\n\r\n    static remove(selector) {\r\n        const node = document.querySelector(selector);\r\n        if (!node) { return; }\r\n        node.remove();\r\n    }\r\n\r\n    // TODO extend Node itself?\r\n    static selectLastNode(parent, selector) {\r\n        const nodes = parent.querySelectorAll(selector);\r\n        return nodes.length === 0 ? null : nodes[nodes.length - 1];\r\n    }\r\n\r\n    static insertStylesheet(href) {\r\n        const stylesheet = document.createElement(\"link\");\r\n        stylesheet.rel = \"stylesheet\";\r\n        stylesheet.type = \"text/css\";\r\n        stylesheet.href = href;\r\n        document.head.appendChild(stylesheet);\r\n    }\r\n\r\n    static insertScript({src, content}, id, onload, isAsync = true) {\r\n        const script = document.createElement(\"script\");\r\n\r\n        if (onload) { script.onload = onload; }\r\n        if (id) { script.id = id; }\r\n        if (src) { script.src = src; }\r\n        if (content) { script.textContent = content; }\r\n        if (isAsync) { script.setAttribute(\"async\", \"\"); }\r\n\r\n        document.head.appendChild(script);\r\n    }\r\n\r\n    static insertCSS(content, id) {\r\n        const style = document.createElement(\"style\");\r\n\r\n        if (id) { style.id = id; }\r\n        style.textContent = content;\r\n\r\n        document.head.appendChild(style);\r\n    }\r\n}\r\n\r\nexport {DOMHelper};\r\n","\r\nclass HorizontalScroller {\r\n\r\n    static create(parentNode, controlLeftNode, controlRightNode) {\r\n\r\n        let lastScroll = 0;\r\n\r\n        parentNode.addEventListener(\"wheel\", e => {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n\r\n            if (Date.now() - lastScroll < 200) { return; }\r\n            lastScroll = Date.now();\r\n\r\n            const isScrollDown = e.deltaY > 0;\r\n            if (isScrollDown) {\r\n                controlRightNode.click();\r\n            } else {\r\n                controlLeftNode.click();\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nexport {HorizontalScroller};\r\n","// This is the basic configuration for the Augmented Steam extension\r\n\r\nexport default {\r\n    \"ApiServerHost\": \"https://esapi.isthereanydeal.com\",\r\n    \"PublicHost\": \"https://augmentedsteam.com\",\r\n    \"ITADApiServerHost\": \"https://api.isthereanydeal.com\",\r\n    \"ITADClientId\": \"5fe78af07889f43a\"\r\n};\r\n","import {HTML} from \"../../Core/Html/Html\";\r\nimport {ExtensionResources} from \"../../Core/ExtensionResources\";\r\nimport {Localization} from \"../../Core/Localization/Localization\";\r\nimport {SyncedStorage} from \"../../Core/Storage/SyncedStorage\";\r\nimport {Language} from \"../../Core/Localization/Language\";\r\nimport {LocalStorage} from \"../../Core/Storage/LocalStorage\";\r\nimport {Background} from \"./Background\";\r\nimport {DOMHelper} from \"./DOMHelper\";\r\nimport {HorizontalScroller} from \"./Widgets/HorizontalScroller\";\r\nimport {DynamicStore} from \"./Data/DynamicStore\";\r\nimport {User} from \"./User\";\r\nimport {Page} from \"../Features/Page\";\r\nimport config from \"../../config\";\r\n\r\nclass AugmentedSteam {\r\n\r\n    static _addMenu() {\r\n\r\n        HTML.afterBegin(\"#global_action_menu\",\r\n            `<div id=\"es_menu\">\r\n                <span id=\"es_pulldown\" class=\"pulldown global_action_link\">Augmented Steam</span>\r\n                <div id=\"es_popup\" class=\"popup_block_new\">\r\n                    <div class=\"popup_body popup_menu\">\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"${ExtensionResources.getURL(\"html/options.html\")}\">${Localization.str.thewordoptions}</a>\r\n                        <a class=\"popup_menu_item\" id=\"es_clear_cache\" href=\"#clear_cache\">${Localization.str.clear_cache}</a>\r\n                        <div class=\"hr\"></div>\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"https://github.com/IsThereAnyDeal/AugmentedSteam\">${Localization.str.contribute}</a>\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"https://github.com/IsThereAnyDeal/AugmentedSteam/issues\">${Localization.str.bug_feature}</a>\r\n                        <div class=\"hr\"></div>\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"${config.PublicHost}\">${Localization.str.website}</a>\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"https://isthereanydeal.com/\">IsThereAnyDeal</a>\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"https://discord.gg/yn57q7f\">Discord</a>\r\n                    </div>\r\n                </div>\r\n            </div>`);\r\n\r\n        document.querySelector(\"#es_pulldown\").addEventListener(\"click\", () => {\r\n            Page.runInPageContext(() => {\r\n                window.SteamFacade.showMenu(\"es_pulldown\", \"es_popup\", \"right\", \"bottom\", true);\r\n            });\r\n        });\r\n\r\n        document.querySelector(\"#es_menu\").addEventListener(\"click\", e => {\r\n            e.stopPropagation();\r\n        });\r\n\r\n        document.querySelector(\"#es_popup\").addEventListener(\"click\", () => {\r\n            Page.runInPageContext(() => {\r\n                window.SteamFacade.hideMenu(\"es_pulldown\", \"es_popup\");\r\n            });\r\n        });\r\n\r\n        document.querySelector(\"#es_clear_cache\").addEventListener(\"click\", async e => {\r\n            e.preventDefault();\r\n\r\n            await AugmentedSteam.clearCache();\r\n            window.location.reload();\r\n        });\r\n    }\r\n\r\n    static _addBackToTop() {\r\n        if (!SyncedStorage.get(\"show_backtotop\")) { return; }\r\n\r\n        // Remove Steam's back-to-top button\r\n        DOMHelper.remove(\"#BackToTop\");\r\n\r\n        const btn = document.createElement(\"div\");\r\n        btn.classList.add(\"es_btt\");\r\n        btn.textContent = \"\";\r\n\r\n        document.body.append(btn);\r\n\r\n        btn.addEventListener(\"click\", () => {\r\n            window.scroll({\r\n                \"top\": 0,\r\n                \"left\": 0,\r\n                \"behavior\": \"smooth\"\r\n            });\r\n        });\r\n\r\n        window.addEventListener(\"scroll\", () => {\r\n            btn.classList.toggle(\"is-visible\", window.scrollY >= 400);\r\n        });\r\n    }\r\n\r\n    static _bindLogout() {\r\n\r\n        // TODO there should be a better detection of logout, probably\r\n        const logoutNode = document.querySelector(\"a[href$='javascript:Logout();']\");\r\n        logoutNode.addEventListener(\"click\", () => {\r\n            AugmentedSteam.clearCache();\r\n        });\r\n    }\r\n\r\n    static _addWarning(innerHTML, stopShowingHandler) {\r\n        const el = HTML.element(\r\n            `<div class=\"es_warn js-warn\">\r\n                <div class=\"es_warn__cnt\">\r\n                    <div>${innerHTML}</div>\r\n                    <div class=\"es_warn__control\">\r\n                        <a class=\"es_warn__btn js-warn-close\">${Localization.str.update.dont_show}</a>\r\n                        <a class=\"es_warn__btn js-warn-hide\">${Localization.str.hide}</a>\r\n                    </div>\r\n                </div>\r\n            </div>`\r\n        );\r\n\r\n        el.querySelector(\".js-warn-close\").addEventListener(\"click\", () => {\r\n            if (stopShowingHandler) {\r\n                stopShowingHandler();\r\n            }\r\n            el.closest(\".js-warn\").remove();\r\n        });\r\n\r\n        el.querySelector(\".js-warn-hide\").addEventListener(\"click\", () => {\r\n            el.closest(\".js-warn\").remove();\r\n        });\r\n\r\n        document.getElementById(\"global_header\").insertAdjacentElement(\"afterend\", el);\r\n    }\r\n\r\n    /**\r\n     * Display warning if browsing using a different language\r\n     */\r\n    static _addLanguageWarning() {\r\n        if (!SyncedStorage.get(\"showlanguagewarning\")) { return; }\r\n\r\n        const currentLanguage = Language.getCurrentSteamLanguage();\r\n        if (!currentLanguage) { return; }\r\n\r\n        if (!SyncedStorage.has(\"showlanguagewarninglanguage\")) {\r\n            SyncedStorage.set(\"showlanguagewarninglanguage\", currentLanguage);\r\n        }\r\n\r\n        const warningLanguage = SyncedStorage.get(\"showlanguagewarninglanguage\");\r\n\r\n        if (currentLanguage === warningLanguage) { return; }\r\n\r\n        Localization.loadLocalization(Language.getLanguageCode(warningLanguage)).then((strings) => {\r\n            AugmentedSteam._addWarning(\r\n                `${strings.using_language.replace(\"__current__\", strings.options.lang[currentLanguage] || currentLanguage)}\r\n                <a href=\"#\" id=\"es_reset_language_code\">\r\n                ${strings.using_language_return.replace(\"__base__\", strings.options.lang[warningLanguage] || warningLanguage)}\r\n                </a>`,\r\n                () => { SyncedStorage.set(\"showlanguagewarning\", false); }\r\n            );\r\n\r\n            document.querySelector(\"#es_reset_language_code\").addEventListener(\"click\", (e) => {\r\n                e.preventDefault();\r\n                // eslint-disable-next-line no-undef, new-cap\r\n                Page.runInPageContext(warningLanguage => { ChangeLanguage(warningLanguage); }, [warningLanguage]);\r\n            });\r\n        });\r\n    }\r\n\r\n    static _handleInstallSteamButton() {\r\n        const option = SyncedStorage.get(\"installsteam\");\r\n        if (option === \"hide\") {\r\n            DOMHelper.remove(\"div.header_installsteam_btn\");\r\n        } else if (option === \"replace\") {\r\n            const btn = document.querySelector(\"div.header_installsteam_btn > a\");\r\n            btn.textContent = Localization.str.viewinclient;\r\n            btn.href = `steam://openurl/${window.location.href}`;\r\n            btn.classList.add(\"es_steamclient_btn\");\r\n        }\r\n    }\r\n\r\n    static _addUsernameSubmenuLinks() {\r\n        // There are two menus; one for responsive (mobile) and one for \"unresponsive\" (desktop) design\r\n        for (const node of document.querySelectorAll(\".submenu_username\")) {\r\n            HTML.afterEnd(\r\n                node.querySelector(\"a\"),\r\n                `<a class=\"submenuitem\" href=\"//steamcommunity.com/my/games/\">${Localization.str.games}</a>`\r\n            );\r\n            HTML.afterEnd(\r\n                node.querySelector(\"a:nth-child(2)\"),\r\n                `<a class=\"submenuitem\" href=\"//store.steampowered.com/wishlist/\">${Localization.str.wishlist}</a>`\r\n            );\r\n            HTML.beforeEnd(\r\n                node,\r\n                `<a class=\"submenuitem\" href=\"//steamcommunity.com/my/recommended/\">${Localization.str.reviews}</a>`\r\n            );\r\n        }\r\n    }\r\n\r\n    static _cartLink() {\r\n        // There are two menus; one for responsive (mobile) and one for \"unresponsive\" (desktop) design\r\n        for (const wishlistLink of document.querySelectorAll(\".submenu_store > .submenuitem[href='https://steamcommunity.com/my/wishlist/']\")) {\r\n            HTML.afterEnd(wishlistLink, `<a class=\"submenuitem\" href=\"https://store.steampowered.com/cart/\">${Localization.str.cart}</a>`);\r\n        }\r\n    }\r\n\r\n    static _disableLinkFilter() {\r\n        if (!SyncedStorage.get(\"disablelinkfilter\")) { return; }\r\n\r\n        function removeLinkFilter(parent = document) {\r\n            const selector = \"a[href*='/linkfilter/']\";\r\n\r\n            for (const link of parent.querySelectorAll(selector)) {\r\n                link.href = new URLSearchParams(link.search).get(\"url\");\r\n            }\r\n        }\r\n\r\n        removeLinkFilter();\r\n\r\n        new MutationObserver(mutations => {\r\n            for (const mutation of mutations) {\r\n                for (const node of mutation.addedNodes) {\r\n                    if (node.nodeType !== Node.ELEMENT_NODE) { continue; }\r\n                    removeLinkFilter(node);\r\n                }\r\n            }\r\n        }).observe(document, {\"childList\": true, \"subtree\": true});\r\n    }\r\n\r\n    static _addRedeemLink() {\r\n        HTML.beforeBegin(\r\n            \"#account_language_pulldown\",\r\n            `<a class=\"popup_menu_item\" href=\"https://store.steampowered.com/account/registerkey\">${Localization.str.activate}</a>`\r\n        );\r\n    }\r\n\r\n    static _replaceAccountName() {\r\n        if (!SyncedStorage.get(\"replaceaccountname\")) { return; }\r\n\r\n        const logoutNode = document.querySelector(\"#account_dropdown .persona.online\");\r\n        const accountName = logoutNode.textContent.trim();\r\n        const communityName = document.querySelector(\"#account_pulldown\").textContent.trim();\r\n\r\n        logoutNode.textContent = communityName;\r\n\r\n        // Replace page header on account related pages\r\n        if (location.href.startsWith(\"https://store.steampowered.com/account\")) {\r\n            const pageHeader = document.querySelector(\"h2.pageheader\");\r\n            if (pageHeader) {\r\n                pageHeader.textContent = pageHeader.textContent.replace(new RegExp(accountName, \"i\"), communityName);\r\n            }\r\n        }\r\n\r\n        // Don't replace title on user pages that aren't mine\r\n        const isUserPage = /.*(id|profiles)\\/.+/g.test(location.pathname);\r\n        if (!isUserPage || location.pathname.includes(User.profilePath)) {\r\n            document.title = document.title.replace(accountName, communityName);\r\n        }\r\n    }\r\n\r\n    static _launchRandomButton() {\r\n\r\n        HTML.beforeEnd(\r\n            \"#es_popup .popup_menu\",\r\n            `<div class=\"hr\"></div>\r\n             <a id=\"es_random_game\" class=\"popup_menu_item\" style=\"cursor: pointer;\">${Localization.str.launch_random}</a>`\r\n        );\r\n\r\n        document.querySelector(\"#es_random_game\").addEventListener(\"click\", async() => {\r\n            const appid = await DynamicStore.getRandomApp();\r\n            if (!appid) { return; }\r\n\r\n            Background.action(\"appdetails\", appid).then(response => {\r\n                if (!response || !response.success) { return; }\r\n                const data = response.data;\r\n\r\n                let gameid = appid;\r\n                let gamename;\r\n                if (data.fullgame) {\r\n                    gameid = data.fullgame.appid;\r\n                    gamename = data.fullgame.name;\r\n                } else {\r\n                    gamename = data.name;\r\n                }\r\n\r\n                Page.runInPageContext((playGameStr, gameid, visitStore) => {\r\n                    const prompt = window.SteamFacade.showConfirmDialog(\r\n                        playGameStr,\r\n                        `<img src=\"//steamcdn-a.akamaihd.net/steam/apps/${gameid}/header.jpg\">`,\r\n                        null,\r\n                        null,\r\n                        visitStore\r\n                    );\r\n\r\n                    prompt.done(result => {\r\n                        if (result === \"OK\") { window.location.assign(`steam://run/${gameid}`); }\r\n                        if (result === \"SECONDARY\") { window.location.assign(`//store.steampowered.com/app/${gameid}`); }\r\n                    });\r\n                },\r\n                [\r\n                    Localization.str.play_game.replace(\"__gamename__\", gamename.replace(\"'\", \"\").trim()),\r\n                    gameid,\r\n                    Localization.str.visit_store,\r\n                ]);\r\n            });\r\n        });\r\n    }\r\n\r\n    static _skipGotSteam() {\r\n        if (!SyncedStorage.get(\"skip_got_steam\")) { return; }\r\n\r\n        // https://github.com/SteamDatabase/SteamTracking/blob/cdf367ce61926a896fe54d710b3ed25d66d7e333/store.steampowered.com/public/javascript/game.js#L1785\r\n        Page.runInPageContext(() => {\r\n            window.ShowGotSteamModal = function(steamUrl) { window.location.assign(steamUrl); };\r\n        });\r\n    }\r\n\r\n    static _keepSteamSubscriberAgreementState() {\r\n        const nodes = document.querySelectorAll(\"#market_sell_dialog_accept_ssa,#market_buyorder_dialog_accept_ssa,#accept_ssa\");\r\n        for (const node of nodes) {\r\n            node.checked = SyncedStorage.get(\"keepssachecked\");\r\n\r\n            node.addEventListener(\"click\", () => {\r\n                SyncedStorage.set(\"keepssachecked\", !SyncedStorage.get(\"keepssachecked\"));\r\n            });\r\n        }\r\n    }\r\n\r\n    static _defaultCommunityTab() {\r\n        const tab = SyncedStorage.get(\"community_default_tab\");\r\n        if (!tab) { return; }\r\n\r\n        const links = document.querySelectorAll(\"a[href^='https://steamcommunity.com/app/']\");\r\n        for (const link of links) {\r\n            if (link.classList.contains(\"apphub_sectionTab\")) { continue; }\r\n            if (!/^\\/app\\/[0-9]+\\/?$/.test(link.pathname)) { continue; }\r\n            if (!link.pathname.endsWith(\"/\")) {\r\n                link.pathname += \"/\";\r\n            }\r\n            link.pathname += `${tab}/`;\r\n        }\r\n    }\r\n\r\n    static _horizontalScrolling() {\r\n        if (!SyncedStorage.get(\"horizontalscrolling\")) { return; }\r\n\r\n        for (const node of document.querySelectorAll(\".slider_ctn:not(.spotlight)\")) {\r\n            HorizontalScroller.create(\r\n                node.parentNode.querySelector(\"#highlight_strip, .store_horizontal_autoslider_ctn\"),\r\n                node.querySelector(\".slider_left\"),\r\n                node.querySelector(\".slider_right\"),\r\n            );\r\n        }\r\n    }\r\n\r\n    static addLoginWarning(type) {\r\n        if (AugmentedSteam._loginWarningAdded || LocalStorage.get(`hide_login_warn_${type}`)) { return; }\r\n\r\n        let host;\r\n\r\n        if (type === \"store\") {\r\n            host = \"store.steampowered.com\";\r\n        } else if (type === \"community\") {\r\n            host = \"steamcommunity.com\";\r\n        } else {\r\n            console.warn(\"Unknown login warning type %s\", type);\r\n            return;\r\n        }\r\n\r\n        AugmentedSteam._addWarning(\r\n            `${Localization.str.login_warning.replace(\"__link__\", `<a href=\"https://${host}/login/\">${host}</a>`)}`,\r\n            () => { LocalStorage.set(`hide_login_warn_${type}`, true); }\r\n        );\r\n        AugmentedSteam._loginWarningAdded = true;\r\n\r\n        console.warn(\"Are you logged into %s?\", host);\r\n    }\r\n\r\n    static clearCache() {\r\n        return Background.action(\"cache.clear\");\r\n    }\r\n\r\n    static init() {\r\n        AugmentedSteam._addBackToTop();\r\n        AugmentedSteam._addMenu();\r\n        AugmentedSteam._addLanguageWarning();\r\n        AugmentedSteam._handleInstallSteamButton();\r\n        AugmentedSteam._disableLinkFilter();\r\n        AugmentedSteam._skipGotSteam();\r\n        AugmentedSteam._keepSteamSubscriberAgreementState();\r\n        AugmentedSteam._defaultCommunityTab();\r\n        AugmentedSteam._horizontalScrolling();\r\n        AugmentedSteam._cartLink();\r\n\r\n        if (User.isSignedIn) {\r\n            AugmentedSteam._addUsernameSubmenuLinks();\r\n            AugmentedSteam._addRedeemLink();\r\n            AugmentedSteam._replaceAccountName();\r\n            AugmentedSteam._launchRandomButton();\r\n            AugmentedSteam._bindLogout();\r\n        }\r\n    }\r\n}\r\n\r\nexport {AugmentedSteam};\r\n","\r\nclass StringUtils {\r\n\r\n    // https://stackoverflow.com/a/6969486/7162651\r\n    static escapeRegExp(str) {\r\n        return str.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\"); // $& means the whole matched string\r\n    }\r\n}\r\n\r\nexport {StringUtils};\r\n","import {SyncedStorage} from \"../../Core/Storage/SyncedStorage\";\r\nimport {StringUtils} from \"../../Core/Utils/StringUtils\";\r\nimport {Background} from \"./Background\";\r\nimport {Page} from \"../Features/Page\";\r\n\r\nclass SteamCurrency {\r\n\r\n    /*\r\n     * Example:\r\n     * {\r\n     *  \"id\": 1,\r\n     *  \"abbr\": \"USD\",\r\n     *  \"symbol\": \"$\",\r\n     *  \"hint\": \"United States Dollars\",\r\n     *  \"multiplier\": 100,\r\n     *  \"unit\": 1,\r\n     *  \"format\": {\r\n     *      \"places\": 2,\r\n     *      \"hidePlacesWhenZero\": false,\r\n     *      \"symbolFormat\": \"$\",\r\n     *      \"thousand\": \",\",\r\n     *      \"decimal\": \".\",\r\n     *      \"right\": false\r\n     *  }\r\n     * }\r\n     */\r\n\r\n    constructor({\r\n        id,\r\n        abbr = \"USD\",\r\n        symbol = \"$\",\r\n        hint = \"Default Currency\",\r\n        multiplier = 100,\r\n        unit = 1,\r\n        \"format\": {\r\n            \"places\": formatPlaces = 2,\r\n            \"hidePlacesWhenZero\": formatHidePlaces = false,\r\n            \"symbolFormat\": formatSymbol = \"$\",\r\n            \"thousand\": formatGroupSeparator = \",\",\r\n            \"group\": formatGroupSize = 3,\r\n            \"decimal\": formatDecimalSeparator = \".\",\r\n            \"right\": formatPostfixSymbol = false,\r\n        },\r\n    }) {\r\n\r\n        // console.assert(id && Number.isInteger(id))\r\n        Object.assign(this, {\r\n            \"id\": id, // Steam Currency ID, integer, 1-41 (at time of writing)\r\n            \"abbr\": abbr, // TLA for the currency\r\n            \"symbol\": symbol, // Symbol used to represent/recognize the currency, this is NULL for CNY to avoid collision with JPY\r\n            \"hint\": hint, // English label for the currency to reduce mistakes editing the JSON\r\n            \"multiplier\": multiplier, // multiplier used by Steam when writing values\r\n            \"unit\": unit, // Minimum transactional unit required by Steam.\r\n            \"format\": {\r\n                \"decimalPlaces\": formatPlaces, // How many decimal places does this currency have?\r\n                \"hidePlacesWhenZero\": formatHidePlaces, // Does this currency show decimal places for a .0 value?\r\n                \"symbol\": formatSymbol, // Symbol used when generating a string value of this currency\r\n                \"groupSeparator\": formatGroupSeparator, // Thousands separator\r\n                \"groupSize\": formatGroupSize, // Digits to a \"thousand\" for the thousands separator\r\n                \"decimalSeparator\": formatDecimalSeparator,\r\n                \"postfix\": formatPostfixSymbol, // Should format.symbol be post-fixed?\r\n            },\r\n        });\r\n        Object.freeze(this.format);\r\n        Object.freeze(this);\r\n    }\r\n\r\n    valueOf(price) {\r\n\r\n        // remove separators\r\n        let _price = price.trim()\r\n            .replace(this.format.groupSeparator, \"\");\r\n        if (this.format.decimalSeparator !== \".\") {\r\n            _price = _price.replace(this.format.decimalSeparator, \".\");\r\n        } // as expected by parseFloat()\r\n        _price = _price.replace(/[^\\d.]/g, \"\");\r\n\r\n        const value = parseFloat(_price);\r\n\r\n        if (Number.isNaN(value)) { return null; }\r\n        return value; // this.multiplier?\r\n    }\r\n\r\n    stringify(value, withSymbol = true) {\r\n        const sign = value < 0 ? \"-\" : \"\";\r\n        const _value = Math.abs(value);\r\n\r\n        let s = _value.toFixed(this.format.decimalPlaces),\r\n            decimals;\r\n\r\n        [s, decimals] = s.split(\".\");\r\n\r\n        const g = [];\r\n        let j = s.length;\r\n\r\n        for (; j > this.format.groupSize; j -= this.format.groupSize) {\r\n            g.unshift(s.substring(j - this.format.groupSize, j));\r\n        }\r\n        g.unshift(s.substring(0, j));\r\n        s = [sign, g.join(this.format.groupSeparator)];\r\n        if (this.format.decimalPlaces > 0) {\r\n            if (!this.format.hidePlacesWhenZero || parseInt(decimals) > 0) {\r\n                s.push(this.format.decimalSeparator);\r\n                s.push(decimals);\r\n            }\r\n        }\r\n        if (withSymbol) {\r\n            if (this.format.postfix) {\r\n                s.push(this.format.symbol);\r\n            } else {\r\n                s.unshift(this.format.symbol);\r\n            }\r\n        }\r\n        return s.join(\"\");\r\n    }\r\n\r\n    placeholder() {\r\n        let str = `1${this.format.groupSeparator}`;\r\n        let cur = 2;\r\n        for (let i = 0; i < this.format.groupSize; ++i, ++cur) {\r\n            str += cur;\r\n        }\r\n\r\n        if (this.format.decimalPlaces === 0) {\r\n            return str;\r\n        }\r\n\r\n        str += this.format.decimalSeparator;\r\n        for (let i = 0; i < this.format.decimalPlaces; ++i, ++cur) {\r\n            str += cur;\r\n        }\r\n        return str;\r\n    }\r\n\r\n    regExp() {\r\n        let regex = `^(?:\\\\d{1,${\r\n            this.format.groupSize\r\n        }}(?:${\r\n            StringUtils.escapeRegExp(this.format.groupSeparator)\r\n        }\\\\d{${\r\n            this.format.groupSize\r\n        }})+|\\\\d*)`;\r\n\r\n        if (this.format.decimalPlaces > 0) {\r\n            regex += `(?:${StringUtils.escapeRegExp(this.format.decimalSeparator)}\\\\d{0,${this.format.decimalPlaces}})?`;\r\n        }\r\n        regex += \"$\";\r\n\r\n        return new RegExp(regex);\r\n    }\r\n}\r\n\r\nclass CurrencyManager {\r\n\r\n    static _getCurrencyFromDom() {\r\n        const currencyNode = document.querySelector('meta[itemprop=\"priceCurrency\"]');\r\n        if (currencyNode && currencyNode.hasAttribute(\"content\")) {\r\n            return currencyNode.getAttribute(\"content\");\r\n        }\r\n        return null;\r\n    }\r\n\r\n    static async _getCurrencyFromWallet() {\r\n        const walletCurrency = await Page.runInPageContext(\r\n            // eslint-disable-next-line no-undef, camelcase\r\n            () => (typeof g_rgWalletInfo !== \"undefined\" && g_rgWalletInfo ? g_rgWalletInfo.wallet_currency : null),\r\n            null,\r\n            \"walletCurrency\"\r\n        );\r\n\r\n        if (walletCurrency) {\r\n            return CurrencyManager.currencyNumberToType(walletCurrency);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    static async _getStoreCurrency(context) {\r\n        let currency = CurrencyManager._getCurrencyFromDom();\r\n\r\n        if (!currency) {\r\n            currency = await CurrencyManager._getCurrencyFromWallet(context);\r\n        }\r\n\r\n        if (!currency) {\r\n            try {\r\n                currency = await Background.action(\"currency\");\r\n            } catch (error) {\r\n                console.error(`Couldn't load currency${error}`);\r\n            }\r\n        }\r\n\r\n        if (!currency) {\r\n            currency = \"USD\"; // fallback\r\n        }\r\n\r\n        return currency;\r\n    }\r\n\r\n    static getRate(from, to) {\r\n        if (from === to) { return 1; }\r\n\r\n        if (CurrencyManager._rates[from] && CurrencyManager._rates[from][to]) {\r\n            return CurrencyManager._rates[from][to];\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    static getCurrencySymbolFromString(str) {\r\n        const re = /(?:R\\$|S\\$|\\$|RM|kr|Rp|||||p|P|||TL||Mex\\$|CDN\\$|A\\$|HK\\$|NT\\$||SR|R |DH|CHF|CLP\\$|S\\/\\.|COL\\$|NZ\\$|ARS\\$||||KD|z|QR|\\$U)/;\r\n        const match = str.match(re);\r\n        return match ? match[0] : \"\";\r\n    }\r\n\r\n    static currencyTypeToNumber(type) {\r\n        return CurrencyManager.fromType(type).id;\r\n    }\r\n\r\n    static currencyNumberToType(number) {\r\n        return CurrencyManager.fromNumber(number).abbr;\r\n    }\r\n\r\n    /**\r\n     * @return SteamCurrency\r\n     */\r\n    static fromType(type) {\r\n        return CurrencyManager._indices.abbr[type] || CurrencyManager._defaultCurrency;\r\n    }\r\n\r\n    /**\r\n     * @return SteamCurrency\r\n     */\r\n    static fromNumber(number) {\r\n        return CurrencyManager._indices.id[number] || CurrencyManager._defaultCurrency;\r\n    }\r\n\r\n    static async _loadCurrency(context) {\r\n        CurrencyManager.storeCurrency = await CurrencyManager._getStoreCurrency(context);\r\n        const currencySetting = SyncedStorage.get(\"override_price\");\r\n        CurrencyManager.customCurrency = (currencySetting === \"auto\")\r\n            ? CurrencyManager.storeCurrency\r\n            : currencySetting;\r\n    }\r\n\r\n    static async _loadRates() {\r\n        const toCurrencies = [CurrencyManager.storeCurrency];\r\n        if (CurrencyManager.customCurrency !== CurrencyManager.storeCurrency) {\r\n            toCurrencies.push(CurrencyManager.customCurrency);\r\n        }\r\n        CurrencyManager._rates = await Background.action(\"rates\", toCurrencies);\r\n    }\r\n\r\n    static async init(context) {\r\n        if (CurrencyManager._isInitialized) { return; }\r\n\r\n        const currencies = await Background.action(\"steam.currencies\");\r\n\r\n        for (let currency of currencies) {\r\n\r\n            currency = new SteamCurrency(currency);\r\n            CurrencyManager._indices.abbr[currency.abbr] = currency;\r\n            CurrencyManager._indices.id[currency.id] = currency;\r\n\r\n            if (currency.symbol) { // CNY && JPY use the same symbol\r\n                CurrencyManager._indices.symbols[currency.symbol] = currency;\r\n            }\r\n        }\r\n        CurrencyManager._defaultCurrency = CurrencyManager._indices.id[1]; // USD\r\n\r\n        try {\r\n            await CurrencyManager._loadCurrency(context);\r\n            await CurrencyManager._loadRates();\r\n        } catch (e) {\r\n            console.error(\"Failed to initialize Currency\");\r\n            console.error(e);\r\n        }\r\n\r\n        CurrencyManager._isInitialized = true;\r\n    }\r\n\r\n    static then(onSuccess, onFailure) {\r\n        return CurrencyManager.init().then(onSuccess, onFailure);\r\n    }\r\n}\r\nCurrencyManager._isInitialized = false;\r\nCurrencyManager._indices = {\r\n    \"id\": {},\r\n    \"abbr\": {},\r\n    \"symbols\": {},\r\n};\r\n\r\nexport {CurrencyManager};\r\n","import {HTML} from \"../../Core/Html/Html\";\r\nimport {ExtensionResources} from \"../../Core/ExtensionResources\";\r\nimport {SyncedStorage} from \"../../Core/Storage/SyncedStorage\";\r\nimport {Localization} from \"../../Core/Localization/Localization\";\r\nimport {Background} from \"./Background\";\r\nimport {User} from \"./User\";\r\nimport {TimeUtils} from \"../../modulesCore\";\r\n\r\nclass ITAD {\r\n    static async create() {\r\n        if (!await Background.action(\"itad.isconnected\")) { return; }\r\n\r\n        HTML.afterBegin(\"#global_action_menu\",\r\n            `<div id=\"es_itad\">\r\n                <img id=\"es_itad_logo\" src=\"${ExtensionResources.getURL(\"img/itad.png\")}\">\r\n                <span id=\"es_itad_status\"></span>\r\n            </div>`);\r\n\r\n        document.querySelector(\"#es_itad\").addEventListener(\"mouseenter\", ITAD.onHover);\r\n\r\n        if (User.isSignedIn && (SyncedStorage.get(\"itad_import_library\") || SyncedStorage.get(\"itad_import_wishlist\"))) {\r\n            Background.action(\"itad.import\");\r\n        }\r\n    }\r\n\r\n    static async onHover() {\r\n\r\n        async function updateLastImport() {\r\n            const {from, to} = await Background.action(\"itad.lastimport\");\r\n\r\n            let htmlStr\r\n                = `<div>${Localization.str.itad.from}</div>\r\n                   <div>${from ? new Date(from * 1000).toLocaleString() : Localization.str.never}</div>`;\r\n\r\n            if (SyncedStorage.get(\"itad_import_library\") || SyncedStorage.get(\"itad_import_wishlist\")) {\r\n                htmlStr\r\n                    += `<div>${Localization.str.itad.to}</div>\r\n                        <div>${to ? new Date(to * 1000).toLocaleString() : Localization.str.never}</div>`;\r\n            }\r\n\r\n            HTML.inner(\".es-itad-hover__last-import\", htmlStr);\r\n        }\r\n\r\n        if (!document.querySelector(\".es-itad-hover\")) {\r\n            HTML.afterEnd(\"#es_itad_status\",\r\n                `<div class=\"es-itad-hover\">\r\n                    <div class=\"es-itad-hover__content\">\r\n                        <h4>${Localization.str.itad.last_import}</h4>\r\n                        <div class=\"es-itad-hover__last-import\"></div>\r\n                        <div class=\"es-itad-hover__sync-now\">\r\n                            <span class=\"es-itad-hover__sync-now-text\">${Localization.str.itad.sync_now}</span>\r\n                            <div class=\"loader\"></div>\r\n                            <span class=\"es-itad-hover__sync-failed\">&#10060;</span>\r\n                            <span class=\"es-itad-hover__sync-success\">&#10003;</span>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"es-itad-hover__arrow\"></div>\r\n                </div>`);\r\n\r\n            const hover = document.querySelector(\".es-itad-hover\");\r\n\r\n            const syncDiv = document.querySelector(\".es-itad-hover__sync-now\");\r\n            document.querySelector(\".es-itad-hover__sync-now-text\").addEventListener(\"click\", async() => {\r\n                syncDiv.classList.remove(\"es-itad-hover__sync-now--failed\", \"es-itad-hover__sync-now--success\");\r\n                syncDiv.classList.add(\"es-itad-hover__sync-now--loading\");\r\n                hover.style.display = \"block\";\r\n\r\n                let timeout;\r\n\r\n                try {\r\n                    await Background.action(\"itad.sync\");\r\n                    syncDiv.classList.add(\"es-itad-hover__sync-now--success\");\r\n                    await updateLastImport();\r\n\r\n                    timeout = 1000;\r\n                } catch (err) {\r\n                    syncDiv.classList.add(\"es-itad-hover__sync-now--failed\");\r\n\r\n                    console.group(\"ITAD sync\");\r\n                    console.error(\"Failed to sync with ITAD\");\r\n                    console.error(err);\r\n                    console.groupEnd();\r\n\r\n                    timeout = 3000;\r\n                } finally {\r\n                    TimeUtils.timer(timeout).then(() => { hover.style.display = \"\"; });\r\n                    syncDiv.classList.remove(\"es-itad-hover__sync-now--loading\");\r\n                }\r\n            });\r\n        }\r\n\r\n        await updateLastImport();\r\n    }\r\n\r\n    static async getAppStatus(storeIds, options) {\r\n        const opts = {\"waitlist\": true,\r\n            \"collection\": true,\r\n            ...options};\r\n\r\n        if (!opts.collection && !opts.waitlist) { return null; }\r\n\r\n        const multiple = Array.isArray(storeIds);\r\n        const promises = [];\r\n        const resolved = Promise.resolve(multiple ? {} : false);\r\n\r\n        if (await Background.action(\"itad.isconnected\")) {\r\n            if (opts.collection) {\r\n                promises.push(Background.action(\"itad.incollection\", storeIds));\r\n            } else {\r\n                promises.push(resolved);\r\n            }\r\n            if (opts.waitlist) {\r\n                promises.push(Background.action(\"itad.inwaitlist\", storeIds));\r\n            } else {\r\n                promises.push(resolved);\r\n            }\r\n        } else {\r\n            promises.push(resolved, resolved);\r\n        }\r\n\r\n        const [inCollection, inWaitlist] = await Promise.all(promises);\r\n\r\n        if (multiple) {\r\n            const result = {};\r\n            for (const id of storeIds) {\r\n                result[id] = {\r\n                    \"collected\": inCollection[id],\r\n                    \"waitlisted\": inWaitlist[id],\r\n                };\r\n            }\r\n            return result;\r\n        } else {\r\n            return {\r\n                \"collected\": inCollection,\r\n                \"waitlisted\": inWaitlist,\r\n            };\r\n        }\r\n    }\r\n}\r\n\r\nexport {ITAD};\r\n","\r\n/**\r\n * NOTE FOR ADDON REVIEWER:\r\n * This class is meant to simplify communication between extension context and page context.\r\n * Basically, we have wrapped postMessage API in this class.\r\n */\r\nclass Messenger {\r\n    static postMessage(msgID, info) {\r\n        window.postMessage({\r\n            \"type\": `es_${msgID}`,\r\n            \"information\": info\r\n        }, window.location.origin);\r\n    }\r\n\r\n    // Used for one-time events\r\n    static onMessage(msgID) {\r\n        return new Promise(resolve => {\r\n            function callback(e) {\r\n                if (e.source !== window) { return; }\r\n                if (!e.data || !e.data.type) { return; }\r\n                if (e.data.type === `es_${msgID}`) {\r\n                    resolve(e.data.information);\r\n                    window.removeEventListener(\"message\", callback);\r\n                }\r\n            }\r\n            window.addEventListener(\"message\", callback);\r\n        });\r\n    }\r\n\r\n    // Used for setting up a listener that should be able to receive more than one callback\r\n    static addMessageListener(msgID, callback) {\r\n        window.addEventListener(\"message\", e => {\r\n            if (e.source !== window) { return; }\r\n            if (!e.data || !e.data.type) { return; }\r\n            if (e.data.type === `es_${msgID}`) {\r\n                callback(e.data.information);\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nexport {Messenger};\r\n","import {SyncedStorage} from \"./Core/Storage/SyncedStorage\";\r\n\r\nlet initialized = false;\r\n\r\n/**\r\n * DOMPurify setup\r\n * @see https://github.com/cure53/DOMPurify\r\n */\r\nexport default function() {\r\n\r\n    if (initialized) { return; }\r\n    initialized = true;\r\n\r\n    const allowOpenInNewTab = SyncedStorage.get(\"openinnewtab\");\r\n\r\n    /*\r\n     * NOTE FOR ADDON REVIEWER:\r\n     * We are modifying default DOMPurify settings to allow other protocols in URLs\r\n     * and to allow links to safely open in new tabs.\r\n     *\r\n     * We took the original Regex and aded chrome-extension://, moz-extension:// and steam://\r\n     * First two are needed for linking local resources from extension,\r\n     * steam:// protocol is used by Steam store to open their own client (e.g. when you want to launch a game).\r\n     *\r\n     * The addition of the `target` attribute to the allowed attributes is done in order to be able to open links in a new tab.\r\n     * We only allow target=\"_blank\" while adding rel=\"noreferrer noopener\" to prevent child window to access window.opener\r\n     * as described in https://www.jitbit.com/alexblog/256-targetblank---the-most-underestimated-vulnerability-ever/\r\n     */\r\n\r\n    const purifyConfig = {\r\n        \"ALLOWED_URI_REGEXP\": /^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|chrome-extension|moz-extension|steam):|[^a-z]|[a-z+.-]+(?:[^a-z+.\\-:]|$))/i\r\n    };\r\n\r\n    if (allowOpenInNewTab) {\r\n        purifyConfig.ADD_ATTR = [\"target\"];\r\n\r\n        DOMPurify.addHook(\"uponSanitizeAttribute\", (node, data) => {\r\n            if (data.attrName === \"target\") {\r\n                if (data.attrValue === \"_blank\") {\r\n                    node.setAttribute(\"rel\", \"noreferrer noopener\");\r\n                } else {\r\n                    data.keepAttr = false;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    DOMPurify.setConfig(purifyConfig);\r\n}\r\n","import {Info, LocalStorage, Localization, SyncedStorage} from \"../../modulesCore\";\r\nimport {\r\n    AugmentedSteam, Background,\r\n    CurrencyManager,\r\n    DOMHelper,\r\n    ITAD, Messenger, ProgressBar,\r\n    UpdateHandler,\r\n    User\r\n} from \"../modulesContent\";\r\nimport {SteamFacade} from \"../Modules/SteamFacade\";\r\nimport setup from \"../../setup\";\r\nimport config from \"../../config\";\r\n\r\n/**\r\n * Event handler for uncaught Background errors\r\n */\r\nfunction unhandledrejection(ev) {\r\n    const err = ev.reason;\r\n    if (!err || !err.error) { return; } // Not a background error\r\n    ev.preventDefault();\r\n    ev.stopPropagation();\r\n    console.group(\"An error occurred in the background context.\");\r\n    console.error(err.localStack);\r\n    console.error(err.stack);\r\n    console.groupEnd();\r\n}\r\nwindow.addEventListener(\"unhandledrejection\", unhandledrejection);\r\n\r\n/**\r\n *  Inject the Messenger, SteamFacade class into the DOM, providing the same interface for the page context side\r\n */\r\nDOMHelper.insertScript({\"content\": `window.Messenger = ${Messenger.toString()}`});\r\nDOMHelper.insertScript({\"content\": `window.SteamFacade = ${SteamFacade.toString()}`});\r\n\r\nBackground.registerErrorHandler(({name, msg}) => {\r\n    if (name !== \"LoginError\") { return false; }\r\n\r\n    AugmentedSteam.addLoginWarning(msg);\r\n    ProgressBar.finishRequest();\r\n    return true;\r\n});\r\n\r\nclass Page {\r\n\r\n    /*\r\n     * NOTE: use cautiously!\r\n     * Run script in the context of the current tab\r\n     */\r\n    static runInPageContext(fun, args, withPromise) {\r\n        const script = document.createElement(\"script\");\r\n        let promise;\r\n        const argsString = Array.isArray(args) ? JSON.stringify(args) : \"[]\";\r\n\r\n        if (withPromise) {\r\n            const msgId = `msg_${++Page._msgCounter}`;\r\n            promise = Messenger.onMessage(msgId);\r\n            script.textContent = `(async () => { Messenger.postMessage(\"${msgId}\", await (${fun})(...${argsString})); })();`;\r\n        } else {\r\n            script.textContent = `(${fun})(...${argsString});`;\r\n        }\r\n\r\n        document.documentElement.appendChild(script);\r\n        script.parentNode.removeChild(script);\r\n        return promise;\r\n    }\r\n\r\n    async run(ContextClass) {\r\n        if (!document.getElementById(\"global_header\")) { return; }\r\n\r\n        try {\r\n            // TODO What errors can be \"suppressed\" here?\r\n            try {\r\n                await SyncedStorage;\r\n                setup();\r\n            } catch (err) {\r\n                console.error(err);\r\n            }\r\n\r\n            await Promise.all([LocalStorage, Localization, User, CurrencyManager]);\r\n        } catch (err) {\r\n            console.group(\"Augmented Steam initialization\");\r\n            console.error(\"Failed to initiliaze Augmented Steam\");\r\n            console.error(err);\r\n            console.groupEnd();\r\n            return;\r\n        }\r\n\r\n        console.log(\r\n            `%c Augmented %cSteam v${Info.version} %c ${config.PublicHost}`,\r\n            \"background: #000000; color: #046eb2\",\r\n            \"background: #000000; color: #ffffff\",\r\n            \"\",\r\n        );\r\n\r\n        ProgressBar.create();\r\n        ProgressBar.loading();\r\n        AugmentedSteam.init();\r\n        UpdateHandler.checkVersion(AugmentedSteam.clearCache);\r\n        ITAD.create();\r\n        this._pageSpecificFeatures();\r\n\r\n        const context = new ContextClass();\r\n        context.applyFeatures();\r\n    }\r\n\r\n    _pageSpecificFeatures() {\r\n        // left for overrides\r\n    }\r\n}\r\nPage._msgCounter = 0;\r\n\r\nexport {Page};\r\n","\r\n/* eslint-disable camelcase,no-undef,new-cap */\r\n\r\n// noinspection JSUnresolvedFunction,JSUnresolvedVariable\r\nclass SteamFacade {\r\n\r\n    // variables\r\n\r\n    static global(name) {\r\n        return window[name];\r\n    }\r\n\r\n    static globalSet(name, value) {\r\n        window[name] = value;\r\n    }\r\n\r\n    // dialogs\r\n\r\n    static showDialog(strTitle, strDescription, rgModalParams) {\r\n        ShowDialog(strTitle, strDescription, rgModalParams);\r\n    }\r\n\r\n    static showConfirmDialog(strTitle, strDescription, strOKButton, strCancelButton, strSecondaryActionButton) {\r\n        return ShowConfirmDialog(strTitle, strDescription, strOKButton, strCancelButton, strSecondaryActionButton);\r\n    }\r\n\r\n    static showAlertDialog(strTitle, strDescription, strOKButton) {\r\n        return ShowAlertDialog(strTitle, strDescription, strOKButton);\r\n    }\r\n\r\n    static showBlockingWaitDialog(strTitle, strDescription) {\r\n        return ShowBlockingWaitDialog(strTitle, strDescription);\r\n    }\r\n\r\n    static showNicknameModal() {\r\n        return ShowNicknameModal();\r\n    }\r\n\r\n    static dismissActiveModal() {\r\n        CModal.DismissActiveModal();\r\n    }\r\n\r\n    // menu\r\n\r\n    static showMenu(elemLink, elemPopup, align, valign, bLinkHasBorder) {\r\n        return ShowMenu(elemLink, elemPopup, align, valign, bLinkHasBorder);\r\n    }\r\n\r\n    static hideMenu(elemLink, elemPopup) {\r\n        return HideMenu(elemLink, elemPopup);\r\n    }\r\n\r\n    // app pages\r\n\r\n    static collapseLongStrings(selector) {\r\n        return CollapseLongStrings(selector);\r\n    }\r\n\r\n    static adjustVisibleAppTags(selector) {\r\n        return AdjustVisibleAppTags($J(selector));\r\n    }\r\n\r\n    static updatePlaytimeFilterValues(hourMin, hourMax) {\r\n        return UpdatePlaytimeFilterValues(hourMin, hourMax);\r\n    }\r\n\r\n    // events\r\n\r\n    static bindAutoFlyoutEvents() {\r\n        return BindAutoFlyoutEvents();\r\n    }\r\n\r\n    static sliderOnChange(value) {\r\n        return g_player.SliderOnChange(value);\r\n    }\r\n\r\n    // dynamic store\r\n\r\n    static dynamicStoreInvalidateCache() {\r\n        return GDynamicStore.InvalidateCache();\r\n    }\r\n\r\n    static dynamicStoreDecorateItems(selector, bForceRecalculate) {\r\n        return GDynamicStore.DecorateDynamicItems($J(selector), bForceRecalculate);\r\n    }\r\n\r\n    static onDynamicStoreReady(callback) {\r\n        return GDynamicStore.OnReady(callback);\r\n    }\r\n\r\n    static storeItemDataBindHover(selector, unAppID, unPackageID, unBundleID, rgAdditionalParams) {\r\n        GStoreItemData.BindHoverEvents($J(selector), unAppID, unPackageID, unBundleID, rgAdditionalParams);\r\n    }\r\n\r\n    // tooltips\r\n\r\n    static vTooltip(selector, isHtml = false) {\r\n        const isStore = window.location.host === \"store.steampowered.com\";\r\n\r\n        $J(selector).v_tooltip({\r\n            \"tooltipClass\": isStore ? \"store_tooltip\" : \"community_tooltip\",\r\n            \"dataName\": isHtml ? \"tooltipHtml\" : \"tooltipText\",\r\n            \"defaultType\": isHtml ? \"html\" : \"text\",\r\n            \"replaceExisting\": false\r\n        });\r\n    }\r\n\r\n    // market\r\n\r\n    static calculateFeeAmount(amount, publisherFee) {\r\n        return CalculateFeeAmount(amount, publisherFee);\r\n    }\r\n\r\n    static vCurrencyFormat(amount, currencyCode) {\r\n        return v_currencyformat(amount, currencyCode);\r\n    }\r\n\r\n    // friends\r\n\r\n    static toggleManageFriends() {\r\n        return ToggleManageFriends();\r\n    }\r\n\r\n    static openFriendChatInWebChat(chatId) {\r\n        return OpenFriendChatInWebChat(chatId);\r\n    }\r\n\r\n    // community\r\n\r\n    static submitGuide() {\r\n        return SubmitGuide();\r\n    }\r\n\r\n    static initMiniprofileHovers() {\r\n        return InitMiniprofileHovers();\r\n    }\r\n\r\n    static inviteUserToGroup(Modal, groupID, steamIDInvitee) {\r\n        return InviteUserToGroup(Modal, groupID, steamIDInvitee);\r\n    }\r\n\r\n    static getCheckedAccounts(selector) {\r\n        return GetCheckedAccounts(selector);\r\n    }\r\n\r\n    static execFriendAction(action, navid) {\r\n        return ExecFriendAction(action, navid);\r\n    }\r\n\r\n    static scrollOffsetForceRecalc() {\r\n        CScrollOffsetWatcher.ForceRecalc();\r\n    }\r\n\r\n    static vSetCookie(strCookieName, strValue, expiryInDays, path) {\r\n        V_SetCookie(strCookieName, strValue, expiryInDays, path);\r\n    }\r\n\r\n    static checkAgeGateSubmit(callbackFunc) {\r\n        CheckAgeGateSubmit(callbackFunc);\r\n    }\r\n\r\n    static loadImageGroupOnScroll(elTarget, strGroup) {\r\n        LoadImageGroupOnScroll(elTarget, strGroup);\r\n    }\r\n\r\n    static showModalContent(url, titleBarText, titleBarURL, sizeToFit) {\r\n        ShowModalContent(url, titleBarText, titleBarURL, sizeToFit);\r\n    }\r\n\r\n    // inventory\r\n\r\n    static firstPage() {\r\n        return InventoryFirstPage();\r\n    }\r\n\r\n    static lastPage() {\r\n        return InventoryLastPage();\r\n    }\r\n\r\n    static goToPage() {\r\n        return InventoryGoToPage();\r\n    }\r\n\r\n    static reloadCommunityInventory() {\r\n        return ReloadCommunityInventory();\r\n    }\r\n\r\n    static getMarketHashName(itemDesc) {\r\n        return GetMarketHashName(itemDesc);\r\n    }\r\n\r\n    static zoomYear() {\r\n        pricehistory_zoomDays(g_plotPriceHistory, g_timePriceHistoryEarliest, g_timePriceHistoryLatest, 365);\r\n    }\r\n\r\n    static zoomYearForSellDialog() {\r\n        pricehistory_zoomDays(SellItemDialog.m_plotPriceHistory, SellItemDialog.m_timePriceHistoryEarliest, SellItemDialog.m_timePriceHistoryLatest, 365);\r\n    }\r\n\r\n    // selections\r\n\r\n    static updateSelection() {\r\n        return UpdateSelection();\r\n    }\r\n\r\n    static selectAll() {\r\n        return SelectAll();\r\n    }\r\n\r\n    static selectNone() {\r\n        return SelectNone();\r\n    }\r\n\r\n    static selectInverse() {\r\n        return SelectInverse();\r\n    }\r\n\r\n\r\n    // jQuery functions\r\n\r\n    static jq(selector) {\r\n        return $J(selector);\r\n    }\r\n\r\n    static jqOnClick(selector, callback) {\r\n        $J(selector).on(\"click\", callback);\r\n    }\r\n\r\n    static jqAjax(settings) {\r\n        return $J.ajax(settings);\r\n    }\r\n\r\n    static jqGet(url, settings) {\r\n        return $J.get(url, settings);\r\n    }\r\n\r\n    static jqPost(url, settings) {\r\n        return $J.post(url, settings);\r\n    }\r\n\r\n    static jqTrigger(selector, eventName) {\r\n        return $J(selector).trigger(eventName);\r\n    }\r\n}\r\n\r\nexport {SteamFacade};\r\n","import {Version} from \"../../Core/Version\";\r\nimport {SyncedStorage} from \"../../Core/Storage/SyncedStorage\";\r\nimport {Info} from \"../../Core/Info\";\r\nimport {ExtensionResources} from \"../../Core/ExtensionResources\";\r\nimport {Localization} from \"../../Core/Localization/Localization\";\r\nimport {BackgroundSimple} from \"../../Core/BackgroundSimple\";\r\nimport {Background} from \"./Background\";\r\nimport {LocalStorage} from \"../../Core/Storage/LocalStorage\";\r\nimport {ITAD} from \"./ITAD\";\r\nimport {Page} from \"../Features/Page\";\r\n\r\nclass UpdateHandler {\r\n\r\n    static async checkVersion(onUpdate) {\r\n        const lastVersion = Version.fromString(SyncedStorage.get(\"version\"));\r\n        const currentVersion = Version.fromString(Info.version);\r\n\r\n        if (currentVersion.isAfter(lastVersion)) {\r\n\r\n            let changelogPromise = Promise.resolve();\r\n            if (SyncedStorage.get(\"version_show\")) {\r\n                changelogPromise = this._showChangelog().catch(err => { console.error(\"Failed to show changelog: %o\", err); });\r\n            }\r\n\r\n            await Promise.all([\r\n                changelogPromise,\r\n                this._migrateSettings(lastVersion),\r\n                onUpdate(),\r\n            ]);\r\n        }\r\n\r\n        SyncedStorage.set(\"version\", Info.version);\r\n    }\r\n\r\n    static async _showChangelog() {\r\n\r\n        const changelog = await ExtensionResources.getJSON(\"changelog.json\");\r\n        const html = changelog[Info.version];\r\n        if (!html) {\r\n            throw new Error(`Can't find changelog for version ${Info.version}`);\r\n        }\r\n\r\n        const logo = ExtensionResources.getURL(\"img/logo/as128.png\");\r\n        const githubChanges = `<p><a href=\"https://github.com/IsThereAnyDeal/AugmentedSteam/compare/v${SyncedStorage.get(\"version\")}...v${Info.version}\">All changes on GitHub</a></p>`;\r\n        const dialog = `<div class=\"es_changelog\"><img src=\"${logo}\"><div>${html}${githubChanges}</div></div>`;\r\n\r\n        const connectBtn = document.querySelector(\"#itad_connect\");\r\n        function itadConnected() { connectBtn.replaceWith(\"\"); }\r\n\r\n        Page.runInPageContext(\r\n            (updatedStr, dialog) => {\r\n                window.SteamFacade.showAlertDialog(updatedStr, dialog);\r\n            },\r\n            [Localization.str.update.updated.replace(\"__version__\", Info.version), dialog]\r\n        );\r\n\r\n        if (Version.fromString(Info.version).isSame(new Version(1, 4))) {\r\n\r\n            if (await BackgroundSimple.action(\"itad.isconnected\")) {\r\n                itadConnected();\r\n            } else {\r\n                connectBtn.addEventListener(\"click\", async() => {\r\n                    await BackgroundSimple.action(\"itad.authorize\");\r\n                    ITAD.create();\r\n                    itadConnected();\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    static _migrateSettings(oldVersion) {\r\n\r\n        if (oldVersion.isSameOrBefore(\"1.3.1\")) {\r\n            BackgroundSimple.action(\"cache.clear\");\r\n\r\n            SyncedStorage.set(\"horizontalscrolling\", SyncedStorage.get(\"horizontalmediascrolling\"));\r\n            SyncedStorage.remove(\"horizontalmediascrolling\");\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"1.4\")) {\r\n            SyncedStorage.remove(\"show_sysreqcheck\");\r\n        }\r\n\r\n        if (oldVersion.isSame(\"1.4\")) {\r\n            Background.action(\"migrate.notesToSyncedStorage\");\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"1.4.1\")) {\r\n            SyncedStorage.set(\"profile_steamid\", SyncedStorage.get(\"profile_permalink\"));\r\n            SyncedStorage.remove(\"profile_permalink\");\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"1.4.3\")) {\r\n            SyncedStorage.remove(\"contscroll\");\r\n            Background.action(\"logout\");\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"1.4.7\")) {\r\n            const emoticons = LocalStorage.get(\"fav_emoticons\");\r\n            if (Array.isArray(emoticons)) {\r\n                SyncedStorage.set(\"fav_emoticons\", emoticons);\r\n            }\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"2.0.0\")) {\r\n            SyncedStorage.remove(\"showfakeccwarning\");\r\n            SyncedStorage.remove(\"hideaboutlinks\");\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"2.0.1\")) {\r\n            SyncedStorage.remove(\"hide_dlcunownedgames\");\r\n            SyncedStorage.remove(\"hide_wishlist\");\r\n            SyncedStorage.remove(\"hide_cart\");\r\n            SyncedStorage.remove(\"hide_notdiscounted\");\r\n            SyncedStorage.remove(\"hide_mixed\");\r\n            SyncedStorage.remove(\"hide_negative\");\r\n            SyncedStorage.remove(\"hide_priceabove\");\r\n            SyncedStorage.remove(\"priceabove_value\");\r\n            SyncedStorage.remove(\"hide_owned\");\r\n            SyncedStorage.remove(\"hide_ignored\");\r\n            SyncedStorage.remove(\"highlight_notdiscounted\");\r\n\r\n            SyncedStorage.remove(\"showallfriendsthatown\");\r\n\r\n            if (SyncedStorage.has(\"showusernotes\")) {\r\n                const val = SyncedStorage.get(\"showusernotes\");\r\n                SyncedStorage.set(\"user_notes_app\", val);\r\n                SyncedStorage.set(\"user_notes_wishlist\", val);\r\n                SyncedStorage.remove(\"showusernotes\");\r\n            }\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"2.1.0\")) {\r\n            SyncedStorage.remove(\"showcomparelinks\");\r\n\r\n            const links = SyncedStorage.get(\"profile_custom_link\");\r\n            for (const link of links) {\r\n                if (link.url && !link.url.includes(\"[ID]\")) {\r\n                    link.url += \"[ID]\";\r\n                }\r\n            }\r\n            SyncedStorage.set(\"profile_custom_link\", links);\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"2.2.1\")) {\r\n            Background.action(\"migrate.cachestorage\");\r\n        }\r\n    }\r\n}\r\n\r\nexport {UpdateHandler};\r\n","import {HTML, Localization, SyncedStorage} from \"../../../modulesCore\";\r\n\r\nexport class CommentHandler {\r\n\r\n    static _toggleHiddenCommentsButton(threadNode, count) {\r\n        threadNode.classList.add(\"esi_commentthread\");\r\n\r\n        let button = threadNode.querySelector(\".esi_commentthread_button\");\r\n\r\n        if (count === 0) {\r\n            if (button) {\r\n                button.classList.add(\"esi-hidden\");\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (!button) {\r\n            button = document.createElement(\"a\");\r\n            button.classList.add(\"esi_commentthread_button\");\r\n            threadNode.insertAdjacentElement(\"afterbegin\", button);\r\n\r\n            button.addEventListener(\"click\", () => {\r\n                threadNode.classList.add(\"esi_commentthread--showspam\");\r\n            });\r\n        }\r\n\r\n        button.classList.remove(\"esi-hidden\");\r\n        button.textContent = Localization.str.spam_comment_show.replace(\"__num__\", count);\r\n        threadNode.classList.remove(\"esi_commentthread--showspam\");\r\n    }\r\n\r\n    static _addCommentThreadObserver(threadNode) {\r\n        if (threadNode.dataset.esiCommentObserver) { return; }\r\n        threadNode.dataset.esiCommentObserver = \"1\";\r\n\r\n        const observer = new MutationObserver(() => {\r\n            this._updateCommentThread(threadNode);\r\n        });\r\n        observer.observe(threadNode.querySelector(\".commentthread_comments\"), {\"childList\": true});\r\n    }\r\n\r\n    static _hideSpamComments(threadNode) {\r\n        const nodes = threadNode.querySelectorAll(\".commentthread_comment .commentthread_comment_text\");\r\n        let hiddenCount = 0;\r\n        for (const node of nodes) {\r\n            const commentText = node.textContent;\r\n            if (!this._spamRgx.test(commentText)) { continue; }\r\n\r\n            node.closest(\".commentthread_comment\").classList.add(\"esi_comment_hidden\");\r\n            hiddenCount++;\r\n        }\r\n\r\n        return hiddenCount;\r\n    }\r\n\r\n    static _updateCommentThread(node) {\r\n        const countHidden = this._hideSpamComments(node);\r\n        this._toggleHiddenCommentsButton(node, countHidden);\r\n    }\r\n\r\n    static _handleAllCommentThreads(parent) {\r\n        const nodes = parent.querySelectorAll(\".commentthread_comment_container:not(.esi_commentthread)\");\r\n        for (const node of nodes) {\r\n            this._updateCommentThread(node);\r\n            this._addCommentThreadObserver(node);\r\n        }\r\n    }\r\n\r\n    static hideSpamComments() {\r\n        if (!SyncedStorage.get(\"hidespamcomments\")) { return; }\r\n\r\n        this._spamRgx = new RegExp(SyncedStorage.get(\"spamcommentregex\"), \"i\");\r\n\r\n        this._handleAllCommentThreads(document);\r\n\r\n        /*\r\n         * modal content\r\n         * TODO(tomas.fedor) this should be handled in apphub page\r\n         */\r\n        const modalWait = document.querySelector(\"#modalContentWait\");\r\n        if (!modalWait) { return; }\r\n\r\n        const observer = new MutationObserver(() => {\r\n            const modalContainer = document.querySelector(\"#modalContentFrameContainer\");\r\n            if (!modalContainer) { return; }\r\n\r\n            const latestFrame = window.frames[window.frames.length - 1]; // tomas.fedor Only check latest added frame\r\n            this._handleAllCommentThreads(latestFrame.document);\r\n        });\r\n        observer.observe(modalWait, {\"attributes\": true});\r\n    }\r\n\r\n    static _updateFavs(favs, emoticonPopup, favBox, name) {\r\n        SyncedStorage.set(\"fav_emoticons\", favs);\r\n\r\n        if (name && favs.includes(name) && favs.length > 1) {\r\n            HTML.beforeEnd(favBox, this._buildEmoticonOption(name));\r\n            const node = favBox.querySelector(`[data-emoticon=\"${name}\"]`);\r\n            this._finalizeFav(node, emoticonPopup);\r\n        } else if (name && !favs.includes(name) && favs.length > 0) {\r\n            const node = favBox.querySelector(`[data-emoticon=\"${name}\"]`);\r\n            if (!node) { return; }\r\n            node.remove();\r\n        } else {\r\n            const favsHtml = this._buildFavBox(favs);\r\n            HTML.inner(favBox, favsHtml);\r\n            for (const node of favBox.querySelectorAll(\".emoticon_option\")) {\r\n                this._finalizeFav(node, emoticonPopup);\r\n            }\r\n        }\r\n    }\r\n\r\n    static _finalizeFav(node, emoticonPopup) {\r\n        node.draggable = true;\r\n        node.querySelector(\"img\").draggable = false;\r\n        node.addEventListener(\"dragstart\", (ev) => this._dragFavEmoticon(ev));\r\n        node.addEventListener(\"click\", (ev) => this._clickFavEmoticon(ev, emoticonPopup));\r\n    }\r\n\r\n    static _dragFavEmoticon(ev) {\r\n        ev.dataTransfer.setData(\"emoticon\", ev.target.dataset.emoticon);\r\n        const emoticonHover = document.querySelector(\".emoticon_hover\");\r\n        if (emoticonHover) {\r\n            emoticonHover.style.display = \"none\";\r\n        }\r\n    }\r\n\r\n    static _clickFavEmoticon(ev, emoticonPopup) {\r\n        const node = ev.target.closest(\".emoticon_option\");\r\n        const noFav = emoticonPopup.querySelector(`[data-emoticon=${node.dataset.emoticon}]:not(.es_fav)`);\r\n        if (!noFav) {\r\n            // The user doesn't have access to this emoticon\r\n            ev.stopPropagation();\r\n            node.classList.add(\"no-access\");\r\n            node.querySelector(\"img\").title = Localization.str.fav_emoticons_no_access;\r\n            return;\r\n        }\r\n        noFav.click();\r\n    }\r\n\r\n    static _buildFavBox(favs = []) {\r\n        let favsHtml;\r\n        if (favs.length) {\r\n            favsHtml = favs.map(fav => this._buildEmoticonOption(fav)).join(\"\");\r\n        } else {\r\n            favsHtml = Localization.str.fav_emoticons_dragging;\r\n        }\r\n        return favsHtml;\r\n    }\r\n\r\n    static _buildEmoticonOption(name) {\r\n        return `<div class=\"emoticon_option es_fav\" data-emoticon=\"${name}\"><img src=\"https://steamcommunity-a.akamaihd.net/economy/emoticon/${name}\" class=\"emoticon\"></div>`;\r\n    }\r\n\r\n    static addFavoriteEmoticons() {\r\n        if (document.querySelectorAll(\".emoticon_button\").length === 0) {\r\n            return;\r\n        }\r\n\r\n        const observer = new MutationObserver(() => {\r\n            const emoticonPopup = document.querySelector(\".emoticon_popup:not(.es_emoticons)\");\r\n            if (!emoticonPopup) { return; }\r\n\r\n            emoticonPopup.classList.add(\"es_emoticons\");\r\n\r\n            for (const node of emoticonPopup.querySelectorAll(\".emoticon_option\")) {\r\n                node.draggable = true;\r\n                node.querySelector(\"img\").draggable = false;\r\n                node.addEventListener(\"dragstart\", (ev) => this._dragFavEmoticon(ev));\r\n            }\r\n\r\n            let favs = SyncedStorage.get(\"fav_emoticons\");\r\n            HTML.afterBegin(emoticonPopup,\r\n                `<div class=\"emoticon_popup_content es_emoticons_content\">\r\n                    <div class=\"commentthread_entry_quotebox\" id=\"es_fav_remove\"></div>\r\n                    <div class=\"commentthread_entry_quotebox\" id=\"es_fav_emoticons\"></div>\r\n                </div>`);\r\n\r\n            const favBox = emoticonPopup.querySelector(\"#es_fav_emoticons\");\r\n            const favRemove = emoticonPopup.querySelector(\"#es_fav_remove\");\r\n            this._updateFavs(favs, emoticonPopup, favBox);\r\n\r\n            favBox.addEventListener(\"dragover\", ev => {\r\n                ev.preventDefault();\r\n                favBox.style.backgroundColor = \"black\";\r\n            });\r\n\r\n            favBox.addEventListener(\"dragenter\", () => {\r\n                favBox.style.backgroundColor = \"black\";\r\n            });\r\n\r\n            favBox.addEventListener(\"dragleave\", ev => {\r\n                // Prevent background flicker when hovering over child elements, see https://stackoverflow.com/a/54960084\r\n                if (!favBox.contains(ev.relatedTarget)) {\r\n                    favBox.style.backgroundColor = null;\r\n                }\r\n            });\r\n\r\n            favBox.addEventListener(\"drop\", ev => {\r\n                ev.preventDefault();\r\n\r\n                favBox.style.backgroundColor = null;\r\n                const name = ev.dataTransfer.getData(\"emoticon\");\r\n                if (favs.includes(name)) { return; }\r\n\r\n                favs.push(name);\r\n                this._updateFavs(favs, emoticonPopup, favBox, name);\r\n            });\r\n\r\n            favRemove.addEventListener(\"dragover\", ev => {\r\n                ev.preventDefault();\r\n                favRemove.style.backgroundColor = \"black\";\r\n            });\r\n\r\n            favRemove.addEventListener(\"dragenter\", () => {\r\n                favRemove.style.backgroundColor = \"black\";\r\n            });\r\n\r\n            favRemove.addEventListener(\"dragleave\", () => {\r\n                favRemove.style.backgroundColor = null;\r\n            });\r\n\r\n            favRemove.addEventListener(\"drop\", ev => {\r\n                ev.preventDefault();\r\n\r\n                favRemove.style.backgroundColor = null;\r\n                const name = ev.dataTransfer.getData(\"emoticon\");\r\n                favs = favs.filter(fav => fav !== name);\r\n                this._updateFavs(favs, emoticonPopup, favBox, name);\r\n            });\r\n        });\r\n\r\n        observer.observe(document.body, {\"childList\": true});\r\n    }\r\n}\r\n","import {HTML, SyncedStorage} from \"../../../modulesCore\";\r\nimport {ContextType, Feature} from \"../../modulesContent\";\r\n\r\nexport default class FHideTrademarks extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return SyncedStorage.get(\"hidetmsymbols\");\r\n    }\r\n\r\n    apply() {\r\n\r\n        // TODO I would try to reduce number of selectors here\r\n        let selectors = \"title, .apphub_AppName, .breadcrumbs, h1, h4\";\r\n        if (this.context.type === ContextType.STORE_DEFAULT) {\r\n            selectors\r\n                += \".game_area_already_owned, .details_block, .game_description_snippet, \"\r\n                + \".game_area_description p, .glance_details, .game_area_dlc_bubble game_area_bubble, .package_contents, \"\r\n                + \".game_area_dlc_name, .tab_desc, .tab_item_name\";\r\n        } else {\r\n            selectors\r\n                += \".game_suggestion, .appHubShortcut_Title, .apphub_CardContentNewsTitle, \"\r\n                + \".apphub_CardTextContent, .apphub_CardContentAppName, .apphub_AppName\";\r\n        }\r\n\r\n        // Replaces \"R\", \"C\" and \"TM\" signs\r\n        function replaceSymbols(node) {\r\n\r\n            // tfedor I don't trust this won't break any inline JS\r\n            if (!node || !node.innerHTML) { return; }\r\n            HTML.inner(node, node.innerHTML.replace(/[\\u00AE\\u00A9\\u2122]/g, \"\"));\r\n        }\r\n\r\n        for (const node of document.querySelectorAll(selectors)) {\r\n            replaceSymbols(node);\r\n        }\r\n\r\n        const observer = new MutationObserver(mutations => {\r\n            mutations.forEach(mutation => {\r\n                mutation.addedNodes.forEach(node => {\r\n                    replaceSymbols(node);\r\n                });\r\n            });\r\n        });\r\n\r\n        const nodes = document.querySelectorAll(\"#game_select_suggestions,#search_suggestion_contents,.tab_content_ctn\");\r\n        for (const node of nodes) {\r\n            observer.observe(node, {\"childList\": true, \"subtree\": true});\r\n        }\r\n    }\r\n}\r\n","import {Context, ContextType} from \"../../modulesContent\";\r\nimport FHideTrademarks from \"../Common/FHideTrademarks\";\r\n\r\nexport class CCommunityBase extends Context {\r\n\r\n    constructor(type = ContextType.COMMUNITY_DEFAULT, features = []) {\r\n\r\n        features.push(\r\n            FHideTrademarks,\r\n        );\r\n\r\n        super(type, features);\r\n    }\r\n}\r\n","import {FeatureManager} from \"../Feature/FeatureManager\";\r\n\r\nclass Context {\r\n\r\n    constructor(type, features) {\r\n        this._callbacks = [];\r\n        this.type = type;\r\n        this.features = features.map(Ref => new Ref(this));\r\n    }\r\n\r\n    applyFeatures() {\r\n        return FeatureManager.apply(this.features);\r\n    }\r\n\r\n    registerCallback(fn) {\r\n        this._callbacks.push(fn);\r\n    }\r\n\r\n    triggerCallbacks(...params) {\r\n        for (const callback of this._callbacks) {\r\n            callback(...params);\r\n        }\r\n    }\r\n}\r\n\r\nexport {Context};\r\n","import {ExtensionResources, GameId, HTML, Language, Localization, SyncedStorage} from \"../../../modulesCore\";\r\nimport {Background, Feature} from \"../../modulesContent\";\r\n\r\nexport default class FEarlyAccess extends Feature {\r\n\r\n    apply() {\r\n        FEarlyAccess.show();\r\n    }\r\n\r\n    static async show(nodes) {\r\n        if (!SyncedStorage.get(\"show_early_access\")) { return; }\r\n\r\n        const _nodes = nodes || document.querySelectorAll(this._selector);\r\n        if (_nodes.length === 0) { return; }\r\n\r\n        if (!this._container) {\r\n\r\n            // TODO add missing images for supported locales\r\n            let imageName = \"img/overlay/early_access_banner_english.png\";\r\n            if (Language.isCurrentLanguageOneOf([\r\n                \"brazilian\",\r\n                \"french\",\r\n                \"italian\",\r\n                \"japanese\",\r\n                \"koreana\",\r\n                \"polish\",\r\n                \"portuguese\",\r\n                \"russian\",\r\n                \"schinese\",\r\n                \"spanish\",\r\n                \"latam\",\r\n                \"tchinese\",\r\n                \"thai\"\r\n            ])) {\r\n                imageName = `img/overlay/early_access_banner_${Language.getCurrentSteamLanguage()}.png`;\r\n            }\r\n\r\n            const imageUrl = ExtensionResources.getURL(imageName);\r\n\r\n            this._container = HTML.element(\r\n                `<span class=\"es_overlay_container\">\r\n                    <span class=\"es_overlay\">\r\n                        <img title=\"${Localization.str.early_access}\" src=\"${imageUrl}\">\r\n                    </span>\r\n                </span>`\r\n            );\r\n        }\r\n\r\n        for (const node of await this.getEaNodes(_nodes)) {\r\n\r\n            /*\r\n             * TODO It's possible a child element has been checked already, remove when not needed\r\n             * e.g. duplicate elements on the storefront (More Curator Recommendations)\r\n             * and when called with the same arguments as highlighting (observing changes in CStoreBase)\r\n             */\r\n            if (node.querySelector(\".es_overlay_container\") !== null) { continue; }\r\n\r\n            node.classList.add(\"es_early_access\");\r\n\r\n            const imgHeader = node.querySelector(\"img\");\r\n            if (!imgHeader) { continue; }\r\n\r\n            const container = this._container.cloneNode(true);\r\n            imgHeader.insertAdjacentElement(\"afterend\", container);\r\n            container.append(imgHeader);\r\n        }\r\n    }\r\n\r\n    static async getEaNodes(nodes) {\r\n\r\n        const appidsMap = new Map();\r\n\r\n        for (const node of nodes) {\r\n\r\n            node.classList.add(\"es_ea_checked\");\r\n\r\n            // Skip the live streams section since the thumbnail is shown on top\r\n            if (node.classList.contains(\"store_capsule\") && node.querySelector(\".capsule[id^=broadcast]\") !== null) {\r\n                continue;\r\n            }\r\n\r\n            let appid = GameId.getAppid(node)\r\n                || GameId.getAppid(node.querySelector(\"a\"))\r\n                || GameId.getAppidImgSrc(node.querySelector(\"img\"));\r\n\r\n            if (appid) {\r\n                appid = String(appid);\r\n                if (appidsMap.has(appid)) {\r\n                    appidsMap.get(appid).push(node);\r\n                } else {\r\n                    appidsMap.set(appid, [node]);\r\n                }\r\n            }\r\n        }\r\n\r\n        if (appidsMap.size === 0) { return []; }\r\n\r\n        const eaStatus = await Background.action(\"isea\", Array.from(appidsMap.keys()));\r\n\r\n        return Array.from(appidsMap).flatMap(([appid, nodesArray]) => {\r\n            return eaStatus[appid] ? nodesArray : [];\r\n        });\r\n    }\r\n}\r\n\r\n// TODO support React-based sales pages, curator lists, etc.\r\nFEarlyAccess._selector = [\r\n    // Store only, selectors for the Community are split into relevant contexts\r\n    \".tab_item\", // Item rows on storefront, genre, category, tags etc. pages\r\n    \".quadscreenshot_carousel a\", // Top carousel on genre, category, tags etc. pages\r\n    \".newonsteam_headercap\", // explore/new\r\n    \".comingsoon_headercap\", // explore/upcoming\r\n    \".store_capsule\",\r\n    \".dailydeal_ctn\",\r\n    \".special.special_img_ctn\", // explore/new, cart/\r\n    /*\r\n     * These use CSS backgrounds instead of img elements, unsupported for now\r\n     * \".store_main_capsule\", // Featured & Recommended\r\n     * \".home_marketing_message\", // Updates and Offers\r\n     */\r\n    \".home_area_spotlight\", // Special Offers, specials/\r\n    \".curator_giant_capsule\", // Curator Recommendations\r\n    \".home_content_item\",\r\n    \".home_content.single\",\r\n    \".highlighted_app_header\", // curators/\r\n    \"#curator_avatar_image\", // Header image on dlc pages\r\n    \".curator_featured a\", // Featured items on curator, developer, publisher, franchise, dlc etc. pages\r\n    \".search_result_row\",\r\n    \".small_cap\", // \"recommended\" section on app pages\r\n    \".browse_tag_game_cap\", // tag/browse\r\n    \".header_image\", // recommended/morelike, friendactivity header\r\n    \".similar_grid_capsule\", // recommended/morelike\r\n    \".friend_game_block a[data-ds-appid]\",\r\n    \".friendactivity_tab_row\",\r\n    \".recommendation_app\",\r\n    \".recommendation_carousel_item\",\r\n    \".app_header\",\r\n    \".friendplaytime_appheader\",\r\n].map(sel => `${sel}:not(.es_ea_checked)`)\r\n    .join(\",\");\r\n","import {GameId} from \"../../../modulesCore\";\r\nimport {Feature} from \"../../modulesContent\";\r\n\r\nexport default class FFixAppImageNotFound extends Feature {\r\n\r\n    apply() {\r\n\r\n        function fixSrc(node) {\r\n\r\n            const appid = GameId.getAppid(node.parentNode.href);\r\n            if (!appid) { return; }\r\n\r\n            const src = `https://cdn.akamai.steamstatic.com/steam/apps/${appid}/capsule_184x69.jpg`;\r\n\r\n            const testImg = document.createElement(\"img\");\r\n            testImg.src = src;\r\n            testImg.addEventListener(\"load\", () => {\r\n                node.src = src;\r\n            });\r\n        }\r\n\r\n        document.querySelectorAll(\"img[src$='338200c5d6c4d9bdcf6632642a2aeb591fb8a5c2.gif']\")\r\n            .forEach(node => fixSrc(node));\r\n\r\n        const container = document.querySelector(\"#games_list_rows\");\r\n        if (!container) { return; }\r\n\r\n        new MutationObserver(mutations => {\r\n            for (const {target} of mutations) {\r\n                if (target.src.endsWith(\"338200c5d6c4d9bdcf6632642a2aeb591fb8a5c2.gif\")) {\r\n                    fixSrc(target);\r\n                }\r\n            }\r\n        }).observe(container, {\"subtree\": true, \"attributeFilter\": [\"src\"]});\r\n    }\r\n}\r\n","import {HTML, Language, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {CommunityUtils, Feature, SteamId} from \"../../../modulesContent\";\r\n\r\nexport default class FCommunityProfileLinks extends Feature {\r\n\r\n    apply() {\r\n\r\n        const steamId = SteamId.getSteamId();\r\n\r\n        const links = [\r\n            {\r\n                \"id\": \"steamrep\",\r\n                \"link\": `https://steamrep.com/profiles/${steamId}`,\r\n                \"name\": \"SteamRep\",\r\n            },\r\n            {\r\n                \"id\": \"steamdbcalc\",\r\n                \"link\": `https://steamdb.info/calculator/?player=${steamId}`,\r\n                \"name\": \"SteamDB\",\r\n            },\r\n            {\r\n                \"id\": \"steamgifts\",\r\n                \"link\": `https://www.steamgifts.com/go/user/${steamId}`,\r\n                \"name\": \"SteamGifts\",\r\n            },\r\n            {\r\n                \"id\": \"steamtrades\",\r\n                \"link\": `https://www.steamtrades.com/user/${steamId}`,\r\n                \"name\": \"SteamTrades\",\r\n            },\r\n            {\r\n                \"id\": \"bartervg\",\r\n                \"link\": `https://barter.vg/steam/${steamId}`,\r\n                \"name\": \"Barter.vg\",\r\n            },\r\n            {\r\n                \"id\": \"astats\",\r\n                \"link\": `https://www.achievementstats.com/index.php?action=profile&playerId=${steamId}`,\r\n                \"name\": \"Achievement Stats\",\r\n            },\r\n            {\r\n                \"id\": \"backpacktf\",\r\n                \"link\": `https://backpack.tf/profiles/${steamId}`,\r\n                \"name\": \"Backpack.tf\",\r\n            },\r\n            {\r\n                \"id\": \"astatsnl\",\r\n                \"link\": `https://astats.astats.nl/astats/User_Info.php?steamID64=${steamId}`,\r\n                \"name\": \"AStats.nl\",\r\n            }\r\n        ];\r\n\r\n        // Add SteamRepCN link if language is Chinese\r\n        const language = Language.getCurrentSteamLanguage();\r\n        if ((language === \"schinese\" || language === \"tchinese\") && SyncedStorage.get(\"profile_steamrepcn\")) {\r\n            links.push({\r\n                \"id\": \"steamrepcn\",\r\n                \"link\": `https://steamrepcn.com/profiles/${steamId}`,\r\n                \"name\": (language === \"schinese\" ? \"\" : \"\")\r\n            });\r\n        }\r\n\r\n        let html = \"\";\r\n        let iconType = SyncedStorage.get(\"show_profile_link_images\");\r\n\r\n        for (const {id, link, name} of links) {\r\n            if (!SyncedStorage.get(`profile_${id}`)) { continue; }\r\n            html += CommunityUtils.makeProfileLink(id, link, name, iconType);\r\n        }\r\n\r\n        // custom profile link\r\n        for (const customLink of SyncedStorage.get(\"profile_custom_link\")) {\r\n            if (!customLink.enabled) { continue; }\r\n\r\n            const name = HTML.escape(customLink.name);\r\n            const link = `//${HTML.escape(customLink.url.replace(\"[ID]\", steamId))}`;\r\n            let icon;\r\n            if (customLink.icon) {\r\n                icon = `//${HTML.escape(customLink.icon)}`;\r\n            } else {\r\n                iconType = \"none\";\r\n            }\r\n\r\n            html += CommunityUtils.makeProfileLink(\"custom\", link, name, iconType, icon);\r\n        }\r\n\r\n        if (html) {\r\n            const linksNode = document.querySelector(\".profile_item_links\");\r\n            if (linksNode) {\r\n                HTML.beforeEnd(linksNode, `${html}<div style=\"clear: both;\"></div>`);\r\n            } else {\r\n                const rightColNode = document.querySelector(\".profile_rightcol\");\r\n                HTML.beforeEnd(rightColNode, `<div class=\"profile_item_links\">${html}</div>`);\r\n                HTML.afterEnd(rightColNode, '<div style=\"clear: both;\"></div>');\r\n            }\r\n        }\r\n    }\r\n}\r\n","import {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Background, Feature} from \"../../../modulesContent\";\r\n\r\nexport default class FWishlistProfileLink extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return !this.context.isPrivateProfile && SyncedStorage.get(\"show_wishlist_link\");\r\n    }\r\n\r\n    async apply() {\r\n\r\n        HTML.afterEnd(\".profile_item_links .profile_count_link\",\r\n            `<div id=\"es_wishlist_link\" class=\"profile_count_link ellipsis\">\r\n                <a href=\"//store.steampowered.com/wishlist${window.location.pathname}\">\r\n                    <span class=\"count_link_label\">${Localization.str.wishlist}</span>&nbsp;\r\n                    <span id=\"es_wishlist_count\" class=\"profile_count_link_total\"></span>\r\n                </a>\r\n            </div>`);\r\n\r\n        if (SyncedStorage.get(\"show_wishlist_count\")) {\r\n\r\n            const wishlistNode = document.querySelector('.gamecollector_showcase .showcase_stat[href$=\"/wishlist/\"]');\r\n\r\n            document.querySelector(\"#es_wishlist_count\").textContent = wishlistNode\r\n                ? wishlistNode.textContent.match(/\\d+(?:,\\d+)?/)[0]\r\n                : await Background.action(\"wishlists\", window.location.pathname);\r\n        }\r\n    }\r\n}\r\n","import Config from \"../../../../config\";\r\nimport {HTML, Localization} from \"../../../../modulesCore\";\r\nimport {Feature, ProfileData} from \"../../../modulesContent\";\r\n\r\nexport default class FSupporterBadges extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return !this.context.isPrivateProfile;\r\n    }\r\n\r\n    async apply() {\r\n\r\n        const {badges} = await ProfileData || {};\r\n        if (!badges || !badges.length) { return; }\r\n\r\n        let html = `<div class=\"profile_badges\" id=\"es_supporter_badges\">\r\n            <div class=\"profile_count_link\">\r\n                <a href=\"${Config.PublicHost}\">\r\n                    <span class=\"count_link_label\">${Localization.str.es_supporter}</span>&nbsp;\r\n                    <span class=\"profile_count_link_total\">${badges.length}</span>\r\n                </a>\r\n            </div>\r\n            <div class=\"profile_count_link_preview\">`;\r\n\r\n        for (const badge of badges) {\r\n            if (badge.link) {\r\n                html += `<div class=\"profile_badges_badge\" data-tooltip-html=\"Augmented Steam<br>${badge.title}\">\r\n                            <a href=\"${badge.link}\"><img class=\"badge_icon small\" src=\"${badge.img}\"></a>\r\n                        </div>`;\r\n            } else {\r\n                html += `<div class=\"profile_badges_badge\" data-tooltip-html=\"Augmented Steam<br>${badge.title}\">\r\n                            <img class=\"badge_icon small\" src=\"${badge.img}\">\r\n                        </div>`;\r\n            }\r\n        }\r\n\r\n        html += \"</div></div>\";\r\n\r\n        HTML.afterEnd(\".profile_badges\", html);\r\n    }\r\n}\r\n","import {HTML} from \"../../../../modulesCore\";\r\nimport {Feature, ProfileData} from \"../../../modulesContent\";\r\n\r\nexport default class FCustomBackground extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        const prevHash = window.location.hash.match(/#previewBackground\\/(\\d+)\\/([a-z0-9.]+)/i);\r\n        if (prevHash) {\r\n            const src = `//cdn.akamai.steamstatic.com/steamcommunity/public/images/items/${prevHash[1]}/${prevHash[2]}`;\r\n            this._setProfileBg(src);\r\n\r\n            return false;\r\n        }\r\n\r\n        return !this.context.isPrivateProfile;\r\n    }\r\n\r\n    async apply() {\r\n\r\n        await ProfileData;\r\n        const bg = ProfileData.getBgImgUrl();\r\n        if (!bg) { return; }\r\n\r\n        this._setProfileBg(bg);\r\n    }\r\n\r\n    _setProfileBg(src) {\r\n\r\n        const isVideo = /(webm|mp4)$/.test(src);\r\n        const profilePage = document.querySelector(\".no_header.profile_page\");\r\n        const animatedBgContainer = document.querySelector(\".profile_animated_background\");\r\n\r\n        if (isVideo) {\r\n            if (animatedBgContainer) {\r\n                animatedBgContainer.querySelector(\"video\").src = src;\r\n            } else {\r\n                HTML.afterBegin(profilePage,\r\n                    `<div class=\"profile_animated_background\">\r\n                        <video playsinline autoplay muted loop src=\"${src}\"></video>\r\n                    </div>`);\r\n\r\n                profilePage.style.backgroundImage = \"none\";\r\n            }\r\n        } else {\r\n            if (animatedBgContainer) {\r\n                animatedBgContainer.remove(); // Animated BGs will interfere with static BGs\r\n            }\r\n\r\n            profilePage.style.backgroundImage = `url(${src})`;\r\n        }\r\n\r\n        if (!profilePage.classList.contains(\"has_profile_background\")) {\r\n            for (const node of [document.body, profilePage, profilePage.querySelector(\".profile_content\")]) {\r\n                node.classList.add(\"has_profile_background\");\r\n            }\r\n        }\r\n    }\r\n}\r\n","import {Feature} from \"../../../Modules/Feature/Feature\";\r\nimport {HTML, Localization} from \"../../../../modulesCore\";\r\n\r\nexport default class FProfileStoreLinks extends Feature {\r\n\r\n    apply() {\r\n\r\n        for (const node of document.querySelectorAll(\".game_name .whiteLink\")) {\r\n            const href = node.href.replace(\"//steamcommunity.com\", \"//store.steampowered.com\");\r\n            HTML.afterEnd(node, `<br><a class=\"whiteLink\" style=\"font-size: 10px;\" href=${href}>${Localization.str.visit_store}</a>`);\r\n        }\r\n    }\r\n}\r\n","import {ExtensionResources, HTML, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Feature, ProfileData, SteamId} from \"../../../modulesContent\";\r\n\r\nexport default class FSteamRep extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return SyncedStorage.get(\"showsteamrepapi\");\r\n    }\r\n\r\n    async apply() {\r\n\r\n        const {steamrep} = await ProfileData || {};\r\n        if (!steamrep || !steamrep.length) { return; }\r\n\r\n        // Build reputation images regexp\r\n        const repImgs = {\r\n            \"banned\": /scammer|banned/i,\r\n            \"valve\": /valve admin/i,\r\n            \"caution\": /caution/i,\r\n            \"okay\": /admin|middleman/i,\r\n            \"donate\": /donator/i\r\n        };\r\n\r\n        let html = \"\";\r\n\r\n        for (const value of steamrep) {\r\n\r\n            if (value.trim() === \"\") { continue; }\r\n\r\n            for (const [img, regex] of Object.entries(repImgs)) {\r\n                if (!regex.test(value)) { continue; }\r\n\r\n                const imgUrl = ExtensionResources.getURL(`img/sr/${img}.png`);\r\n                let status;\r\n\r\n                switch (img) {\r\n                    case \"banned\":\r\n                        status = \"bad\";\r\n                        break;\r\n                    case \"caution\":\r\n                        status = \"caution\";\r\n                        break;\r\n                    case \"valve\":\r\n                    case \"okay\":\r\n                        status = \"good\";\r\n                        break;\r\n                    case \"donate\":\r\n                        status = \"neutral\";\r\n                        break;\r\n                }\r\n\r\n                html += `<div class=\"${status}\"><img src=\"${imgUrl}\"><span> ${value}</span></div>`;\r\n            }\r\n        }\r\n\r\n        if (html) {\r\n            const steamId = SteamId.getSteamId();\r\n\r\n            HTML.afterBegin(\".profile_rightcol\",\r\n                `<a id=\"es_steamrep\" href=\"https://steamrep.com/profiles/${steamId}\" target=\"_blank\">\r\n                    ${html}\r\n                </a>`);\r\n        }\r\n    }\r\n}\r\n","import {HTML, Localization} from \"../../../../modulesCore\";\r\nimport {Feature, User} from \"../../../modulesContent\";\r\nimport {Page} from \"../../Page\";\r\n\r\nexport default class FProfileDropdownOptions extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        this._node = document.querySelector(\"#profile_action_dropdown .popup_body .profile_actions_follow\");\r\n        return this._node !== null;\r\n    }\r\n\r\n    apply() {\r\n\r\n        // add nickname option for non-friends\r\n        if (User.isSignedIn) {\r\n\r\n            // Selects the \"Add Friend\" button (ID selector for unblocked, class selector for blocked users)\r\n            if (document.querySelector(\"#btn_add_friend, .profile_header_actions > .btn_profile_action_disabled\")) {\r\n\r\n                HTML.afterEnd(this._node,\r\n                    `<a class=\"popup_menu_item\" id=\"es_nickname\">\r\n                        <img src=\"//steamcommunity-a.akamaihd.net/public/images/skin_1/notification_icon_edit_bright.png\">&nbsp; ${Localization.str.add_nickname}\r\n                    </a>`);\r\n\r\n                document.querySelector(\"#es_nickname\").addEventListener(\"click\", () => {\r\n                    Page.runInPageContext(() => {\r\n                        const f = window.SteamFacade;\r\n                        f.showNicknameModal();\r\n                        f.hideMenu(\"profile_action_dropdown_link\", \"profile_action_dropdown\");\r\n                    });\r\n                });\r\n            }\r\n\r\n            // Show current nickname in input box\r\n            Page.runInPageContext(() => {\r\n                const oldShowNicknameModal = window.ShowNicknameModal;\r\n\r\n                window.ShowNicknameModal = function() {\r\n                    oldShowNicknameModal();\r\n\r\n                    const nicknameNode = document.querySelector(\".persona_name .nickname\");\r\n                    if (nicknameNode !== null) {\r\n                        document.querySelector(\".newmodal input[type=text]\").value = nicknameNode.textContent.trim().slice(1, -1);\r\n                    }\r\n                };\r\n            });\r\n        }\r\n\r\n        // add post history link\r\n        HTML.afterEnd(this._node,\r\n            `<a class=\"popup_menu_item\" href=\"${window.location.pathname}/posthistory\">\r\n                <img src=\"//steamcommunity-a.akamaihd.net/public/images/skin_1/icon_btn_comment.png\">&nbsp; ${Localization.str.post_history}\r\n            </a>`);\r\n    }\r\n}\r\n","import {GameId, HTML, HTMLParser, Localization} from \"../../../../modulesCore\";\r\nimport {Feature, RequestData} from \"../../../modulesContent\";\r\n\r\nexport default class FInGameStoreLink extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return !this.context.isPrivateProfile\r\n            && (this._avatarNode = document.querySelector(\".profile_header_size[data-miniprofile]\")) !== null\r\n            && this._avatarNode.classList.contains(\"in-game\");\r\n    }\r\n\r\n    async apply() {\r\n\r\n        // Try to get appid from the deprecated \"report abuse\" form (only appears when logged in)\r\n        let appid = document.querySelector(\"input[name=ingameAppID]\")?.value;\r\n\r\n        // Otherwise fetch the profile's miniprofile hover content\r\n        if (!appid) {\r\n            const html = await RequestData.getHttp(`https://steamcommunity.com/miniprofile/${this._avatarNode.dataset.miniprofile}`);\r\n            const doc = HTMLParser.htmlToDOM(html);\r\n            appid = GameId.getAppidImgSrc(doc.querySelector(\"img.game_logo\"));\r\n            if (!appid) { return; }\r\n        }\r\n\r\n        const node = document.querySelector(\".profile_in_game_name\");\r\n\r\n        HTML.inner(node,\r\n            `<a href=\"//store.steampowered.com/app/${appid}\" target=\"_blank\">\r\n                <span data-tooltip-text=\"${Localization.str.view_in_store}\">${node.textContent}</span>\r\n            </a>`);\r\n    }\r\n}\r\n","import {ExtensionResources, HTML, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {DOMHelper, Feature, ProfileData} from \"../../../modulesContent\";\r\n\r\nexport default class FCustomStyle extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return !this.context.isPrivateProfile && SyncedStorage.get(\"show_custom_themes\");\r\n    }\r\n\r\n    async apply() {\r\n\r\n        const {style} = await ProfileData || {};\r\n        if (!style) { return; }\r\n\r\n        const availableStyles = [\r\n            \"clear\",\r\n            \"goldenprofile\",\r\n            \"goldenprofile2020\",\r\n            \"winter2019\",\r\n            \"green\",\r\n            \"holiday2014\",\r\n            \"orange\",\r\n            \"pink\",\r\n            \"purple\",\r\n            \"red\",\r\n            \"teal\",\r\n            \"yellow\",\r\n            \"blue\",\r\n            \"grey\"\r\n        ];\r\n\r\n        if (!availableStyles.includes(style)) { return; }\r\n\r\n        document.body.classList.add(\"es_profile_style\");\r\n\r\n        switch (style) {\r\n            case \"winter2019\": {\r\n                DOMHelper.insertStylesheet(\"//steamcommunity-a.akamaihd.net/public/css/promo/winter2019/goldenprofile.css\");\r\n\r\n                const profilePageNode = document.querySelector(\".no_header.profile_page\");\r\n                profilePageNode.classList.add(\"golden_profile\");\r\n                HTML.wrap(\"<div class='profile_golden_wrapper'></div>\", profilePageNode);\r\n\r\n                HTML.afterBegin(profilePageNode,\r\n                    `<div class=\"w19_sides_position\">\r\n                        <div class=\"w19_side left\">\r\n                            <div class=\"w19_side_background\"></div>\r\n                            <div class=\"w19_pig\"></div>\r\n                            <div class=\"w19_top\"></div>\r\n                            <div class=\"w19_pendulum\">\r\n                                <div class=\"w19_strings\"></div>\r\n                                <img src=\"//steamcdn-a.akamaihd.net/steamcommunity/public/assets/winter2019/goldenprofile/dangle_flake.png\">\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"w19_side right\">\r\n                            <div class=\"w19_side_background\"></div>\r\n                            <div class=\"w19_pig\"></div>\r\n                            <div class=\"w19_top\"></div>\r\n                            <div class=\"w19_pendulum\">\r\n                                <div class=\"w19_strings\"></div>\r\n                                <img src=\"//steamcdn-a.akamaihd.net/steamcommunity/public/assets/winter2019/goldenprofile/dangle_flake.png\">\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"snowflakes\" aria-hidden=\"true\">\r\n                            <div class=\"snowflake\"></div>\r\n                            <div class=\"snowflake\"></div>\r\n                            <div class=\"snowflake\"></div>\r\n                            <div class=\"snowflake\"></div>\r\n                            <div class=\"snowflake\"></div>\r\n                            <div class=\"snowflake\"></div>\r\n                            <div class=\"snowflake\"></div>\r\n                            <div class=\"snowflake\"></div>\r\n                            <div class=\"snowflake\"></div>\r\n                            <div class=\"snowflake\"></div>\r\n                            <div class=\"snowflake\"></div>\r\n                        </div>\r\n                    </div>`);\r\n\r\n                HTML.afterBegin(\".profile_header_bg_texture\", \"<div class='golden_profile_header'></div>\");\r\n\r\n                document.querySelector(\".playerAvatar.profile_header_size\").classList.add(\"golden\");\r\n\r\n                break;\r\n            }\r\n            case \"goldenprofile2020\": {\r\n                DOMHelper.insertStylesheet(\"//steamcommunity-a.akamaihd.net/public/css/promo/lny2020/goldenprofile.css\");\r\n\r\n                const profilePageNode = document.querySelector(\".no_header.profile_page\");\r\n                profilePageNode.classList.add(\"golden_profile\");\r\n                HTML.wrap(\"<div class='profile_golden_wrapper'></div>\", profilePageNode);\r\n\r\n                HTML.afterBegin(profilePageNode,\r\n                    `<div class=\"w19_sides_position\">\r\n                        <div class=\"w19_side left\">\r\n                            <div class=\"w19_side_background\"></div>\r\n                        </div>\r\n                        <div class=\"w19_side right\">\r\n                            <div class=\"w19_side_background\"></div>\r\n                        </div>\r\n                    </div>`);\r\n\r\n                HTML.afterBegin(\".profile_header_bg_texture\", \"<div class='golden_profile_header'></div>\");\r\n\r\n                const avatarNode = document.querySelector(\".playerAvatar.profile_header_size\");\r\n                avatarNode.classList.add(\"golden\");\r\n                HTML.afterBegin(avatarNode, \"<div class='goldenAvatarOverlay'></div>\");\r\n\r\n                // Use the animated BG that comes with this theme if the profile has no BG equipped\r\n                if (!profilePageNode.classList.contains(\"has_profile_background\")) {\r\n\r\n                    HTML.afterBegin(profilePageNode,\r\n                        `<div class=\"profile_animated_background\">\r\n                            <video playsinline autoplay muted loop poster=\"//steamcdn-a.akamaihd.net/steamcommunity/public/images/items/1223590/daa4b34582ed6cab1327f247be8d03d92ae8aaaa.jpg\">\r\n                                <source src=\"//steamcdn-a.akamaihd.net/steamcommunity/public/images/items/1223590/c146558951b46ade8d64ea8e787980f84d30ec46.webm\" type=\"video/webm\">\r\n                                <source src=\"//steamcdn-a.akamaihd.net/steamcommunity/public/images/items/1223590/b5c39efda3998e0d2e734e8b7385ecf705ce8cc5.mp4\" type=\"video/mp4\">\r\n                            </video>\r\n                        </div>`);\r\n\r\n                    for (const node of [document.body, profilePageNode, profilePageNode.querySelector(\".profile_content\")]) {\r\n                        node.classList.add(\"has_profile_background\");\r\n                    }\r\n                }\r\n\r\n                break;\r\n            }\r\n            case \"goldenprofile\": {\r\n                DOMHelper.insertStylesheet(\"//steamcommunity-a.akamaihd.net/public/css/promo/lny2019/goldenprofile.css\");\r\n\r\n                const profilePageNode = document.querySelector(\".no_header.profile_page\");\r\n                profilePageNode.classList.add(\"golden_profile\");\r\n                HTML.wrap(\"<div class='profile_golden_wrapper'></div>\", profilePageNode);\r\n\r\n                HTML.afterBegin(profilePageNode,\r\n                    `<div class=\"lny_sides_position\">\r\n                        <div class=\"lny_side left\">\r\n                            <div class=\"lny_side_background\"></div>\r\n                            <div class=\"lny_top\"></div>\r\n                            <div class=\"lny_pig\"></div>\r\n                            <div class=\"lny_pendulum\">\r\n                                <div class=\"lny_strings\"></div>\r\n                                <img src=\"//steamcdn-a.akamaihd.net/steamcommunity/public/assets/lny2019/goldenprofile/test_lantern1.png\">\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"lny_side right\">\r\n                            <div class=\"lny_side_background\"></div>\r\n                            <div class=\"lny_top\"></div>\r\n                            <div class=\"lny_pig\"></div>\r\n                            <div class=\"lny_pendulum\">\r\n                                <div class=\"lny_strings\"></div>\r\n                                <img src=\"//steamcdn-a.akamaihd.net/steamcommunity/public/assets/lny2019/goldenprofile/test_lantern2.png\">\r\n                            </div>\r\n                        </div>\r\n                    </div>`);\r\n\r\n                HTML.afterBegin(\".profile_header_bg_texture\",\r\n                    `<div class=\"golden_profile_header\">\r\n                        <div class=\"lny_pig_center\"></div>\r\n                    </div>`);\r\n\r\n                document.querySelector(\".playerAvatar.profile_header_size\").classList.add(\"golden\");\r\n\r\n                break;\r\n            }\r\n            case \"holiday2014\":\r\n                DOMHelper.insertStylesheet(\"//steamcommunity-a.akamaihd.net/public/css/skin_1/holidayprofile.css\");\r\n\r\n                HTML.beforeEnd(\".profile_header_bg_texture\", \"<div class='holidayprofile_header_overlay'></div>\");\r\n                document.querySelector(\".no_header.profile_page\").classList.add(\"holidayprofile\");\r\n\r\n                DOMHelper.insertScript({\"src\": ExtensionResources.getURL(\"js/extra/holidayprofile.js\")});\r\n\r\n                break;\r\n            case \"clear\":\r\n                document.body.classList.add(\"es_style_clear\");\r\n                break;\r\n            default: {\r\n                DOMHelper.insertStylesheet(ExtensionResources.getURL(`img/profile_styles/${style}/style.css`));\r\n\r\n                const headerImg = ExtensionResources.getURL(`img/profile_styles/${style}/header.jpg`);\r\n                document.querySelector(\".profile_header_bg_texture\").style.backgroundImage = `url(${headerImg})`;\r\n\r\n                break;\r\n            }\r\n        }\r\n    }\r\n}\r\n","import {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Background, Feature, User} from \"../../../modulesContent\";\r\n\r\nexport default class FTwitchShowcase extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        if (!SyncedStorage.get(\"profile_showcase_twitch\")) { return false; }\r\n\r\n        // Don't show our Twitch.tv showcase on our own profile\r\n        return !User.isSignedIn\r\n            || SyncedStorage.get(\"profile_showcase_own_twitch\")\r\n            || window.location.pathname !== User.profilePath;\r\n    }\r\n\r\n    async apply() {\r\n\r\n        let selector = \".profile_summary a[href*='twitch.tv/']\";\r\n        if (!SyncedStorage.get(\"profile_showcase_twitch_profileonly\")) {\r\n            selector += \", .customtext_showcase a[href*='twitch.tv/']\";\r\n        }\r\n        const search = document.querySelector(selector);\r\n        if (!search) { return; }\r\n\r\n        const m = search.href.match(/twitch\\.tv\\/(.+)/);\r\n        if (!m) { return; }\r\n\r\n        const twitchId = m[1].replace(/\\//g, \"\");\r\n\r\n        const data = await Background.action(\"twitch.stream\", {\"channel\": twitchId});\r\n\r\n        // If the channel is not streaming, the response is: {\"result\":\"success\",\"data\":[]}\r\n        if (Array.isArray(data)) { return; }\r\n\r\n        const channelUsername = data.user_name;\r\n        const channelUrl = search.href;\r\n        const channelGame = data.game;\r\n        const channelViewers = data.viewer_count;\r\n        const previewUrl = `${data.thumbnail_url.replace(\"{width}\", 636).replace(\"{height}\", 358)}?${Math.random()}`;\r\n\r\n        HTML.afterBegin(\".profile_leftcol\",\r\n            `<div class='profile_customization' id='es_twitch'>\r\n                <div class='profile_customization_header'>\r\n                    ${Localization.str.twitch.now_streaming.replace(\"__username__\", channelUsername)}\r\n                </div>\r\n                <a class=\"esi-stream\" href=\"${channelUrl}\">\r\n                    <div class=\"esi-stream__preview\">\r\n                        <img src=\"${previewUrl}\">\r\n                        <img src=\"https://steamstore-a.akamaihd.net/public/shared/images/apphubs/play_icon80.png\" class=\"esi-stream__play\">\r\n                        <div class=\"esi-stream__live\">Live on <span class=\"esi-stream__twitch\">Twitch</span></div>\r\n                    </div>\r\n                    <div class=\"esi-stream__title\">\r\n                        <span class=\"live_stream_app\">${channelGame}</span>\r\n                        <span class=\"live_steam_viewers\">${channelViewers} ${Localization.str.twitch.viewers}</span>\r\n                    </div>\r\n                </a>\r\n            </div>`);\r\n    }\r\n}\r\n","import {HTML, HTMLParser, Localization} from \"../../../../modulesCore\";\r\nimport {Feature, User} from \"../../../modulesContent\";\r\nimport {Page} from \"../../Page\";\r\n\r\nexport default class FChatDropdownOptions extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return User.isSignedIn;\r\n    }\r\n\r\n    apply() {\r\n\r\n        const sendButton = document.querySelector(\"div.profile_header_actions > a[href*=OpenFriendChat]\");\r\n        if (!sendButton) { return; }\r\n\r\n        const {\"steamid\": friendSteamId} = HTMLParser.getVariableFromDom(\"g_rgProfileData\", \"object\");\r\n\r\n        HTML.replace(sendButton,\r\n            `<span class=\"btn_profile_action btn_medium\" id=\"profile_chat_dropdown_link\">\r\n                <span>${sendButton.textContent}<img src=\"//steamcommunity-a.akamaihd.net/public/images/profile/profile_action_dropdown.png\"></span>\r\n            </span>\r\n            <div class=\"popup_block\" id=\"profile_chat_dropdown\">\r\n                <div class=\"popup_body popup_menu shadow_content\">\r\n                    <a id=\"btnWebChat\" class=\"popup_menu_item\">\r\n                        <img src=\"//steamcommunity-a.akamaihd.net/public/images/skin_1/icon_btn_comment.png\">\r\n                        &nbsp; ${Localization.str.web_browser_chat}\r\n                    </a>\r\n                    <a class=\"popup_menu_item\" href=\"steam://friends/message/${friendSteamId}\">\r\n                        <img src=\"//steamcommunity-a.akamaihd.net/public/images/skin_1/icon_btn_comment.png\">\r\n                        &nbsp; ${Localization.str.steam_client_chat}\r\n                    </a>\r\n                </div>\r\n            </div>`);\r\n\r\n        document.querySelector(\"#btnWebChat\").addEventListener(\"click\", () => {\r\n            Page.runInPageContext(steamId => {\r\n                window.SteamFacade.openFriendChatInWebChat(steamId);\r\n            }, [friendSteamId]);\r\n        });\r\n\r\n        document.querySelector(\"#profile_chat_dropdown_link\").addEventListener(\"click\", () => {\r\n            Page.runInPageContext(() => {\r\n                window.SteamFacade.showMenu(\"profile_chat_dropdown_link\", \"profile_chat_dropdown\", \"right\");\r\n            });\r\n        });\r\n\r\n        document.querySelector(\"#profile_chat_dropdown\").addEventListener(\"click\", () => {\r\n            Page.runInPageContext(() => {\r\n                window.SteamFacade.hideMenu(\"profile_chat_dropdown_link\", \"profile_chat_dropdown\");\r\n            });\r\n        });\r\n    }\r\n}\r\n","import {ExtensionResources, HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Clipboard, Feature, SteamId, SteamIdDetail} from \"../../../modulesContent\";\r\nimport {Page} from \"../../Page\";\r\n\r\nexport default class FViewSteamId extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return SyncedStorage.get(\"profile_steamid\");\r\n    }\r\n\r\n    apply() {\r\n\r\n        async function copySteamId(e) {\r\n            const elem = e.target.closest(\".es-copy\");\r\n            if (!elem) { return; }\r\n\r\n            const result = await Clipboard.set(elem.querySelector(\".es-copy__id\").textContent);\r\n            if (!result) { return; }\r\n\r\n            elem.addEventListener(\"transitionend\", () => {\r\n                elem.classList.remove(\"is-copied\");\r\n            }, {\"once\": true});\r\n\r\n            elem.classList.add(\"is-copied\");\r\n        }\r\n\r\n        function showSteamIdDialog() {\r\n            document.addEventListener(\"click\", copySteamId);\r\n\r\n            const imgUrl = ExtensionResources.getURL(\"img/clippy.svg\");\r\n\r\n            const steamId = new SteamIdDetail(SteamId.getSteamId());\r\n            const ids = [\r\n                steamId.id2,\r\n                steamId.id3,\r\n                steamId.id64,\r\n                `https://steamcommunity.com/profiles/${steamId.id64}`\r\n            ];\r\n\r\n            let html = \"\";\r\n            for (const id of ids) {\r\n                if (!id) { continue; }\r\n                html += `<p>\r\n                            <a class=\"es-copy\">\r\n                                <span class=\"es-copy__id\">${id}</span>\r\n                                <img src=\"${imgUrl}\" class=\"es-copy__icon\">\r\n                                <span class=\"es-copy__copied\">${Localization.str.copied}</span>\r\n                            </a>\r\n                        </p>`;\r\n            }\r\n\r\n            Page.runInPageContext((steamidOfUser, html, close) => {\r\n                const f = window.SteamFacade;\r\n                f.hideMenu(\"profile_action_dropdown_link\", \"profile_action_dropdown\");\r\n\r\n                const dialog = f.showAlertDialog(\r\n                    steamidOfUser.replace(\"__user__\", f.global(\"g_rgProfileData\").personaname),\r\n                    html,\r\n                    close\r\n                );\r\n\r\n                return new Promise(resolve => {\r\n                    dialog.done(() => { resolve(); });\r\n                });\r\n            },\r\n            [\r\n                Localization.str.steamid_of_user,\r\n                html,\r\n                Localization.str.close,\r\n            ],\r\n            \"closeDialog\")\r\n                .then(() => { document.removeEventListener(\"click\", copySteamId); });\r\n        }\r\n\r\n        const dropdown = document.querySelector(\"#profile_action_dropdown .popup_body.popup_menu\");\r\n        if (dropdown) {\r\n            HTML.beforeEnd(dropdown,\r\n                `<a class=\"popup_menu_item\" id=\"es_steamid\">\r\n                    <img src=\"https://steamcommunity-a.akamaihd.net/public/images/skin_1/iconForums.png\">&nbsp; ${Localization.str.view_steamid}\r\n                </a>`);\r\n        } else {\r\n            const actions = document.querySelector(\".profile_header_actions\");\r\n            if (actions) {\r\n                HTML.beforeEnd(actions,\r\n                    `<a class=\"btn_profile_action btn_medium\" id=\"es_steamid\">\r\n                        <span>${Localization.str.view_steamid}</span>\r\n                    </a>`);\r\n            }\r\n        }\r\n\r\n        document.querySelector(\"#es_steamid\").addEventListener(\"click\", showSteamIdDialog);\r\n    }\r\n}\r\n","\r\nclass Clipboard {\r\n\r\n    static async set(content) {\r\n\r\n        try {\r\n            await navigator.clipboard.writeText(content);\r\n            return true;\r\n        } catch {\r\n            // Ignore error, use fallback\r\n        }\r\n\r\n        // Based on https://stackoverflow.com/a/12693636\r\n        function copyHandler(e) {\r\n            e.clipboardData.setData(\"text/plain\", content);\r\n            e.preventDefault();\r\n        }\r\n\r\n        document.addEventListener(\"copy\", copyHandler);\r\n        const result = document.execCommand(\"copy\");\r\n        document.removeEventListener(\"copy\", copyHandler);\r\n        return result;\r\n    }\r\n}\r\n\r\nexport {Clipboard};\r\n","import {SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Feature} from \"../../../modulesContent\";\r\n\r\nexport default class FPinnedBackground extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return SyncedStorage.get(\"profile_pinned_bg\");\r\n    }\r\n\r\n    apply() {\r\n\r\n        const animatedBgNode = document.querySelector(\".profile_animated_background\");\r\n        if (animatedBgNode) {\r\n            animatedBgNode.style.position = \"fixed\";\r\n        } else {\r\n\r\n            /**\r\n             * For static bgs, add its own element so it can scroll independently to avoid performance issues.\r\n             * See https://www.fourkitchens.com/blog/article/fix-scrolling-performance-css-will-change-property/\r\n             */\r\n            const bgNode = document.createElement(\"div\");\r\n            bgNode.classList.add(\"as_profile_static_background\");\r\n\r\n            // Copy background-image from inline style\r\n            const profilePage = document.querySelector(\".no_header.profile_page\");\r\n\r\n            // For the default background this property is not present in the inline style, so use getComputedStyle\r\n            bgNode.style.backgroundImage = getComputedStyle(profilePage).backgroundImage;\r\n            profilePage.insertAdjacentElement(\"afterbegin\", bgNode);\r\n            profilePage.style.backgroundImage = \"none\";\r\n        }\r\n    }\r\n}\r\n","import {CommunityPage} from \"../../CommunityPage\";\r\nimport {CProfileHome} from \"./CProfileHome\";\r\nimport {CCommunityBase} from \"../CCommunityBase\";\r\n\r\nconst page = new CommunityPage();\r\n\r\n// This regex can't be translated to a match pattern / glob combination in the manifest\r\nif (/^\\/(?:id|profiles)\\/[^/]+\\/?$/.test(window.location.pathname)) {\r\n    page.run(CProfileHome);\r\n} else {\r\n    page.run(CCommunityBase);\r\n}\r\n","import {Page} from \"./Page\";\r\nimport {CommentHandler} from \"../Modules/Community/CommentHandler\";\r\n\r\nclass CommunityPage extends Page {\r\n\r\n    _pageSpecificFeatures() {\r\n        super._pageSpecificFeatures();\r\n\r\n        CommentHandler.hideSpamComments();\r\n        CommentHandler.addFavoriteEmoticons();\r\n    }\r\n\r\n}\r\n\r\nexport {CommunityPage};\r\n","import {ContextType, ProfileData} from \"../../../modulesContent\";\r\nimport {CCommunityBase} from \"../CCommunityBase\";\r\nimport FEarlyAccess from \"../../Common/FEarlyAccess\";\r\nimport FFixAppImageNotFound from \"../FFixAppImageNotFound\";\r\nimport FCommunityProfileLinks from \"./FCommunityProfileLinks\";\r\nimport FWishlistProfileLink from \"./FWishlistProfileLink\";\r\nimport FSupporterBadges from \"./FSupporterBadges\";\r\nimport FCustomBackground from \"./FCustomBackground\";\r\nimport FProfileStoreLinks from \"./FProfileStoreLinks\";\r\nimport FSteamRep from \"./FSteamRep\";\r\nimport FProfileDropdownOptions from \"./FProfileDropdownOptions\";\r\nimport FInGameStoreLink from \"./FInGameStoreLink\";\r\nimport FCustomStyle from \"./FCustomStyle\";\r\nimport FTwitchShowcase from \"./FTwitchShowcase\";\r\nimport FChatDropdownOptions from \"./FChatDropdownOptions\";\r\nimport FViewSteamId from \"./FViewSteamId\";\r\nimport FPinnedBackground from \"./FPinnedBackground\";\r\n\r\nexport class CProfileHome extends CCommunityBase {\r\n\r\n    constructor() {\r\n        // Don't apply features if there's an error message (e.g. non-existent profile)\r\n        if (document.getElementById(\"message\") !== null) {\r\n            super(ContextType.PROFILE_HOME);\r\n            return;\r\n        }\r\n\r\n        if (window.location.hash === \"#as-success\") {\r\n\r\n            /*\r\n             * TODO This is a hack. It turns out, that clearOwn clears data, but immediately reloads them.\r\n             *      That's why when we clear profile before going to API to store changes we don't get updated images\r\n             *      when we get back.\r\n             *      clearOwn shouldn't immediately reload.\r\n             *\r\n             *      Also, we are hoping for the best here, we should probably await?\r\n             */\r\n            ProfileData.clearOwn();\r\n        }\r\n\r\n        ProfileData.promise();\r\n\r\n        super(ContextType.PROFILE_HOME, [\r\n            FFixAppImageNotFound,\r\n            FCommunityProfileLinks,\r\n            FWishlistProfileLink,\r\n            FSupporterBadges,\r\n            FCustomBackground,\r\n            FProfileStoreLinks,\r\n            FSteamRep,\r\n            FProfileDropdownOptions,\r\n            FInGameStoreLink,\r\n            FCustomStyle,\r\n            FTwitchShowcase,\r\n            FChatDropdownOptions,\r\n            FViewSteamId,\r\n            FPinnedBackground,\r\n        ]);\r\n\r\n        this.isPrivateProfile = document.body.classList.contains(\"private_profile\");\r\n\r\n        FEarlyAccess.show(document.querySelectorAll(\".game_info_cap, .showcase_slot:not(.showcase_achievement)\"));\r\n\r\n        // Need to wait on custom background and style (LNY2020 may set the background) to be fetched and set\r\n        FPinnedBackground.dependencies = [FCustomBackground, FCustomStyle];\r\n        FPinnedBackground.weakDependency = true;\r\n\r\n        // Required for LNY2020 to check whether the profile has a (custom) background\r\n        FCustomStyle.dependencies = [FCustomBackground];\r\n    }\r\n}\r\n"],"names":["LoginError","Error","constructor","type","super","this","name","ServerOutageError","msg","HTTPError","code","message","FeatureDependencyError","featureName","Errors","static","str","map","replace","m","html","template","document","createElement","innerHTML","DOMPurify","sanitize","content","fragment","firstElementChild","node","_node","console","warn","querySelector","Element","_getNode","outerHTML","wrapper","startEl","endEl","_startEl","_endEl","parentElement","lastElementChild","wrappedNodes","cur","nextElementSibling","push","_wrapper","element","replaceWith","append","position","insertAdjacentHTML","adjacent","string","text","regex","RegExp","match","parseInt","JSON","parse","dom","querySelectorAll","value","getVariableFromText","textContent","CookieStorage","defaultValue","_name","trim","cache","has","get","val","ttl","_val","set","encodeURIComponent","cookie","delete","Map","key","split","kv","decodeURIComponent","init","ContextType","Object","freeze","currentContext","browser","extension","getBackgroundPage","bgPage","window","BACKGROUND","OPTIONS","CONTENT_SCRIPT","Environment","Language","_currentSteamLanguage","script","language","URL","src","searchParams","isContentScript","languages","array","includes","getCurrentSteamLanguage","BackgroundSimple","runtime","sendMessage","requested","params","length","ExtensionResources","pathname","getURL","fetch","then","r","json","Storage","prototype","hasOwnProperty","call","defaults","_adapter","entries","remove","prefix","keys","filter","k","startsWith","force","tmp","persistent","reduce","acc","option","clear","import","area","storage","sync","caches","onChanged","addListener","changes","eventArea","assign","onDone","onCatch","promise","_initialized","Promise","resolve","stringify","Info","getManifest","version","local","QUOTA_BYTES_PER_ITEM","getJSON","_promise","currentSteamLanguage","storedSteamLanguage","deepAssign","target","source","action","getLanguageCode","codes","all","lc","loadLocalization","english","path","reverse","current","pop","LocalStorage","migrate","migrationDone","location","hostname","async","localStorage","getItem","err","error","removeItem","Timer","duration","_id","setTimeout","onSuccess","onFail","clearTimeout","ResettableTimer","reset","running","_running","GameId","id","_text","HTMLElement","appid","dataset","dsAppid","parseId","href","subid","dsPackageid","bundleid","dsBundleid","storeId","Number","slice","indexOf","HTMLImageElement","hasAttribute","getAttribute","imageUrl","res","exec","ctxPermissions","Version","major","minor","patch","assert","isInteger","fromString","Array","isArray","fromArray","v","from","toString","toArray","toJSON","isCurrent","isSameOrAfter","isSame","_version","coerce","isBefore","isSameOrBefore","isAfter","ProgressBar","_progress","setAttribute","requests","classList","style","width","initiated","progress","completed","_value","add","warningNode","nodeError","_failedRequests","result","startRequest","finishRequest","errObj","errStr","info","serverOutage","_errorHandlers","some","handler","failed","RequestData","url","settings","responseType","_url","_settings","origin","response","protocol","_fetchFn","ok","status","statusText","formData","returnJSON","getHttp","bind","storeCountry","country","_storeCountry","substr","avatarNode","loginPromise","profileUrl","profilePath","login","isSignedIn","steamId","catch","newCountry","endsWith","getElementsByTagName","config","COUNTRY","group","groupEnd","sessionId","_sessionId","lang","appName","_appName","getJson","success","data","webapi_token","CommunityUtils","profileLink","link","iconType","iconUrl","SteamId","_steamId","profileData","steamid","SteamIdDetail","steam64str","upper32","lower32","_getBinary","_y","_accountNumber","_instance","_type","_universe","_steamId64","_divide","num","i","Math","floor","index","bit","_str","id2","id3","id64","ProfileData","getSteamId","_data","badges","steamrep","bg","img","getBgImg","allSettled","promises","reason","DynamicStore","multiple","trimmedIds","statusList","trimStoreId","dsStatusList","trimmedId","owned","_fetch","Feature","context","checkPrerequisites","apply","logError","args","_activeDropLists","_lastSelectHideTime","addEventListener","e","closest","_hide","bSetSelected","droplist","trigger","rgItems","item","highlightedItem","className","yOffset","offsetTop","clientHeight","curVisibleOffset","scrollTop","bScrolledDown","nMaxLoopIterations","nLoopCounter","input","dispatchEvent","Event","contains","Date","now","focus","_show","options","initialOption","changeFn","storageOption","reversed","box","getTrimmedValue","onChange","reverseEl","_onFocus","_onBlur","_onTriggerClick","ul","trimmedOption","toggle","a","_highlightItem","DOMHelper","container","parent","parentNode","insertBefore","removeChild","selector","nodes","stylesheet","rel","head","appendChild","onload","isAsync","HorizontalScroller","controlLeftNode","controlRightNode","lastScroll","preventDefault","stopPropagation","deltaY","click","AugmentedSteam","SteamFacade","showMenu","hideMenu","clearCache","reload","btn","body","scroll","scrollY","stopShowingHandler","el","getElementById","insertAdjacentElement","currentLanguage","warningLanguage","strings","_addWarning","using_language","using_language_return","ChangeLanguage","wishlistLink","removeLinkFilter","URLSearchParams","search","MutationObserver","mutations","mutation","addedNodes","nodeType","Node","ELEMENT_NODE","observe","logoutNode","accountName","communityName","pageHeader","test","title","getRandomApp","gamename","gameid","fullgame","playGameStr","visitStore","showConfirmDialog","done","ShowGotSteamModal","steamUrl","checked","tab","links","create","_loginWarningAdded","host","_addBackToTop","_addMenu","_addLanguageWarning","_handleInstallSteamButton","_disableLinkFilter","_skipGotSteam","_keepSteamSubscriberAgreementState","_defaultCommunityTab","_horizontalScrolling","_cartLink","_addUsernameSubmenuLinks","_addRedeemLink","_replaceAccountName","_launchRandomButton","_bindLogout","StringUtils","SteamCurrency","abbr","symbol","hint","multiplier","unit","formatPlaces","formatHidePlaces","formatSymbol","formatGroupSeparator","formatGroupSize","formatDecimalSeparator","formatPostfixSymbol","format","valueOf","price","_price","groupSeparator","decimalSeparator","parseFloat","isNaN","withSymbol","sign","decimals","s","abs","toFixed","decimalPlaces","g","j","groupSize","unshift","substring","join","hidePlacesWhenZero","postfix","placeholder","regExp","escapeRegExp","currencyNode","walletCurrency","g_rgWalletInfo","wallet_currency","currencyNumberToType","currency","_getCurrencyFromDom","_getCurrencyFromWallet","to","_rates","fromType","number","fromNumber","_indices","_defaultCurrency","storeCurrency","_getStoreCurrency","currencySetting","customCurrency","toCurrencies","_isInitialized","currencies","symbols","_loadCurrency","_loadRates","onFailure","ITAD","onHover","updateLastImport","htmlStr","toLocaleString","hover","syncDiv","timeout","display","trunc","timer","storeIds","opts","collection","waitlist","resolved","inCollection","inWaitlist","Messenger","msgID","postMessage","callback","information","removeEventListener","initialized","ev","localStack","stack","insertScript","strTitle","strDescription","rgModalParams","ShowDialog","strOKButton","strCancelButton","strSecondaryActionButton","ShowConfirmDialog","ShowAlertDialog","ShowBlockingWaitDialog","ShowNicknameModal","CModal","DismissActiveModal","elemLink","elemPopup","align","valign","bLinkHasBorder","ShowMenu","HideMenu","CollapseLongStrings","AdjustVisibleAppTags","$J","hourMin","hourMax","UpdatePlaytimeFilterValues","BindAutoFlyoutEvents","g_player","SliderOnChange","GDynamicStore","InvalidateCache","bForceRecalculate","DecorateDynamicItems","OnReady","unAppID","unPackageID","unBundleID","rgAdditionalParams","GStoreItemData","BindHoverEvents","isHtml","isStore","v_tooltip","amount","publisherFee","CalculateFeeAmount","currencyCode","v_currencyformat","ToggleManageFriends","chatId","OpenFriendChatInWebChat","SubmitGuide","InitMiniprofileHovers","Modal","groupID","steamIDInvitee","InviteUserToGroup","GetCheckedAccounts","navid","ExecFriendAction","CScrollOffsetWatcher","ForceRecalc","strCookieName","strValue","expiryInDays","V_SetCookie","callbackFunc","CheckAgeGateSubmit","elTarget","strGroup","LoadImageGroupOnScroll","titleBarText","titleBarURL","sizeToFit","ShowModalContent","InventoryFirstPage","InventoryLastPage","InventoryGoToPage","ReloadCommunityInventory","itemDesc","GetMarketHashName","pricehistory_zoomDays","g_plotPriceHistory","g_timePriceHistoryEarliest","g_timePriceHistoryLatest","SellItemDialog","m_plotPriceHistory","m_timePriceHistoryEarliest","m_timePriceHistoryLatest","UpdateSelection","SelectAll","SelectNone","SelectInverse","on","ajax","post","eventName","addLoginWarning","fun","withPromise","argsString","msgId","_msgCounter","onMessage","documentElement","ContextClass","purifyConfig","ADD_ATTR","addHook","attrName","attrValue","keepAttr","setConfig","setup","log","loading","onUpdate","lastVersion","changelogPromise","_showChangelog","_migrateSettings","dialog","connectBtn","itadConnected","updatedStr","showAlertDialog","oldVersion","emoticons","checkVersion","_pageSpecificFeatures","applyFeatures","CommentHandler","threadNode","count","button","esiCommentObserver","_updateCommentThread","hiddenCount","commentText","_spamRgx","countHidden","_hideSpamComments","_toggleHiddenCommentsButton","_addCommentThreadObserver","_handleAllCommentThreads","modalWait","latestFrame","frames","favs","emoticonPopup","favBox","_buildEmoticonOption","_finalizeFav","favsHtml","_buildFavBox","draggable","_dragFavEmoticon","_clickFavEmoticon","dataTransfer","setData","emoticon","emoticonHover","noFav","fav","favRemove","_updateFavs","backgroundColor","relatedTarget","getData","FHideTrademarks","selectors","replaceSymbols","observer","forEach","CCommunityBase","features","_callbacks","Ref","_promisesMap","_stats","feature","_generateFeatureChain","values","dependency","ready","dependencies","dep","ftr","previousCheck","prev","weakDependency","every","fulfilled","registerCallback","fn","triggerCallbacks","FEarlyAccess","show","_nodes","_selector","_container","imageName","isCurrentLanguageOneOf","getEaNodes","imgHeader","cloneNode","appidsMap","getAppid","getAppidImgSrc","String","size","eaStatus","flatMap","nodesArray","sel","FFixAppImageNotFound","fixSrc","testImg","FCommunityProfileLinks","makeProfileLink","customLink","enabled","icon","linksNode","rightColNode","FWishlistProfileLink","isPrivateProfile","wishlistNode","FSupporterBadges","badge","FCustomBackground","prevHash","hash","_setProfileBg","getBgImgUrl","isVideo","profilePage","animatedBgContainer","backgroundImage","FProfileStoreLinks","FSteamRep","repImgs","imgUrl","FProfileDropdownOptions","f","showNicknameModal","oldShowNicknameModal","nicknameNode","FInGameStoreLink","_avatarNode","miniprofile","doc","FCustomStyle","insertStylesheet","profilePageNode","headerImg","FTwitchShowcase","twitchId","channelUsername","user_name","channelUrl","channelGame","game","channelViewers","viewer_count","previewUrl","thumbnail_url","random","FChatDropdownOptions","sendButton","friendSteamId","openFriendChatInWebChat","FViewSteamId","copySteamId","elem","navigator","clipboard","writeText","copyHandler","clipboardData","execCommand","dropdown","actions","ids","steamidOfUser","close","global","personaname","FPinnedBackground","animatedBgNode","bgNode","getComputedStyle","page","hideSpamComments","addFavoriteEmoticons","run","clearOwn"],"sourceRoot":""}