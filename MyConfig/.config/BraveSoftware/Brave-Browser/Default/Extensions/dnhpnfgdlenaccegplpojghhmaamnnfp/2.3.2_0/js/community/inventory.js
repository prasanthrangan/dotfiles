(()=>{"use strict";class e extends Error{constructor(e){super(e),this.name="LoginError"}}class t extends Error{constructor(e){super(e),this.name="ServerOutageError"}}class s extends Error{constructor(e,t){super(t),this.code=e}}class r extends Error{constructor(e,t){super(e),this.featureName=t}}const n={LoginError:e,ServerOutageError:t,HTTPError:s,FeatureDependencyError:r};class a{static escape(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,(e=>t[e]))}static fragment(e){const t=document.createElement("template");return t.innerHTML=DOMPurify.sanitize(e),t.content}static element(e){return a.fragment(e).firstElementChild}static _getNode(e){let t=e;return null==t?(console.warn(`${t} is not an Element.`),null):("string"==typeof t&&(t=document.querySelector(t)),t instanceof Element?t:(console.warn(`${t} is not an Element.`),null))}static inner(e,t){const s=a._getNode(e);return s&&(s.innerHTML=DOMPurify.sanitize(t)),s}static replace(e,t){const s=a._getNode(e);return s&&(s.outerHTML=DOMPurify.sanitize(t)),s}static wrap(e,t,s=t){const r=a._getNode(t);if(!r)return null;const n=null===s?r.parentElement.lastElementChild:a._getNode(s),o=[r];for(let e=r;null!==e.nextElementSibling&&e!==n;e=e.nextElementSibling)o.push(e.nextElementSibling);const i=a.element(e);return r.replaceWith(i),i.append(...o),i}static adjacent(e,t,s){const r=a._getNode(e);return r&&r.insertAdjacentHTML(t,DOMPurify.sanitize(s)),r}static beforeBegin(e,t){a.adjacent(e,"beforebegin",t)}static afterBegin(e,t){a.adjacent(e,"afterbegin",t)}static beforeEnd(e,t){a.adjacent(e,"beforeend",t)}static afterEnd(e,t){a.adjacent(e,"afterend",t)}}class o{static get(e,t){const s=e.trim();return o.cache.has(s)?o.cache.get(s):t}static set(e,t,s=31536e3){let r=e.trim(),n=t.trim();o.cache.set(r,n),r=encodeURIComponent(r),n=encodeURIComponent(n),document.cookie=`${r}=${n}; max-age=${s}`}static remove(e){let t=e.trim();o.cache.delete(t),t=encodeURIComponent(t),document.cookie=`${t}; expires=Thu, 01 Jan 1970 00:00:00 GMT`}static init(){o.cache=new Map;for(let[e,t]of document.cookie.split(";").map((e=>e.split("="))))e=e.trim(),o.cache.set(e,decodeURIComponent(t))}}o.init();const i=Object.freeze({BACKGROUND:1,CONTENT_SCRIPT:2,OPTIONS:3});let c;if(browser.extension.getBackgroundPage){const e=browser.extension.getBackgroundPage();c=e===window?i.BACKGROUND:i.OPTIONS}else c=i.CONTENT_SCRIPT;class l{static isBackgroundScript(){return c===i.BACKGROUND}static isContentScript(){return c===i.CONTENT_SCRIPT}static isOptions(){return c===i.OPTIONS}}class d{static getCurrentSteamLanguage(){if(null!==this._currentSteamLanguage)return this._currentSteamLanguage;for(const e of document.querySelectorAll("script[src]")){const t=new URL(e.src).searchParams.get("l");if(t)return d._currentSteamLanguage=t,this._currentSteamLanguage}return l.isContentScript()&&(d._currentSteamLanguage=o.get("Steam_Language")||null),this._currentSteamLanguage}static getLanguageCode(e){return d.languages[e]||"en"}static isCurrentLanguageOneOf(e){return e.includes(d.getCurrentSteamLanguage())}}d._currentSteamLanguage=null,d.languages={english:"en",bulgarian:"bg",czech:"cs",danish:"da",dutch:"nl",finnish:"fi",french:"fr",greek:"el",german:"de",hungarian:"hu",italian:"it",japanese:"ja",koreana:"ko",norwegian:"no",polish:"pl",portuguese:"pt-PT",brazilian:"pt-BR",russian:"ru",romanian:"ro",schinese:"zh-CN",spanish:"es-ES",latam:"es-419",swedish:"sv-SE",tchinese:"zh-TW",thai:"th",turkish:"tr",ukrainian:"ua",vietnamese:"vi"};class u{static message(e){return browser.runtime.sendMessage(e)}static action(e,...t){return t.length?this.message({action:e,params:t}):this.message({action:e})}}class m{static getURL(e){return browser.runtime.getURL(e)}static get(e){return fetch(m.getURL(e))}static getJSON(e){return m.get(e).then((e=>e.json()))}static getText(e){return m.get(e).then((e=>e.text()))}}class _{static has(e){return Object.prototype.hasOwnProperty.call(this.cache,e)}static get(e){return void 0!==this.cache[e]||void 0===this.defaults?this.cache[e]:(void 0===this.defaults[e]&&console.warn('Unrecognized storage key "%s"',e),this.defaults[e])}static set(e,t){return this.cache[e]=t,this._adapter.set({[e]:t})}static import(e){for(const[t,s]of Object.entries(e))this.cache[t]=s;return this._adapter.set(e)}static remove(e){return void 0!==this.cache[e]&&delete this.cache[e],this._adapter.remove(e)}static keys(e=""){return Object.keys(this.cache).filter((t=>t.startsWith(e)))}static entries(){return Object.entries(this.cache)}static async clear(e=!1){let t;e||(t=(this.persistent??[]).reduce(((e,t)=>(e[t]=this.cache[t],e)),{})),await this._adapter.clear(),this.cache={},e||await this.import(t)}static async init(){const e=this._adapter===browser.storage.sync?"sync":"local",t=_.caches[e];return void 0!==t?(this.cache=t,this.cache):(_.caches[e]={},this.cache=_.caches[e],browser.storage.onChanged.addListener(((t,s)=>{if(e===s)for(const[e,{newValue:s}]of Object.entries(t))this.cache[e]=s})),Object.assign(this.cache,await this._adapter.get(null)))}static then(e,t){const s=this._initialized?Promise.resolve(this.cache):this.init();return this._initialized=!0,s.then(e,t)}static toJson(){return JSON.stringify(this.cache)}}_.caches={};const g={version:browser.runtime.getManifest().version,db_version:3};class p extends _{}p._adapter=browser.storage.sync||browser.storage.local,p.QUOTA_BYTES_PER_ITEM=browser.storage.sync?8192:5240832,p.defaults=Object.freeze({language:"english",version:g.version,version_show:!0,highlight_owned_color:"#00ce67",highlight_wishlist_color:"#0491bf",highlight_coupon_color:"#a26426",highlight_inv_gift_color:"#800040",highlight_inv_guestpass_color:"#513c73",highlight_notinterested_color:"#4f4f4f",highlight_collection_color:"#856d0e",highlight_waitlist_color:"#4c7521",tag_owned_color:"#00b75b",tag_wishlist_color:"#0383b4",tag_coupon_color:"#c27120",tag_inv_gift_color:"#b10059",tag_inv_guestpass_color:"#65449a",tag_notinterested_color:"#4f4f4f",tag_collection_color:"#856d0e",tag_waitlist_color:"#4c7521",highlight_owned:!0,highlight_wishlist:!0,highlight_coupon:!1,highlight_inv_gift:!1,highlight_inv_guestpass:!1,highlight_notinterested:!1,highlight_excludef2p:!1,highlight_collection:!0,highlight_waitlist:!0,tag_owned:!1,tag_wishlist:!1,tag_coupon:!1,tag_inv_gift:!1,tag_inv_guestpass:!1,tag_notinterested:!0,tag_collection:!1,tag_waitlist:!1,tag_short:!1,hidetmsymbols:!1,showlowestprice:!0,showlowestprice_onwishlist:!0,showlowestpricecoupon:!0,showallstores:!0,stores:[],override_price:"auto",showregionalprice:"mouse",regional_countries:["us","gb","ru","br","au","jp"],show_es_homepagetabs:!0,showmarkettotal:!1,showsteamrepapi:!0,showmcus:!0,showoc:!0,showhltb:!0,showyoutube:!0,showtwitch:!0,showpcgw:!0,showcompletionistme:!1,showprotondb:!1,showviewinlibrary:!1,showsteamcardexchange:!1,showitadlinks:!0,showsteamdb:!0,showbartervg:!1,showastatslink:!0,showyoutubegameplay:!0,showyoutubereviews:!0,showwsgf:!0,exfgls:!0,app_custom_link:[{enabled:!1,name:"Google",url:"google.com/search?q=[ID]+[NAME]",icon:"www.google.com/images/branding/product/ico/googleg_lodp.ico"}],customize_apppage:{recentupdates:!0,reviews:!0,about:!0,contentwarning:!0,steamchart:!0,steamspy:!0,surveys:!0,sysreq:!0,legal:!0,morelikethis:!0,recommendedbycurators:!0,customerreviews:!0},customize_frontpage:{featuredrecommended:!0,specialoffers:!0,trendingamongfriends:!0,discoveryqueue:!0,browsesteam:!0,curators:!0,morecuratorrecommendations:!0,recentlyupdated:!0,fromdevelopersandpublishersthatyouknow:!0,popularvrgames:!0,homepagetabs:!0,gamesstreamingnow:!0,under:!0,updatesandoffers:!0,homepagesidebar:!0},show_package_info:!1,show_steamchart_info:!0,show_steamspy_info:!0,show_early_access:!0,show_alternative_linux_icon:!1,show_itad_button:!1,skip_got_steam:!1,installsteam:"show",openinnewtab:!1,keepssachecked:!1,showemptywishlist:!0,user_notes_app:!0,user_notes_wishlist:!0,showwishliststats:!0,oneclickremovewl:!1,user_notes:{},user_notes_adapter:"synced_storage",replaceaccountname:!0,showlanguagewarning:!0,showlanguagewarninglanguage:"english",homepage_tab_selection:"remember",homepage_tab_last:null,send_age_info:!0,removebroadcasts:!1,mp4video:!1,horizontalscrolling:!0,showsupportinfo:!0,showdrm:!0,regional_hideworld:!1,showinvnav:!0,quickinv:!0,quickinv_diff:-.01,community_default_tab:"",showallachievements:!1,showallstats:!0,replacecommunityhublinks:!1,hideannouncementcomments:!1,showachinstore:!0,hideactivelistings:!1,showlowestmarketprice:!0,hidespamcomments:!1,spamcommentregex:"[\\u2500-\\u25FF]",wlbuttoncommunityapp:!0,removeguideslanguagefilter:!1,disablelinkfilter:!1,sortfriendsby:"default_ASC",sortreviewsby:"default_ASC",sortgroupsby:"default_ASC",show1clickgoo:!0,show_profile_link_images:"gray",show_custom_themes:!0,profile_pinned_bg:!1,profile_steamrepcn:!0,profile_steamgifts:!0,profile_steamtrades:!0,profile_bartervg:!0,profile_steamrep:!0,profile_steamdbcalc:!0,profile_astats:!0,profile_backpacktf:!0,profile_astatsnl:!0,profile_steamid:!0,profile_custom_link:[{enabled:!0,name:"Google",url:"google.com/search?q=[ID]",icon:"www.google.com/images/branding/product/ico/googleg_lodp.ico"}],fav_emoticons:[],group_steamgifts:!0,steamcardexchange:!0,purchase_dates:!0,show_badge_progress:!0,show_coupon:!0,show_wishlist_link:!0,show_wishlist_count:!0,show_progressbar:!0,show_backtotop:!1,profile_showcase_twitch:!0,profile_showcase_own_twitch:!1,profile_showcase_twitch_profileonly:!1,itad_import_library:!1,itad_import_wishlist:!1,add_to_waitlist:!1,context_steam_store:!1,context_steam_market:!1,context_itad:!1,context_bartervg:!1,context_steamdb:!1,context_steamdb_instant:!1,context_steam_keys:!1}),p.persistent=["user_notes","user_notes_adapter"];class h{static loadLocalization(e){return m.getJSON(`/localization/${e}.json`)}static init(){if(h._promise)return h._promise;let e=d.getCurrentSteamLanguage();const t=p.get("language");function s(e,t){for(const[r,n]of Object.entries(t))void 0!==e[r]?"object"==typeof n?s(e[r],n):""!==n&&(e[r]=n):console.warn("The key %s doesn't exist in the English localization file",r);return e}null===e?e=t:e!==t&&(p.set("language",e),u.action("clearpurchases"));const r=d.getLanguageCode(e),n=["en"];return null!==r&&"en"!==r&&n.push(r),h._promise=Promise.all(n.map((e=>h.loadLocalization(e)))).then((([e,t])=>(h.str=e,t&&s(h.str,t),h.str))),h._promise}static then(e,t){return h.init().then(e,t)}static getString(e){const t=e.split(".").reverse();let s=h.str;for(;t.length;){if("object"!=typeof s)return null;s=s[t.pop()]}return s}}h._promise=null;class f extends _{static async init(){return await super.init(),this===f?this.migrate():null}static async migrate(){const e=this.get("local_storage_migration");let t;if("store.steampowered.com"===location.hostname)t="store";else if("steamcommunity.com"===location.hostname)t="community";else{if(l.isContentScript())return null;t="extension"}return e[t]?null:(await Promise.all(Object.keys(f.defaults).map((async e=>{let t=localStorage.getItem(e);if(null!==t){try{t=JSON.parse(t)}catch(e){throw console.error("Can't parse value",t),e}await f.set(e,t),localStorage.removeItem(e)}}))),e[t]=!0,f.set("local_storage_migration",e))}}f._adapter=browser.storage.local,f.defaults=Object.freeze({access_token:null,lastItadImport:{from:null,to:null},login:{steamId:null,profilePath:null},storeCountry:null,expand_slider:!1,es_guide_tags:{},market_stats:{startListing:null,purchaseTotal:0,saleTotal:0},popular_refresh:!1,workshop_state:"",playback_hd:!1,show_review_section:!0,steampeek:!1,support_info:null,hide_login_warn_store:!1,hide_login_warn_community:!1,review_filters:{},local_storage_migration:{store:!1,community:!1,extension:!1}});class y{constructor(e){this._promise=new Promise((t=>{this._id=setTimeout((()=>{t()}),e)}))}then(e,t){if(this._promise)return this._promise.then(e,t);throw new Error("Timer has been cleared before")}clear(){clearTimeout(this._id),this._promise=null}}class w{constructor(e,t){this.onDone=e,this.duration=t,this.reset()}get running(){return this._running}reset(){void 0!==this._id&&clearTimeout(this._id),this._id=setTimeout((async()=>{await this.onDone(),this._running=!1}),this.duration),this._running=!0}}class v{static parseId(e){if(!e)return null;return parseInt(e)||null}static getAppid(e){let t=e;if(!t)return null;if(t instanceof HTMLElement){const e=t.dataset.dsAppid;if(e)return v.parseId(e);if(t=t.href,!t)return null}const s=t.match(/(?:store\.steampowered|steamcommunity)\.com\/(?:app|games|market\/listings)\/(\d+)\/?/);return s&&v.parseId(s[1])}static getSubid(e){let t=e;if(!t)return null;if(t instanceof HTMLElement){const e=t.dataset.dsPackageid;if(e)return v.parseId(e);if(t=t.href,!t)return null}const s=t.match(/(?:store\.steampowered|steamcommunity)\.com\/sub\/(\d+)\/?/);return s&&v.parseId(s[1])}static getBundleid(e){let t=e;if(!t)return null;if(t instanceof HTMLElement){const e=t.dataset.dsBundleid;if(e)return v.parseId(e);if(t=t.href,!t)return null}const s=t.match(/(?:store\.steampowered|steamcommunity)\.com\/bundle\/(\d+)\/?/);return s&&v.parseId(s[1])}static trimStoreId(e){return Number(e.slice(e.indexOf("/")+1))}static getAppidImgSrc(e){let t=e;if(!t)return null;if(t instanceof HTMLImageElement&&(t=t.hasAttribute("src")?t.getAttribute("src"):t.dataset.imageUrl,!t))return null;const s=t.match(/(?:cdn\.(?:akamai|cloudflare)\.steamstatic\.com\/steam|steamcdn-a\.akamaihd\.net\/steam|steamcommunity\/public\/images)\/apps\/(\d+)\//);return s&&v.parseId(s[1])}static getAppidUriQuery(e){if(!e)return null;const t=e.match(/appid=(\d+)/);return t&&v.parseId(t[1])}static getAppids(e){const t=/(?:store\.steampowered|steamcommunity)\.com\/app\/(\d+)\/?/g,s=[];let r;for(;null!==(r=t.exec(e));){const e=v.parseId(r[1]);e&&s.push(e)}return s}static getAppidFromId(e){if(!e)return null;const t=e.match(/game_(\d+)/);return t&&v.parseId(t[1])}static getAppidFromGameCard(e){if(!e)return null;const t=e.match(/\/gamecards\/(\d+)/);return t&&v.parseId(t[1])}}const b=["contextMenus"];Object.freeze({context_steam_store:{persistent:!0,permissions:b},context_steam_market:{persistent:!0,permissions:b},context_itad:{persistent:!0,permissions:b},context_bartervg:{persistent:!0,permissions:b},context_steamdb:{persistent:!0,permissions:b},context_steamdb_instant:{persistent:!0,permissions:b},context_steam_keys:{persistent:!0,permissions:b}});class S{constructor(e,t=0,s=0){console.assert(3===[e,t,s].filter(Number.isInteger).length,`${e}.${t}.${s} must be integers`),this.major=e,this.minor=t,this.patch=s}static from(e){if(e instanceof S)return new S(e.major,e.minor,e.patch);if("string"==typeof e)return S.fromString(e);if(Array.isArray(e))return S.fromArray(e);throw new Error(`Could not construct a Version from ${e}`)}static fromArray(e){return new S(...e.map((e=>parseInt(e))))}static fromString(e){return S.fromArray(e.split("."))}static coerce(e){return e instanceof S?e:S.from(e)}toString(){return`${this.major}.${this.minor}.${this.patch}`}toArray(){return[this.major,this.minor,this.patch]}toJSON(){return this.toString()}isCurrent(){return this.isSameOrAfter(g.version)}isSame(e){const t=S.coerce(e);return this.major===t.major&&this.minor===t.minor&&this.patch===t.patch}isBefore(e){const t=S.coerce(e);return this.major<t.major||!(this.major>t.major)&&(this.minor<t.minor||!(this.minor>t.minor)&&this.patch<t.patch)}isSameOrBefore(e){return this.isSame(e)||this.isBefore(e)}isAfter(e){return S.coerce(e).isBefore(this)}isSameOrAfter(e){return S.coerce(e).isSameOrBefore(this)}}class k{static clearSpecialSymbols(e){return e.replace(/[\u00AE\u00A9\u2122]/g,"")}static htmlToDOM(e){return a.fragment(e)}static htmlToElement(e){return a.element(e)}static getVariableFromText(e,t,s){let r;if("object"===s)r=new RegExp(`${t}\\s*=\\s*(\\{.+?\\});`);else if("array"===s)r=new RegExp(`${t}\\s*=\\s*(\\[.+?\\]);`);else if("int"===s)r=new RegExp(`${t}\\s*=\\s*(.+?);`);else{if("string"!==s)return null;r=new RegExp(`${t}\\s*=\\s*(\\".+?\\");`)}const n=e.match(r);return n?"int"===s?parseInt(n[1]):JSON.parse(n[1]):null}static getVariableFromDom(e,t,s=document){for(const r of s.querySelectorAll("script")){const s=k.getVariableFromText(r.textContent,e,t);if(null!==s)return s}return null}}class E{static create(){p.get("show_progressbar")&&(a.afterEnd("#global_actions",`<div class="es_progress__wrap">\n                <div class="es_progress es_progress--complete" title="${h.str.ready.ready}">\n                    <div class="es_progress__bar">\n                        <div class="es_progress__value"></div>\n                    </div>\n                </div>\n            </div>`),E._progress=document.querySelector(".es_progress"))}static loading(){E._progress&&(E._progress.setAttribute("title",h.str.ready.loading),E.requests={initiated:0,completed:0},E._progress.classList.remove("es_progress--complete"),E._progress.querySelector(".es_progress__value").style.width="18px")}static startRequest(){E.requests&&(E.requests.initiated++,E.progress())}static finishRequest(){E.requests&&(E.requests.completed++,E.progress())}static progress(e){if(!E._progress)return;let t=e;if(!t){if(!E.requests)return;E.requests.initiated>0&&(t=100*E.requests.completed/E.requests.initiated)}t>100&&(t=100),E._progress.querySelector(".es_progress__value").style.width=`${t}px`,t>=100&&(E._progress.classList.add("es_progress--complete"),E._progress.setAttribute("title",h.str.ready.ready),E.requests=null)}static serverOutage(){E._progress&&(E._progress.classList.add("es_progress--warning"),E.requests=null,E._progress.parentElement.querySelector(".es_progress__warning, .es_progress__error")||a.afterEnd(E._progress,`<div class="es_progress__warning">${h.str.ready.server_outage}</div>`))}static failed(){if(!E._progress)return;const e=E._progress.parentElement.querySelector(".es_progress__warning");e&&(E._progress.classList.remove("es_progress--warning"),e.remove()),E._progress.classList.add("es_progress--error"),E.requests=null;const t=E._progress.parentElement.querySelector(".es_progress__error");t?t.textContent=h.str.ready.failed.replace("__amount__",++E._failedRequests):a.afterEnd(E._progress,`<div class="es_progress__error">${h.str.ready.failed.replace("__amount__",++E._failedRequests)}</div>`)}}E._progress=null,E._failedRequests=0;class I extends u{static async message(e){let t;E.startRequest();try{return t=await super.message(e),E.finishRequest(),t}catch(e){const t=class{static parse(e){const t=e.match(/(.*):\s(.+)/);return{name:t[1]||"",msg:t[2]||""}}}.parse(e.message);throw"ServerOutageError"===t.name?E.serverOutage():I._errorHandlers.some((e=>e(t)))||E.failed(),e}}static registerErrorHandler(e){I._errorHandlers.push(e)}}I._errorHandlers=[];class C{static async getHttp(e,t={},s="text"){let r=e;const a={method:"GET",credentials:"include",headers:{origin:window.location.origin},referrer:window.location.origin+window.location.pathname,...t};let o;E.startRequest(),r.startsWith("//")&&(r=window.location.protocol+e,console.warn("Requesting URL without protocol, please update"));try{if(o=await C._fetchFn(r,a),!o.ok)throw new n.HTTPError(o.status,`HTTP ${o.status} ${o.statusText} for ${o.url}`)}catch(e){throw E.failed(),e}return E.finishRequest(),o[s]()}static post(e,t,s,r){return C.getHttp(e,Object.assign(s||{},{method:"POST",body:t}),r?"json":"text")}static getJson(e,t){return C.getHttp(e,t,"json")}static getBlob(e,t){return C.getHttp(e,t,"blob")}}C._fetchFn="undefined"!=typeof content&&content&&content.fetch||fetch.bind(window);class ${static get storeCountry(){const e=new URL(window.location.href);let t;return e.searchParams&&e.searchParams.has("cc")?t=e.searchParams.get("cc"):(t=$._storeCountry,t||(t=o.get("steamCountry"))),t||(console.warn("Failed to detect store country, falling back to US"),t="US"),t.substr(0,2)}static promise(){if($._promise)return $._promise;const e=document.querySelector("#global_actions > a.user_avatar");let t;return e?($.profileUrl=e.href,$.profilePath=e.pathname,t=I.action("login",$.profilePath).then((e=>{e&&($.isSignedIn=!0,$.steamId=e.steamId)}))):t=I.action("logout"),$._promise=t.then((()=>I.action("storecountry"))).catch((({message:e})=>{console.error(e)})).then((e=>{if(e)return $._storeCountry=e,null;let t;if(window.location.hostname.endsWith("steampowered.com"))for(const e of document.getElementsByTagName("script")){const s=e.textContent.match(/GDynamicStore\.Init\(.+?, '([A-Z]{2})/);if(s){t=s[1];break}}else if("steamcommunity.com"===window.location.hostname){const e=document.querySelector("#webui_config,#application_config");e&&(t=JSON.parse(e.dataset.config).COUNTRY)}if(t)return $._storeCountry=t,I.action("storecountry",t).catch((({message:e})=>{console.error(e)}));throw new Error("Script with user store country not found")})).catch((e=>{console.group("Store country detection"),console.warn("Failed to detect store country from page"),console.error(e),console.groupEnd()})),$._promise}static then(e,t){return $.promise().then(e,t)}static get sessionId(){return $._sessionId||($._sessionId=k.getVariableFromDom("g_sessionID","string")),$._sessionId}static getPurchaseDate(e,t){const s=k.clearSpecialSymbols(t);return I.action("purchases",s,e)}static async getUserToken(){const e=await C.getJson("/pointssummary/ajaxgetasyncconfig").catch((()=>!1));if(!e||!e.success)throw new Error("Failed to get webapi token");return e.data.webapi_token}}Promise.allSettled||(Promise.allSettled=e=>Promise.all(e.map((e=>e.then((e=>({status:"fulfilled",value:e}))).catch((e=>({status:"rejected",reason:e})))))));const L=Object.freeze({ACCOUNT:1,APP:2,BUNDLE:3,STORE_DEFAULT:4,FUNDS:5,REGISTER_KEY:6,SALE:7,SEARCH:8,STATS:9,STORE_FRONT:10,SUB:11,WISHLIST:12,AGECHECK:13,COMMUNITY_DEFAULT:14,WORKSHOP:15,PROFILE_ACTIVITY:16,GAMES:17,PROFILE_EDIT:18,BADGES:19,GAME_CARD:20,FRIENDS_THAT_PLAY:21,FRIENDS:22,MARKET_SEARCH:23,INVENTORY:24,MARKET_LISTING:25,MARKET_HOME:26,PROFILE_HOME:27,GROUP_HOME:28,GUIDES:29,COMMUNITY_APP:30,COMMUNITY_STATS:31,MY_WORKSHOP:32,SHARED_FILES:33,WORKSHOP_BROWSE:34,EDIT_GUIDE:35,RECOMMENDED:36,BOOSTER_CREATOR:37,TRADE_OFFER:38,FRIENDS_AND_GROUPS:39,POINTS_SHOP:40});class x{static clear(){return I.action("dynamicstore.clear")}static async getAppStatus(e){const t=Array.isArray(e);let s,r,n;t?(r=e.map((e=>v.trimStoreId(e))),s=I.action("dynamicstorestatus",r)):s=I.action("dynamicstorestatus",v.trimStoreId(e));const a=await s;if(t){n={};for(let t=0;t<e.length;++t){const s=r[t],o=e[t];n[o]={ignored:a[s].includes("ignored"),wishlisted:a[s].includes("wishlisted")},o.startsWith("app/")?n[o].owned=a[s].includes("ownedApps"):o.startsWith("sub/")&&(n[o].owned=a[s].includes("ownedPackages"))}}else n={ignored:a.includes("ignored"),wishlisted:a.includes("wishlisted")},e.startsWith("app/")?n.owned=a.includes("ownedApps"):e.startsWith("sub/")&&(n.owned=a.includes("ownedPackages"));return n}static async getRandomApp(){return await x._fetch(),I.action("dynamicStore.randomApp")}static _fetch(){return $.isSignedIn?Promise.resolve(null):x.clear()}static then(e,t){return x._promise||(x._promise=x._fetch()),x._promise.then(e,t)}}class P{constructor(e){this.context=e}checkPrerequisites(){return!0}apply(){throw new Error("Stub")}logError(e,t,...s){console.group(this.constructor.name),console.error(t,...s),console.error(e),console.groupEnd()}}class A extends P{apply(){this.context.registerCallback(((...e)=>{this.callback(...e)})),"function"==typeof this.setup&&this.setup()}}(class{static init(){this._activeDropLists={},this._lastSelectHideTime=0,document.addEventListener("mousedown",(e=>{for(const t of Object.keys(this._activeDropLists))this._activeDropLists[t]&&!e.target.closest(`#${t}_container`)&&this._hide(t)}))}static _highlightItem(e,t,s){const r=document.querySelector(`#${e}_droplist`),n=document.querySelector(`#${e}_trigger`),o=r.getElementsByTagName("a");if(t>=0&&t<o.length){const i=o[t];void 0!==n.highlightedItem&&n.highlightedItem!==t&&(o[n.highlightedItem].className="inactive_selection"),n.highlightedItem=t,o[t].className="highlighted_selection";let c=o[t].offsetTop+o[t].clientHeight,l=r.scrollTop+r.clientHeight,d=!1;const u=o.length;let m=0;for(;l<c&&m++<u;)r.scrollTop+=o[t].clientHeight,l=r.scrollTop+r.clientHeight,d=!0;if(!d)for(m=0,c=o[t].offsetTop,l=r.scrollTop;l>c&&m++<u;)r.scrollTop-=o[t].clientHeight,l=r.scrollTop;if(s){a.inner(n,i.innerHTML);const t=document.querySelector(`#${e}`);t.value=i.id,t.dispatchEvent(new Event("change")),this._hide(e)}}}static _onFocus(e){this._activeDropLists[e]=!0}static _onBlur(e){document.querySelector(`#${e}_trigger`).classList.contains("activetrigger")||(this._activeDropLists[e]=!1)}static _hide(e){const t=document.querySelector(`#${e}_droplist`),s=document.querySelector(`#${e}_trigger`);this._lastSelectHideTime=Date.now(),s.className="trigger",t.className="dropdownhidden",this._activeDropLists[e]=!1,s.focus()}static _show(e){if(Date.now()-this._lastSelectHideTime<50)return;const t=document.querySelector(`#${e}_droplist`),s=document.querySelector(`#${e}_trigger`);s.className="activetrigger",t.className="dropdownvisible",this._activeDropLists[e]=!0,s.focus()}static _onTriggerClick(e){document.querySelector(`#${e}_trigger`).classList.contains("activetrigger")||this._show(e)}static get(e,t,s,r,n){const o=`sort_by_${e}`;let i=s.endsWith("_DESC");const c=a.element(`<div class="es-sortbox es-sortbox--${e}">\n                <div class="es-sortbox__label">${h.str.sort_by}</div>\n                <div id="${o}_container" class="es-sortbox__container">\n                    <input id="${o}" type="hidden" name="${e}" value="${s}">\n                    <a id="${o}_trigger" class="trigger"></a>\n                    <div class="es-dropdown">\n                        <ul id="${o}_droplist" class="dropdownhidden"></ul>\n                    </div>\n                </div>\n                <span class="es-sortbox__reverse">${i?"↑":"↓"}</span>\n            </div>`),l=c.querySelector(`#${o}`);function d(e){return e.replace(/(_ASC|_DESC)$/,"")}function u(e,t){const s=d(e);r(s,t),n&&p.set(n,`${s}_${t?"DESC":"ASC"}`)}l.addEventListener("change",(()=>{u(l.value.replace(`${o}_`,""),i)})),"default_ASC"!==s&&l.dispatchEvent(new Event("change"));const m=c.querySelector(".es-sortbox__reverse");m.addEventListener("click",(()=>{i=!i,m.textContent=i?"↑":"↓",u(l.value.replace(`${o}_`,""),i)}));const _=c.querySelector(`#${o}_trigger`);_.addEventListener("focus",(()=>this._onFocus(o))),_.addEventListener("blur",(()=>this._onBlur(o))),_.addEventListener("click",(()=>this._onTriggerClick(o)));const g=c.querySelector("ul"),f=d(s);for(let e=0;e<t.length;++e){const[s,r]=t[e];let n="inactive";s===f&&(l.value=s,_.textContent=r,n="highlighted"),a.beforeEnd(g,`<li>\n                    <a class="${n}_selection" tabindex="99999" id="${o}_${s}">${r}</a>\n                </li>`);const i=g.querySelector("li:last-child > a");i.addEventListener("mouseover",(()=>this._highlightItem(o,e,!1))),i.addEventListener("click",(()=>this._highlightItem(o,e,!0)))}return c}}).init();class T{static wrap(e,t){const s=t.parentNode;s.insertBefore(e,t),s.removeChild(t),e.append(t)}static remove(e){const t=document.querySelector(e);t&&t.remove()}static selectLastNode(e,t){const s=e.querySelectorAll(t);return 0===s.length?null:s[s.length-1]}static insertStylesheet(e){const t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=e,document.head.appendChild(t)}static insertScript({src:e,content:t},s,r,n=!0){const a=document.createElement("script");r&&(a.onload=r),s&&(a.id=s),e&&(a.src=e),t&&(a.textContent=t),n&&a.setAttribute("async",""),document.head.appendChild(a)}static insertCSS(e,t){const s=document.createElement("style");t&&(s.id=t),s.textContent=e,document.head.appendChild(s)}}class q{static create(e,t,s){let r=0;e.addEventListener("wheel",(e=>{e.preventDefault(),e.stopPropagation(),Date.now()-r<200||(r=Date.now(),e.deltaY>0?s.click():t.click())}))}}const O="https://augmentedsteam.com";class F{static _addMenu(){a.afterBegin("#global_action_menu",`<div id="es_menu">\n                <span id="es_pulldown" class="pulldown global_action_link">Augmented Steam</span>\n                <div id="es_popup" class="popup_block_new">\n                    <div class="popup_body popup_menu">\n                        <a class="popup_menu_item" target="_blank" href="${m.getURL("html/options.html")}">${h.str.thewordoptions}</a>\n                        <a class="popup_menu_item" id="es_clear_cache" href="#clear_cache">${h.str.clear_cache}</a>\n                        <div class="hr"></div>\n                        <a class="popup_menu_item" target="_blank" href="https://github.com/IsThereAnyDeal/AugmentedSteam">${h.str.contribute}</a>\n                        <a class="popup_menu_item" target="_blank" href="https://github.com/IsThereAnyDeal/AugmentedSteam/issues">${h.str.bug_feature}</a>\n                        <div class="hr"></div>\n                        <a class="popup_menu_item" target="_blank" href="${O}">${h.str.website}</a>\n                        <a class="popup_menu_item" target="_blank" href="https://isthereanydeal.com/">IsThereAnyDeal</a>\n                        <a class="popup_menu_item" target="_blank" href="https://discord.gg/yn57q7f">Discord</a>\n                    </div>\n                </div>\n            </div>`),document.querySelector("#es_pulldown").addEventListener("click",(()=>{z.runInPageContext((()=>{window.SteamFacade.showMenu("es_pulldown","es_popup","right","bottom",!0)}))})),document.querySelector("#es_menu").addEventListener("click",(e=>{e.stopPropagation()})),document.querySelector("#es_popup").addEventListener("click",(()=>{z.runInPageContext((()=>{window.SteamFacade.hideMenu("es_pulldown","es_popup")}))})),document.querySelector("#es_clear_cache").addEventListener("click",(async e=>{e.preventDefault(),await F.clearCache(),window.location.reload()}))}static _addBackToTop(){if(!p.get("show_backtotop"))return;T.remove("#BackToTop");const e=document.createElement("div");e.classList.add("es_btt"),e.textContent="▲",document.body.append(e),e.addEventListener("click",(()=>{window.scroll({top:0,left:0,behavior:"smooth"})})),window.addEventListener("scroll",(()=>{e.classList.toggle("is-visible",window.scrollY>=400)}))}static _bindLogout(){document.querySelector("a[href$='javascript:Logout();']").addEventListener("click",(()=>{F.clearCache()}))}static _addWarning(e,t){const s=a.element(`<div class="es_warn js-warn">\n                <div class="es_warn__cnt">\n                    <div>${e}</div>\n                    <div class="es_warn__control">\n                        <a class="es_warn__btn js-warn-close">${h.str.update.dont_show}</a>\n                        <a class="es_warn__btn js-warn-hide">${h.str.hide}</a>\n                    </div>\n                </div>\n            </div>`);s.querySelector(".js-warn-close").addEventListener("click",(()=>{t&&t(),s.closest(".js-warn").remove()})),s.querySelector(".js-warn-hide").addEventListener("click",(()=>{s.closest(".js-warn").remove()})),document.getElementById("global_header").insertAdjacentElement("afterend",s)}static _addLanguageWarning(){if(!p.get("showlanguagewarning"))return;const e=d.getCurrentSteamLanguage();if(!e)return;p.has("showlanguagewarninglanguage")||p.set("showlanguagewarninglanguage",e);const t=p.get("showlanguagewarninglanguage");e!==t&&h.loadLocalization(d.getLanguageCode(t)).then((s=>{F._addWarning(`${s.using_language.replace("__current__",s.options.lang[e]||e)}\n                <a href="#" id="es_reset_language_code">\n                ${s.using_language_return.replace("__base__",s.options.lang[t]||t)}\n                </a>`,(()=>{p.set("showlanguagewarning",!1)})),document.querySelector("#es_reset_language_code").addEventListener("click",(e=>{e.preventDefault(),z.runInPageContext((e=>{ChangeLanguage(e)}),[t])}))}))}static _handleInstallSteamButton(){const e=p.get("installsteam");if("hide"===e)T.remove("div.header_installsteam_btn");else if("replace"===e){const e=document.querySelector("div.header_installsteam_btn > a");e.textContent=h.str.viewinclient,e.href=`steam://openurl/${window.location.href}`,e.classList.add("es_steamclient_btn")}}static _addUsernameSubmenuLinks(){for(const e of document.querySelectorAll(".submenu_username"))a.afterEnd(e.querySelector("a"),`<a class="submenuitem" href="//steamcommunity.com/my/games/">${h.str.games}</a>`),a.afterEnd(e.querySelector("a:nth-child(2)"),`<a class="submenuitem" href="//store.steampowered.com/wishlist/">${h.str.wishlist}</a>`),a.beforeEnd(e,`<a class="submenuitem" href="//steamcommunity.com/my/recommended/">${h.str.reviews}</a>`)}static _cartLink(){for(const e of document.querySelectorAll(".submenu_store > .submenuitem[href='https://steamcommunity.com/my/wishlist/']"))a.afterEnd(e,`<a class="submenuitem" href="https://store.steampowered.com/cart/">${h.str.cart}</a>`)}static _disableLinkFilter(){function e(e=document){for(const t of e.querySelectorAll("a[href*='/linkfilter/']"))t.href=new URLSearchParams(t.search).get("url")}p.get("disablelinkfilter")&&(e(),new MutationObserver((t=>{for(const s of t)for(const t of s.addedNodes)t.nodeType===Node.ELEMENT_NODE&&e(t)})).observe(document,{childList:!0,subtree:!0}))}static _addRedeemLink(){a.beforeBegin("#account_language_pulldown",`<a class="popup_menu_item" href="https://store.steampowered.com/account/registerkey">${h.str.activate}</a>`)}static _replaceAccountName(){if(!p.get("replaceaccountname"))return;const e=document.querySelector("#account_dropdown .persona.online"),t=e.textContent.trim(),s=document.querySelector("#account_pulldown").textContent.trim();if(e.textContent=s,location.href.startsWith("https://store.steampowered.com/account")){const e=document.querySelector("h2.pageheader");e&&(e.textContent=e.textContent.replace(new RegExp(t,"i"),s))}/.*(id|profiles)\/.+/g.test(location.pathname)&&!location.pathname.includes($.profilePath)||(document.title=document.title.replace(t,s))}static _launchRandomButton(){a.beforeEnd("#es_popup .popup_menu",`<div class="hr"></div>\n             <a id="es_random_game" class="popup_menu_item" style="cursor: pointer;">${h.str.launch_random}</a>`),document.querySelector("#es_random_game").addEventListener("click",(async()=>{const e=await x.getRandomApp();e&&I.action("appdetails",e).then((t=>{if(!t||!t.success)return;const s=t.data;let r,n=e;s.fullgame?(n=s.fullgame.appid,r=s.fullgame.name):r=s.name,z.runInPageContext(((e,t,s)=>{window.SteamFacade.showConfirmDialog(e,`<img src="//steamcdn-a.akamaihd.net/steam/apps/${t}/header.jpg">`,null,null,s).done((e=>{"OK"===e&&window.location.assign(`steam://run/${t}`),"SECONDARY"===e&&window.location.assign(`//store.steampowered.com/app/${t}`)}))}),[h.str.play_game.replace("__gamename__",r.replace("'","").trim()),n,h.str.visit_store])}))}))}static _skipGotSteam(){p.get("skip_got_steam")&&z.runInPageContext((()=>{window.ShowGotSteamModal=function(e){window.location.assign(e)}}))}static _keepSteamSubscriberAgreementState(){const e=document.querySelectorAll("#market_sell_dialog_accept_ssa,#market_buyorder_dialog_accept_ssa,#accept_ssa");for(const t of e)t.checked=p.get("keepssachecked"),t.addEventListener("click",(()=>{p.set("keepssachecked",!p.get("keepssachecked"))}))}static _defaultCommunityTab(){const e=p.get("community_default_tab");if(!e)return;const t=document.querySelectorAll("a[href^='https://steamcommunity.com/app/']");for(const s of t)s.classList.contains("apphub_sectionTab")||/^\/app\/[0-9]+\/?$/.test(s.pathname)&&(s.pathname.endsWith("/")||(s.pathname+="/"),s.pathname+=`${e}/`)}static _horizontalScrolling(){if(p.get("horizontalscrolling"))for(const e of document.querySelectorAll(".slider_ctn:not(.spotlight)"))q.create(e.parentNode.querySelector("#highlight_strip, .store_horizontal_autoslider_ctn"),e.querySelector(".slider_left"),e.querySelector(".slider_right"))}static addLoginWarning(e){if(F._loginWarningAdded||f.get(`hide_login_warn_${e}`))return;let t;if("store"===e)t="store.steampowered.com";else{if("community"!==e)return void console.warn("Unknown login warning type %s",e);t="steamcommunity.com"}F._addWarning(`${h.str.login_warning.replace("__link__",`<a href="https://${t}/login/">${t}</a>`)}`,(()=>{f.set(`hide_login_warn_${e}`,!0)})),F._loginWarningAdded=!0,console.warn("Are you logged into %s?",t)}static clearCache(){return I.action("cache.clear")}static init(){F._addBackToTop(),F._addMenu(),F._addLanguageWarning(),F._handleInstallSteamButton(),F._disableLinkFilter(),F._skipGotSteam(),F._keepSteamSubscriberAgreementState(),F._defaultCommunityTab(),F._horizontalScrolling(),F._cartLink(),$.isSignedIn&&(F._addUsernameSubmenuLinks(),F._addRedeemLink(),F._replaceAccountName(),F._launchRandomButton(),F._bindLogout())}}class D{static escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}}class N{constructor({id:e,abbr:t="USD",symbol:s="$",hint:r="Default Currency",multiplier:n=100,unit:a=1,format:{places:o=2,hidePlacesWhenZero:i=!1,symbolFormat:c="$",thousand:l=",",group:d=3,decimal:u=".",right:m=!1}}){Object.assign(this,{id:e,abbr:t,symbol:s,hint:r,multiplier:n,unit:a,format:{decimalPlaces:o,hidePlacesWhenZero:i,symbol:c,groupSeparator:l,groupSize:d,decimalSeparator:u,postfix:m}}),Object.freeze(this.format),Object.freeze(this)}valueOf(e){let t=e.trim().replace(this.format.groupSeparator,"");"."!==this.format.decimalSeparator&&(t=t.replace(this.format.decimalSeparator,".")),t=t.replace(/[^\d.]/g,"");const s=parseFloat(t);return Number.isNaN(s)?null:s}stringify(e,t=!0){const s=e<0?"-":"";let r,n=Math.abs(e).toFixed(this.format.decimalPlaces);[n,r]=n.split(".");const a=[];let o=n.length;for(;o>this.format.groupSize;o-=this.format.groupSize)a.unshift(n.substring(o-this.format.groupSize,o));return a.unshift(n.substring(0,o)),n=[s,a.join(this.format.groupSeparator)],this.format.decimalPlaces>0&&(!this.format.hidePlacesWhenZero||parseInt(r)>0)&&(n.push(this.format.decimalSeparator),n.push(r)),t&&(this.format.postfix?n.push(this.format.symbol):n.unshift(this.format.symbol)),n.join("")}placeholder(){let e=`1${this.format.groupSeparator}`,t=2;for(let s=0;s<this.format.groupSize;++s,++t)e+=t;if(0===this.format.decimalPlaces)return e;e+=this.format.decimalSeparator;for(let s=0;s<this.format.decimalPlaces;++s,++t)e+=t;return e}regExp(){let e=`^(?:\\d{1,${this.format.groupSize}}(?:${D.escapeRegExp(this.format.groupSeparator)}\\d{${this.format.groupSize}})+|\\d*)`;return this.format.decimalPlaces>0&&(e+=`(?:${D.escapeRegExp(this.format.decimalSeparator)}\\d{0,${this.format.decimalPlaces}})?`),e+="$",new RegExp(e)}}class R{static _getCurrencyFromDom(){const e=document.querySelector('meta[itemprop="priceCurrency"]');return e&&e.hasAttribute("content")?e.getAttribute("content"):null}static async _getCurrencyFromWallet(){const e=await z.runInPageContext((()=>"undefined"!=typeof g_rgWalletInfo&&g_rgWalletInfo?g_rgWalletInfo.wallet_currency:null),null,"walletCurrency");return e?R.currencyNumberToType(e):null}static async _getStoreCurrency(e){let t=R._getCurrencyFromDom();if(t||(t=await R._getCurrencyFromWallet(e)),!t)try{t=await I.action("currency")}catch(e){console.error(`Couldn't load currency${e}`)}return t||(t="USD"),t}static getRate(e,t){return e===t?1:R._rates[e]&&R._rates[e][t]?R._rates[e][t]:null}static getCurrencySymbolFromString(e){const t=e.match(/(?:R\$|S\$|\$|RM|kr|Rp|€|¥|£|฿|pуб|P|₫|₩|TL|₴|Mex\$|CDN\$|A\$|HK\$|NT\$|₹|SR|R |DH|CHF|CLP\$|S\/\.|COL\$|NZ\$|ARS\$|₡|₪|₸|KD|zł|QR|\$U)/);return t?t[0]:""}static currencyTypeToNumber(e){return R.fromType(e).id}static currencyNumberToType(e){return R.fromNumber(e).abbr}static fromType(e){return R._indices.abbr[e]||R._defaultCurrency}static fromNumber(e){return R._indices.id[e]||R._defaultCurrency}static async _loadCurrency(e){R.storeCurrency=await R._getStoreCurrency(e);const t=p.get("override_price");R.customCurrency="auto"===t?R.storeCurrency:t}static async _loadRates(){const e=[R.storeCurrency];R.customCurrency!==R.storeCurrency&&e.push(R.customCurrency),R._rates=await I.action("rates",e)}static async init(e){if(R._isInitialized)return;const t=await I.action("steam.currencies");for(let e of t)e=new N(e),R._indices.abbr[e.abbr]=e,R._indices.id[e.id]=e,e.symbol&&(R._indices.symbols[e.symbol]=e);R._defaultCurrency=R._indices.id[1];try{await R._loadCurrency(e),await R._loadRates()}catch(e){console.error("Failed to initialize Currency"),console.error(e)}R._isInitialized=!0}static then(e,t){return R.init().then(e,t)}}R._isInitialized=!1,R._indices={id:{},abbr:{},symbols:{}};class M{static async create(){await I.action("itad.isconnected")&&(a.afterBegin("#global_action_menu",`<div id="es_itad">\n                <img id="es_itad_logo" src="${m.getURL("img/itad.png")}">\n                <span id="es_itad_status">✓</span>\n            </div>`),document.querySelector("#es_itad").addEventListener("mouseenter",M.onHover),$.isSignedIn&&(p.get("itad_import_library")||p.get("itad_import_wishlist"))&&I.action("itad.import"))}static async onHover(){async function e(){const{from:e,to:t}=await I.action("itad.lastimport");let s=`<div>${h.str.itad.from}</div>\n                   <div>${e?new Date(1e3*e).toLocaleString():h.str.never}</div>`;(p.get("itad_import_library")||p.get("itad_import_wishlist"))&&(s+=`<div>${h.str.itad.to}</div>\n                        <div>${t?new Date(1e3*t).toLocaleString():h.str.never}</div>`),a.inner(".es-itad-hover__last-import",s)}if(!document.querySelector(".es-itad-hover")){a.afterEnd("#es_itad_status",`<div class="es-itad-hover">\n                    <div class="es-itad-hover__content">\n                        <h4>${h.str.itad.last_import}</h4>\n                        <div class="es-itad-hover__last-import"></div>\n                        <div class="es-itad-hover__sync-now">\n                            <span class="es-itad-hover__sync-now-text">${h.str.itad.sync_now}</span>\n                            <div class="loader"></div>\n                            <span class="es-itad-hover__sync-failed">&#10060;</span>\n                            <span class="es-itad-hover__sync-success">&#10003;</span>\n                        </div>\n                    </div>\n                    <div class="es-itad-hover__arrow"></div>\n                </div>`);const t=document.querySelector(".es-itad-hover"),s=document.querySelector(".es-itad-hover__sync-now");document.querySelector(".es-itad-hover__sync-now-text").addEventListener("click",(async()=>{let r;s.classList.remove("es-itad-hover__sync-now--failed","es-itad-hover__sync-now--success"),s.classList.add("es-itad-hover__sync-now--loading"),t.style.display="block";try{await I.action("itad.sync"),s.classList.add("es-itad-hover__sync-now--success"),await e(),r=1e3}catch(e){s.classList.add("es-itad-hover__sync-now--failed"),console.group("ITAD sync"),console.error("Failed to sync with ITAD"),console.error(e),console.groupEnd(),r=3e3}finally{(class{static timer(e){return new y(e)}static resettableTimer(e,t){return new w(e,t)}static now(){return Math.trunc(Date.now()/1e3)}}).timer(r).then((()=>{t.style.display=""})),s.classList.remove("es-itad-hover__sync-now--loading")}}))}await e()}static async getAppStatus(e,t){const s={waitlist:!0,collection:!0,...t};if(!s.collection&&!s.waitlist)return null;const r=Array.isArray(e),n=[],a=Promise.resolve(!!r&&{});await I.action("itad.isconnected")?(s.collection?n.push(I.action("itad.incollection",e)):n.push(a),s.waitlist?n.push(I.action("itad.inwaitlist",e)):n.push(a)):n.push(a,a);const[o,i]=await Promise.all(n);if(r){const t={};for(const s of e)t[s]={collected:o[s],waitlisted:i[s]};return t}return{collected:o,waitlisted:i}}}class B{static postMessage(e,t){window.postMessage({type:`es_${e}`,information:t},window.location.origin)}static onMessage(e){return new Promise((t=>{window.addEventListener("message",(function s(r){r.source===window&&r.data&&r.data.type&&r.data.type===`es_${e}`&&(t(r.data.information),window.removeEventListener("message",s))}))}))}static addMessageListener(e,t){window.addEventListener("message",(s=>{s.source===window&&s.data&&s.data.type&&s.data.type===`es_${e}`&&t(s.data.information)}))}}class j{constructor(e=0,t=R.storeCurrency){this.value=e,this.currency=t,Object.freeze(this)}formattedValue(){return R.fromType(this.currency).stringify(this.value,!1)}toString(){return R.fromType(this.currency).stringify(this.value)}add(e){let t=e;return e.currency!==this.currency&&(t=e.inCurrency(this.currency)),new j(this.value+t.value,this.currency)}inCurrency(e){if(this.currency===e)return new j(this.value,this.currency);const t=R.getRate(this.currency,e);if(!t)throw new Error(`Could not establish conversion rate between ${this.currency} and ${e}`);return new j(this.value*t,e)}static parseFromString(e,t=R.storeCurrency){let s=R.fromType(t).valueOf(e);return null!==s&&(s=new j(s,t)),s}}let H=!1;window.addEventListener("unhandledrejection",(function(e){const t=e.reason;t&&t.error&&(e.preventDefault(),e.stopPropagation(),console.group("An error occurred in the background context."),console.error(t.localStack),console.error(t.stack),console.groupEnd())})),T.insertScript({content:`window.Messenger = ${B.toString()}`}),T.insertScript({content:`window.SteamFacade = ${class{static global(e){return window[e]}static globalSet(e,t){window[e]=t}static showDialog(e,t,s){ShowDialog(e,t,s)}static showConfirmDialog(e,t,s,r,n){return ShowConfirmDialog(e,t,s,r,n)}static showAlertDialog(e,t,s){return ShowAlertDialog(e,t,s)}static showBlockingWaitDialog(e,t){return ShowBlockingWaitDialog(e,t)}static showNicknameModal(){return ShowNicknameModal()}static dismissActiveModal(){CModal.DismissActiveModal()}static showMenu(e,t,s,r,n){return ShowMenu(e,t,s,r,n)}static hideMenu(e,t){return HideMenu(e,t)}static collapseLongStrings(e){return CollapseLongStrings(e)}static adjustVisibleAppTags(e){return AdjustVisibleAppTags($J(e))}static updatePlaytimeFilterValues(e,t){return UpdatePlaytimeFilterValues(e,t)}static bindAutoFlyoutEvents(){return BindAutoFlyoutEvents()}static sliderOnChange(e){return g_player.SliderOnChange(e)}static dynamicStoreInvalidateCache(){return GDynamicStore.InvalidateCache()}static dynamicStoreDecorateItems(e,t){return GDynamicStore.DecorateDynamicItems($J(e),t)}static onDynamicStoreReady(e){return GDynamicStore.OnReady(e)}static storeItemDataBindHover(e,t,s,r,n){GStoreItemData.BindHoverEvents($J(e),t,s,r,n)}static vTooltip(e,t=!1){const s="store.steampowered.com"===window.location.host;$J(e).v_tooltip({tooltipClass:s?"store_tooltip":"community_tooltip",dataName:t?"tooltipHtml":"tooltipText",defaultType:t?"html":"text",replaceExisting:!1})}static calculateFeeAmount(e,t){return CalculateFeeAmount(e,t)}static vCurrencyFormat(e,t){return v_currencyformat(e,t)}static toggleManageFriends(){return ToggleManageFriends()}static openFriendChatInWebChat(e){return OpenFriendChatInWebChat(e)}static submitGuide(){return SubmitGuide()}static initMiniprofileHovers(){return InitMiniprofileHovers()}static inviteUserToGroup(e,t,s){return InviteUserToGroup(e,t,s)}static getCheckedAccounts(e){return GetCheckedAccounts(e)}static execFriendAction(e,t){return ExecFriendAction(e,t)}static scrollOffsetForceRecalc(){CScrollOffsetWatcher.ForceRecalc()}static vSetCookie(e,t,s,r){V_SetCookie(e,t,s,r)}static checkAgeGateSubmit(e){CheckAgeGateSubmit(e)}static loadImageGroupOnScroll(e,t){LoadImageGroupOnScroll(e,t)}static showModalContent(e,t,s,r){ShowModalContent(e,t,s,r)}static firstPage(){return InventoryFirstPage()}static lastPage(){return InventoryLastPage()}static goToPage(){return InventoryGoToPage()}static reloadCommunityInventory(){return ReloadCommunityInventory()}static getMarketHashName(e){return GetMarketHashName(e)}static zoomYear(){pricehistory_zoomDays(g_plotPriceHistory,g_timePriceHistoryEarliest,g_timePriceHistoryLatest,365)}static zoomYearForSellDialog(){pricehistory_zoomDays(SellItemDialog.m_plotPriceHistory,SellItemDialog.m_timePriceHistoryEarliest,SellItemDialog.m_timePriceHistoryLatest,365)}static updateSelection(){return UpdateSelection()}static selectAll(){return SelectAll()}static selectNone(){return SelectNone()}static selectInverse(){return SelectInverse()}static jq(e){return $J(e)}static jqOnClick(e,t){$J(e).on("click",t)}static jqAjax(e){return $J.ajax(e)}static jqGet(e,t){return $J.get(e,t)}static jqPost(e,t){return $J.post(e,t)}static jqTrigger(e,t){return $J(e).trigger(t)}}.toString()}`}),I.registerErrorHandler((({name:e,msg:t})=>"LoginError"===e&&(F.addLoginWarning(t),E.finishRequest(),!0)));class z{static runInPageContext(e,t,s){const r=document.createElement("script");let n;const a=Array.isArray(t)?JSON.stringify(t):"[]";if(s){const t="msg_"+ ++z._msgCounter;n=B.onMessage(t),r.textContent=`(async () => { Messenger.postMessage("${t}", await (${e})(...${a})); })();`}else r.textContent=`(${e})(...${a});`;return document.documentElement.appendChild(r),r.parentNode.removeChild(r),n}async run(e){if(document.getElementById("global_header")){try{try{await p,function(){if(H)return;H=!0;const e={ALLOWED_URI_REGEXP:/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|chrome-extension|moz-extension|steam):|[^a-z]|[a-z+.-]+(?:[^a-z+.\-:]|$))/i};p.get("openinnewtab")&&(e.ADD_ATTR=["target"],DOMPurify.addHook("uponSanitizeAttribute",((e,t)=>{"target"===t.attrName&&("_blank"===t.attrValue?e.setAttribute("rel","noreferrer noopener"):t.keepAttr=!1)}))),DOMPurify.setConfig(e)}()}catch(e){console.error(e)}await Promise.all([f,h,$,R])}catch(e){return console.group("Augmented Steam initialization"),console.error("Failed to initiliaze Augmented Steam"),console.error(e),void console.groupEnd()}console.log(`%c Augmented %cSteam v${g.version} %c ${O}`,"background: #000000; color: #046eb2","background: #000000; color: #ffffff",""),E.create(),E.loading(),F.init(),class{static async checkVersion(e){const t=S.fromString(p.get("version"));if(S.fromString(g.version).isAfter(t)){let s=Promise.resolve();p.get("version_show")&&(s=this._showChangelog().catch((e=>{console.error("Failed to show changelog: %o",e)}))),await Promise.all([s,this._migrateSettings(t),e()])}p.set("version",g.version)}static async _showChangelog(){const e=(await m.getJSON("changelog.json"))[g.version];if(!e)throw new Error(`Can't find changelog for version ${g.version}`);const t=`<div class="es_changelog"><img src="${m.getURL("img/logo/as128.png")}"><div>${e}<p><a href="https://github.com/IsThereAnyDeal/AugmentedSteam/compare/v${p.get("version")}...v${g.version}">All changes on GitHub</a></p></div></div>`,s=document.querySelector("#itad_connect");function r(){s.replaceWith("✓")}z.runInPageContext(((e,t)=>{window.SteamFacade.showAlertDialog(e,t)}),[h.str.update.updated.replace("__version__",g.version),t]),S.fromString(g.version).isSame(new S(1,4))&&(await u.action("itad.isconnected")?r():s.addEventListener("click",(async()=>{await u.action("itad.authorize"),M.create(),r()})))}static _migrateSettings(e){if(e.isSameOrBefore("1.3.1")&&(u.action("cache.clear"),p.set("horizontalscrolling",p.get("horizontalmediascrolling")),p.remove("horizontalmediascrolling")),e.isSameOrBefore("1.4")&&p.remove("show_sysreqcheck"),e.isSame("1.4")&&I.action("migrate.notesToSyncedStorage"),e.isSameOrBefore("1.4.1")&&(p.set("profile_steamid",p.get("profile_permalink")),p.remove("profile_permalink")),e.isSameOrBefore("1.4.3")&&(p.remove("contscroll"),I.action("logout")),e.isSameOrBefore("1.4.7")){const e=f.get("fav_emoticons");Array.isArray(e)&&p.set("fav_emoticons",e)}if(e.isSameOrBefore("2.0.0")&&(p.remove("showfakeccwarning"),p.remove("hideaboutlinks")),e.isSameOrBefore("2.0.1")&&(p.remove("hide_dlcunownedgames"),p.remove("hide_wishlist"),p.remove("hide_cart"),p.remove("hide_notdiscounted"),p.remove("hide_mixed"),p.remove("hide_negative"),p.remove("hide_priceabove"),p.remove("priceabove_value"),p.remove("hide_owned"),p.remove("hide_ignored"),p.remove("highlight_notdiscounted"),p.remove("showallfriendsthatown"),p.has("showusernotes"))){const e=p.get("showusernotes");p.set("user_notes_app",e),p.set("user_notes_wishlist",e),p.remove("showusernotes")}if(e.isSameOrBefore("2.1.0")){p.remove("showcomparelinks");const e=p.get("profile_custom_link");for(const t of e)t.url&&!t.url.includes("[ID]")&&(t.url+="[ID]");p.set("profile_custom_link",e)}e.isSameOrBefore("2.2.1")&&I.action("migrate.cachestorage")}}.checkVersion(F.clearCache),M.create(),this._pageSpecificFeatures(),(new e).applyFeatures()}}_pageSpecificFeatures(){}}z._msgCounter=0;class U{static _toggleHiddenCommentsButton(e,t){e.classList.add("esi_commentthread");let s=e.querySelector(".esi_commentthread_button");0!==t?(s||(s=document.createElement("a"),s.classList.add("esi_commentthread_button"),e.insertAdjacentElement("afterbegin",s),s.addEventListener("click",(()=>{e.classList.add("esi_commentthread--showspam")}))),s.classList.remove("esi-hidden"),s.textContent=h.str.spam_comment_show.replace("__num__",t),e.classList.remove("esi_commentthread--showspam")):s&&s.classList.add("esi-hidden")}static _addCommentThreadObserver(e){e.dataset.esiCommentObserver||(e.dataset.esiCommentObserver="1",new MutationObserver((()=>{this._updateCommentThread(e)})).observe(e.querySelector(".commentthread_comments"),{childList:!0}))}static _hideSpamComments(e){const t=e.querySelectorAll(".commentthread_comment .commentthread_comment_text");let s=0;for(const e of t){const t=e.textContent;this._spamRgx.test(t)&&(e.closest(".commentthread_comment").classList.add("esi_comment_hidden"),s++)}return s}static _updateCommentThread(e){const t=this._hideSpamComments(e);this._toggleHiddenCommentsButton(e,t)}static _handleAllCommentThreads(e){const t=e.querySelectorAll(".commentthread_comment_container:not(.esi_commentthread)");for(const e of t)this._updateCommentThread(e),this._addCommentThreadObserver(e)}static hideSpamComments(){if(!p.get("hidespamcomments"))return;this._spamRgx=new RegExp(p.get("spamcommentregex"),"i"),this._handleAllCommentThreads(document);const e=document.querySelector("#modalContentWait");e&&new MutationObserver((()=>{if(!document.querySelector("#modalContentFrameContainer"))return;const e=window.frames[window.frames.length-1];this._handleAllCommentThreads(e.document)})).observe(e,{attributes:!0})}static _updateFavs(e,t,s,r){if(p.set("fav_emoticons",e),r&&e.includes(r)&&e.length>1){a.beforeEnd(s,this._buildEmoticonOption(r));const e=s.querySelector(`[data-emoticon="${r}"]`);this._finalizeFav(e,t)}else if(r&&!e.includes(r)&&e.length>0){const e=s.querySelector(`[data-emoticon="${r}"]`);if(!e)return;e.remove()}else{const r=this._buildFavBox(e);a.inner(s,r);for(const e of s.querySelectorAll(".emoticon_option"))this._finalizeFav(e,t)}}static _finalizeFav(e,t){e.draggable=!0,e.querySelector("img").draggable=!1,e.addEventListener("dragstart",(e=>this._dragFavEmoticon(e))),e.addEventListener("click",(e=>this._clickFavEmoticon(e,t)))}static _dragFavEmoticon(e){e.dataTransfer.setData("emoticon",e.target.dataset.emoticon);const t=document.querySelector(".emoticon_hover");t&&(t.style.display="none")}static _clickFavEmoticon(e,t){const s=e.target.closest(".emoticon_option"),r=t.querySelector(`[data-emoticon=${s.dataset.emoticon}]:not(.es_fav)`);if(!r)return e.stopPropagation(),s.classList.add("no-access"),void(s.querySelector("img").title=h.str.fav_emoticons_no_access);r.click()}static _buildFavBox(e=[]){let t;return t=e.length?e.map((e=>this._buildEmoticonOption(e))).join(""):h.str.fav_emoticons_dragging,t}static _buildEmoticonOption(e){return`<div class="emoticon_option es_fav" data-emoticon="${e}"><img src="https://steamcommunity-a.akamaihd.net/economy/emoticon/${e}" class="emoticon"></div>`}static addFavoriteEmoticons(){0!==document.querySelectorAll(".emoticon_button").length&&new MutationObserver((()=>{const e=document.querySelector(".emoticon_popup:not(.es_emoticons)");if(!e)return;e.classList.add("es_emoticons");for(const t of e.querySelectorAll(".emoticon_option"))t.draggable=!0,t.querySelector("img").draggable=!1,t.addEventListener("dragstart",(e=>this._dragFavEmoticon(e)));let t=p.get("fav_emoticons");a.afterBegin(e,'<div class="emoticon_popup_content es_emoticons_content">\n                    <div class="commentthread_entry_quotebox" id="es_fav_remove"></div>\n                    <div class="commentthread_entry_quotebox" id="es_fav_emoticons"></div>\n                </div>');const s=e.querySelector("#es_fav_emoticons"),r=e.querySelector("#es_fav_remove");this._updateFavs(t,e,s),s.addEventListener("dragover",(e=>{e.preventDefault(),s.style.backgroundColor="black"})),s.addEventListener("dragenter",(()=>{s.style.backgroundColor="black"})),s.addEventListener("dragleave",(e=>{s.contains(e.relatedTarget)||(s.style.backgroundColor=null)})),s.addEventListener("drop",(r=>{r.preventDefault(),s.style.backgroundColor=null;const n=r.dataTransfer.getData("emoticon");t.includes(n)||(t.push(n),this._updateFavs(t,e,s,n))})),r.addEventListener("dragover",(e=>{e.preventDefault(),r.style.backgroundColor="black"})),r.addEventListener("dragenter",(()=>{r.style.backgroundColor="black"})),r.addEventListener("dragleave",(()=>{r.style.backgroundColor=null})),r.addEventListener("drop",(n=>{n.preventDefault(),r.style.backgroundColor=null;const a=n.dataTransfer.getData("emoticon");t=t.filter((e=>e!==a)),this._updateFavs(t,e,s,a)}))})).observe(document.body,{childList:!0})}}class W extends P{checkPrerequisites(){return p.get("hidetmsymbols")}apply(){let e="title, .apphub_AppName, .breadcrumbs, h1, h4";function t(e){e&&e.innerHTML&&a.inner(e,e.innerHTML.replace(/[\u00AE\u00A9\u2122]/g,""))}this.context.type===L.STORE_DEFAULT?e+=".game_area_already_owned, .details_block, .game_description_snippet, .game_area_description p, .glance_details, .game_area_dlc_bubble game_area_bubble, .package_contents, .game_area_dlc_name, .tab_desc, .tab_item_name":e+=".game_suggestion, .appHubShortcut_Title, .apphub_CardContentNewsTitle, .apphub_CardTextContent, .apphub_CardContentAppName, .apphub_AppName";for(const s of document.querySelectorAll(e))t(s);const s=new MutationObserver((e=>{e.forEach((e=>{e.addedNodes.forEach((e=>{t(e)}))}))})),r=document.querySelectorAll("#game_select_suggestions,#search_suggestion_contents,.tab_content_ctn");for(const e of r)s.observe(e,{childList:!0,subtree:!0})}}class G extends class{constructor(e,t){this._callbacks=[],this.type=e,this.features=t.map((e=>new e(this)))}applyFeatures(){return class{static async apply(e){for(this._promisesMap=new Map,this._stats={completed:0,failed:0,dependency:0};e.length>0;){const t=e.pop(),s=this._generateFeatureChain(t);null===s?e.unshift(t):this._promisesMap.set(t.constructor,s)}await Promise.allSettled(Array.from(this._promisesMap.values())),console.log("Feature loading complete, %i successfully loaded, %i failed to load, %i didn't load due to dependency errors",this._stats.completed,this._stats.failed,this._stats.dependency)}static _generateFeatureChain(e){let t=!0,s=Promise.resolve(!0);if(Array.isArray(e.constructor.dependencies)){for(const s of e.constructor.dependencies)if(!this._promisesMap.has(s)){t=!1;break}t&&(s=Promise.all(Array.from(this._promisesMap.entries()).filter((([t])=>e.constructor.dependencies.includes(t))).map((([,e])=>e))))}return t?s.then((t=>{let s=!0;return e.constructor.weakDependency||(s=Array.isArray(t)?t.every((e=>e)):t),s&&e.checkPrerequisites()})).then((async t=>(t&&(await e.apply(),++this._stats.completed),t))).catch((t=>{const s=e.constructor.name;if(t instanceof n.FeatureDependencyError)throw console.warn("Not applying feature %s due to an error in the dependency chain (namely %s)",s,t.featureName),++this._stats.dependency,t;throw console.group(s),console.error("Error while applying feature %s",s),console.error(t),console.groupEnd(),++this._stats.failed,new n.FeatureDependencyError("Failed to apply",s)})):null}}.apply(this.features)}registerCallback(e){this._callbacks.push(e)}triggerCallbacks(...e){for(const t of this._callbacks)t(...e)}}{constructor(e=L.COMMUNITY_DEFAULT,t=[]){t.push(W),super(e,t)}}class J extends A{async callback({view:e,contextId:t,globalId:s}){if(1!==t||753!==s)return;const r=document.getElementById(`iteminfo${e}_item_actions`),n=r.querySelector("a");if(!n||!n.href.startsWith("https://store.steampowered.com/app/"))return;const o=v.getAppid(n.href);if(!o)return;const i=await I.action("appdetails",o,"price_overview");if(!i||!i.success)return;const c=i.data.price_overview;if(!c)return;const l=c.discount_percent,d=new j(c.final/100,c.currency);if(r.style.display="flex",r.style.alignItems="center",r.style.justifyContent="space-between",l>0){const e=new j(c.initial/100,c.currency);a.beforeEnd(r,`<div class="es_game_purchase_action">\n                    <div class="es_game_purchase_action_bg">\n                        <div class="es_game_purchase_discount">\n                            <div class="es_discount_pct">-${l}%</div>\n                            <div class="es_discount_original_price">${e}</div>\n                            <div class="es_discount_final_price">${d}</div>\n                        </div>\n                    </div>\n                </div>`)}else a.beforeEnd(r,`<div class="es_game_purchase_action">\n                    <div class="es_game_purchase_action_bg">\n                        <div class="es_game_purchase_price">${d}</div>\n                    </div>\n                </div>`)}}class V extends A{checkPrerequisites(){return this.context.myInventory}async callback({view:e,assetId:t,contextId:s,globalId:r}){const n=document.getElementById(`${r}_${s}_${t}`),o=document.getElementById(`iteminfo${e}_item_actions`);if(o.querySelector(".es_set_background"))return;const i=o.querySelector("a"),c=i&&i.href.match(/images\/(items\/\d+\/[a-z0-9.]+)/i),l=c&&c[1];if(!l)return;if(!this.profileBgsOwned){this.userToken=await $.getUserToken();try{const[e,t]=await Promise.all([C.getJson(`https://api.steampowered.com/IPlayerService/GetProfileItemsEquipped/v1?access_token=${this.userToken}&steamid=${$.steamId}`,{credentials:"omit"}),C.getJson(`https://api.steampowered.com/IPlayerService/GetProfileItemsOwned/v1?access_token=${this.userToken}`,{credentials:"omit"})]);this.profileBgItemId=e.response.profile_background.communityitemid,this.profileBgsOwned=t.response.profile_backgrounds}catch(e){return void console.error(e)}}if(!n.dataset.communityitemid){const e=this.profileBgsOwned.find((e=>e.image_large===l));if(!e)return void console.error("Failed to find communityitemid for selected background");n.dataset.communityitemid=e.communityitemid}const d=n.dataset.communityitemid===this.profileBgItemId?"btn_disabled":"";a.afterEnd(i,`<a class="es_set_background btn_small btn_darkblue_white_innerfade ${d}">\n                <span>${h.str.set_as_background}</span>\n            </a>`),o.querySelector(".es_set_background").addEventListener("click",(async e=>{e.preventDefault();const t=e.target.closest(".es_set_background");if(t.classList.contains("es_background_loading")||t.classList.contains("btn_disabled"))return;t.classList.add("es_background_loading");const s=new FormData;s.append("communityitemid",n.dataset.communityitemid);try{await C.post(`https://api.steampowered.com/IPlayerService/SetProfileBackground/v1?access_token=${this.userToken}`,s,{credentials:"omit"}),t.classList.add("btn_disabled"),this.profileBgItemId=n.dataset.communityitemid}catch(e){console.error("Failed to set selected background",e)}finally{t.classList.remove("es_background_loading")}}))}}class Y extends A{checkPrerequisites(){return this.context.myInventory}callback({view:e,appid:t,isBooster:s}){s&&a.beforeEnd(`#iteminfo${e}_item_owner_actions`,`<a class="btn_small btn_grey_white_innerfade" href="//steamcommunity.com/my/gamecards/${t}/">\n                <span>${h.str.view_badge_progress}</span>\n            </a>`)}}class K extends A{checkPrerequisites(){return this.context.myInventory&&p.get("show1clickgoo")}callback({view:e,sessionId:t,assetId:s,appid:r}){if(!r)return;const n=document.getElementById(`iteminfo${e}_item_scrap_link`),a=n.cloneNode(!0);n.replaceWith(a),a.querySelector("span").textContent=h.str.oneclickgoo,a.addEventListener("click",(e=>{e.preventDefault(),z.runInPageContext(((e,t,s)=>{const r=window.SteamFacade,n={sessionid:e,appid:s,assetid:t,contextid:6},a=r.global("g_strProfileURL");r.jqGet(`${a}/ajaxgetgoovalue/`,n).done((e=>{n.goo_value_expected=e.goo_value,r.jqPost(`${a}/ajaxgrindintogoo/`,n).done((()=>{r.reloadCommunityInventory()}))}))}),[t,s,r])}))}}class Z extends A{checkPrerequisites(){return this.context.myInventory&&p.get("quickinv")}async callback({view:e,sessionId:t,assetId:s,contextId:r,globalId:n,walletCurrency:o,marketable:i,hashName:c,publisherFee:l}){if(!i)return;const d=document.getElementById(`${n}_${r}_${s}`),u=document.getElementById(`iteminfo${e}_item_market_actions`),m=p.get("quickinv_diff");if(a.beforeEnd(u,this._makeMarketButton(`es_quicksell${e}`,h.str.quick_sell_desc.replace("__modifier__",m))+this._makeMarketButton(`es_instantsell${e}`,h.str.instant_sell_desc)),z.runInPageContext((e=>{window.SteamFacade.vTooltip(`#es_quicksell${e}, #es_instantsell${e}`)}),[e]),!d.dataset.priceLow){if(d.classList.contains("es_prices_loading"))return;d.classList.add("es_prices_loading"),d.dataset.priceLow="nodata",d.dataset.priceHigh="nodata";const e=(await C.getHttp(`https://steamcommunity.com/market/listings/${n}/${encodeURIComponent(c)}`)).match(/Market_LoadOrderSpread\( (\d+) \)/);if(e){const t=await C.getJson(`https://steamcommunity.com/market/itemordershistogram?language=english&currency=${o}&item_nameid=${e[1]}`);if(t&&t.success&&(t.highest_buy_order&&(d.dataset.priceLow=t.highest_buy_order),t.lowest_sell_order)){let e=parseFloat(t.lowest_sell_order/100)+parseFloat(m);e<.03&&(e=.03),d.dataset.priceHigh=100*e.toFixed(2)}}d.classList.remove("es_prices_loading")}if(!d.classList.contains("activeInfo"))return;const _=document.getElementById(`es_quicksell${e}`),g=document.getElementById(`es_instantsell${e}`),f=Number(d.dataset.priceHigh)||0,y=Number(d.dataset.priceLow)||0,w=R.currencyNumberToType(o);if(f&&f>y){const e=await z.runInPageContext(((e,t)=>window.SteamFacade.vCurrencyFormat(e,t)),[f,w],!0);_.querySelector(".item_market_action_button_contents").textContent=h.str.quick_sell.replace("__amount__",e),_.dataset.price=f,_.style.display="block"}if(y){const e=await z.runInPageContext(((e,t)=>window.SteamFacade.vCurrencyFormat(e,t)),[y,w],!0);g.querySelector(".item_market_action_button_contents").textContent=h.str.instant_sell.replace("__amount__",e),g.dataset.price=y,g.style.display="block"}async function v(o){o.preventDefault();const i=o.target.closest(".item_market_action_button[data-price]");if(!i)return;for(const e of[_,g])e.classList.add("btn_disabled"),e.style.pointerEvents="none";a.inner(u.querySelector("div"),`<div class="es_loading" style="min-height: 66px;">\n                    <img src="//steamcommunity-a.akamaihd.net/public/images/login/throbber.gif">\n                    <span>${h.str.selling}</span>\n                </div>`);const c=await z.runInPageContext(((e,t)=>window.SteamFacade.calculateFeeAmount(e,t)),[i.dataset.price,l],!0),m=c.amount-c.fees,p=new FormData;p.append("sessionid",t),p.append("appid",n),p.append("contextid",r),p.append("assetid",s),p.append("amount",1),p.append("price",m),await C.post("https://steamcommunity.com/market/sellitem/",p),u.style.display="none",document.getElementById(`iteminfo${e}_item_scrap_actions`).style.display="none",d.classList.add("btn_disabled","activeInfo"),d.style.pointerEvents="none"}_.addEventListener("click",v),g.addEventListener("click",v)}_makeMarketButton(e,t){return`<a class="item_market_action_button item_market_action_button_green" id="${e}" data-tooltip-text="${t}" style="display: none;">\n                    <span class="item_market_action_button_edge item_market_action_button_left"></span>\n                    <span class="item_market_action_button_contents"></span>\n                    <span class="item_market_action_button_edge item_market_action_button_right"></span>\n                    <span class="item_market_action_button_preload"></span>\n                </a>`}}class Q extends A{async callback({view:e,assetId:t,contextId:s,globalId:r,walletCurrency:n,marketable:o,hashName:i,restriction:c,appid:l,isBooster:d}){if((!this.context.myInventory||!c||o)&&!o)return;const u=document.getElementById(`${r}_${s}_${t}`),m=document.getElementById(`iteminfo${e}_item_market_actions`);if(d&&!u.dataset.cardsPrice){if(u.classList.contains("es_avgprice_loading"))return;u.classList.add("es_avgprice_loading"),u.dataset.cardsPrice="nodata";try{const e=R.currencyNumberToType(n),t=await I.action("market.averagecardprices",{currency:e,appids:l,foilappids:l}),s=100*(t[l].foil.average*Q._foilChance+t[l].regular.average*(1-Q._foilChance)).toFixed(2);u.dataset.cardsPrice=await z.runInPageContext(((e,t)=>window.SteamFacade.vCurrencyFormat(e,t)),[s,e],!0)}catch(e){console.error("Failed to retrieve average card prices for appid",l,e)}finally{u.classList.remove("es_avgprice_loading")}}let _=m.querySelector(":scope > div");if(_){if(u.dataset.cardsPrice&&"nodata"!==u.dataset.cardsPrice){const e=_.querySelector("div:nth-child(2)");e.firstChild.nodeType===Node.TEXT_NODE?e.append(h.str.avg_price_3cards.replace("__price__",u.dataset.cardsPrice)):z.runInPageContext((e=>new Promise((t=>{window.Ajax.Responders.register({onComplete:function s(r){r.url.startsWith("https://steamcommunity.com/market/priceoverview/")&&r.parameters.market_hash_name===e&&(t(),window.Ajax.Responders.unregister(s))}})}))),[i],!0).then((()=>{_.querySelector("div:nth-child(2)").append(h.str.avg_price_3cards.replace("__price__",u.dataset.cardsPrice))}))}return}_=document.createElement("div"),m.insertAdjacentElement("afterbegin",_),m.style.display="block";const g=encodeURIComponent(i);let p=`<div style="height:24px;">\n                        <a href="//steamcommunity.com/market/listings/${r}/${g}">${h.str.view_in_market}</a>\n                    </div>`;if(!u.dataset.lowestPrice){if(null!==_.querySelector("img.es_loading"))return;a.inner(_,'<img class="es_loading" src="//steamcommunity-a.akamaihd.net/public/images/login/throbber.gif">'),u.dataset.lowestPrice="nodata",u.dataset.soldVolume="nodata";try{const e=await C.getJson(`https://steamcommunity.com/market/priceoverview/?currency=${n}&appid=${r}&market_hash_name=${g}`);e&&e.success&&(u.dataset.lowestPrice=e.lowest_price||"nodata",u.dataset.soldVolume=e.volume||"nodata")}catch(e){return console.error("Couldn't load price overview from market",e),void a.inner(_,p)}}p+=this._getMarketOverviewHtml(u),p+='<div class="market_item_action_buyback_at_price"></div>',a.inner(_,p)}_getMarketOverviewHtml(e){let t='<div style="min-height:3em;margin-left:1em;">';return e.dataset.lowestPrice&&"nodata"!==e.dataset.lowestPrice?(t+=h.str.starting_at.replace("__price__",e.dataset.lowestPrice),e.dataset.soldVolume&&"nodata"!==e.dataset.soldVolume&&(t+="<br>",t+=h.str.volume_sold_last_24.replace("__sold__",e.dataset.soldVolume)),e.dataset.cardsPrice&&"nodata"!==e.dataset.cardsPrice&&(t+="<br>",t+=h.str.avg_price_3cards.replace("__price__",e.dataset.cardsPrice))):t+=h.str.no_price_data,t+="</div>",t}}Q._foilChance=.01;class X extends P{checkPrerequisites(){return p.get("showinvnav")}apply(){this._insertScript(),a.afterEnd("#pagebtn_previous",'<a id="pagebtn_first" class="pagebtn pagecontrol_element disabled">&lt;&lt;</a>'),document.getElementById("pagebtn_first").addEventListener("click",(()=>{z.runInPageContext((()=>{window.SteamFacade.firstPage()}))})),a.beforeBegin("#pagebtn_next",'<a id="pagebtn_last" class="pagebtn pagecontrol_element">&gt;&gt;</a>'),document.getElementById("pagebtn_last").addEventListener("click",(()=>{z.runInPageContext((()=>{window.SteamFacade.lastPage()}))}));const e=document.getElementById("pagecontrol_max");a.beforeBegin("#inventory_pagecontrols",`<div id="es_pagego">\n                <input type="number" id="es_pagenumber" class="filter_search_box" value="1" min="1" max="${e.textContent}">\n                <a id="es_gotopage_btn" class="pagebtn">${h.str.go}</a>\n            </div>`),document.getElementById("es_gotopage_btn").addEventListener("click",(()=>{z.runInPageContext((()=>{window.SteamFacade.goToPage()}))})),new MutationObserver((()=>{document.getElementById("es_pagenumber").max=e.textContent})).observe(e,{subtree:!0,childList:!0}),new MutationObserver((e=>{for(const{target:t}of e){const e=t.id;"inventory_pagecontrols"===e&&(document.getElementById("es_pagego").style.visibility=t.style.visibility),"pagebtn_next"===e?document.getElementById("pagebtn_last").classList.toggle("disabled",t.classList.contains("disabled")):"pagebtn_previous"===e&&document.getElementById("pagebtn_first").classList.toggle("disabled",t.classList.contains("disabled"))}})).observe(document.getElementById("inventory_pagecontrols"),{subtree:!0,attributes:!0})}_insertScript(){T.insertScript({content:'function ensureFn() {\n                if (typeof g_ActiveInventory.GoToPage === "function") { return; }\n                g_ActiveInventory.GoToPage = function(page) {\n                    const nPageWidth = this.m_$Inventory.children(".inventory_page:first").width();\n                    const iCurPage = this.m_iCurrentPage;\n                    const iNextPage = Math.min(Math.max(0, --page), this.m_cPages - 1);\n                    const iPages = this.m_cPages;\n                    if (iCurPage < iNextPage) {\n                        if (iCurPage < iPages - 1) {\n                            this.PrepPageTransition(nPageWidth, iCurPage, iNextPage);\n                            this.m_$Inventory.css("left", "0");\n                            this.m_$Inventory.animate({"left": -nPageWidth}, 250, null, () => this.FinishPageTransition(iCurPage, iNextPage));\n                        }\n                    } else if (iCurPage > iNextPage) {\n                        if (iCurPage > 0) {\n                            this.PrepPageTransition(nPageWidth, iCurPage, iNextPage);\n                            this.m_$Inventory.css("left", "-" + nPageWidth + "px");\n                            this.m_$Inventory.animate({"left": 0}, 250, null, () => this.FinishPageTransition(iCurPage, iNextPage));\n                        }\n                    }\n                };\n            }\n\n            function InventoryLastPage() {\n                ensureFn();\n                g_ActiveInventory.GoToPage(g_ActiveInventory.m_cPages);\n            }\n            function InventoryFirstPage() {\n                ensureFn();\n                g_ActiveInventory.GoToPage(1);\n            }\n            function InventoryGoToPage() {\n                ensureFn();\n                const page = $("es_pagenumber").value;\n                if (isNaN(page)) { return; }\n                g_ActiveInventory.GoToPage(parseInt(page));\n            }'})}}class ee extends P{checkPrerequisites(){return null!==document.getElementById("pricehistory")}apply(){const e=document.createElement("a");e.classList.add("zoomopt"),e.textContent=h.str.year,document.querySelectorAll(".zoomopt")[2].insertAdjacentElement("beforebegin",e),e.addEventListener("click",(()=>{this.context.type===L.MARKET_LISTING?z.runInPageContext((()=>{window.SteamFacade.zoomYear()})):this.context.type===L.INVENTORY&&z.runInPageContext((()=>{window.SteamFacade.zoomYearForSellDialog()}))}))}}const te=new class extends z{_pageSpecificFeatures(){super._pageSpecificFeatures(),U.hideSpamComments(),U.addFavoriteEmoticons()}};/^\/(?:id|profiles)\/[^/]+\/inventory\/?$/.test(window.location.pathname)?te.run(class extends G{constructor(){document.getElementById("no_inventories")?super(L.INVENTORY):(super(L.INVENTORY,[J,V,Y,K,Z,Q,X,ee]),this.myInventory=class{static currentUserIsOwner(){if(!$.isSignedIn)return!1;let e=document.querySelector(".profile_small_header_texture > a, .friends_header_avatar > a").href;return e.endsWith("/")||(e+="/"),e===$.profileUrl}static makeProfileLink(e,t,s,r,n){let a=`<div class="es_profile_link profile_count_link">\n                    <a class="es_sites_icons es_${e}_icon es_${n?"none":r}" href="${t}" target="_blank">`;return"none"!==r&&n&&(a+=`<i class="es_sites_custom_icon es_${r}" style="background-image: url('${n}');"></i>`),a+=`<span class="count_link_label">${s}</span>\n                 <span class="profile_count_link_total">&nbsp;</span></a></div>`,a}}.currentUserIsOwner(),z.runInPageContext((()=>{document.addEventListener("click",(({target:e})=>{if(!e.matches("a.inventory_item_link, a.newitem"))return;const t=window.SteamFacade.getMarketHashName(g_ActiveInventory.selectedItem.description),s=!!Array.isArray(g_ActiveInventory.selectedItem.description.owner_descriptions)&&g_ActiveInventory.selectedItem.description.owner_descriptions.some((e=>/\[date\]\d+\[\/date\]/.test(e.value))),r=void 0!==g_ActiveInventory.selectedItem.description.market_fee&&null!==g_ActiveInventory.selectedItem.description.market_fee?g_ActiveInventory.selectedItem.description.market_fee:g_rgWalletInfo.wallet_publisher_fee_percent_default,n=Number(g_ActiveInventory.selectedItem.contextid),a=Number(g_ActiveInventory.appid);let o=null,i=!1;6===n&&753===a&&(o=parseInt(t),i=/Booster Pack/i.test(t)),window.Messenger.postMessage("marketInfo",{view:iActiveSelectView,sessionId:g_sessionID,assetId:g_ActiveInventory.selectedItem.assetid,contextId:n,globalId:a,walletCurrency:g_rgWalletInfo.wallet_currency,marketable:g_ActiveInventory.selectedItem.description.marketable,hashName:t,publisherFee:r,restriction:s,appid:o,isBooster:i})}))})),B.addMessageListener("marketInfo",(e=>{this.triggerCallbacks(e)})))}}):te.run(G)})();
//# sourceMappingURL=inventory.js.map