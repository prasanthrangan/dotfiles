{"version":3,"file":"js/store/app.js","mappings":"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","sources":["webpack:///./src/js/Core/Errors/Errors.js","webpack:///./src/js/Core/Html/Html.js","webpack:///./src/js/Core/Html/HtmlParser.js","webpack:///./src/js/Core/Storage/CookieStorage.js","webpack:///./src/js/Core/Environment.js","webpack:///./src/js/Core/Localization/Language.js","webpack:///./src/js/Core/BackgroundSimple.js","webpack:///./src/js/Core/ExtensionResources.js","webpack:///./src/js/Core/Storage/Storage.js","webpack:///./src/js/Core/Info.js","webpack:///./src/js/Core/Storage/SyncedStorage.js","webpack:///./src/js/Core/Localization/Localization.js","webpack:///./src/js/Core/Storage/LocalStorage.js","webpack:///./src/js/Core/Utils/TimeUtils.js","webpack:///./src/js/Core/GameId.js","webpack:///./src/js/Core/Permissions.js","webpack:///./src/js/Core/Version.js","webpack:///./src/js/Content/Modules/Widgets/ProgressBar.js","webpack:///./src/js/Content/Modules/Background.js","webpack:///./src/js/Core/Errors/ErrorParser.js","webpack:///./src/js/Content/Modules/RequestData.js","webpack:///./src/js/Content/Modules/User.js","webpack:///./src/js/Content/Modules/Feature/FeatureManager.js","webpack:///./src/js/Content/Modules/Context/ContextType.js","webpack:///./src/js/Content/Modules/Data/DynamicStore.js","webpack:///./src/js/Content/Modules/Data/Inventory.js","webpack:///./src/js/Content/Modules/Feature/Feature.js","webpack:///./src/js/Content/Modules/Widgets/SortBox.js","webpack:///./src/js/Content/Modules/DOMHelper.js","webpack:///./src/js/Content/Modules/Widgets/HorizontalScroller.js","webpack:///./src/js/config.js","webpack:///./src/js/Content/Modules/AugmentedSteam.js","webpack:///./src/js/Core/Utils/StringUtils.js","webpack:///./src/js/Content/Modules/CurrencyManager.js","webpack:///./src/js/Content/Modules/ITAD.js","webpack:///./src/js/Content/Modules/Messenger.js","webpack:///./src/js/Content/Modules/Price.js","webpack:///./src/js/Content/Modules/Prices.js","webpack:///./src/js/setup.js","webpack:///./src/js/Content/Features/Page.js","webpack:///./src/js/Content/Modules/SteamFacade.js","webpack:///./src/js/Content/Modules/UpdateHandler.js","webpack:///./src/js/Content/Features/Common/FMediaExpander.js","webpack:///./src/js/Content/Features/Store/Common/FITADPrices.js","webpack:///./src/js/Content/Features/Store/Common/FDRMWarnings.js","webpack:///./src/js/Content/Features/Store/Common/FExtraLinks.js","webpack:///./src/js/Core/Storage/UserNotesAdapter.js","webpack:///./src/js/Content/Features/Store/Common/UserNotes.js","webpack:///./src/js/Content/Features/Common/FHighlightsTags.js","webpack:///./src/js/Content/Features/Common/FEarlyAccess.js","webpack:///./src/js/Content/Features/Common/FHideTrademarks.js","webpack:///./src/js/Content/Features/Store/Common/FAlternativeLinuxIcon.js","webpack:///./src/js/Content/Features/Store/App/FReplaceDevPubLinks.js","webpack:///./src/js/Content/Features/Store/App/FRemoveFromWishlist.js","webpack:///./src/js/Content/Features/Store/App/FForceMP4.js","webpack:///./src/js/Content/Features/Store/App/FHDPlayer.js","webpack:///./src/js/Content/Features/Store/App/FUserNotes.js","webpack:///./src/js/Content/Features/Store/App/FWaitlistDropdown.js","webpack:///./src/js/Content/Features/Store/App/FNewQueue.js","webpack:///./src/js/Content/Features/Store/App/FFullscreenScreenshotView.js","webpack:///./src/js/Content/Features/Store/App/FShowCoupon.js","webpack:///./src/js/Content/Features/Store/App/FDLCInfo.js","webpack:///./src/js/Content/Features/Store/App/FMetacriticUserScore.js","webpack:///./src/js/Content/Features/Store/App/FOpenCritic.js","webpack:///./src/js/Content/Features/Store/App/FOwnedElsewhere.js","webpack:///./src/js/Content/Features/Store/App/FPurchaseDate.js","webpack:///./src/js/Content/Features/Store/App/FSteamPeek.js","webpack:///./src/js/Content/Features/Store/App/FWidescreenCertification.js","webpack:///./src/js/Content/Features/Store/App/FHowLongToBeat.js","webpack:///./src/js/Content/Features/Store/App/FFamilySharingNotice.js","webpack:///./src/js/Content/Features/Store/App/FPackBreakdown.js","webpack:///./src/js/Content/Features/Store/App/FPackageInfoButton.js","webpack:///./src/js/Content/Features/Store/App/FSteamChart.js","webpack:///./src/js/Content/Features/Store/App/FSteamSpy.js","webpack:///./src/js/Content/Features/Store/App/FSurveyData.js","webpack:///./src/js/Content/Features/Store/Common/FCustomizer.js","webpack:///./src/js/Content/Features/Store/App/FDLCCheckboxes.js","webpack:///./src/js/Content/Features/Store/App/FBadgeProgress.js","webpack:///./src/js/Content/Features/Store/App/FAStatsLink.js","webpack:///./src/js/Content/Features/Store/App/FAchievementBar.js","webpack:///./src/js/Content/Modules/Stats.js","webpack:///./src/js/Content/Features/Store/Common/FRegionalPricing.js","webpack:///./src/js/Content/Features/Store/App/FReviewToggleButton.js","webpack:///./src/js/Content/Features/Store/App/FOwnedActionsButtons.js","webpack:///./src/js/Content/Features/Store/App/FSupportInfo.js","webpack:///./src/js/Content/Features/Store/App/FRemoveBroadcasts.js","webpack:///./src/js/Content/Features/Store/App/FDemoAbovePurchase.js","webpack:///./src/js/Content/Features/Store/App/FSaveReviewFilters.js","webpack:///./src/js/Content/Features/Store/App/PApp.js","webpack:///./src/js/Content/Features/StorePage.js","webpack:///./src/js/Content/Features/Store/App/CApp.js","webpack:///./src/js/Content/Features/Store/Common/CStore.js","webpack:///./src/js/Content/Features/Store/Common/CStoreBase.js","webpack:///./src/js/Content/Modules/Context/Context.js"],"sourcesContent":["\r\nclass LoginError extends Error {\r\n    constructor(type) {\r\n        super(type);\r\n        this.name = \"LoginError\";\r\n    }\r\n}\r\n\r\nclass ServerOutageError extends Error {\r\n    constructor(msg) {\r\n        super(msg);\r\n        this.name = \"ServerOutageError\";\r\n    }\r\n}\r\n\r\nclass HTTPError extends Error {\r\n    constructor(code, message) {\r\n        super(message);\r\n        this.code = code;\r\n    }\r\n}\r\n\r\n\r\nclass FeatureDependencyError extends Error {\r\n    constructor(msg, featureName) {\r\n        super(msg);\r\n        this.featureName = featureName;\r\n    }\r\n}\r\n\r\nconst Errors = {\r\n    \"LoginError\": LoginError,\r\n    \"ServerOutageError\": ServerOutageError,\r\n    \"HTTPError\": HTTPError,\r\n    \"FeatureDependencyError\": FeatureDependencyError\r\n};\r\n\r\nexport {Errors};\r\n","// TODO Accept NodeLists to insert HTML for every node in the list\r\nclass HTML {\r\n\r\n    static escape(str) {\r\n\r\n        // @see https://stackoverflow.com/a/4835406\r\n        const map = {\r\n            \"&\": \"&amp;\",\r\n            \"<\": \"&lt;\",\r\n            \">\": \"&gt;\",\r\n            '\"': \"&quot;\",\r\n            \"'\": \"&#039;\"\r\n        };\r\n\r\n        return str.replace(/[&<>\"']/g, (m) => { return map[m]; });\r\n    }\r\n\r\n    static fragment(html) {\r\n        const template = document.createElement(\"template\");\r\n        template.innerHTML = DOMPurify.sanitize(html);\r\n        return template.content;\r\n    }\r\n\r\n    static element(html) {\r\n        return HTML.fragment(html).firstElementChild;\r\n    }\r\n\r\n    static _getNode(node) {\r\n        let _node = node;\r\n\r\n        if (typeof _node == \"undefined\" || _node === null) {\r\n            console.warn(`${_node} is not an Element.`);\r\n            return null;\r\n        }\r\n        if (typeof _node == \"string\") {\r\n            _node = document.querySelector(_node);\r\n        }\r\n        if (!(_node instanceof Element)) {\r\n            console.warn(`${_node} is not an Element.`);\r\n            return null;\r\n        }\r\n\r\n        return _node;\r\n    }\r\n\r\n    static inner(node, html) {\r\n        const _node = HTML._getNode(node);\r\n\r\n        if (_node) {\r\n            _node.innerHTML = DOMPurify.sanitize(html);\r\n        }\r\n        return _node;\r\n    }\r\n\r\n    static replace(node, html) {\r\n        const _node = HTML._getNode(node);\r\n\r\n        if (_node) {\r\n            _node.outerHTML = DOMPurify.sanitize(html);\r\n        }\r\n        return _node;\r\n    }\r\n\r\n    static wrap(wrapper, startEl, endEl = startEl) {\r\n        const _startEl = HTML._getNode(startEl);\r\n\r\n        if (!_startEl) { return null; }\r\n\r\n        const _endEl = endEl === null ? _startEl.parentElement.lastElementChild : HTML._getNode(endEl);\r\n\r\n        const wrappedNodes = [_startEl];\r\n        for (let cur = _startEl; cur.nextElementSibling !== null && cur !== _endEl; cur = cur.nextElementSibling) {\r\n            wrappedNodes.push(cur.nextElementSibling);\r\n        }\r\n\r\n        const _wrapper = HTML.element(wrapper);\r\n        _startEl.replaceWith(_wrapper);\r\n        _wrapper.append(...wrappedNodes);\r\n        return _wrapper;\r\n    }\r\n\r\n    static adjacent(node, position, html) {\r\n        const _node = HTML._getNode(node);\r\n\r\n        if (_node) {\r\n            _node.insertAdjacentHTML(position, DOMPurify.sanitize(html));\r\n        }\r\n        return _node;\r\n    }\r\n\r\n    static beforeBegin(node, html) {\r\n        HTML.adjacent(node, \"beforebegin\", html);\r\n    }\r\n\r\n    static afterBegin(node, html) {\r\n        HTML.adjacent(node, \"afterbegin\", html);\r\n    }\r\n\r\n    static beforeEnd(node, html) {\r\n        HTML.adjacent(node, \"beforeend\", html);\r\n    }\r\n\r\n    static afterEnd(node, html) {\r\n        HTML.adjacent(node, \"afterend\", html);\r\n    }\r\n}\r\n\r\nexport {HTML};\r\n","import {HTML} from \"./Html\";\r\n\r\nclass HTMLParser {\r\n\r\n    static clearSpecialSymbols(string) {\r\n        return string.replace(/[\\u00AE\\u00A9\\u2122]/g, \"\");\r\n    }\r\n\r\n    static htmlToDOM(html) {\r\n        return HTML.fragment(html);\r\n    }\r\n\r\n    static htmlToElement(html) {\r\n        return HTML.element(html);\r\n    }\r\n\r\n    static getVariableFromText(text, name, type) {\r\n        let regex;\r\n        if (type === \"object\") {\r\n            regex = new RegExp(`${name}\\\\s*=\\\\s*(\\\\{.+?\\\\});`);\r\n        } else if (type === \"array\") {\r\n            regex = new RegExp(`${name}\\\\s*=\\\\s*(\\\\[.+?\\\\]);`);\r\n        } else if (type === \"int\") {\r\n            regex = new RegExp(`${name}\\\\s*=\\\\s*(.+?);`);\r\n        } else if (type === \"string\") {\r\n            regex = new RegExp(`${name}\\\\s*=\\\\s*(\\\\\".+?\\\\\");`);\r\n        } else {\r\n            return null;\r\n        }\r\n\r\n        const m = text.match(regex);\r\n        if (m) {\r\n            if (type === \"int\") {\r\n                return parseInt(m[1]);\r\n            }\r\n            return JSON.parse(m[1]);\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    static getVariableFromDom(name, type, dom = document) {\r\n        for (const node of dom.querySelectorAll(\"script\")) {\r\n            const value = HTMLParser.getVariableFromText(node.textContent, name, type);\r\n\r\n            if (value !== null) {\r\n                return value;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n}\r\n\r\nexport {HTMLParser};\r\n","\r\nclass CookieStorage {\r\n\r\n    static get(name, defaultValue) {\r\n        const _name = name.trim();\r\n\r\n        if (!CookieStorage.cache.has(_name)) {\r\n            return defaultValue;\r\n        }\r\n        return CookieStorage.cache.get(_name);\r\n    }\r\n\r\n    static set(name, val, ttl = 60 * 60 * 24 * 365) {\r\n        let _name = name.trim();\r\n        let _val = val.trim();\r\n\r\n        CookieStorage.cache.set(_name, _val);\r\n\r\n        _name = encodeURIComponent(_name);\r\n        _val = encodeURIComponent(_val);\r\n        document.cookie = `${_name}=${_val}; max-age=${ttl}`;\r\n    }\r\n\r\n    static remove(name) {\r\n        let _name = name.trim();\r\n        CookieStorage.cache.delete(_name);\r\n        _name = encodeURIComponent(_name);\r\n        document.cookie = `${_name}; expires=Thu, 01 Jan 1970 00:00:00 GMT`;\r\n    }\r\n\r\n    static init() {\r\n        CookieStorage.cache = new Map();\r\n        for (let [key, val] of document.cookie.split(\";\").map(kv => kv.split(\"=\"))) {\r\n            key = key.trim();\r\n            CookieStorage.cache.set(key, decodeURIComponent(val));\r\n        }\r\n    }\r\n}\r\n\r\nCookieStorage.init();\r\n\r\nexport {CookieStorage};\r\n","\r\nconst ContextType = Object.freeze({\r\n    \"BACKGROUND\": 1,\r\n    \"CONTENT_SCRIPT\": 2,\r\n    \"OPTIONS\": 3,\r\n});\r\n\r\nlet currentContext;\r\nif (browser.extension.getBackgroundPage) {\r\n    const bgPage = browser.extension.getBackgroundPage();\r\n\r\n    currentContext = (bgPage === window)\r\n        ? ContextType.BACKGROUND\r\n        : ContextType.OPTIONS;\r\n} else {\r\n    currentContext = ContextType.CONTENT_SCRIPT;\r\n}\r\n\r\nclass Environment {\r\n\r\n    static isBackgroundScript() {\r\n        return currentContext === ContextType.BACKGROUND;\r\n    }\r\n\r\n    static isContentScript() {\r\n        return currentContext === ContextType.CONTENT_SCRIPT;\r\n    }\r\n\r\n    static isOptions() {\r\n        return currentContext === ContextType.OPTIONS;\r\n    }\r\n}\r\n\r\nexport {Environment};\r\n","import {CookieStorage} from \"../Storage/CookieStorage\";\r\nimport {Environment} from \"../Environment\";\r\n\r\nclass Language {\r\n\r\n    static getCurrentSteamLanguage() {\r\n        if (this._currentSteamLanguage !== null) {\r\n            return this._currentSteamLanguage;\r\n        }\r\n\r\n        for (const script of document.querySelectorAll(\"script[src]\")) {\r\n            const language = new URL(script.src).searchParams.get(\"l\");\r\n            if (language) {\r\n                Language._currentSteamLanguage = language;\r\n                return this._currentSteamLanguage;\r\n            }\r\n        }\r\n\r\n        // In a Content Context, we can check for a cookie\r\n        if (Environment.isContentScript()) {\r\n            Language._currentSteamLanguage = CookieStorage.get(\"Steam_Language\") || null;\r\n        }\r\n\r\n        return this._currentSteamLanguage;\r\n    }\r\n\r\n    static getLanguageCode(language) {\r\n        const code = Language.languages[language];\r\n        return code || \"en\";\r\n    }\r\n\r\n    static isCurrentLanguageOneOf(array) {\r\n        return array.includes(Language.getCurrentSteamLanguage());\r\n    }\r\n}\r\n\r\nLanguage._currentSteamLanguage = null;\r\nLanguage.languages = {\r\n    \"english\": \"en\",\r\n    \"bulgarian\": \"bg\",\r\n    \"czech\": \"cs\",\r\n    \"danish\": \"da\",\r\n    \"dutch\": \"nl\",\r\n    \"finnish\": \"fi\",\r\n    \"french\": \"fr\",\r\n    \"greek\": \"el\",\r\n    \"german\": \"de\",\r\n    \"hungarian\": \"hu\",\r\n    \"italian\": \"it\",\r\n    \"japanese\": \"ja\",\r\n    \"koreana\": \"ko\",\r\n    \"norwegian\": \"no\",\r\n    \"polish\": \"pl\",\r\n    \"portuguese\": \"pt-PT\",\r\n    \"brazilian\": \"pt-BR\",\r\n    \"russian\": \"ru\",\r\n    \"romanian\": \"ro\",\r\n    \"schinese\": \"zh-CN\",\r\n    \"spanish\": \"es-ES\",\r\n    \"latam\": \"es-419\",\r\n    \"swedish\": \"sv-SE\",\r\n    \"tchinese\": \"zh-TW\",\r\n    \"thai\": \"th\",\r\n    \"turkish\": \"tr\",\r\n    \"ukrainian\": \"ua\",\r\n    \"vietnamese\": \"vi\",\r\n};\r\n\r\nexport {Language};\r\n","\r\nclass BackgroundSimple {\r\n    static message(message) {\r\n        return browser.runtime.sendMessage(message);\r\n    }\r\n\r\n    static action(requested, ...params) {\r\n        if (!params.length) { return this.message({\"action\": requested}); }\r\n        return this.message({\"action\": requested, \"params\": params});\r\n    }\r\n}\r\n\r\nexport {BackgroundSimple};\r\n","\r\nclass ExtensionResources {\r\n\r\n    static getURL(pathname) {\r\n        return browser.runtime.getURL(pathname);\r\n    }\r\n\r\n    static get(pathname) {\r\n        return fetch(ExtensionResources.getURL(pathname));\r\n    }\r\n\r\n    static getJSON(pathname) {\r\n        return ExtensionResources.get(pathname).then(r => r.json());\r\n    }\r\n\r\n    static getText(pathname) {\r\n        return ExtensionResources.get(pathname).then(r => r.text());\r\n    }\r\n}\r\n\r\nexport {ExtensionResources};\r\n","class Storage {\r\n\r\n    static has(key) {\r\n        return Object.prototype.hasOwnProperty.call(this.cache, key);\r\n    }\r\n\r\n    static get(key) {\r\n        if (typeof this.cache[key] !== \"undefined\" || typeof this.defaults === \"undefined\") {\r\n            return this.cache[key];\r\n        }\r\n        if (typeof this.defaults[key] === \"undefined\") {\r\n            console.warn('Unrecognized storage key \"%s\"', key);\r\n        }\r\n        return this.defaults[key];\r\n    }\r\n\r\n    static set(key, value) {\r\n        this.cache[key] = value;\r\n        return this._adapter.set({[key]: value});\r\n    }\r\n\r\n    static import(entries) {\r\n        for (const [key, value] of Object.entries(entries)) {\r\n            this.cache[key] = value;\r\n        }\r\n        return this._adapter.set(entries);\r\n    }\r\n\r\n    static remove(key) {\r\n        if (typeof this.cache[key] !== \"undefined\") {\r\n            delete this.cache[key];\r\n        }\r\n        return this._adapter.remove(key);\r\n    }\r\n\r\n    static keys(prefix = \"\") {\r\n        return Object.keys(this.cache).filter(k => k.startsWith(prefix));\r\n    }\r\n\r\n    static entries() {\r\n        return Object.entries(this.cache);\r\n    }\r\n\r\n    static async clear(force = false) {\r\n\r\n        let tmp;\r\n        if (!force) {\r\n            tmp = (this.persistent ?? []).reduce((acc, option) => {\r\n                acc[option] = this.cache[option];\r\n                return acc;\r\n            }, {});\r\n        }\r\n\r\n        await this._adapter.clear();\r\n        this.cache = {};\r\n\r\n        if (!force) {\r\n            await this.import(tmp);\r\n        }\r\n    }\r\n\r\n    // load whole storage and make local copy\r\n    static async init() {\r\n\r\n        const area = this._adapter === browser.storage.sync ? \"sync\" : \"local\";\r\n        const cache = Storage.caches[area];\r\n\r\n        if (typeof cache !== \"undefined\") {\r\n            this.cache = cache;\r\n            return this.cache;\r\n        }\r\n\r\n        Storage.caches[area] = {};\r\n        this.cache = Storage.caches[area];\r\n\r\n        browser.storage.onChanged.addListener((changes, eventArea) => {\r\n\r\n            if (area !== eventArea) { return; }\r\n\r\n            for (const [key, {\"newValue\": val}] of Object.entries(changes)) {\r\n                this.cache[key] = val;\r\n            }\r\n        });\r\n\r\n        return Object.assign(this.cache, await this._adapter.get(null));\r\n    }\r\n\r\n    static then(onDone, onCatch) {\r\n        const promise = this._initialized ? Promise.resolve(this.cache) : this.init();\r\n        this._initialized = true;\r\n        return promise.then(onDone, onCatch);\r\n    }\r\n\r\n    static toJson() {\r\n        return JSON.stringify(this.cache);\r\n    }\r\n}\r\n\r\nStorage.caches = {};\r\n\r\nexport {Storage};\r\n","\r\nconst Info = {\r\n    \"version\": browser.runtime.getManifest().version,\r\n    \"db_version\": 3,\r\n};\r\n\r\nexport {Info};\r\n","import {Storage} from \"./Storage\";\r\nimport {Info} from \"../Info\";\r\n\r\n/*\r\n * browser.storage.sync limits\r\n * QUOTA_BYTES = 102400 // 100KB\r\n * QUOTA_BYTES_PER_ITEM = 8192 // 8KB\r\n * MAX_ITEMS = 512\r\n * MAX_WRITE_OPERATIONS_PER_HOUR = 1800\r\n * MAX_WRITE_OPERATIONS_PER_MINUTE = 120\r\n */\r\nclass SyncedStorage extends Storage {}\r\n\r\nSyncedStorage._adapter = browser.storage.sync || browser.storage.local;\r\n\r\n/*\r\n * 8KiB is the limit for storage.sync https://chromium.googlesource.com/chromium/src/+/refs/heads/main/extensions/common/api/storage.json#227\r\n * 5MiB is the limit for storage.local (overall size) https://chromium.googlesource.com/chromium/src/+/refs/heads/main/extensions/common/api/storage.json#227\r\n * 2KiB are subtracted in order to save some space for other configuration options\r\n */\r\nSyncedStorage.QUOTA_BYTES_PER_ITEM = browser.storage.sync ? 8192 : 5242880 - 2048;\r\n\r\nSyncedStorage.defaults = Object.freeze({\r\n    \"language\": \"english\",\r\n\r\n    \"version\": Info.version,\r\n    \"version_show\": true,\r\n\r\n    \"highlight_owned_color\": \"#00ce67\",\r\n    \"highlight_wishlist_color\": \"#0491bf\",\r\n    \"highlight_coupon_color\": \"#a26426\",\r\n    \"highlight_inv_gift_color\": \"#800040\",\r\n    \"highlight_inv_guestpass_color\": \"#513c73\",\r\n    \"highlight_notinterested_color\": \"#4f4f4f\",\r\n    \"highlight_collection_color\": \"#856d0e\",\r\n    \"highlight_waitlist_color\": \"#4c7521\",\r\n\r\n    \"tag_owned_color\": \"#00b75b\",\r\n    \"tag_wishlist_color\": \"#0383b4\",\r\n    \"tag_coupon_color\": \"#c27120\",\r\n    \"tag_inv_gift_color\": \"#b10059\",\r\n    \"tag_inv_guestpass_color\": \"#65449a\",\r\n    \"tag_notinterested_color\": \"#4f4f4f\",\r\n    \"tag_collection_color\": \"#856d0e\",\r\n    \"tag_waitlist_color\": \"#4c7521\",\r\n\r\n    \"highlight_owned\": true,\r\n    \"highlight_wishlist\": true,\r\n    \"highlight_coupon\": false,\r\n    \"highlight_inv_gift\": false,\r\n    \"highlight_inv_guestpass\": false,\r\n    \"highlight_notinterested\": false,\r\n    \"highlight_excludef2p\": false,\r\n    \"highlight_collection\": true,\r\n    \"highlight_waitlist\": true,\r\n\r\n    \"tag_owned\": false,\r\n    \"tag_wishlist\": false,\r\n    \"tag_coupon\": false,\r\n    \"tag_inv_gift\": false,\r\n    \"tag_inv_guestpass\": false,\r\n    \"tag_notinterested\": true,\r\n    \"tag_collection\": false,\r\n    \"tag_waitlist\": false,\r\n    \"tag_short\": false,\r\n\r\n    \"hidetmsymbols\": false,\r\n\r\n    \"showlowestprice\": true,\r\n    \"showlowestprice_onwishlist\": true,\r\n    \"showlowestpricecoupon\": true,\r\n    \"showallstores\": true,\r\n    \"stores\": [],\r\n    \"override_price\": \"auto\",\r\n    \"showregionalprice\": \"mouse\",\r\n    \"regional_countries\": [\"us\", \"gb\", \"ru\", \"br\", \"au\", \"jp\"],\r\n\r\n    \"show_es_homepagetabs\": true,\r\n    \"showmarkettotal\": false,\r\n    \"showsteamrepapi\": true,\r\n    \"showmcus\": true,\r\n    \"showoc\": true,\r\n    \"showhltb\": true,\r\n    \"showyoutube\": true,\r\n    \"showtwitch\": true,\r\n    \"showpcgw\": true,\r\n    \"showcompletionistme\": false,\r\n    \"showprotondb\": false,\r\n    \"showviewinlibrary\": false,\r\n    \"showsteamcardexchange\": false,\r\n    \"showitadlinks\": true,\r\n    \"showsteamdb\": true,\r\n    \"showbartervg\": false,\r\n    \"showastatslink\": true,\r\n    \"showyoutubegameplay\": true,\r\n    \"showyoutubereviews\": true,\r\n    \"showwsgf\": true,\r\n    \"exfgls\": true,\r\n    \"app_custom_link\": [\r\n        {\r\n            \"enabled\": false,\r\n            \"name\": \"Google\",\r\n            \"url\": \"google.com/search?q=[ID]+[NAME]\",\r\n            \"icon\": \"www.google.com/images/branding/product/ico/googleg_lodp.ico\"\r\n        },\r\n    ],\r\n\r\n    \"customize_apppage\": {\r\n        \"recentupdates\": true,\r\n        \"reviews\": true,\r\n        \"about\": true,\r\n        \"contentwarning\": true,\r\n        \"steamchart\": true,\r\n        \"steamspy\": true,\r\n        \"surveys\": true,\r\n        \"sysreq\": true,\r\n        \"legal\": true,\r\n        \"morelikethis\": true,\r\n        \"recommendedbycurators\": true,\r\n        \"customerreviews\": true\r\n    },\r\n\r\n    \"customize_frontpage\": {\r\n        \"featuredrecommended\": true,\r\n        \"specialoffers\": true,\r\n        \"trendingamongfriends\": true,\r\n        \"discoveryqueue\": true,\r\n        \"browsesteam\": true,\r\n        \"curators\": true,\r\n        \"morecuratorrecommendations\": true,\r\n        \"recentlyupdated\": true,\r\n        \"fromdevelopersandpublishersthatyouknow\": true,\r\n        \"popularvrgames\": true,\r\n        \"homepagetabs\": true,\r\n        \"gamesstreamingnow\": true,\r\n        \"under\": true,\r\n        \"updatesandoffers\": true,\r\n        \"homepagesidebar\": true\r\n    },\r\n\r\n    // 'show_keylol_links': false, // not in use, option is commented out\r\n    \"show_package_info\": false,\r\n    \"show_steamchart_info\": true,\r\n    \"show_steamspy_info\": true,\r\n    \"show_early_access\": true,\r\n    \"show_alternative_linux_icon\": false,\r\n    \"show_itad_button\": false,\r\n    \"skip_got_steam\": false,\r\n\r\n    \"installsteam\": \"show\",\r\n    \"openinnewtab\": false,\r\n    \"keepssachecked\": false,\r\n    \"showemptywishlist\": true,\r\n    \"user_notes_app\": true,\r\n    \"user_notes_wishlist\": true,\r\n    \"showwishliststats\": true,\r\n    \"oneclickremovewl\": false,\r\n    \"user_notes\": {},\r\n    \"user_notes_adapter\": \"synced_storage\",\r\n    \"replaceaccountname\": true,\r\n    \"showlanguagewarning\": true,\r\n    \"showlanguagewarninglanguage\": \"english\",\r\n    \"homepage_tab_selection\": \"remember\",\r\n    \"homepage_tab_last\": null,\r\n    \"send_age_info\": true,\r\n    \"removebroadcasts\": false,\r\n    \"mp4video\": false,\r\n    \"horizontalscrolling\": true,\r\n    \"showsupportinfo\": true,\r\n    \"showdrm\": true,\r\n    \"regional_hideworld\": false,\r\n    \"showinvnav\": true,\r\n    \"quickinv\": true,\r\n    \"quickinv_diff\": -0.01,\r\n    \"community_default_tab\": \"\",\r\n    \"showallachievements\": false,\r\n    \"showallstats\": true,\r\n    \"replacecommunityhublinks\": false,\r\n    \"hideannouncementcomments\": false,\r\n    \"showachinstore\": true,\r\n    \"hideactivelistings\": false,\r\n    \"showlowestmarketprice\": true,\r\n    \"hidespamcomments\": false,\r\n    \"spamcommentregex\": \"[\\\\u2500-\\\\u25FF]\",\r\n    \"wlbuttoncommunityapp\": true,\r\n    \"removeguideslanguagefilter\": false,\r\n    \"disablelinkfilter\": false,\r\n    \"sortfriendsby\": \"default_ASC\",\r\n    \"sortreviewsby\": \"default_ASC\",\r\n    \"sortgroupsby\": \"default_ASC\",\r\n    \"show1clickgoo\": true,\r\n    \"show_profile_link_images\": \"gray\",\r\n    \"show_custom_themes\": true,\r\n    \"profile_pinned_bg\": false,\r\n    \"profile_steamrepcn\": true,\r\n    \"profile_steamgifts\": true,\r\n    \"profile_steamtrades\": true,\r\n    \"profile_bartervg\": true,\r\n    \"profile_steamrep\": true,\r\n    \"profile_steamdbcalc\": true,\r\n    \"profile_astats\": true,\r\n    \"profile_backpacktf\": true,\r\n    \"profile_astatsnl\": true,\r\n    \"profile_steamid\": true,\r\n    \"profile_custom_link\": [\r\n        {\r\n            \"enabled\": true,\r\n            \"name\": \"Google\",\r\n            \"url\": \"google.com/search?q=[ID]\",\r\n            \"icon\": \"www.google.com/images/branding/product/ico/googleg_lodp.ico\"\r\n        },\r\n    ],\r\n    \"fav_emoticons\": [],\r\n    \"group_steamgifts\": true,\r\n    \"steamcardexchange\": true,\r\n    \"purchase_dates\": true,\r\n    \"show_badge_progress\": true,\r\n    \"show_coupon\": true,\r\n    \"show_wishlist_link\": true,\r\n    \"show_wishlist_count\": true,\r\n    \"show_progressbar\": true,\r\n    \"show_backtotop\": false,\r\n\r\n    \"profile_showcase_twitch\": true,\r\n    \"profile_showcase_own_twitch\": false,\r\n    \"profile_showcase_twitch_profileonly\": false,\r\n\r\n    \"itad_import_library\": false,\r\n    \"itad_import_wishlist\": false,\r\n    \"add_to_waitlist\": false,\r\n\r\n    \"context_steam_store\": false,\r\n    \"context_steam_market\": false,\r\n    \"context_itad\": false,\r\n    \"context_bartervg\": false,\r\n    \"context_steamdb\": false,\r\n    \"context_steamdb_instant\": false,\r\n    \"context_steam_keys\": false,\r\n});\r\nSyncedStorage.persistent = [\r\n    \"user_notes\",\r\n    \"user_notes_adapter\",\r\n];\r\n\r\nexport {SyncedStorage};\r\n","import {BackgroundSimple} from \"../BackgroundSimple\";\r\nimport {ExtensionResources} from \"../ExtensionResources\";\r\nimport {Language} from \"./Language\";\r\nimport {SyncedStorage} from \"../Storage/SyncedStorage\";\r\n\r\n\r\nclass Localization {\r\n\r\n    static loadLocalization(code) {\r\n        return ExtensionResources.getJSON(`/localization/${code}.json`);\r\n    }\r\n\r\n    static init() {\r\n        if (Localization._promise) { return Localization._promise; }\r\n\r\n        let currentSteamLanguage = Language.getCurrentSteamLanguage();\r\n        const storedSteamLanguage = SyncedStorage.get(\"language\");\r\n        if (currentSteamLanguage === null) {\r\n            currentSteamLanguage = storedSteamLanguage;\r\n        } else if (currentSteamLanguage !== storedSteamLanguage) {\r\n            SyncedStorage.set(\"language\", currentSteamLanguage);\r\n            BackgroundSimple.action(\"clearpurchases\");\r\n        }\r\n\r\n        function deepAssign(target, source) {\r\n\r\n            // Object.assign() but deep-assigning objects recursively\r\n            for (const [key, val] of Object.entries(source)) {\r\n                if (typeof target[key] === \"undefined\") {\r\n                    console.warn(\"The key %s doesn't exist in the English localization file\", key);\r\n                    continue;\r\n                }\r\n                if (typeof val === \"object\") {\r\n                    deepAssign(target[key], val);\r\n                } else if (val !== \"\") {\r\n                    target[key] = val;\r\n                }\r\n            }\r\n            return target;\r\n        }\r\n\r\n        const local = Language.getLanguageCode(currentSteamLanguage);\r\n        const codes = [\"en\"];\r\n        if (local !== null && local !== \"en\") {\r\n            codes.push(local);\r\n        }\r\n        Localization._promise = Promise.all(\r\n            codes.map(lc => Localization.loadLocalization(lc))\r\n        ).then(([english, local]) => {\r\n            Localization.str = english;\r\n            if (local) {\r\n                deepAssign(Localization.str, local);\r\n            }\r\n            return Localization.str;\r\n        });\r\n        return Localization._promise;\r\n    }\r\n\r\n    static then(onDone, onCatch) {\r\n        return Localization.init().then(onDone, onCatch);\r\n    }\r\n\r\n    static getString(key) {\r\n\r\n        // Source: http://stackoverflow.com/a/24221895\r\n        const path = key.split(\".\").reverse();\r\n        let current = Localization.str;\r\n\r\n        while (path.length) {\r\n            if (typeof current !== \"object\") {\r\n                return null;\r\n            }\r\n            current = current[path.pop()];\r\n        }\r\n        return current;\r\n    }\r\n}\r\n\r\nLocalization._promise = null;\r\n\r\n\r\nexport {Localization};\r\n","\r\nimport {Storage} from \"./Storage\";\r\nimport {Environment} from \"../Environment\";\r\n\r\nclass LocalStorage extends Storage {\r\n\r\n    static async init() {\r\n        await super.init();\r\n\r\n        if (this === LocalStorage) {\r\n            // TODO Remove after some versions\r\n            return this.migrate();\r\n        }\r\n        return null;\r\n    }\r\n\r\n    static async migrate() {\r\n\r\n        const migrationDone = this.get(\"local_storage_migration\");\r\n\r\n        let type;\r\n\r\n        if (location.hostname === \"store.steampowered.com\") {\r\n            type = \"store\";\r\n        } else if (location.hostname === \"steamcommunity.com\") {\r\n            type = \"community\";\r\n        } else if (Environment.isContentScript()) {\r\n            return null;\r\n        } else {\r\n            type = \"extension\";\r\n        }\r\n\r\n        if (migrationDone[type]) { return null; }\r\n\r\n        await Promise.all(Object.keys(LocalStorage.defaults).map(async key => {\r\n\r\n            let value = localStorage.getItem(key);\r\n            if (value === null) { return; }\r\n\r\n            try {\r\n                value = JSON.parse(value);\r\n            } catch (err) {\r\n                console.error(\"Can't parse value\", value);\r\n                throw err;\r\n            }\r\n\r\n            await LocalStorage.set(key, value);\r\n            localStorage.removeItem(key);\r\n        }));\r\n\r\n        migrationDone[type] = true;\r\n        return LocalStorage.set(\"local_storage_migration\", migrationDone);\r\n    }\r\n}\r\n\r\nLocalStorage._adapter = browser.storage.local;\r\n\r\nLocalStorage.defaults = Object.freeze({\r\n    \"access_token\": null,\r\n    \"lastItadImport\": {\"from\": null, \"to\": null},\r\n    \"login\": {\"steamId\": null, \"profilePath\": null},\r\n    \"storeCountry\": null,\r\n    \"expand_slider\": false,\r\n    \"es_guide_tags\": {}, // TODO remove prefix\r\n    \"market_stats\": {\"startListing\": null, \"purchaseTotal\": 0, \"saleTotal\": 0},\r\n    \"popular_refresh\": false,\r\n    \"workshop_state\": \"\",\r\n    \"playback_hd\": false,\r\n    \"show_review_section\": true,\r\n    \"steampeek\": false,\r\n    \"support_info\": null,\r\n    \"hide_login_warn_store\": false,\r\n    \"hide_login_warn_community\": false,\r\n    \"review_filters\": {},\r\n    \"local_storage_migration\": {\"store\": false, \"community\": false, \"extension\": false},\r\n});\r\n\r\nexport {LocalStorage};\r\n","class Timer {\r\n\r\n    constructor(duration) {\r\n        this._promise = new Promise(resolve => {\r\n            this._id = setTimeout(() => { resolve(); }, duration);\r\n        });\r\n    }\r\n\r\n    then(onSuccess, onFail) {\r\n        if (this._promise) {\r\n            return this._promise.then(onSuccess, onFail);\r\n        }\r\n\r\n        throw new Error(\"Timer has been cleared before\");\r\n    }\r\n\r\n    clear() {\r\n        clearTimeout(this._id);\r\n        this._promise = null;\r\n    }\r\n}\r\n\r\nclass ResettableTimer {\r\n\r\n    constructor(onDone, duration) {\r\n        this.onDone = onDone;\r\n        this.duration = duration;\r\n\r\n        this.reset();\r\n    }\r\n\r\n    get running() { return this._running; }\r\n\r\n    reset() {\r\n        if (typeof this._id !== \"undefined\") {\r\n            clearTimeout(this._id);\r\n        }\r\n\r\n        this._id = setTimeout(async() => {\r\n            await this.onDone();\r\n            this._running = false;\r\n        }, this.duration);\r\n\r\n        this._running = true;\r\n    }\r\n}\r\n\r\nclass TimeUtils {\r\n\r\n    static timer(duration) {\r\n        return new Timer(duration);\r\n    }\r\n\r\n    static resettableTimer(onDone, duration) {\r\n        return new ResettableTimer(onDone, duration);\r\n    }\r\n\r\n    static now() {\r\n        return Math.trunc(Date.now() / 1000);\r\n    }\r\n}\r\n\r\nexport {TimeUtils};\r\n","\r\nclass GameId {\r\n\r\n    static parseId(id) {\r\n        if (!id) { return null; }\r\n\r\n        const intId = parseInt(id);\r\n        if (!intId) { return null; }\r\n\r\n        return intId;\r\n    }\r\n\r\n    static getAppid(text) {\r\n        let _text = text;\r\n\r\n        if (!_text) { return null; }\r\n\r\n        if (_text instanceof HTMLElement) {\r\n            const appid = _text.dataset.dsAppid;\r\n            if (appid) { return GameId.parseId(appid); }\r\n            _text = _text.href;\r\n            if (!_text) { return null; }\r\n        }\r\n\r\n        // app, games (legacy official group page), market/listing\r\n        const m = _text.match(/(?:store\\.steampowered|steamcommunity)\\.com\\/(?:app|games|market\\/listings)\\/(\\d+)\\/?/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static getSubid(text) {\r\n        let _text = text;\r\n\r\n        if (!_text) { return null; }\r\n\r\n        if (_text instanceof HTMLElement) {\r\n            const subid = _text.dataset.dsPackageid;\r\n            if (subid) { return GameId.parseId(subid); }\r\n            _text = _text.href;\r\n            if (!_text) { return null; }\r\n        }\r\n\r\n        const m = _text.match(/(?:store\\.steampowered|steamcommunity)\\.com\\/sub\\/(\\d+)\\/?/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static getBundleid(text) {\r\n        let _text = text;\r\n\r\n        if (!_text) { return null; }\r\n\r\n        if (_text instanceof HTMLElement) {\r\n            const bundleid = _text.dataset.dsBundleid;\r\n            if (bundleid) { return GameId.parseId(bundleid); }\r\n            _text = _text.href;\r\n            if (!_text) { return null; }\r\n        }\r\n\r\n        const m = _text.match(/(?:store\\.steampowered|steamcommunity)\\.com\\/bundle\\/(\\d+)\\/?/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static trimStoreId(storeId) {\r\n        return Number(storeId.slice(storeId.indexOf(\"/\") + 1));\r\n    }\r\n\r\n    static getAppidImgSrc(text) {\r\n        let _text = text;\r\n\r\n        if (!_text) { return null; }\r\n\r\n        if (_text instanceof HTMLImageElement) {\r\n            if (_text.hasAttribute(\"src\")) {\r\n                _text = _text.getAttribute(\"src\");\r\n            } else {\r\n                _text = _text.dataset.imageUrl;\r\n            }\r\n            if (!_text) { return null; }\r\n        }\r\n\r\n        // TODO support Steam's CDN option\r\n        const m = _text.match(/(?:cdn\\.(?:akamai|cloudflare)\\.steamstatic\\.com\\/steam|steamcdn-a\\.akamaihd\\.net\\/steam|steamcommunity\\/public\\/images)\\/apps\\/(\\d+)\\//);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static getAppidUriQuery(text) {\r\n        if (!text) { return null; }\r\n        const m = text.match(/appid=(\\d+)/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static getAppids(text) {\r\n        const regex = /(?:store\\.steampowered|steamcommunity)\\.com\\/app\\/(\\d+)\\/?/g;\r\n        const res = [];\r\n        let m;\r\n        while ((m = regex.exec(text)) !== null) {\r\n            const id = GameId.parseId(m[1]);\r\n            if (id) {\r\n                res.push(id);\r\n            }\r\n        }\r\n        return res;\r\n    }\r\n\r\n    static getAppidFromId(text) {\r\n        if (!text) { return null; }\r\n        const m = text.match(/game_(\\d+)/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static getAppidFromGameCard(text) {\r\n        if (!text) { return null; }\r\n        const m = text.match(/\\/gamecards\\/(\\d+)/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n}\r\n\r\nexport {GameId};\r\n","import {SyncedStorage} from \"./Storage/SyncedStorage\";\r\n\r\nconst ctxPermissions = __BROWSER__ === \"firefox\" ? [] : [\"contextMenus\"];\r\n\r\nconst PermissionOptions = Object.freeze({\r\n    \"context_steam_store\": {\r\n        \"persistent\": true,\r\n        \"permissions\": ctxPermissions,\r\n    },\r\n    \"context_steam_market\": {\r\n        \"persistent\": true,\r\n        \"permissions\": ctxPermissions,\r\n    },\r\n    \"context_itad\": {\r\n        \"persistent\": true,\r\n        \"permissions\": ctxPermissions,\r\n    },\r\n    \"context_bartervg\": {\r\n        \"persistent\": true,\r\n        \"permissions\": ctxPermissions,\r\n    },\r\n    \"context_steamdb\": {\r\n        \"persistent\": true,\r\n        \"permissions\": ctxPermissions,\r\n    },\r\n    \"context_steamdb_instant\": {\r\n        \"persistent\": true,\r\n        \"permissions\": ctxPermissions,\r\n    },\r\n    \"context_steam_keys\": {\r\n        \"persistent\": true,\r\n        \"permissions\": ctxPermissions,\r\n    },\r\n});\r\n\r\nclass Permissions {\r\n\r\n    /**\r\n     * @return Promise\r\n     */\r\n    static contains(permissionList) {\r\n        return browser.permissions.contains({\"permissions\": permissionList});\r\n    }\r\n\r\n    /**\r\n     * @return Promise\r\n     */\r\n    static request(permissionList) {\r\n        return browser.permissions.request({\"permissions\": permissionList});\r\n    }\r\n\r\n    /**\r\n     * @return Promise\r\n     */\r\n    static remove(permissionList) {\r\n        if (permissionList.includes(\"contextMenus\")) {\r\n            browser.contextMenus.removeAll();\r\n        }\r\n        return browser.permissions.remove({\"permissions\": permissionList});\r\n    }\r\n\r\n    static async when(permission, onAdded, onRemoved) {\r\n        if (onAdded) {\r\n            if (await Permissions.contains([permission])) {\r\n                onAdded();\r\n            }\r\n\r\n            browser.permissions.onAdded.addListener(p => {\r\n                if (p.permissions.includes(permission)) {\r\n                    onAdded();\r\n                }\r\n            });\r\n        }\r\n\r\n        if (onRemoved) {\r\n            browser.permissions.onRemoved.addListener(p => {\r\n                if (p.permissions.includes(permission)) {\r\n                    onRemoved();\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    static requestOption(option) {\r\n        return Permissions.request(PermissionOptions[option].permissions);\r\n    }\r\n\r\n    static removeOption(optionToRemove) {\r\n\r\n        // If any of the permissions is in use by another option, don't remove.\r\n        const unusedPermissions = Permissions._getUnusedPermissions(optionToRemove);\r\n        if (unusedPermissions.length === 0) {\r\n            return Promise.resolve(true);\r\n        }\r\n\r\n        return Permissions.remove(unusedPermissions);\r\n    }\r\n\r\n    static _getUnusedPermissions(option) {\r\n        const used = new Set();\r\n        for (const [key, setup] of Object.entries(PermissionOptions)) {\r\n            if (option === key || (setup.persistent && !SyncedStorage.get(key))) {\r\n                continue;\r\n            }\r\n\r\n            for (const p of setup.permissions) {\r\n                used.add(p);\r\n            }\r\n        }\r\n\r\n        const unused = new Set();\r\n        for (const p of PermissionOptions[option].permissions) {\r\n            if (!used.has(p)) {\r\n                unused.add(p);\r\n            }\r\n        }\r\n\r\n        return Array.from(unused.values());\r\n    }\r\n}\r\n\r\nexport {PermissionOptions, Permissions};\r\n","import {Info} from \"./Info\";\r\n\r\nclass Version {\r\n\r\n    constructor(major, minor = 0, patch = 0) {\r\n        console.assert([major, minor, patch].filter(Number.isInteger).length === 3, `${major}.${minor}.${patch} must be integers`);\r\n        this.major = major;\r\n        this.minor = minor;\r\n        this.patch = patch;\r\n    }\r\n\r\n    static from(version) {\r\n        if (version instanceof Version) {\r\n            return new Version(version.major, version.minor, version.patch);\r\n        }\r\n        if (typeof version == \"string\") {\r\n            return Version.fromString(version);\r\n        }\r\n        if (Array.isArray(version)) {\r\n            return Version.fromArray(version);\r\n        }\r\n        throw new Error(`Could not construct a Version from ${version}`);\r\n    }\r\n\r\n    static fromArray(version) {\r\n        return new Version(...version.map(v => parseInt(v)));\r\n    }\r\n\r\n    static fromString(version) {\r\n        return Version.fromArray(version.split(\".\"));\r\n    }\r\n\r\n    static coerce(version) {\r\n        if (version instanceof Version) {\r\n            return version;\r\n        }\r\n        return Version.from(version);\r\n    }\r\n\r\n    toString() {\r\n        return `${this.major}.${this.minor}.${this.patch}`;\r\n    }\r\n\r\n    toArray() {\r\n        return [this.major, this.minor, this.patch];\r\n    }\r\n\r\n    toJSON() {\r\n        return this.toString();\r\n    }\r\n\r\n    isCurrent() {\r\n        return this.isSameOrAfter(Info.version);\r\n    }\r\n\r\n    isSame(version) {\r\n        const _version = Version.coerce(version);\r\n        return this.major === _version.major\r\n            && this.minor === _version.minor\r\n            && this.patch === _version.patch;\r\n    }\r\n\r\n    isBefore(version) {\r\n        const _version = Version.coerce(version);\r\n        if (this.major < _version.major) { return true; }\r\n        if (this.major > _version.major) { return false; }\r\n\r\n        // this.major == _version.major\r\n        if (this.minor < _version.minor) { return true; }\r\n        if (this.minor > _version.minor) { return false; }\r\n\r\n        // this.minor == _version.minor\r\n        if (this.patch < _version.patch) { return true; }\r\n        return false;\r\n    }\r\n\r\n    isSameOrBefore(version) {\r\n        return this.isSame(version) || this.isBefore(version);\r\n    }\r\n\r\n    isAfter(version) {\r\n        const _version = Version.coerce(version);\r\n        return _version.isBefore(this);\r\n    }\r\n\r\n    isSameOrAfter(version) {\r\n        const _version = Version.coerce(version);\r\n        return _version.isSameOrBefore(this);\r\n    }\r\n}\r\n\r\nexport {Version};\r\n","import {SyncedStorage} from \"../../../Core/Storage/SyncedStorage\";\r\nimport {HTML} from \"../../../Core/Html/Html\";\r\nimport {Localization} from \"../../../Core/Localization/Localization\";\r\n\r\nclass ProgressBar {\r\n    static create() {\r\n        if (!SyncedStorage.get(\"show_progressbar\")) { return; }\r\n\r\n        HTML.afterEnd(\"#global_actions\",\r\n            `<div class=\"es_progress__wrap\">\r\n                <div class=\"es_progress es_progress--complete\" title=\"${Localization.str.ready.ready}\">\r\n                    <div class=\"es_progress__bar\">\r\n                        <div class=\"es_progress__value\"></div>\r\n                    </div>\r\n                </div>\r\n            </div>`);\r\n        ProgressBar._progress = document.querySelector(\".es_progress\");\r\n    }\r\n\r\n    static loading() {\r\n        if (!ProgressBar._progress) { return; }\r\n\r\n        ProgressBar._progress.setAttribute(\"title\", Localization.str.ready.loading);\r\n\r\n        ProgressBar.requests = {\"initiated\": 0, \"completed\": 0};\r\n        ProgressBar._progress.classList.remove(\"es_progress--complete\");\r\n        ProgressBar._progress.querySelector(\".es_progress__value\").style.width = \"18px\";\r\n    }\r\n\r\n    static startRequest() {\r\n        if (!ProgressBar.requests) { return; }\r\n        ProgressBar.requests.initiated++;\r\n        ProgressBar.progress();\r\n    }\r\n\r\n    static finishRequest() {\r\n        if (!ProgressBar.requests) { return; }\r\n        ProgressBar.requests.completed++;\r\n        ProgressBar.progress();\r\n    }\r\n\r\n    static progress(value) {\r\n        if (!ProgressBar._progress) { return; }\r\n\r\n        let _value = value;\r\n\r\n        if (!_value) {\r\n            if (!ProgressBar.requests) { return; }\r\n            if (ProgressBar.requests.initiated > 0) {\r\n                _value = 100 * ProgressBar.requests.completed / ProgressBar.requests.initiated;\r\n            }\r\n        }\r\n        if (_value > 100) {\r\n            _value = 100;\r\n        }\r\n\r\n        ProgressBar._progress.querySelector(\".es_progress__value\").style.width = `${_value}px`;\r\n\r\n        if (_value >= 100) {\r\n            ProgressBar._progress.classList.add(\"es_progress--complete\");\r\n            ProgressBar._progress.setAttribute(\"title\", Localization.str.ready.ready);\r\n            ProgressBar.requests = null;\r\n        }\r\n    }\r\n\r\n    static serverOutage() {\r\n        if (!ProgressBar._progress) { return; }\r\n\r\n        ProgressBar._progress.classList.add(\"es_progress--warning\");\r\n        ProgressBar.requests = null;\r\n\r\n        if (!ProgressBar._progress.parentElement.querySelector(\".es_progress__warning, .es_progress__error\")) {\r\n            HTML.afterEnd(\r\n                ProgressBar._progress,\r\n                `<div class=\"es_progress__warning\">${Localization.str.ready.server_outage}</div>`\r\n            );\r\n        }\r\n    }\r\n\r\n    static failed() {\r\n        if (!ProgressBar._progress) { return; }\r\n\r\n        const warningNode = ProgressBar._progress.parentElement.querySelector(\".es_progress__warning\");\r\n        if (warningNode) {\r\n            ProgressBar._progress.classList.remove(\"es_progress--warning\"); // Errors have higher precedence\r\n            warningNode.remove();\r\n        }\r\n        ProgressBar._progress.classList.add(\"es_progress--error\");\r\n        ProgressBar.requests = null;\r\n\r\n        const nodeError = ProgressBar._progress.parentElement.querySelector(\".es_progress__error\");\r\n        if (nodeError) {\r\n            nodeError.textContent = Localization.str.ready.failed.replace(\"__amount__\", ++ProgressBar._failedRequests);\r\n        } else {\r\n            HTML.afterEnd(\r\n                ProgressBar._progress,\r\n                `<div class=\"es_progress__error\">${\r\n                    Localization.str.ready.failed.replace(\"__amount__\", ++ProgressBar._failedRequests)\r\n                }</div>`\r\n            );\r\n        }\r\n    }\r\n}\r\n\r\nProgressBar._progress = null;\r\nProgressBar._failedRequests = 0;\r\n\r\nexport {ProgressBar};\r\n","import {BackgroundSimple} from \"../../Core/BackgroundSimple\";\r\nimport {ErrorParser} from \"../../Core/Errors/ErrorParser\";\r\nimport {ProgressBar} from \"./Widgets/ProgressBar\";\r\n\r\nclass Background extends BackgroundSimple {\r\n    static async message(message) {\r\n        ProgressBar.startRequest();\r\n\r\n        let result;\r\n        try {\r\n            result = await super.message(message);\r\n            ProgressBar.finishRequest();\r\n            return result;\r\n        } catch (err) {\r\n            const errObj = ErrorParser.parse(err.message);\r\n\r\n            switch (errObj.name) {\r\n                case \"ServerOutageError\":\r\n                    ProgressBar.serverOutage();\r\n                    break;\r\n                default: {\r\n                    if (!Background._errorHandlers.some(handler => handler(errObj))) {\r\n                        ProgressBar.failed();\r\n                    }\r\n                }\r\n            }\r\n            throw err;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @callback registerErrorHandlerCallback\r\n     * @param {string} name - The error name\r\n     * @param {string} msg - The error message\r\n     * @returns {boolean} - Whether the error has been handled\r\n     */\r\n\r\n    /**\r\n     * @param {registerErrorHandlerCallback} handler - The callback that will (eventually) handle the error\r\n     */\r\n    static registerErrorHandler(handler) {\r\n        Background._errorHandlers.push(handler);\r\n    }\r\n}\r\nBackground._errorHandlers = [];\r\n\r\nexport {Background};\r\n","\r\n/**\r\n * Convenience class for passing errors between contexts.\r\n * Errors thrown in the context of a message callback on the background page are\r\n * {@link https://github.com/mozilla/webextension-polyfill/blob/87bdfa844da054d189ac28423cf01b64ebfe1e5b/src/browser-polyfill.js#L418\r\n *  cut down to only send the message of the error},\r\n * losing information about the type.\r\n */\r\nclass ErrorParser {\r\n\r\n    /**\r\n     * Takes an Error string and parses it by splitting it into name and message\r\n     * @param {String} errStr a string created by Error.prototype.toString\r\n     * @returns {{name: String, msg: String}} an object containing information about the error name and its message\r\n     */\r\n    static parse(errStr) {\r\n        const info = errStr.match(/(.*):\\s(.+)/);\r\n\r\n        return {\"name\": info[1] || \"\", \"msg\": info[2] || \"\"};\r\n    }\r\n}\r\n\r\nexport {ErrorParser};\r\n","import {ProgressBar} from \"./Widgets/ProgressBar\";\r\nimport {Errors} from \"../../Core/Errors/Errors\";\r\n\r\nclass RequestData {\r\n\r\n    static async getHttp(url, settings = {}, responseType = \"text\") {\r\n\r\n        let _url = url;\r\n        const _settings = {\r\n            \"method\": \"GET\",\r\n            \"credentials\": \"include\",\r\n            \"headers\": {\"origin\": window.location.origin},\r\n            \"referrer\": window.location.origin + window.location.pathname,\r\n            ...settings\r\n        };\r\n\r\n        ProgressBar.startRequest();\r\n\r\n        if (_url.startsWith(\"//\")) { // TODO remove when not needed\r\n            _url = window.location.protocol + url;\r\n            console.warn(\"Requesting URL without protocol, please update\");\r\n        }\r\n\r\n        let response;\r\n\r\n        try {\r\n            response = await RequestData._fetchFn(_url, _settings);\r\n\r\n            if (!response.ok) {\r\n                throw new Errors.HTTPError(response.status, `HTTP ${response.status} ${response.statusText} for ${response.url}`);\r\n            }\r\n        } catch (err) {\r\n            ProgressBar.failed();\r\n            throw err;\r\n        }\r\n\r\n        ProgressBar.finishRequest();\r\n\r\n        return response[responseType]();\r\n    }\r\n\r\n    static post(url, formData, settings, returnJSON) {\r\n        return RequestData.getHttp(url, Object.assign(settings || {}, {\r\n            \"method\": \"POST\",\r\n            \"body\": formData\r\n        }), returnJSON ? \"json\" : \"text\");\r\n    }\r\n\r\n    static getJson(url, settings) {\r\n        return RequestData.getHttp(url, settings, \"json\");\r\n    }\r\n\r\n    static getBlob(url, settings) {\r\n        return RequestData.getHttp(url, settings, \"blob\");\r\n    }\r\n}\r\n\r\n/**\r\n * In Firefox, the global fetch lies in the sandbox environment, thus we have to\r\n * access the fetch function of the content window.\r\n * See https://bugzilla.mozilla.org/show_bug.cgi?id=1579347#c5\r\n */\r\nRequestData._fetchFn\r\n    // eslint-disable-next-line no-undef\r\n    = (typeof content !== \"undefined\" && content && content.fetch) // content is only available in FF environments\r\n    || fetch.bind(window);\r\n\r\nexport {RequestData};\r\n","import {CookieStorage} from \"../../Core/Storage/CookieStorage\";\r\nimport {HTMLParser} from \"../../Core/Html/HtmlParser\";\r\nimport {Background} from \"./Background\";\r\nimport {RequestData} from \"./RequestData\";\r\n\r\nclass User {\r\n\r\n    static get storeCountry() {\r\n\r\n        const url = new URL(window.location.href);\r\n\r\n        let country;\r\n        if (url.searchParams && url.searchParams.has(\"cc\")) {\r\n            country = url.searchParams.get(\"cc\");\r\n        } else {\r\n            country = User._storeCountry;\r\n            if (!country) {\r\n                country = CookieStorage.get(\"steamCountry\");\r\n            }\r\n        }\r\n\r\n        if (!country) {\r\n            console.warn(\"Failed to detect store country, falling back to US\");\r\n            country = \"US\";\r\n        }\r\n\r\n        return country.substr(0, 2);\r\n    }\r\n\r\n    static promise() {\r\n        if (User._promise) { return User._promise; }\r\n\r\n        const avatarNode = document.querySelector(\"#global_actions > a.user_avatar\");\r\n        let loginPromise;\r\n\r\n        if (avatarNode) {\r\n            User.profileUrl = avatarNode.href;\r\n            User.profilePath = avatarNode.pathname;\r\n\r\n            loginPromise = Background.action(\"login\", User.profilePath)\r\n                .then(login => {\r\n                    if (!login) { return; }\r\n                    User.isSignedIn = true;\r\n                    User.steamId = login.steamId;\r\n                });\r\n        } else {\r\n            loginPromise = Background.action(\"logout\");\r\n        }\r\n\r\n        User._promise = loginPromise\r\n            .then(() => Background.action(\"storecountry\"))\r\n            .catch(({message}) => { console.error(message); })\r\n            .then(country => {\r\n                if (country) {\r\n                    User._storeCountry = country;\r\n                    return null;\r\n                }\r\n\r\n                let newCountry;\r\n\r\n                if (window.location.hostname.endsWith(\"steampowered.com\")) {\r\n\r\n                    // Search through all scripts in case the order gets changed or a new one gets added\r\n                    for (const script of document.getElementsByTagName(\"script\")) {\r\n                        const match = script.textContent.match(/GDynamicStore\\.Init\\(.+?, '([A-Z]{2})/);\r\n                        if (match) {\r\n                            newCountry = match[1];\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                } else if (window.location.hostname === \"steamcommunity.com\") {\r\n                    const config = document.querySelector(\"#webui_config,#application_config\");\r\n                    if (config) {\r\n                        newCountry = JSON.parse(config.dataset.config).COUNTRY;\r\n                    }\r\n                }\r\n\r\n                if (newCountry) {\r\n                    User._storeCountry = newCountry;\r\n                    return Background.action(\"storecountry\", newCountry)\r\n                        .catch(({message}) => { console.error(message); });\r\n                } else {\r\n                    throw new Error(\"Script with user store country not found\");\r\n                }\r\n\r\n            })\r\n            .catch(err => {\r\n                console.group(\"Store country detection\");\r\n                console.warn(\"Failed to detect store country from page\");\r\n                console.error(err);\r\n                console.groupEnd();\r\n            });\r\n\r\n        return User._promise;\r\n    }\r\n\r\n    static then(onDone, onCatch) {\r\n        return User.promise().then(onDone, onCatch);\r\n    }\r\n\r\n    static get sessionId() {\r\n        if (!User._sessionId) {\r\n            User._sessionId = HTMLParser.getVariableFromDom(\"g_sessionID\", \"string\");\r\n        }\r\n        return User._sessionId;\r\n    }\r\n\r\n    static getPurchaseDate(lang, appName) {\r\n        const _appName = HTMLParser.clearSpecialSymbols(appName);\r\n        return Background.action(\"purchases\", _appName, lang);\r\n    }\r\n\r\n    /*\r\n     * Retrieve user access token to use in new style WebAPI calls (Services)\r\n     * https://github.com/Revadike/UnofficialSteamWebAPI/wiki/Get-Points-Summary-Config\r\n     */\r\n    static async getUserToken() {\r\n        // Use relative URL, so it matches domain (works on any steam domain)\r\n        const response = await RequestData.getJson(\"/pointssummary/ajaxgetasyncconfig\").catch(() => false);\r\n        if (!response || !response.success) {\r\n            throw new Error(\"Failed to get webapi token\");\r\n        }\r\n\r\n        return response.data.webapi_token;\r\n    }\r\n}\r\n\r\nexport {User};\r\n","import {Errors} from \"../../../Core/Errors/Errors\";\r\n\r\n// Polyfill from https://gist.github.com/davidbarral/d0d4da70fa9e6f615595d01f54276e0b#file-promises-js\r\nif (!Promise.allSettled) {\r\n    Promise.allSettled = promises => Promise.all(\r\n        promises.map(promise => promise\r\n            .then(value => ({\r\n                \"status\": \"fulfilled\",\r\n                value,\r\n            }))\r\n            .catch(reason => ({\r\n                \"status\": \"rejected\",\r\n                reason,\r\n            })))\r\n    );\r\n}\r\n\r\nclass FeatureManager {\r\n    static async apply(features) {\r\n\r\n        this._promisesMap = new Map();\r\n\r\n        this._stats = {\r\n            \"completed\": 0,\r\n            \"failed\": 0,\r\n            \"dependency\": 0,\r\n        };\r\n\r\n        while (features.length > 0) {\r\n\r\n            const feature = features.pop();\r\n            const promise = this._generateFeatureChain(feature);\r\n\r\n            if (promise === null) {\r\n                features.unshift(feature);\r\n            } else {\r\n                this._promisesMap.set(feature.constructor, promise);\r\n            }\r\n        }\r\n\r\n        await Promise.allSettled(Array.from(this._promisesMap.values()));\r\n\r\n        console.log(\r\n            \"Feature loading complete, %i successfully loaded, %i failed to load, %i didn't load due to dependency errors\",\r\n            this._stats.completed,\r\n            this._stats.failed,\r\n            this._stats.dependency\r\n        );\r\n    }\r\n\r\n    static _generateFeatureChain(feature) {\r\n\r\n        let ready = true;\r\n        let promise = Promise.resolve(true);\r\n\r\n        if (Array.isArray(feature.constructor.dependencies)) {\r\n\r\n            // Ensure that all dependencies have generated a dependency chain for themselves\r\n            for (const dep of feature.constructor.dependencies) {\r\n                if (this._promisesMap.has(dep)) { continue; }\r\n\r\n                ready = false;\r\n                break;\r\n            }\r\n\r\n            if (ready) {\r\n\r\n                // Promise that waits for all dependencies to finish executing\r\n                promise = Promise.all(\r\n                    Array.from(this._promisesMap.entries())\r\n                        .filter(([ftr]) => feature.constructor.dependencies.includes(ftr))\r\n                        .map(([, promise]) => promise)\r\n                );\r\n            }\r\n        }\r\n\r\n        if (!ready) { return null; }\r\n\r\n        return promise\r\n            .then(previousCheck => { // Check if the dependencies have all their prerequisites fulfilled\r\n                let prev = true;\r\n\r\n                if (!feature.constructor.weakDependency) {\r\n                    if (Array.isArray(previousCheck)) {\r\n                        prev = previousCheck.every(res => res);\r\n                    } else {\r\n                        prev = previousCheck;\r\n                    }\r\n                }\r\n\r\n                return prev && feature.checkPrerequisites();\r\n            })\r\n            .then(async fulfilled => { // If the feature's prerequisites are fulfilled, apply it\r\n                if (fulfilled) {\r\n                    await feature.apply();\r\n                    ++this._stats.completed;\r\n                }\r\n                return fulfilled;\r\n            })\r\n            .catch(err => {\r\n\r\n                const featureName = feature.constructor.name;\r\n\r\n                if (err instanceof Errors.FeatureDependencyError) {\r\n                    console.warn(\r\n                        \"Not applying feature %s due to an error in the dependency chain (namely %s)\",\r\n                        featureName,\r\n                        err.featureName\r\n                    );\r\n                    ++this._stats.dependency;\r\n                    throw err;\r\n                }\r\n\r\n                console.group(featureName);\r\n                console.error(\"Error while applying feature %s\", featureName);\r\n                console.error(err);\r\n                console.groupEnd();\r\n\r\n                ++this._stats.failed;\r\n                throw new Errors.FeatureDependencyError(\"Failed to apply\", featureName);\r\n            });\r\n\r\n    }\r\n}\r\n\r\nexport {FeatureManager};\r\n","\r\nexport default Object.freeze({\r\n    \"ACCOUNT\": 1,\r\n    \"APP\": 2,\r\n    \"BUNDLE\": 3,\r\n    \"STORE_DEFAULT\": 4,\r\n    \"FUNDS\": 5,\r\n    \"REGISTER_KEY\": 6,\r\n    \"SALE\": 7, // unused\r\n    \"SEARCH\": 8,\r\n    \"STATS\": 9,\r\n    \"STORE_FRONT\": 10,\r\n    \"SUB\": 11,\r\n    \"WISHLIST\": 12,\r\n    \"AGECHECK\": 13,\r\n    \"COMMUNITY_DEFAULT\": 14,\r\n    \"WORKSHOP\": 15,\r\n    \"PROFILE_ACTIVITY\": 16,\r\n    \"GAMES\": 17,\r\n    \"PROFILE_EDIT\": 18,\r\n    \"BADGES\": 19,\r\n    \"GAME_CARD\": 20,\r\n    \"FRIENDS_THAT_PLAY\": 21,\r\n    \"FRIENDS\": 22, // unused\r\n    \"MARKET_SEARCH\": 23,\r\n    \"INVENTORY\": 24,\r\n    \"MARKET_LISTING\": 25,\r\n    \"MARKET_HOME\": 26,\r\n    \"PROFILE_HOME\": 27,\r\n    \"GROUP_HOME\": 28,\r\n    \"GUIDES\": 29,\r\n    \"COMMUNITY_APP\": 30,\r\n    \"COMMUNITY_STATS\": 31,\r\n    \"MY_WORKSHOP\": 32,\r\n    \"SHARED_FILES\": 33,\r\n    \"WORKSHOP_BROWSE\": 34,\r\n    \"EDIT_GUIDE\": 35,\r\n    \"RECOMMENDED\": 36,\r\n    \"BOOSTER_CREATOR\": 37,\r\n    \"TRADE_OFFER\": 38,\r\n    \"FRIENDS_AND_GROUPS\": 39,\r\n    \"POINTS_SHOP\": 40,\r\n});\r\n\r\n","import {GameId} from \"../../../Core/GameId\";\r\nimport {Background} from \"../Background\";\r\nimport {User} from \"../User\";\r\n\r\nclass DynamicStore {\r\n\r\n    /*\r\n     * FIXME\r\n     *  1. Check usage of `await DynamicStore`, currently it does nothing\r\n     *  2. getAppStatus() is not properly waiting for initialization of the DynamicStore\r\n     *  3. There is no guarante that `User` is initialized before `_fetch()` is called\r\n     *  4. getAppStatus() should probably be simplified if we force array even when only one storeId was requested\r\n     */\r\n\r\n    static clear() {\r\n        return Background.action(\"dynamicstore.clear\");\r\n    }\r\n\r\n    static async getAppStatus(storeId) {\r\n        const multiple = Array.isArray(storeId);\r\n        let promise;\r\n        let trimmedIds;\r\n\r\n        if (multiple) {\r\n            trimmedIds = storeId.map(id => GameId.trimStoreId(id));\r\n            promise = Background.action(\"dynamicstorestatus\", trimmedIds);\r\n        } else {\r\n            promise = Background.action(\"dynamicstorestatus\", GameId.trimStoreId(storeId));\r\n        }\r\n\r\n        let statusList;\r\n        const dsStatusList = await promise;\r\n\r\n        if (multiple) {\r\n            statusList = {};\r\n            for (let i = 0; i < storeId.length; ++i) {\r\n                const trimmedId = trimmedIds[i];\r\n                const id = storeId[i];\r\n                statusList[id] = {\r\n                    \"ignored\": dsStatusList[trimmedId].includes(\"ignored\"),\r\n                    \"wishlisted\": dsStatusList[trimmedId].includes(\"wishlisted\"),\r\n                };\r\n                if (id.startsWith(\"app/\")) {\r\n                    statusList[id].owned = dsStatusList[trimmedId].includes(\"ownedApps\");\r\n                } else if (id.startsWith(\"sub/\")) {\r\n                    statusList[id].owned = dsStatusList[trimmedId].includes(\"ownedPackages\");\r\n                }\r\n            }\r\n        } else {\r\n            statusList = {\r\n                \"ignored\": dsStatusList.includes(\"ignored\"),\r\n                \"wishlisted\": dsStatusList.includes(\"wishlisted\"),\r\n            };\r\n            if (storeId.startsWith(\"app/\")) {\r\n                statusList.owned = dsStatusList.includes(\"ownedApps\");\r\n            } else if (storeId.startsWith(\"sub/\")) {\r\n                statusList.owned = dsStatusList.includes(\"ownedPackages\");\r\n            }\r\n        }\r\n\r\n        return statusList;\r\n    }\r\n\r\n    static async getRandomApp() {\r\n        await DynamicStore._fetch();\r\n        return Background.action(\"dynamicStore.randomApp\");\r\n    }\r\n\r\n    static _fetch() {\r\n        if (!User.isSignedIn) {\r\n            return DynamicStore.clear();\r\n        }\r\n        return Promise.resolve(null);\r\n    }\r\n\r\n    static then(onDone, onCatch) {\r\n        if (!DynamicStore._promise) {\r\n            DynamicStore._promise = DynamicStore._fetch();\r\n        }\r\n        return DynamicStore._promise.then(onDone, onCatch);\r\n    }\r\n}\r\n\r\nexport {DynamicStore};\r\n","import {Background} from \"../Background\";\r\n\r\nclass Inventory {\r\n\r\n    static getCoupon(appid) {\r\n        return Background.action(\"coupon\", appid);\r\n    }\r\n\r\n    static async getAppStatus(appids, options) {\r\n\r\n        function getStatusObject(giftsAndPasses, hasCoupon) {\r\n            return {\r\n                \"gift\": giftsAndPasses.includes(\"gifts\"),\r\n                \"guestPass\": giftsAndPasses.includes(\"passes\"),\r\n                \"coupon\": Boolean(hasCoupon),\r\n            };\r\n        }\r\n\r\n        const opts = {\"giftsAndPasses\": true,\r\n            \"coupons\": true,\r\n            ...options};\r\n\r\n        if (!opts.giftsAndPasses && !opts.coupons) { return null; }\r\n\r\n        const multiple = Array.isArray(appids);\r\n\r\n        try {\r\n            const [giftsAndPasses, coupons] = await Promise.all([\r\n                opts.giftsAndPasses ? Background.action(\"hasgiftsandpasses\", appids) : Promise.resolve(),\r\n                opts.coupons ? Background.action(\"hascoupon\", appids) : Promise.resolve(),\r\n            ]);\r\n\r\n            if (multiple) {\r\n                const results = {};\r\n\r\n                for (const id of appids) {\r\n                    results[id] = getStatusObject(giftsAndPasses ? giftsAndPasses[id] : [], coupons ? coupons[id] : false);\r\n                }\r\n\r\n                return results;\r\n            }\r\n            return getStatusObject(giftsAndPasses || [], typeof coupons === \"undefined\" ? false : coupons);\r\n        } catch (err) {\r\n            if (multiple) {\r\n                const results = {};\r\n                for (const id of appids) {\r\n                    results[id] = getStatusObject([], false);\r\n                }\r\n                return results;\r\n            }\r\n\r\n            return getStatusObject([], false);\r\n        }\r\n    }\r\n\r\n    static hasInMarketInventory(marketHashes) {\r\n        return Background.action(\"hasitem\", marketHashes);\r\n    }\r\n}\r\n\r\nexport {Inventory};\r\n","\r\nclass Feature {\r\n\r\n    /**\r\n     * @param {Context} context\r\n     */\r\n    constructor(context) {\r\n        this.context = context;\r\n    }\r\n\r\n    checkPrerequisites() {\r\n        return true;\r\n    }\r\n\r\n    apply() {\r\n        throw new Error(\"Stub\");\r\n    }\r\n\r\n    logError(err, msg, ...args) {\r\n        console.group(this.constructor.name);\r\n        console.error(msg, ...args);\r\n        console.error(err);\r\n        console.groupEnd();\r\n    }\r\n}\r\n\r\nexport {Feature};\r\n","\r\n// Most of the code here comes from dselect.js\r\nimport {HTML} from \"../../../Core/Html/Html\";\r\nimport {Localization} from \"../../../Core/Localization/Localization\";\r\nimport {SyncedStorage} from \"../../../Core/Storage/SyncedStorage\";\r\n\r\nclass Sortbox {\r\n\r\n    static init() {\r\n        this._activeDropLists = {};\r\n        this._lastSelectHideTime = 0;\r\n\r\n        // Hide droplist when clicking outside\r\n        document.addEventListener(\"mousedown\", e => {\r\n            for (const key of Object.keys(this._activeDropLists)) {\r\n                if (this._activeDropLists[key] && !e.target.closest(`#${key}_container`)) {\r\n                    this._hide(key);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    static _highlightItem(id, index, bSetSelected) {\r\n        const droplist = document.querySelector(`#${id}_droplist`);\r\n        const trigger = document.querySelector(`#${id}_trigger`);\r\n        const rgItems = droplist.getElementsByTagName(\"a\");\r\n\r\n        if (index >= 0 && index < rgItems.length) {\r\n            const item = rgItems[index];\r\n\r\n            if (typeof trigger.highlightedItem !== \"undefined\" && trigger.highlightedItem !== index) {\r\n                rgItems[trigger.highlightedItem].className = \"inactive_selection\";\r\n            }\r\n\r\n            trigger.highlightedItem = index;\r\n            rgItems[index].className = \"highlighted_selection\";\r\n\r\n            let yOffset = rgItems[index].offsetTop + rgItems[index].clientHeight;\r\n            let curVisibleOffset = droplist.scrollTop + droplist.clientHeight;\r\n            let bScrolledDown = false;\r\n            const nMaxLoopIterations = rgItems.length;\r\n            let nLoopCounter = 0;\r\n\r\n            while (curVisibleOffset < yOffset && nLoopCounter++ < nMaxLoopIterations) {\r\n                droplist.scrollTop += rgItems[index].clientHeight;\r\n                curVisibleOffset = droplist.scrollTop + droplist.clientHeight;\r\n                bScrolledDown = true;\r\n            }\r\n\r\n            if (!bScrolledDown) {\r\n                nLoopCounter = 0;\r\n                yOffset = rgItems[index].offsetTop;\r\n                curVisibleOffset = droplist.scrollTop;\r\n                while (curVisibleOffset > yOffset && nLoopCounter++ < nMaxLoopIterations) {\r\n                    droplist.scrollTop -= rgItems[index].clientHeight;\r\n                    curVisibleOffset = droplist.scrollTop;\r\n                }\r\n            }\r\n\r\n            if (bSetSelected) {\r\n                HTML.inner(trigger, item.innerHTML);\r\n                const input = document.querySelector(`#${id}`);\r\n                input.value = item.id;\r\n                input.dispatchEvent(new Event(\"change\"));\r\n\r\n                this._hide(id);\r\n            }\r\n        }\r\n    }\r\n\r\n    static _onFocus(id) {\r\n        this._activeDropLists[id] = true;\r\n    }\r\n\r\n    static _onBlur(id) {\r\n        if (!document.querySelector(`#${id}_trigger`).classList.contains(\"activetrigger\")) {\r\n            this._activeDropLists[id] = false;\r\n        }\r\n    }\r\n\r\n    static _hide(id) {\r\n        const droplist = document.querySelector(`#${id}_droplist`);\r\n        const trigger = document.querySelector(`#${id}_trigger`);\r\n\r\n        this._lastSelectHideTime = Date.now();\r\n\r\n        trigger.className = \"trigger\";\r\n        droplist.className = \"dropdownhidden\";\r\n        this._activeDropLists[id] = false;\r\n        trigger.focus();\r\n    }\r\n\r\n    static _show(id) {\r\n        if (Date.now() - this._lastSelectHideTime < 50) { return; }\r\n\r\n        const droplist = document.querySelector(`#${id}_droplist`);\r\n        const trigger = document.querySelector(`#${id}_trigger`);\r\n\r\n        trigger.className = \"activetrigger\";\r\n        droplist.className = \"dropdownvisible\";\r\n        this._activeDropLists[id] = true;\r\n        trigger.focus();\r\n    }\r\n\r\n    static _onTriggerClick(id) {\r\n        if (!document.querySelector(`#${id}_trigger`).classList.contains(\"activetrigger\")) {\r\n            this._show(id);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * NOTE FOR ADDON REVIEWER:\r\n     * Elements returned by this function are already sanitized (calls to HTML class),\r\n     * so they can be safely inserted without being sanitized again.\r\n     * If we would sanitize them again, all event listeners would be lost due to\r\n     * DOMPurify only returning HTML strings.\r\n     */\r\n    static get(name, options, initialOption, changeFn, storageOption) {\r\n\r\n        const id = `sort_by_${name}`;\r\n        let reversed = initialOption.endsWith(\"_DESC\");\r\n\r\n        const arrowDown = \"↓\";\r\n        const arrowUp = \"↑\";\r\n\r\n        const box = HTML.element(\r\n            `<div class=\"es-sortbox es-sortbox--${name}\">\r\n                <div class=\"es-sortbox__label\">${Localization.str.sort_by}</div>\r\n                <div id=\"${id}_container\" class=\"es-sortbox__container\">\r\n                    <input id=\"${id}\" type=\"hidden\" name=\"${name}\" value=\"${initialOption}\">\r\n                    <a id=\"${id}_trigger\" class=\"trigger\"></a>\r\n                    <div class=\"es-dropdown\">\r\n                        <ul id=\"${id}_droplist\" class=\"dropdownhidden\"></ul>\r\n                    </div>\r\n                </div>\r\n                <span class=\"es-sortbox__reverse\">${reversed ? arrowUp : arrowDown}</span>\r\n            </div>`\r\n        );\r\n\r\n        const input = box.querySelector(`#${id}`);\r\n\r\n        function getTrimmedValue(val) { return val.replace(/(_ASC|_DESC)$/, \"\"); }\r\n\r\n        function onChange(val, reversed) {\r\n            const _val = getTrimmedValue(val);\r\n            changeFn(_val, reversed);\r\n            if (storageOption) { SyncedStorage.set(storageOption, `${_val}_${reversed ? \"DESC\" : \"ASC\"}`); }\r\n        }\r\n\r\n        input.addEventListener(\"change\", () => { onChange(input.value.replace(`${id}_`, \"\"), reversed); });\r\n\r\n        // Trigger changeFn for initial option\r\n        if (initialOption !== \"default_ASC\") {\r\n            input.dispatchEvent(new Event(\"change\"));\r\n        }\r\n\r\n        const reverseEl = box.querySelector(\".es-sortbox__reverse\");\r\n        reverseEl.addEventListener(\"click\", () => {\r\n            reversed = !reversed;\r\n            reverseEl.textContent = reversed ? arrowUp : arrowDown;\r\n            onChange(input.value.replace(`${id}_`, \"\"), reversed);\r\n        });\r\n\r\n        const trigger = box.querySelector(`#${id}_trigger`);\r\n        trigger.addEventListener(\"focus\", () => this._onFocus(id));\r\n        trigger.addEventListener(\"blur\", () => this._onBlur(id));\r\n        trigger.addEventListener(\"click\", () => this._onTriggerClick(id));\r\n\r\n        const ul = box.querySelector(\"ul\");\r\n        const trimmedOption = getTrimmedValue(initialOption);\r\n        for (let i = 0; i < options.length; ++i) {\r\n            const [key, text] = options[i];\r\n\r\n            let toggle = \"inactive\";\r\n            if (key === trimmedOption) {\r\n                input.value = key;\r\n                trigger.textContent = text;\r\n                toggle = \"highlighted\";\r\n            }\r\n\r\n            HTML.beforeEnd(ul,\r\n                `<li>\r\n                    <a class=\"${toggle}_selection\" tabindex=\"99999\" id=\"${id}_${key}\">${text}</a>\r\n                </li>`);\r\n\r\n            const a = ul.querySelector(\"li:last-child > a\");\r\n\r\n            // a.href = \"javascript:DSelectNoop()\";\r\n            a.addEventListener(\"mouseover\", () => this._highlightItem(id, i, false));\r\n            a.addEventListener(\"click\", () => this._highlightItem(id, i, true));\r\n        }\r\n\r\n        return box;\r\n    }\r\n}\r\n\r\nSortbox.init();\r\n\r\nexport {Sortbox};\r\n","\r\nclass DOMHelper {\r\n\r\n    static wrap(container, node) {\r\n        const parent = node.parentNode;\r\n        parent.insertBefore(container, node);\r\n        parent.removeChild(node);\r\n        container.append(node);\r\n    }\r\n\r\n    static remove(selector) {\r\n        const node = document.querySelector(selector);\r\n        if (!node) { return; }\r\n        node.remove();\r\n    }\r\n\r\n    // TODO extend Node itself?\r\n    static selectLastNode(parent, selector) {\r\n        const nodes = parent.querySelectorAll(selector);\r\n        return nodes.length === 0 ? null : nodes[nodes.length - 1];\r\n    }\r\n\r\n    static insertStylesheet(href) {\r\n        const stylesheet = document.createElement(\"link\");\r\n        stylesheet.rel = \"stylesheet\";\r\n        stylesheet.type = \"text/css\";\r\n        stylesheet.href = href;\r\n        document.head.appendChild(stylesheet);\r\n    }\r\n\r\n    static insertScript({src, content}, id, onload, isAsync = true) {\r\n        const script = document.createElement(\"script\");\r\n\r\n        if (onload) { script.onload = onload; }\r\n        if (id) { script.id = id; }\r\n        if (src) { script.src = src; }\r\n        if (content) { script.textContent = content; }\r\n        if (isAsync) { script.setAttribute(\"async\", \"\"); }\r\n\r\n        document.head.appendChild(script);\r\n    }\r\n\r\n    static insertCSS(content, id) {\r\n        const style = document.createElement(\"style\");\r\n\r\n        if (id) { style.id = id; }\r\n        style.textContent = content;\r\n\r\n        document.head.appendChild(style);\r\n    }\r\n}\r\n\r\nexport {DOMHelper};\r\n","\r\nclass HorizontalScroller {\r\n\r\n    static create(parentNode, controlLeftNode, controlRightNode) {\r\n\r\n        let lastScroll = 0;\r\n\r\n        parentNode.addEventListener(\"wheel\", e => {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n\r\n            if (Date.now() - lastScroll < 200) { return; }\r\n            lastScroll = Date.now();\r\n\r\n            const isScrollDown = e.deltaY > 0;\r\n            if (isScrollDown) {\r\n                controlRightNode.click();\r\n            } else {\r\n                controlLeftNode.click();\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nexport {HorizontalScroller};\r\n","// This is the basic configuration for the Augmented Steam extension\r\n\r\nexport default {\r\n    \"ApiServerHost\": \"https://esapi.isthereanydeal.com\",\r\n    \"PublicHost\": \"https://augmentedsteam.com\",\r\n    \"ITADApiServerHost\": \"https://api.isthereanydeal.com\",\r\n    \"ITADClientId\": \"5fe78af07889f43a\"\r\n};\r\n","import {HTML} from \"../../Core/Html/Html\";\r\nimport {ExtensionResources} from \"../../Core/ExtensionResources\";\r\nimport {Localization} from \"../../Core/Localization/Localization\";\r\nimport {SyncedStorage} from \"../../Core/Storage/SyncedStorage\";\r\nimport {Language} from \"../../Core/Localization/Language\";\r\nimport {LocalStorage} from \"../../Core/Storage/LocalStorage\";\r\nimport {Background} from \"./Background\";\r\nimport {DOMHelper} from \"./DOMHelper\";\r\nimport {HorizontalScroller} from \"./Widgets/HorizontalScroller\";\r\nimport {DynamicStore} from \"./Data/DynamicStore\";\r\nimport {User} from \"./User\";\r\nimport {Page} from \"../Features/Page\";\r\nimport config from \"../../config\";\r\n\r\nclass AugmentedSteam {\r\n\r\n    static _addMenu() {\r\n\r\n        HTML.afterBegin(\"#global_action_menu\",\r\n            `<div id=\"es_menu\">\r\n                <span id=\"es_pulldown\" class=\"pulldown global_action_link\">Augmented Steam</span>\r\n                <div id=\"es_popup\" class=\"popup_block_new\">\r\n                    <div class=\"popup_body popup_menu\">\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"${ExtensionResources.getURL(\"html/options.html\")}\">${Localization.str.thewordoptions}</a>\r\n                        <a class=\"popup_menu_item\" id=\"es_clear_cache\" href=\"#clear_cache\">${Localization.str.clear_cache}</a>\r\n                        <div class=\"hr\"></div>\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"https://github.com/IsThereAnyDeal/AugmentedSteam\">${Localization.str.contribute}</a>\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"https://github.com/IsThereAnyDeal/AugmentedSteam/issues\">${Localization.str.bug_feature}</a>\r\n                        <div class=\"hr\"></div>\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"${config.PublicHost}\">${Localization.str.website}</a>\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"https://isthereanydeal.com/\">IsThereAnyDeal</a>\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"https://discord.gg/yn57q7f\">Discord</a>\r\n                    </div>\r\n                </div>\r\n            </div>`);\r\n\r\n        document.querySelector(\"#es_pulldown\").addEventListener(\"click\", () => {\r\n            Page.runInPageContext(() => {\r\n                window.SteamFacade.showMenu(\"es_pulldown\", \"es_popup\", \"right\", \"bottom\", true);\r\n            });\r\n        });\r\n\r\n        document.querySelector(\"#es_menu\").addEventListener(\"click\", e => {\r\n            e.stopPropagation();\r\n        });\r\n\r\n        document.querySelector(\"#es_popup\").addEventListener(\"click\", () => {\r\n            Page.runInPageContext(() => {\r\n                window.SteamFacade.hideMenu(\"es_pulldown\", \"es_popup\");\r\n            });\r\n        });\r\n\r\n        document.querySelector(\"#es_clear_cache\").addEventListener(\"click\", async e => {\r\n            e.preventDefault();\r\n\r\n            await AugmentedSteam.clearCache();\r\n            window.location.reload();\r\n        });\r\n    }\r\n\r\n    static _addBackToTop() {\r\n        if (!SyncedStorage.get(\"show_backtotop\")) { return; }\r\n\r\n        // Remove Steam's back-to-top button\r\n        DOMHelper.remove(\"#BackToTop\");\r\n\r\n        const btn = document.createElement(\"div\");\r\n        btn.classList.add(\"es_btt\");\r\n        btn.textContent = \"▲\";\r\n\r\n        document.body.append(btn);\r\n\r\n        btn.addEventListener(\"click\", () => {\r\n            window.scroll({\r\n                \"top\": 0,\r\n                \"left\": 0,\r\n                \"behavior\": \"smooth\"\r\n            });\r\n        });\r\n\r\n        window.addEventListener(\"scroll\", () => {\r\n            btn.classList.toggle(\"is-visible\", window.scrollY >= 400);\r\n        });\r\n    }\r\n\r\n    static _bindLogout() {\r\n\r\n        // TODO there should be a better detection of logout, probably\r\n        const logoutNode = document.querySelector(\"a[href$='javascript:Logout();']\");\r\n        logoutNode.addEventListener(\"click\", () => {\r\n            AugmentedSteam.clearCache();\r\n        });\r\n    }\r\n\r\n    static _addWarning(innerHTML, stopShowingHandler) {\r\n        const el = HTML.element(\r\n            `<div class=\"es_warn js-warn\">\r\n                <div class=\"es_warn__cnt\">\r\n                    <div>${innerHTML}</div>\r\n                    <div class=\"es_warn__control\">\r\n                        <a class=\"es_warn__btn js-warn-close\">${Localization.str.update.dont_show}</a>\r\n                        <a class=\"es_warn__btn js-warn-hide\">${Localization.str.hide}</a>\r\n                    </div>\r\n                </div>\r\n            </div>`\r\n        );\r\n\r\n        el.querySelector(\".js-warn-close\").addEventListener(\"click\", () => {\r\n            if (stopShowingHandler) {\r\n                stopShowingHandler();\r\n            }\r\n            el.closest(\".js-warn\").remove();\r\n        });\r\n\r\n        el.querySelector(\".js-warn-hide\").addEventListener(\"click\", () => {\r\n            el.closest(\".js-warn\").remove();\r\n        });\r\n\r\n        document.getElementById(\"global_header\").insertAdjacentElement(\"afterend\", el);\r\n    }\r\n\r\n    /**\r\n     * Display warning if browsing using a different language\r\n     */\r\n    static _addLanguageWarning() {\r\n        if (!SyncedStorage.get(\"showlanguagewarning\")) { return; }\r\n\r\n        const currentLanguage = Language.getCurrentSteamLanguage();\r\n        if (!currentLanguage) { return; }\r\n\r\n        if (!SyncedStorage.has(\"showlanguagewarninglanguage\")) {\r\n            SyncedStorage.set(\"showlanguagewarninglanguage\", currentLanguage);\r\n        }\r\n\r\n        const warningLanguage = SyncedStorage.get(\"showlanguagewarninglanguage\");\r\n\r\n        if (currentLanguage === warningLanguage) { return; }\r\n\r\n        Localization.loadLocalization(Language.getLanguageCode(warningLanguage)).then((strings) => {\r\n            AugmentedSteam._addWarning(\r\n                `${strings.using_language.replace(\"__current__\", strings.options.lang[currentLanguage] || currentLanguage)}\r\n                <a href=\"#\" id=\"es_reset_language_code\">\r\n                ${strings.using_language_return.replace(\"__base__\", strings.options.lang[warningLanguage] || warningLanguage)}\r\n                </a>`,\r\n                () => { SyncedStorage.set(\"showlanguagewarning\", false); }\r\n            );\r\n\r\n            document.querySelector(\"#es_reset_language_code\").addEventListener(\"click\", (e) => {\r\n                e.preventDefault();\r\n                // eslint-disable-next-line no-undef, new-cap\r\n                Page.runInPageContext(warningLanguage => { ChangeLanguage(warningLanguage); }, [warningLanguage]);\r\n            });\r\n        });\r\n    }\r\n\r\n    static _handleInstallSteamButton() {\r\n        const option = SyncedStorage.get(\"installsteam\");\r\n        if (option === \"hide\") {\r\n            DOMHelper.remove(\"div.header_installsteam_btn\");\r\n        } else if (option === \"replace\") {\r\n            const btn = document.querySelector(\"div.header_installsteam_btn > a\");\r\n            btn.textContent = Localization.str.viewinclient;\r\n            btn.href = `steam://openurl/${window.location.href}`;\r\n            btn.classList.add(\"es_steamclient_btn\");\r\n        }\r\n    }\r\n\r\n    static _addUsernameSubmenuLinks() {\r\n        // There are two menus; one for responsive (mobile) and one for \"unresponsive\" (desktop) design\r\n        for (const node of document.querySelectorAll(\".submenu_username\")) {\r\n            HTML.afterEnd(\r\n                node.querySelector(\"a\"),\r\n                `<a class=\"submenuitem\" href=\"//steamcommunity.com/my/games/\">${Localization.str.games}</a>`\r\n            );\r\n            HTML.afterEnd(\r\n                node.querySelector(\"a:nth-child(2)\"),\r\n                `<a class=\"submenuitem\" href=\"//store.steampowered.com/wishlist/\">${Localization.str.wishlist}</a>`\r\n            );\r\n            HTML.beforeEnd(\r\n                node,\r\n                `<a class=\"submenuitem\" href=\"//steamcommunity.com/my/recommended/\">${Localization.str.reviews}</a>`\r\n            );\r\n        }\r\n    }\r\n\r\n    static _cartLink() {\r\n        // There are two menus; one for responsive (mobile) and one for \"unresponsive\" (desktop) design\r\n        for (const wishlistLink of document.querySelectorAll(\".submenu_store > .submenuitem[href='https://steamcommunity.com/my/wishlist/']\")) {\r\n            HTML.afterEnd(wishlistLink, `<a class=\"submenuitem\" href=\"https://store.steampowered.com/cart/\">${Localization.str.cart}</a>`);\r\n        }\r\n    }\r\n\r\n    static _disableLinkFilter() {\r\n        if (!SyncedStorage.get(\"disablelinkfilter\")) { return; }\r\n\r\n        function removeLinkFilter(parent = document) {\r\n            const selector = \"a[href*='/linkfilter/']\";\r\n\r\n            for (const link of parent.querySelectorAll(selector)) {\r\n                link.href = new URLSearchParams(link.search).get(\"url\");\r\n            }\r\n        }\r\n\r\n        removeLinkFilter();\r\n\r\n        new MutationObserver(mutations => {\r\n            for (const mutation of mutations) {\r\n                for (const node of mutation.addedNodes) {\r\n                    if (node.nodeType !== Node.ELEMENT_NODE) { continue; }\r\n                    removeLinkFilter(node);\r\n                }\r\n            }\r\n        }).observe(document, {\"childList\": true, \"subtree\": true});\r\n    }\r\n\r\n    static _addRedeemLink() {\r\n        HTML.beforeBegin(\r\n            \"#account_language_pulldown\",\r\n            `<a class=\"popup_menu_item\" href=\"https://store.steampowered.com/account/registerkey\">${Localization.str.activate}</a>`\r\n        );\r\n    }\r\n\r\n    static _replaceAccountName() {\r\n        if (!SyncedStorage.get(\"replaceaccountname\")) { return; }\r\n\r\n        const logoutNode = document.querySelector(\"#account_dropdown .persona.online\");\r\n        const accountName = logoutNode.textContent.trim();\r\n        const communityName = document.querySelector(\"#account_pulldown\").textContent.trim();\r\n\r\n        logoutNode.textContent = communityName;\r\n\r\n        // Replace page header on account related pages\r\n        if (location.href.startsWith(\"https://store.steampowered.com/account\")) {\r\n            const pageHeader = document.querySelector(\"h2.pageheader\");\r\n            if (pageHeader) {\r\n                pageHeader.textContent = pageHeader.textContent.replace(new RegExp(accountName, \"i\"), communityName);\r\n            }\r\n        }\r\n\r\n        // Don't replace title on user pages that aren't mine\r\n        const isUserPage = /.*(id|profiles)\\/.+/g.test(location.pathname);\r\n        if (!isUserPage || location.pathname.includes(User.profilePath)) {\r\n            document.title = document.title.replace(accountName, communityName);\r\n        }\r\n    }\r\n\r\n    static _launchRandomButton() {\r\n\r\n        HTML.beforeEnd(\r\n            \"#es_popup .popup_menu\",\r\n            `<div class=\"hr\"></div>\r\n             <a id=\"es_random_game\" class=\"popup_menu_item\" style=\"cursor: pointer;\">${Localization.str.launch_random}</a>`\r\n        );\r\n\r\n        document.querySelector(\"#es_random_game\").addEventListener(\"click\", async() => {\r\n            const appid = await DynamicStore.getRandomApp();\r\n            if (!appid) { return; }\r\n\r\n            Background.action(\"appdetails\", appid).then(response => {\r\n                if (!response || !response.success) { return; }\r\n                const data = response.data;\r\n\r\n                let gameid = appid;\r\n                let gamename;\r\n                if (data.fullgame) {\r\n                    gameid = data.fullgame.appid;\r\n                    gamename = data.fullgame.name;\r\n                } else {\r\n                    gamename = data.name;\r\n                }\r\n\r\n                Page.runInPageContext((playGameStr, gameid, visitStore) => {\r\n                    const prompt = window.SteamFacade.showConfirmDialog(\r\n                        playGameStr,\r\n                        `<img src=\"//steamcdn-a.akamaihd.net/steam/apps/${gameid}/header.jpg\">`,\r\n                        null,\r\n                        null,\r\n                        visitStore\r\n                    );\r\n\r\n                    prompt.done(result => {\r\n                        if (result === \"OK\") { window.location.assign(`steam://run/${gameid}`); }\r\n                        if (result === \"SECONDARY\") { window.location.assign(`//store.steampowered.com/app/${gameid}`); }\r\n                    });\r\n                },\r\n                [\r\n                    Localization.str.play_game.replace(\"__gamename__\", gamename.replace(\"'\", \"\").trim()),\r\n                    gameid,\r\n                    Localization.str.visit_store,\r\n                ]);\r\n            });\r\n        });\r\n    }\r\n\r\n    static _skipGotSteam() {\r\n        if (!SyncedStorage.get(\"skip_got_steam\")) { return; }\r\n\r\n        // https://github.com/SteamDatabase/SteamTracking/blob/cdf367ce61926a896fe54d710b3ed25d66d7e333/store.steampowered.com/public/javascript/game.js#L1785\r\n        Page.runInPageContext(() => {\r\n            window.ShowGotSteamModal = function(steamUrl) { window.location.assign(steamUrl); };\r\n        });\r\n    }\r\n\r\n    static _keepSteamSubscriberAgreementState() {\r\n        const nodes = document.querySelectorAll(\"#market_sell_dialog_accept_ssa,#market_buyorder_dialog_accept_ssa,#accept_ssa\");\r\n        for (const node of nodes) {\r\n            node.checked = SyncedStorage.get(\"keepssachecked\");\r\n\r\n            node.addEventListener(\"click\", () => {\r\n                SyncedStorage.set(\"keepssachecked\", !SyncedStorage.get(\"keepssachecked\"));\r\n            });\r\n        }\r\n    }\r\n\r\n    static _defaultCommunityTab() {\r\n        const tab = SyncedStorage.get(\"community_default_tab\");\r\n        if (!tab) { return; }\r\n\r\n        const links = document.querySelectorAll(\"a[href^='https://steamcommunity.com/app/']\");\r\n        for (const link of links) {\r\n            if (link.classList.contains(\"apphub_sectionTab\")) { continue; }\r\n            if (!/^\\/app\\/[0-9]+\\/?$/.test(link.pathname)) { continue; }\r\n            if (!link.pathname.endsWith(\"/\")) {\r\n                link.pathname += \"/\";\r\n            }\r\n            link.pathname += `${tab}/`;\r\n        }\r\n    }\r\n\r\n    static _horizontalScrolling() {\r\n        if (!SyncedStorage.get(\"horizontalscrolling\")) { return; }\r\n\r\n        for (const node of document.querySelectorAll(\".slider_ctn:not(.spotlight)\")) {\r\n            HorizontalScroller.create(\r\n                node.parentNode.querySelector(\"#highlight_strip, .store_horizontal_autoslider_ctn\"),\r\n                node.querySelector(\".slider_left\"),\r\n                node.querySelector(\".slider_right\"),\r\n            );\r\n        }\r\n    }\r\n\r\n    static addLoginWarning(type) {\r\n        if (AugmentedSteam._loginWarningAdded || LocalStorage.get(`hide_login_warn_${type}`)) { return; }\r\n\r\n        let host;\r\n\r\n        if (type === \"store\") {\r\n            host = \"store.steampowered.com\";\r\n        } else if (type === \"community\") {\r\n            host = \"steamcommunity.com\";\r\n        } else {\r\n            console.warn(\"Unknown login warning type %s\", type);\r\n            return;\r\n        }\r\n\r\n        AugmentedSteam._addWarning(\r\n            `${Localization.str.login_warning.replace(\"__link__\", `<a href=\"https://${host}/login/\">${host}</a>`)}`,\r\n            () => { LocalStorage.set(`hide_login_warn_${type}`, true); }\r\n        );\r\n        AugmentedSteam._loginWarningAdded = true;\r\n\r\n        console.warn(\"Are you logged into %s?\", host);\r\n    }\r\n\r\n    static clearCache() {\r\n        return Background.action(\"cache.clear\");\r\n    }\r\n\r\n    static init() {\r\n        AugmentedSteam._addBackToTop();\r\n        AugmentedSteam._addMenu();\r\n        AugmentedSteam._addLanguageWarning();\r\n        AugmentedSteam._handleInstallSteamButton();\r\n        AugmentedSteam._disableLinkFilter();\r\n        AugmentedSteam._skipGotSteam();\r\n        AugmentedSteam._keepSteamSubscriberAgreementState();\r\n        AugmentedSteam._defaultCommunityTab();\r\n        AugmentedSteam._horizontalScrolling();\r\n        AugmentedSteam._cartLink();\r\n\r\n        if (User.isSignedIn) {\r\n            AugmentedSteam._addUsernameSubmenuLinks();\r\n            AugmentedSteam._addRedeemLink();\r\n            AugmentedSteam._replaceAccountName();\r\n            AugmentedSteam._launchRandomButton();\r\n            AugmentedSteam._bindLogout();\r\n        }\r\n    }\r\n}\r\n\r\nexport {AugmentedSteam};\r\n","\r\nclass StringUtils {\r\n\r\n    // https://stackoverflow.com/a/6969486/7162651\r\n    static escapeRegExp(str) {\r\n        return str.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\"); // $& means the whole matched string\r\n    }\r\n}\r\n\r\nexport {StringUtils};\r\n","import {SyncedStorage} from \"../../Core/Storage/SyncedStorage\";\r\nimport {StringUtils} from \"../../Core/Utils/StringUtils\";\r\nimport {Background} from \"./Background\";\r\nimport {Page} from \"../Features/Page\";\r\n\r\nclass SteamCurrency {\r\n\r\n    /*\r\n     * Example:\r\n     * {\r\n     *  \"id\": 1,\r\n     *  \"abbr\": \"USD\",\r\n     *  \"symbol\": \"$\",\r\n     *  \"hint\": \"United States Dollars\",\r\n     *  \"multiplier\": 100,\r\n     *  \"unit\": 1,\r\n     *  \"format\": {\r\n     *      \"places\": 2,\r\n     *      \"hidePlacesWhenZero\": false,\r\n     *      \"symbolFormat\": \"$\",\r\n     *      \"thousand\": \",\",\r\n     *      \"decimal\": \".\",\r\n     *      \"right\": false\r\n     *  }\r\n     * }\r\n     */\r\n\r\n    constructor({\r\n        id,\r\n        abbr = \"USD\",\r\n        symbol = \"$\",\r\n        hint = \"Default Currency\",\r\n        multiplier = 100,\r\n        unit = 1,\r\n        \"format\": {\r\n            \"places\": formatPlaces = 2,\r\n            \"hidePlacesWhenZero\": formatHidePlaces = false,\r\n            \"symbolFormat\": formatSymbol = \"$\",\r\n            \"thousand\": formatGroupSeparator = \",\",\r\n            \"group\": formatGroupSize = 3,\r\n            \"decimal\": formatDecimalSeparator = \".\",\r\n            \"right\": formatPostfixSymbol = false,\r\n        },\r\n    }) {\r\n\r\n        // console.assert(id && Number.isInteger(id))\r\n        Object.assign(this, {\r\n            \"id\": id, // Steam Currency ID, integer, 1-41 (at time of writing)\r\n            \"abbr\": abbr, // TLA for the currency\r\n            \"symbol\": symbol, // Symbol used to represent/recognize the currency, this is NULL for CNY to avoid collision with JPY\r\n            \"hint\": hint, // English label for the currency to reduce mistakes editing the JSON\r\n            \"multiplier\": multiplier, // multiplier used by Steam when writing values\r\n            \"unit\": unit, // Minimum transactional unit required by Steam.\r\n            \"format\": {\r\n                \"decimalPlaces\": formatPlaces, // How many decimal places does this currency have?\r\n                \"hidePlacesWhenZero\": formatHidePlaces, // Does this currency show decimal places for a .0 value?\r\n                \"symbol\": formatSymbol, // Symbol used when generating a string value of this currency\r\n                \"groupSeparator\": formatGroupSeparator, // Thousands separator\r\n                \"groupSize\": formatGroupSize, // Digits to a \"thousand\" for the thousands separator\r\n                \"decimalSeparator\": formatDecimalSeparator,\r\n                \"postfix\": formatPostfixSymbol, // Should format.symbol be post-fixed?\r\n            },\r\n        });\r\n        Object.freeze(this.format);\r\n        Object.freeze(this);\r\n    }\r\n\r\n    valueOf(price) {\r\n\r\n        // remove separators\r\n        let _price = price.trim()\r\n            .replace(this.format.groupSeparator, \"\");\r\n        if (this.format.decimalSeparator !== \".\") {\r\n            _price = _price.replace(this.format.decimalSeparator, \".\");\r\n        } // as expected by parseFloat()\r\n        _price = _price.replace(/[^\\d.]/g, \"\");\r\n\r\n        const value = parseFloat(_price);\r\n\r\n        if (Number.isNaN(value)) { return null; }\r\n        return value; // this.multiplier?\r\n    }\r\n\r\n    stringify(value, withSymbol = true) {\r\n        const sign = value < 0 ? \"-\" : \"\";\r\n        const _value = Math.abs(value);\r\n\r\n        let s = _value.toFixed(this.format.decimalPlaces),\r\n            decimals;\r\n\r\n        [s, decimals] = s.split(\".\");\r\n\r\n        const g = [];\r\n        let j = s.length;\r\n\r\n        for (; j > this.format.groupSize; j -= this.format.groupSize) {\r\n            g.unshift(s.substring(j - this.format.groupSize, j));\r\n        }\r\n        g.unshift(s.substring(0, j));\r\n        s = [sign, g.join(this.format.groupSeparator)];\r\n        if (this.format.decimalPlaces > 0) {\r\n            if (!this.format.hidePlacesWhenZero || parseInt(decimals) > 0) {\r\n                s.push(this.format.decimalSeparator);\r\n                s.push(decimals);\r\n            }\r\n        }\r\n        if (withSymbol) {\r\n            if (this.format.postfix) {\r\n                s.push(this.format.symbol);\r\n            } else {\r\n                s.unshift(this.format.symbol);\r\n            }\r\n        }\r\n        return s.join(\"\");\r\n    }\r\n\r\n    placeholder() {\r\n        let str = `1${this.format.groupSeparator}`;\r\n        let cur = 2;\r\n        for (let i = 0; i < this.format.groupSize; ++i, ++cur) {\r\n            str += cur;\r\n        }\r\n\r\n        if (this.format.decimalPlaces === 0) {\r\n            return str;\r\n        }\r\n\r\n        str += this.format.decimalSeparator;\r\n        for (let i = 0; i < this.format.decimalPlaces; ++i, ++cur) {\r\n            str += cur;\r\n        }\r\n        return str;\r\n    }\r\n\r\n    regExp() {\r\n        let regex = `^(?:\\\\d{1,${\r\n            this.format.groupSize\r\n        }}(?:${\r\n            StringUtils.escapeRegExp(this.format.groupSeparator)\r\n        }\\\\d{${\r\n            this.format.groupSize\r\n        }})+|\\\\d*)`;\r\n\r\n        if (this.format.decimalPlaces > 0) {\r\n            regex += `(?:${StringUtils.escapeRegExp(this.format.decimalSeparator)}\\\\d{0,${this.format.decimalPlaces}})?`;\r\n        }\r\n        regex += \"$\";\r\n\r\n        return new RegExp(regex);\r\n    }\r\n}\r\n\r\nclass CurrencyManager {\r\n\r\n    static _getCurrencyFromDom() {\r\n        const currencyNode = document.querySelector('meta[itemprop=\"priceCurrency\"]');\r\n        if (currencyNode && currencyNode.hasAttribute(\"content\")) {\r\n            return currencyNode.getAttribute(\"content\");\r\n        }\r\n        return null;\r\n    }\r\n\r\n    static async _getCurrencyFromWallet() {\r\n        const walletCurrency = await Page.runInPageContext(\r\n            // eslint-disable-next-line no-undef, camelcase\r\n            () => (typeof g_rgWalletInfo !== \"undefined\" && g_rgWalletInfo ? g_rgWalletInfo.wallet_currency : null),\r\n            null,\r\n            \"walletCurrency\"\r\n        );\r\n\r\n        if (walletCurrency) {\r\n            return CurrencyManager.currencyNumberToType(walletCurrency);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    static async _getStoreCurrency(context) {\r\n        let currency = CurrencyManager._getCurrencyFromDom();\r\n\r\n        if (!currency) {\r\n            currency = await CurrencyManager._getCurrencyFromWallet(context);\r\n        }\r\n\r\n        if (!currency) {\r\n            try {\r\n                currency = await Background.action(\"currency\");\r\n            } catch (error) {\r\n                console.error(`Couldn't load currency${error}`);\r\n            }\r\n        }\r\n\r\n        if (!currency) {\r\n            currency = \"USD\"; // fallback\r\n        }\r\n\r\n        return currency;\r\n    }\r\n\r\n    static getRate(from, to) {\r\n        if (from === to) { return 1; }\r\n\r\n        if (CurrencyManager._rates[from] && CurrencyManager._rates[from][to]) {\r\n            return CurrencyManager._rates[from][to];\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    static getCurrencySymbolFromString(str) {\r\n        const re = /(?:R\\$|S\\$|\\$|RM|kr|Rp|€|¥|£|฿|pуб|P|₫|₩|TL|₴|Mex\\$|CDN\\$|A\\$|HK\\$|NT\\$|₹|SR|R |DH|CHF|CLP\\$|S\\/\\.|COL\\$|NZ\\$|ARS\\$|₡|₪|₸|KD|zł|QR|\\$U)/;\r\n        const match = str.match(re);\r\n        return match ? match[0] : \"\";\r\n    }\r\n\r\n    static currencyTypeToNumber(type) {\r\n        return CurrencyManager.fromType(type).id;\r\n    }\r\n\r\n    static currencyNumberToType(number) {\r\n        return CurrencyManager.fromNumber(number).abbr;\r\n    }\r\n\r\n    /**\r\n     * @return SteamCurrency\r\n     */\r\n    static fromType(type) {\r\n        return CurrencyManager._indices.abbr[type] || CurrencyManager._defaultCurrency;\r\n    }\r\n\r\n    /**\r\n     * @return SteamCurrency\r\n     */\r\n    static fromNumber(number) {\r\n        return CurrencyManager._indices.id[number] || CurrencyManager._defaultCurrency;\r\n    }\r\n\r\n    static async _loadCurrency(context) {\r\n        CurrencyManager.storeCurrency = await CurrencyManager._getStoreCurrency(context);\r\n        const currencySetting = SyncedStorage.get(\"override_price\");\r\n        CurrencyManager.customCurrency = (currencySetting === \"auto\")\r\n            ? CurrencyManager.storeCurrency\r\n            : currencySetting;\r\n    }\r\n\r\n    static async _loadRates() {\r\n        const toCurrencies = [CurrencyManager.storeCurrency];\r\n        if (CurrencyManager.customCurrency !== CurrencyManager.storeCurrency) {\r\n            toCurrencies.push(CurrencyManager.customCurrency);\r\n        }\r\n        CurrencyManager._rates = await Background.action(\"rates\", toCurrencies);\r\n    }\r\n\r\n    static async init(context) {\r\n        if (CurrencyManager._isInitialized) { return; }\r\n\r\n        const currencies = await Background.action(\"steam.currencies\");\r\n\r\n        for (let currency of currencies) {\r\n\r\n            currency = new SteamCurrency(currency);\r\n            CurrencyManager._indices.abbr[currency.abbr] = currency;\r\n            CurrencyManager._indices.id[currency.id] = currency;\r\n\r\n            if (currency.symbol) { // CNY && JPY use the same symbol\r\n                CurrencyManager._indices.symbols[currency.symbol] = currency;\r\n            }\r\n        }\r\n        CurrencyManager._defaultCurrency = CurrencyManager._indices.id[1]; // USD\r\n\r\n        try {\r\n            await CurrencyManager._loadCurrency(context);\r\n            await CurrencyManager._loadRates();\r\n        } catch (e) {\r\n            console.error(\"Failed to initialize Currency\");\r\n            console.error(e);\r\n        }\r\n\r\n        CurrencyManager._isInitialized = true;\r\n    }\r\n\r\n    static then(onSuccess, onFailure) {\r\n        return CurrencyManager.init().then(onSuccess, onFailure);\r\n    }\r\n}\r\nCurrencyManager._isInitialized = false;\r\nCurrencyManager._indices = {\r\n    \"id\": {},\r\n    \"abbr\": {},\r\n    \"symbols\": {},\r\n};\r\n\r\nexport {CurrencyManager};\r\n","import {HTML} from \"../../Core/Html/Html\";\r\nimport {ExtensionResources} from \"../../Core/ExtensionResources\";\r\nimport {SyncedStorage} from \"../../Core/Storage/SyncedStorage\";\r\nimport {Localization} from \"../../Core/Localization/Localization\";\r\nimport {Background} from \"./Background\";\r\nimport {User} from \"./User\";\r\nimport {TimeUtils} from \"../../modulesCore\";\r\n\r\nclass ITAD {\r\n    static async create() {\r\n        if (!await Background.action(\"itad.isconnected\")) { return; }\r\n\r\n        HTML.afterBegin(\"#global_action_menu\",\r\n            `<div id=\"es_itad\">\r\n                <img id=\"es_itad_logo\" src=\"${ExtensionResources.getURL(\"img/itad.png\")}\">\r\n                <span id=\"es_itad_status\">✓</span>\r\n            </div>`);\r\n\r\n        document.querySelector(\"#es_itad\").addEventListener(\"mouseenter\", ITAD.onHover);\r\n\r\n        if (User.isSignedIn && (SyncedStorage.get(\"itad_import_library\") || SyncedStorage.get(\"itad_import_wishlist\"))) {\r\n            Background.action(\"itad.import\");\r\n        }\r\n    }\r\n\r\n    static async onHover() {\r\n\r\n        async function updateLastImport() {\r\n            const {from, to} = await Background.action(\"itad.lastimport\");\r\n\r\n            let htmlStr\r\n                = `<div>${Localization.str.itad.from}</div>\r\n                   <div>${from ? new Date(from * 1000).toLocaleString() : Localization.str.never}</div>`;\r\n\r\n            if (SyncedStorage.get(\"itad_import_library\") || SyncedStorage.get(\"itad_import_wishlist\")) {\r\n                htmlStr\r\n                    += `<div>${Localization.str.itad.to}</div>\r\n                        <div>${to ? new Date(to * 1000).toLocaleString() : Localization.str.never}</div>`;\r\n            }\r\n\r\n            HTML.inner(\".es-itad-hover__last-import\", htmlStr);\r\n        }\r\n\r\n        if (!document.querySelector(\".es-itad-hover\")) {\r\n            HTML.afterEnd(\"#es_itad_status\",\r\n                `<div class=\"es-itad-hover\">\r\n                    <div class=\"es-itad-hover__content\">\r\n                        <h4>${Localization.str.itad.last_import}</h4>\r\n                        <div class=\"es-itad-hover__last-import\"></div>\r\n                        <div class=\"es-itad-hover__sync-now\">\r\n                            <span class=\"es-itad-hover__sync-now-text\">${Localization.str.itad.sync_now}</span>\r\n                            <div class=\"loader\"></div>\r\n                            <span class=\"es-itad-hover__sync-failed\">&#10060;</span>\r\n                            <span class=\"es-itad-hover__sync-success\">&#10003;</span>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"es-itad-hover__arrow\"></div>\r\n                </div>`);\r\n\r\n            const hover = document.querySelector(\".es-itad-hover\");\r\n\r\n            const syncDiv = document.querySelector(\".es-itad-hover__sync-now\");\r\n            document.querySelector(\".es-itad-hover__sync-now-text\").addEventListener(\"click\", async() => {\r\n                syncDiv.classList.remove(\"es-itad-hover__sync-now--failed\", \"es-itad-hover__sync-now--success\");\r\n                syncDiv.classList.add(\"es-itad-hover__sync-now--loading\");\r\n                hover.style.display = \"block\";\r\n\r\n                let timeout;\r\n\r\n                try {\r\n                    await Background.action(\"itad.sync\");\r\n                    syncDiv.classList.add(\"es-itad-hover__sync-now--success\");\r\n                    await updateLastImport();\r\n\r\n                    timeout = 1000;\r\n                } catch (err) {\r\n                    syncDiv.classList.add(\"es-itad-hover__sync-now--failed\");\r\n\r\n                    console.group(\"ITAD sync\");\r\n                    console.error(\"Failed to sync with ITAD\");\r\n                    console.error(err);\r\n                    console.groupEnd();\r\n\r\n                    timeout = 3000;\r\n                } finally {\r\n                    TimeUtils.timer(timeout).then(() => { hover.style.display = \"\"; });\r\n                    syncDiv.classList.remove(\"es-itad-hover__sync-now--loading\");\r\n                }\r\n            });\r\n        }\r\n\r\n        await updateLastImport();\r\n    }\r\n\r\n    static async getAppStatus(storeIds, options) {\r\n        const opts = {\"waitlist\": true,\r\n            \"collection\": true,\r\n            ...options};\r\n\r\n        if (!opts.collection && !opts.waitlist) { return null; }\r\n\r\n        const multiple = Array.isArray(storeIds);\r\n        const promises = [];\r\n        const resolved = Promise.resolve(multiple ? {} : false);\r\n\r\n        if (await Background.action(\"itad.isconnected\")) {\r\n            if (opts.collection) {\r\n                promises.push(Background.action(\"itad.incollection\", storeIds));\r\n            } else {\r\n                promises.push(resolved);\r\n            }\r\n            if (opts.waitlist) {\r\n                promises.push(Background.action(\"itad.inwaitlist\", storeIds));\r\n            } else {\r\n                promises.push(resolved);\r\n            }\r\n        } else {\r\n            promises.push(resolved, resolved);\r\n        }\r\n\r\n        const [inCollection, inWaitlist] = await Promise.all(promises);\r\n\r\n        if (multiple) {\r\n            const result = {};\r\n            for (const id of storeIds) {\r\n                result[id] = {\r\n                    \"collected\": inCollection[id],\r\n                    \"waitlisted\": inWaitlist[id],\r\n                };\r\n            }\r\n            return result;\r\n        } else {\r\n            return {\r\n                \"collected\": inCollection,\r\n                \"waitlisted\": inWaitlist,\r\n            };\r\n        }\r\n    }\r\n}\r\n\r\nexport {ITAD};\r\n","\r\n/**\r\n * NOTE FOR ADDON REVIEWER:\r\n * This class is meant to simplify communication between extension context and page context.\r\n * Basically, we have wrapped postMessage API in this class.\r\n */\r\nclass Messenger {\r\n    static postMessage(msgID, info) {\r\n        window.postMessage({\r\n            \"type\": `es_${msgID}`,\r\n            \"information\": info\r\n        }, window.location.origin);\r\n    }\r\n\r\n    // Used for one-time events\r\n    static onMessage(msgID) {\r\n        return new Promise(resolve => {\r\n            function callback(e) {\r\n                if (e.source !== window) { return; }\r\n                if (!e.data || !e.data.type) { return; }\r\n                if (e.data.type === `es_${msgID}`) {\r\n                    resolve(e.data.information);\r\n                    window.removeEventListener(\"message\", callback);\r\n                }\r\n            }\r\n            window.addEventListener(\"message\", callback);\r\n        });\r\n    }\r\n\r\n    // Used for setting up a listener that should be able to receive more than one callback\r\n    static addMessageListener(msgID, callback) {\r\n        window.addEventListener(\"message\", e => {\r\n            if (e.source !== window) { return; }\r\n            if (!e.data || !e.data.type) { return; }\r\n            if (e.data.type === `es_${msgID}`) {\r\n                callback(e.data.information);\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nexport {Messenger};\r\n","import {CurrencyManager} from \"./CurrencyManager\";\r\n\r\nclass Price {\r\n\r\n    constructor(value = 0, currency = CurrencyManager.storeCurrency) {\r\n        this.value = value;\r\n        this.currency = currency;\r\n        Object.freeze(this);\r\n    }\r\n\r\n    formattedValue() {\r\n        return CurrencyManager.fromType(this.currency).stringify(this.value, false);\r\n    }\r\n\r\n    toString() {\r\n        return CurrencyManager.fromType(this.currency).stringify(this.value);\r\n    }\r\n\r\n    /*\r\n     * Not currently in use\r\n     * totalValue = totalValue.add(somePrice)\r\n     */\r\n    add(otherPrice) {\r\n        let _otherPrice = otherPrice;\r\n        if (otherPrice.currency !== this.currency) {\r\n            _otherPrice = otherPrice.inCurrency(this.currency);\r\n        }\r\n        return new Price(this.value + _otherPrice.value, this.currency);\r\n    }\r\n\r\n    inCurrency(desiredCurrency) {\r\n        if (this.currency === desiredCurrency) {\r\n            return new Price(this.value, this.currency);\r\n        }\r\n        const rate = CurrencyManager.getRate(this.currency, desiredCurrency);\r\n        if (!rate) {\r\n            throw new Error(`Could not establish conversion rate between ${this.currency} and ${desiredCurrency}`);\r\n        }\r\n        return new Price(this.value * rate, desiredCurrency);\r\n    }\r\n\r\n    static parseFromString(str, currencyType = CurrencyManager.storeCurrency) {\r\n        const currency = CurrencyManager.fromType(currencyType);\r\n        let value = currency.valueOf(str);\r\n        if (value !== null) {\r\n            value = new Price(value, currencyType);\r\n        }\r\n        return value;\r\n    }\r\n}\r\n\r\nexport {Price};\r\n","import {SyncedStorage} from \"../../Core/Storage/SyncedStorage\";\r\nimport {Localization} from \"../../Core/Localization/Localization\";\r\nimport {HTML} from \"../../Core/Html/Html\";\r\nimport {Background} from \"./Background\";\r\nimport {User} from \"./User\";\r\nimport {Price} from \"./Price\";\r\nimport {CurrencyManager} from \"./CurrencyManager\";\r\n\r\nclass Prices {\r\n\r\n    constructor() {\r\n        this.appids = [];\r\n        this.subids = [];\r\n        this.bundleids = [];\r\n\r\n        this.priceCallback = null;\r\n        this.bundleCallback = null;\r\n\r\n        this._bundles = [];\r\n    }\r\n\r\n    _getApiParams() {\r\n        const apiParams = {};\r\n\r\n        if (!SyncedStorage.get(\"showallstores\") && SyncedStorage.get(\"stores\").length > 0) {\r\n            apiParams.stores = SyncedStorage.get(\"stores\").join(\",\");\r\n        }\r\n\r\n        const cc = User.storeCountry;\r\n        if (cc) {\r\n            apiParams.cc = cc;\r\n        }\r\n\r\n        apiParams.appids = this.appids.join(\",\");\r\n        apiParams.subids = this.subids.join(\",\");\r\n        apiParams.bundleids = this.bundleids.join(\",\");\r\n\r\n        if (SyncedStorage.get(\"showlowestpricecoupon\")) {\r\n            apiParams.coupon = true;\r\n        }\r\n\r\n        if (!apiParams.appids && !apiParams.subids && !apiParams.bundleids) { return null; }\r\n\r\n        return apiParams;\r\n    }\r\n\r\n    /**\r\n     * @param priceData\r\n     * @param {Price} price\r\n     * @param {string} pricingStr\r\n     */\r\n    _getPricingStrings(priceData, price, pricingStr) {\r\n        let prices = price.toString();\r\n        if (CurrencyManager.customCurrency !== CurrencyManager.storeCurrency) {\r\n            const priceAlt = price.inCurrency(CurrencyManager.storeCurrency);\r\n            prices += ` (${priceAlt.toString()})`;\r\n        }\r\n        const pricesStr = `<span class=\"itad-pricing__price\">${prices}</span>`;\r\n\r\n        let cutStr = \"\";\r\n        if (priceData.cut > 0) {\r\n            cutStr = `<span class=\"itad-pricing__cut\">-${priceData.cut}%</span> `;\r\n        }\r\n\r\n        const storeStr = pricingStr.store.replace(\"__store__\", priceData.store);\r\n        return [pricesStr, cutStr, storeStr];\r\n    }\r\n\r\n    _processPrices(gameid, meta, info) {\r\n        if (!this.priceCallback) { return; }\r\n\r\n        const [type, id] = gameid.split(\"/\");\r\n\r\n        const node = document.createElement(\"div\");\r\n        node.classList.add(\"itad-pricing\");\r\n        node.id = `es_price_${id}`;\r\n\r\n        const pricingStr = Localization.str.pricing;\r\n\r\n        let hasData = false;\r\n        const priceData = info.price;\r\n        const lowestData = info.lowest;\r\n        const bundledCount = info.bundles.count;\r\n        const urlData = info.urls;\r\n\r\n        // Current best\r\n        if (priceData) {\r\n            hasData = true;\r\n\r\n            let lowest;\r\n            let voucherStr = \"\";\r\n            if (SyncedStorage.get(\"showlowestpricecoupon\") && priceData.price_voucher) {\r\n                lowest = new Price(priceData.price_voucher, meta.currency);\r\n\r\n                const voucher = HTML.escape(priceData.voucher);\r\n                voucherStr = `${pricingStr.with_voucher.replace(\r\n                    \"__voucher__\",\r\n                    `<span class=\"itad-pricing__voucher\">${voucher}</span>`\r\n                )} `;\r\n            } else {\r\n                lowest = new Price(priceData.price, meta.currency);\r\n            }\r\n\r\n            lowest = lowest.inCurrency(CurrencyManager.customCurrency);\r\n            const [pricesStr, cutStr, storeStr] = this._getPricingStrings(priceData, lowest, pricingStr);\r\n\r\n            let drmStr = \"\";\r\n            if (priceData.drm.length > 0 && priceData.store !== \"Steam\") {\r\n                drmStr = `<span class=\"itad-pricing__drm\">(${priceData.drm[0]})</span>`;\r\n            }\r\n\r\n            const infoUrl = HTML.escape(urlData.info);\r\n            const storeUrl = HTML.escape(priceData.url.toString());\r\n\r\n            HTML.beforeEnd(node, `<a href=\"${infoUrl}\" target=\"_blank\">${pricingStr.lowest_price}</a>`);\r\n            HTML.beforeEnd(node, pricesStr);\r\n            HTML.beforeEnd(\r\n                node,\r\n                `<a href=\"${storeUrl}\" class=\"itad-pricing__main\" target=\"_blank\">${cutStr}${voucherStr}${storeStr} ${drmStr}</a>`\r\n            );\r\n        }\r\n\r\n        // Historical low\r\n        if (lowestData) {\r\n            hasData = true;\r\n\r\n            const historical = new Price(lowestData.price, meta.currency).inCurrency(CurrencyManager.customCurrency);\r\n            const [pricesStr, cutStr, storeStr] = this._getPricingStrings(lowestData, historical, pricingStr);\r\n            const dateStr = new Date(lowestData.recorded * 1000).toLocaleDateString();\r\n\r\n            const infoUrl = HTML.escape(urlData.history);\r\n\r\n            HTML.beforeEnd(node, `<a href=\"${infoUrl}\" target=\"_blank\">${pricingStr.historical_low}</a>`);\r\n            HTML.beforeEnd(node, pricesStr);\r\n            HTML.beforeEnd(node, `<div class=\"itad-pricing__main\">${cutStr}${storeStr} ${dateStr}</div>`);\r\n        }\r\n\r\n        // times bundled\r\n        if (bundledCount > 0) {\r\n            hasData = true;\r\n\r\n            const bundledUrl = HTML.escape(urlData.bundles || urlData.bundle_history);\r\n            const bundledStr = pricingStr.bundle_count.replace(\"__count__\", bundledCount);\r\n\r\n            HTML.beforeEnd(node, `<a href=\"${bundledUrl}\" target=\"_blank\">${pricingStr.bundled}</a>`);\r\n            HTML.beforeEnd(node, `<div class=\"itad-pricing__bundled\">${bundledStr}</div>`);\r\n        }\r\n\r\n        if (hasData) {\r\n            this.priceCallback(type, id, node);\r\n        }\r\n    }\r\n\r\n    _processBundles(meta, info) {\r\n        if (!this.bundleCallback) { return; }\r\n\r\n        let purchase = \"\";\r\n\r\n        for (const bundle of info.bundles.live) {\r\n            const tiers = bundle.tiers;\r\n\r\n            let endDate;\r\n            if (bundle.expiry) {\r\n                endDate = new Date(bundle.expiry * 1000);\r\n            }\r\n\r\n            const currentDate = new Date().getTime();\r\n            if (endDate && currentDate > endDate) { continue; }\r\n\r\n            const bundleNormalized = JSON.stringify({\r\n                \"page\":  bundle.page || \"\",\r\n                \"title\": bundle.title || \"\",\r\n                \"url\":   bundle.url || \"\",\r\n                \"tiers\": (() => {\r\n                    const sorted = [];\r\n                    for (const t of Object.keys(tiers)) {\r\n                        sorted.push((tiers[t].games || []).sort());\r\n                    }\r\n                    return sorted;\r\n                })(),\r\n            });\r\n\r\n            if (this._bundles.indexOf(bundleNormalized) >= 0) { continue; }\r\n            this._bundles.push(bundleNormalized);\r\n\r\n            if (bundle.page) {\r\n                const bundlePage = Localization.str.buy_package.replace(\"__package__\", `${bundle.page} ${bundle.title}`);\r\n                purchase\r\n                    += `<div class=\"game_area_purchase_game\">\r\n                            <div class=\"game_area_purchase_platform\"></div>\r\n                            <h1>${bundlePage}</h1>`;\r\n            } else {\r\n                const bundleTitle = Localization.str.buy_package.replace(\"__package__\", bundle.title);\r\n                purchase\r\n                    += `<div class=\"game_area_purchase_game_wrapper\">\r\n                            <div class=\"game_area_purchase_game\"></div>\r\n                            <div class=\"game_area_purchase_platform\"></div>\r\n                            <h1>${bundleTitle}</h1>`;\r\n            }\r\n\r\n            if (endDate) {\r\n                purchase += `<p class=\"game_purchase_discount_countdown\">${Localization.str.bundle.offer_ends} ${endDate}</p>`;\r\n            }\r\n\r\n            purchase += '<p class=\"package_contents\">';\r\n\r\n            let bundlePrice;\r\n            const appName = document.querySelector(\".apphub_AppName\").textContent;\r\n\r\n            for (let i = 0; i < tiers.length; ++i) {\r\n                const tierNum = i + 1;\r\n                const tier = tiers[i];\r\n\r\n                purchase += \"<b>\";\r\n                if (tiers.length > 1) {\r\n                    const tierName = tier.note || Localization.str.bundle.tier.replace(\"__num__\", tierNum);\r\n                    const tierPrice = (new Price(tier.price, meta.currency).inCurrency(CurrencyManager.customCurrency))\r\n                        .toString();\r\n\r\n                    purchase += Localization.str.bundle.tier_includes.replace(\"__tier__\", tierName).replace(\"__price__\", tierPrice)\r\n                        .replace(\"__num__\", tier.games.length);\r\n                } else {\r\n                    purchase += Localization.str.bundle.includes.replace(\"__num__\", tier.games.length);\r\n                }\r\n                purchase += \":</b> \";\r\n\r\n                const gameList = tier.games.join(\", \");\r\n                if (gameList.includes(appName)) {\r\n                    purchase += gameList.replace(appName, `<u>${appName}</u>`);\r\n                    bundlePrice = tier.price;\r\n                } else {\r\n                    purchase += gameList;\r\n                }\r\n\r\n                purchase += \"<br>\";\r\n            }\r\n\r\n            purchase += \"</p>\";\r\n            purchase += `<div class=\"game_purchase_action\">\r\n                            <div class=\"game_purchase_action_bg\">\r\n                                <div class=\"btn_addtocart btn_packageinfo\">\r\n                                    <a class=\"btn_blue_steamui btn_medium\" href=\"${bundle.details}\" target=\"_blank\">\r\n                                        <span>${Localization.str.bundle.info}</span>\r\n                                    </a>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"game_purchase_action_bg\">`;\r\n\r\n            if (bundlePrice && bundlePrice > 0) {\r\n                bundlePrice = (new Price(bundlePrice, meta.currency).inCurrency(CurrencyManager.customCurrency))\r\n                    .toString();\r\n                purchase += `<div class=\"game_purchase_price price\" itemprop=\"price\">${bundlePrice}</div>`;\r\n            }\r\n\r\n            purchase += `<div class=\"btn_addtocart\">\r\n                            <a class=\"btn_green_steamui btn_medium\" href=\"${bundle.url}\" target=\"_blank\">\r\n                                <span>${Localization.str.buy}</span>\r\n                            </a>\r\n                        </div></div></div></div>`;\r\n        }\r\n\r\n        if (purchase) {\r\n            this.bundleCallback(purchase);\r\n        }\r\n    }\r\n\r\n    load() {\r\n        const apiParams = this._getApiParams();\r\n        if (!apiParams) { return; }\r\n\r\n        Background.action(\"prices\", apiParams).then(response => {\r\n            const meta = response[\".meta\"];\r\n\r\n            for (const [gameid, info] of Object.entries(response.data)) {\r\n                this._processPrices(gameid, meta, info);\r\n                this._processBundles(meta, info);\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nexport {Prices};\r\n","import {SyncedStorage} from \"./Core/Storage/SyncedStorage\";\r\n\r\nlet initialized = false;\r\n\r\n/**\r\n * DOMPurify setup\r\n * @see https://github.com/cure53/DOMPurify\r\n */\r\nexport default function() {\r\n\r\n    if (initialized) { return; }\r\n    initialized = true;\r\n\r\n    const allowOpenInNewTab = SyncedStorage.get(\"openinnewtab\");\r\n\r\n    /*\r\n     * NOTE FOR ADDON REVIEWER:\r\n     * We are modifying default DOMPurify settings to allow other protocols in URLs\r\n     * and to allow links to safely open in new tabs.\r\n     *\r\n     * We took the original Regex and aded chrome-extension://, moz-extension:// and steam://\r\n     * First two are needed for linking local resources from extension,\r\n     * steam:// protocol is used by Steam store to open their own client (e.g. when you want to launch a game).\r\n     *\r\n     * The addition of the `target` attribute to the allowed attributes is done in order to be able to open links in a new tab.\r\n     * We only allow target=\"_blank\" while adding rel=\"noreferrer noopener\" to prevent child window to access window.opener\r\n     * as described in https://www.jitbit.com/alexblog/256-targetblank---the-most-underestimated-vulnerability-ever/\r\n     */\r\n\r\n    const purifyConfig = {\r\n        \"ALLOWED_URI_REGEXP\": /^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|chrome-extension|moz-extension|steam):|[^a-z]|[a-z+.-]+(?:[^a-z+.\\-:]|$))/i\r\n    };\r\n\r\n    if (allowOpenInNewTab) {\r\n        purifyConfig.ADD_ATTR = [\"target\"];\r\n\r\n        DOMPurify.addHook(\"uponSanitizeAttribute\", (node, data) => {\r\n            if (data.attrName === \"target\") {\r\n                if (data.attrValue === \"_blank\") {\r\n                    node.setAttribute(\"rel\", \"noreferrer noopener\");\r\n                } else {\r\n                    data.keepAttr = false;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    DOMPurify.setConfig(purifyConfig);\r\n}\r\n","import {Info, LocalStorage, Localization, SyncedStorage} from \"../../modulesCore\";\r\nimport {\r\n    AugmentedSteam, Background,\r\n    CurrencyManager,\r\n    DOMHelper,\r\n    ITAD, Messenger, ProgressBar,\r\n    UpdateHandler,\r\n    User\r\n} from \"../modulesContent\";\r\nimport {SteamFacade} from \"../Modules/SteamFacade\";\r\nimport setup from \"../../setup\";\r\nimport config from \"../../config\";\r\n\r\n/**\r\n * Event handler for uncaught Background errors\r\n */\r\nfunction unhandledrejection(ev) {\r\n    const err = ev.reason;\r\n    if (!err || !err.error) { return; } // Not a background error\r\n    ev.preventDefault();\r\n    ev.stopPropagation();\r\n    console.group(\"An error occurred in the background context.\");\r\n    console.error(err.localStack);\r\n    console.error(err.stack);\r\n    console.groupEnd();\r\n}\r\nwindow.addEventListener(\"unhandledrejection\", unhandledrejection);\r\n\r\n/**\r\n *  Inject the Messenger, SteamFacade class into the DOM, providing the same interface for the page context side\r\n */\r\nDOMHelper.insertScript({\"content\": `window.Messenger = ${Messenger.toString()}`});\r\nDOMHelper.insertScript({\"content\": `window.SteamFacade = ${SteamFacade.toString()}`});\r\n\r\nBackground.registerErrorHandler(({name, msg}) => {\r\n    if (name !== \"LoginError\") { return false; }\r\n\r\n    AugmentedSteam.addLoginWarning(msg);\r\n    ProgressBar.finishRequest();\r\n    return true;\r\n});\r\n\r\nclass Page {\r\n\r\n    /*\r\n     * NOTE: use cautiously!\r\n     * Run script in the context of the current tab\r\n     */\r\n    static runInPageContext(fun, args, withPromise) {\r\n        const script = document.createElement(\"script\");\r\n        let promise;\r\n        const argsString = Array.isArray(args) ? JSON.stringify(args) : \"[]\";\r\n\r\n        if (withPromise) {\r\n            const msgId = `msg_${++Page._msgCounter}`;\r\n            promise = Messenger.onMessage(msgId);\r\n            script.textContent = `(async () => { Messenger.postMessage(\"${msgId}\", await (${fun})(...${argsString})); })();`;\r\n        } else {\r\n            script.textContent = `(${fun})(...${argsString});`;\r\n        }\r\n\r\n        document.documentElement.appendChild(script);\r\n        script.parentNode.removeChild(script);\r\n        return promise;\r\n    }\r\n\r\n    async run(ContextClass) {\r\n        if (!document.getElementById(\"global_header\")) { return; }\r\n\r\n        try {\r\n            // TODO What errors can be \"suppressed\" here?\r\n            try {\r\n                await SyncedStorage;\r\n                setup();\r\n            } catch (err) {\r\n                console.error(err);\r\n            }\r\n\r\n            await Promise.all([LocalStorage, Localization, User, CurrencyManager]);\r\n        } catch (err) {\r\n            console.group(\"Augmented Steam initialization\");\r\n            console.error(\"Failed to initiliaze Augmented Steam\");\r\n            console.error(err);\r\n            console.groupEnd();\r\n            return;\r\n        }\r\n\r\n        console.log(\r\n            `%c Augmented %cSteam v${Info.version} %c ${config.PublicHost}`,\r\n            \"background: #000000; color: #046eb2\",\r\n            \"background: #000000; color: #ffffff\",\r\n            \"\",\r\n        );\r\n\r\n        ProgressBar.create();\r\n        ProgressBar.loading();\r\n        AugmentedSteam.init();\r\n        UpdateHandler.checkVersion(AugmentedSteam.clearCache);\r\n        ITAD.create();\r\n        this._pageSpecificFeatures();\r\n\r\n        const context = new ContextClass();\r\n        context.applyFeatures();\r\n    }\r\n\r\n    _pageSpecificFeatures() {\r\n        // left for overrides\r\n    }\r\n}\r\nPage._msgCounter = 0;\r\n\r\nexport {Page};\r\n","\r\n/* eslint-disable camelcase,no-undef,new-cap */\r\n\r\n// noinspection JSUnresolvedFunction,JSUnresolvedVariable\r\nclass SteamFacade {\r\n\r\n    // variables\r\n\r\n    static global(name) {\r\n        return window[name];\r\n    }\r\n\r\n    static globalSet(name, value) {\r\n        window[name] = value;\r\n    }\r\n\r\n    // dialogs\r\n\r\n    static showDialog(strTitle, strDescription, rgModalParams) {\r\n        ShowDialog(strTitle, strDescription, rgModalParams);\r\n    }\r\n\r\n    static showConfirmDialog(strTitle, strDescription, strOKButton, strCancelButton, strSecondaryActionButton) {\r\n        return ShowConfirmDialog(strTitle, strDescription, strOKButton, strCancelButton, strSecondaryActionButton);\r\n    }\r\n\r\n    static showAlertDialog(strTitle, strDescription, strOKButton) {\r\n        return ShowAlertDialog(strTitle, strDescription, strOKButton);\r\n    }\r\n\r\n    static showBlockingWaitDialog(strTitle, strDescription) {\r\n        return ShowBlockingWaitDialog(strTitle, strDescription);\r\n    }\r\n\r\n    static showNicknameModal() {\r\n        return ShowNicknameModal();\r\n    }\r\n\r\n    static dismissActiveModal() {\r\n        CModal.DismissActiveModal();\r\n    }\r\n\r\n    // menu\r\n\r\n    static showMenu(elemLink, elemPopup, align, valign, bLinkHasBorder) {\r\n        return ShowMenu(elemLink, elemPopup, align, valign, bLinkHasBorder);\r\n    }\r\n\r\n    static hideMenu(elemLink, elemPopup) {\r\n        return HideMenu(elemLink, elemPopup);\r\n    }\r\n\r\n    // app pages\r\n\r\n    static collapseLongStrings(selector) {\r\n        return CollapseLongStrings(selector);\r\n    }\r\n\r\n    static adjustVisibleAppTags(selector) {\r\n        return AdjustVisibleAppTags($J(selector));\r\n    }\r\n\r\n    static updatePlaytimeFilterValues(hourMin, hourMax) {\r\n        return UpdatePlaytimeFilterValues(hourMin, hourMax);\r\n    }\r\n\r\n    // events\r\n\r\n    static bindAutoFlyoutEvents() {\r\n        return BindAutoFlyoutEvents();\r\n    }\r\n\r\n    static sliderOnChange(value) {\r\n        return g_player.SliderOnChange(value);\r\n    }\r\n\r\n    // dynamic store\r\n\r\n    static dynamicStoreInvalidateCache() {\r\n        return GDynamicStore.InvalidateCache();\r\n    }\r\n\r\n    static dynamicStoreDecorateItems(selector, bForceRecalculate) {\r\n        return GDynamicStore.DecorateDynamicItems($J(selector), bForceRecalculate);\r\n    }\r\n\r\n    static onDynamicStoreReady(callback) {\r\n        return GDynamicStore.OnReady(callback);\r\n    }\r\n\r\n    static storeItemDataBindHover(selector, unAppID, unPackageID, unBundleID, rgAdditionalParams) {\r\n        GStoreItemData.BindHoverEvents($J(selector), unAppID, unPackageID, unBundleID, rgAdditionalParams);\r\n    }\r\n\r\n    // tooltips\r\n\r\n    static vTooltip(selector, isHtml = false) {\r\n        const isStore = window.location.host === \"store.steampowered.com\";\r\n\r\n        $J(selector).v_tooltip({\r\n            \"tooltipClass\": isStore ? \"store_tooltip\" : \"community_tooltip\",\r\n            \"dataName\": isHtml ? \"tooltipHtml\" : \"tooltipText\",\r\n            \"defaultType\": isHtml ? \"html\" : \"text\",\r\n            \"replaceExisting\": false\r\n        });\r\n    }\r\n\r\n    // market\r\n\r\n    static calculateFeeAmount(amount, publisherFee) {\r\n        return CalculateFeeAmount(amount, publisherFee);\r\n    }\r\n\r\n    static vCurrencyFormat(amount, currencyCode) {\r\n        return v_currencyformat(amount, currencyCode);\r\n    }\r\n\r\n    // friends\r\n\r\n    static toggleManageFriends() {\r\n        return ToggleManageFriends();\r\n    }\r\n\r\n    static openFriendChatInWebChat(chatId) {\r\n        return OpenFriendChatInWebChat(chatId);\r\n    }\r\n\r\n    // community\r\n\r\n    static submitGuide() {\r\n        return SubmitGuide();\r\n    }\r\n\r\n    static initMiniprofileHovers() {\r\n        return InitMiniprofileHovers();\r\n    }\r\n\r\n    static inviteUserToGroup(Modal, groupID, steamIDInvitee) {\r\n        return InviteUserToGroup(Modal, groupID, steamIDInvitee);\r\n    }\r\n\r\n    static getCheckedAccounts(selector) {\r\n        return GetCheckedAccounts(selector);\r\n    }\r\n\r\n    static execFriendAction(action, navid) {\r\n        return ExecFriendAction(action, navid);\r\n    }\r\n\r\n    static scrollOffsetForceRecalc() {\r\n        CScrollOffsetWatcher.ForceRecalc();\r\n    }\r\n\r\n    static vSetCookie(strCookieName, strValue, expiryInDays, path) {\r\n        V_SetCookie(strCookieName, strValue, expiryInDays, path);\r\n    }\r\n\r\n    static checkAgeGateSubmit(callbackFunc) {\r\n        CheckAgeGateSubmit(callbackFunc);\r\n    }\r\n\r\n    static loadImageGroupOnScroll(elTarget, strGroup) {\r\n        LoadImageGroupOnScroll(elTarget, strGroup);\r\n    }\r\n\r\n    static showModalContent(url, titleBarText, titleBarURL, sizeToFit) {\r\n        ShowModalContent(url, titleBarText, titleBarURL, sizeToFit);\r\n    }\r\n\r\n    // inventory\r\n\r\n    static firstPage() {\r\n        return InventoryFirstPage();\r\n    }\r\n\r\n    static lastPage() {\r\n        return InventoryLastPage();\r\n    }\r\n\r\n    static goToPage() {\r\n        return InventoryGoToPage();\r\n    }\r\n\r\n    static reloadCommunityInventory() {\r\n        return ReloadCommunityInventory();\r\n    }\r\n\r\n    static getMarketHashName(itemDesc) {\r\n        return GetMarketHashName(itemDesc);\r\n    }\r\n\r\n    static zoomYear() {\r\n        pricehistory_zoomDays(g_plotPriceHistory, g_timePriceHistoryEarliest, g_timePriceHistoryLatest, 365);\r\n    }\r\n\r\n    static zoomYearForSellDialog() {\r\n        pricehistory_zoomDays(SellItemDialog.m_plotPriceHistory, SellItemDialog.m_timePriceHistoryEarliest, SellItemDialog.m_timePriceHistoryLatest, 365);\r\n    }\r\n\r\n    // selections\r\n\r\n    static updateSelection() {\r\n        return UpdateSelection();\r\n    }\r\n\r\n    static selectAll() {\r\n        return SelectAll();\r\n    }\r\n\r\n    static selectNone() {\r\n        return SelectNone();\r\n    }\r\n\r\n    static selectInverse() {\r\n        return SelectInverse();\r\n    }\r\n\r\n\r\n    // jQuery functions\r\n\r\n    static jq(selector) {\r\n        return $J(selector);\r\n    }\r\n\r\n    static jqOnClick(selector, callback) {\r\n        $J(selector).on(\"click\", callback);\r\n    }\r\n\r\n    static jqAjax(settings) {\r\n        return $J.ajax(settings);\r\n    }\r\n\r\n    static jqGet(url, settings) {\r\n        return $J.get(url, settings);\r\n    }\r\n\r\n    static jqPost(url, settings) {\r\n        return $J.post(url, settings);\r\n    }\r\n\r\n    static jqTrigger(selector, eventName) {\r\n        return $J(selector).trigger(eventName);\r\n    }\r\n}\r\n\r\nexport {SteamFacade};\r\n","import {Version} from \"../../Core/Version\";\r\nimport {SyncedStorage} from \"../../Core/Storage/SyncedStorage\";\r\nimport {Info} from \"../../Core/Info\";\r\nimport {ExtensionResources} from \"../../Core/ExtensionResources\";\r\nimport {Localization} from \"../../Core/Localization/Localization\";\r\nimport {BackgroundSimple} from \"../../Core/BackgroundSimple\";\r\nimport {Background} from \"./Background\";\r\nimport {LocalStorage} from \"../../Core/Storage/LocalStorage\";\r\nimport {ITAD} from \"./ITAD\";\r\nimport {Page} from \"../Features/Page\";\r\n\r\nclass UpdateHandler {\r\n\r\n    static async checkVersion(onUpdate) {\r\n        const lastVersion = Version.fromString(SyncedStorage.get(\"version\"));\r\n        const currentVersion = Version.fromString(Info.version);\r\n\r\n        if (currentVersion.isAfter(lastVersion)) {\r\n\r\n            let changelogPromise = Promise.resolve();\r\n            if (SyncedStorage.get(\"version_show\")) {\r\n                changelogPromise = this._showChangelog().catch(err => { console.error(\"Failed to show changelog: %o\", err); });\r\n            }\r\n\r\n            await Promise.all([\r\n                changelogPromise,\r\n                this._migrateSettings(lastVersion),\r\n                onUpdate(),\r\n            ]);\r\n        }\r\n\r\n        SyncedStorage.set(\"version\", Info.version);\r\n    }\r\n\r\n    static async _showChangelog() {\r\n\r\n        const changelog = await ExtensionResources.getJSON(\"changelog.json\");\r\n        const html = changelog[Info.version];\r\n        if (!html) {\r\n            throw new Error(`Can't find changelog for version ${Info.version}`);\r\n        }\r\n\r\n        const logo = ExtensionResources.getURL(\"img/logo/as128.png\");\r\n        const githubChanges = `<p><a href=\"https://github.com/IsThereAnyDeal/AugmentedSteam/compare/v${SyncedStorage.get(\"version\")}...v${Info.version}\">All changes on GitHub</a></p>`;\r\n        const dialog = `<div class=\"es_changelog\"><img src=\"${logo}\"><div>${html}${githubChanges}</div></div>`;\r\n\r\n        const connectBtn = document.querySelector(\"#itad_connect\");\r\n        function itadConnected() { connectBtn.replaceWith(\"✓\"); }\r\n\r\n        Page.runInPageContext(\r\n            (updatedStr, dialog) => {\r\n                window.SteamFacade.showAlertDialog(updatedStr, dialog);\r\n            },\r\n            [Localization.str.update.updated.replace(\"__version__\", Info.version), dialog]\r\n        );\r\n\r\n        if (Version.fromString(Info.version).isSame(new Version(1, 4))) {\r\n\r\n            if (await BackgroundSimple.action(\"itad.isconnected\")) {\r\n                itadConnected();\r\n            } else {\r\n                connectBtn.addEventListener(\"click\", async() => {\r\n                    await BackgroundSimple.action(\"itad.authorize\");\r\n                    ITAD.create();\r\n                    itadConnected();\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    static _migrateSettings(oldVersion) {\r\n\r\n        if (oldVersion.isSameOrBefore(\"1.3.1\")) {\r\n            BackgroundSimple.action(\"cache.clear\");\r\n\r\n            SyncedStorage.set(\"horizontalscrolling\", SyncedStorage.get(\"horizontalmediascrolling\"));\r\n            SyncedStorage.remove(\"horizontalmediascrolling\");\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"1.4\")) {\r\n            SyncedStorage.remove(\"show_sysreqcheck\");\r\n        }\r\n\r\n        if (oldVersion.isSame(\"1.4\")) {\r\n            Background.action(\"migrate.notesToSyncedStorage\");\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"1.4.1\")) {\r\n            SyncedStorage.set(\"profile_steamid\", SyncedStorage.get(\"profile_permalink\"));\r\n            SyncedStorage.remove(\"profile_permalink\");\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"1.4.3\")) {\r\n            SyncedStorage.remove(\"contscroll\");\r\n            Background.action(\"logout\");\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"1.4.7\")) {\r\n            const emoticons = LocalStorage.get(\"fav_emoticons\");\r\n            if (Array.isArray(emoticons)) {\r\n                SyncedStorage.set(\"fav_emoticons\", emoticons);\r\n            }\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"2.0.0\")) {\r\n            SyncedStorage.remove(\"showfakeccwarning\");\r\n            SyncedStorage.remove(\"hideaboutlinks\");\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"2.0.1\")) {\r\n            SyncedStorage.remove(\"hide_dlcunownedgames\");\r\n            SyncedStorage.remove(\"hide_wishlist\");\r\n            SyncedStorage.remove(\"hide_cart\");\r\n            SyncedStorage.remove(\"hide_notdiscounted\");\r\n            SyncedStorage.remove(\"hide_mixed\");\r\n            SyncedStorage.remove(\"hide_negative\");\r\n            SyncedStorage.remove(\"hide_priceabove\");\r\n            SyncedStorage.remove(\"priceabove_value\");\r\n            SyncedStorage.remove(\"hide_owned\");\r\n            SyncedStorage.remove(\"hide_ignored\");\r\n            SyncedStorage.remove(\"highlight_notdiscounted\");\r\n\r\n            SyncedStorage.remove(\"showallfriendsthatown\");\r\n\r\n            if (SyncedStorage.has(\"showusernotes\")) {\r\n                const val = SyncedStorage.get(\"showusernotes\");\r\n                SyncedStorage.set(\"user_notes_app\", val);\r\n                SyncedStorage.set(\"user_notes_wishlist\", val);\r\n                SyncedStorage.remove(\"showusernotes\");\r\n            }\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"2.1.0\")) {\r\n            SyncedStorage.remove(\"showcomparelinks\");\r\n\r\n            const links = SyncedStorage.get(\"profile_custom_link\");\r\n            for (const link of links) {\r\n                if (link.url && !link.url.includes(\"[ID]\")) {\r\n                    link.url += \"[ID]\";\r\n                }\r\n            }\r\n            SyncedStorage.set(\"profile_custom_link\", links);\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"2.2.1\")) {\r\n            Background.action(\"migrate.cachestorage\");\r\n        }\r\n    }\r\n}\r\n\r\nexport {UpdateHandler};\r\n","import {HTML, LocalStorage, Localization} from \"../../../modulesCore\";\r\nimport {ContextType, Feature} from \"../../modulesContent\";\r\nimport {Page} from \"../Page\";\r\n\r\nexport default class FMediaExpander extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        this._details = document.querySelector(\"#game_highlights .rightcol, .workshop_item_header .col_right\");\r\n        return this._details !== null;\r\n    }\r\n\r\n    apply() {\r\n        HTML.beforeEnd(\"#highlight_player_area\",\r\n            `<div class=\"es_slider_toggle btnv6_blue_hoverfade btn_medium\">\r\n                <div data-tooltip-text=\"${Localization.str.expand_slider}\" class=\"es_slider_expand\"><i class=\"es_slider_toggle_icon\"></i></div>\r\n                <div data-tooltip-text=\"${Localization.str.contract_slider}\" class=\"es_slider_contract\"><i class=\"es_slider_toggle_icon\"></i></div>\r\n            </div>`);\r\n\r\n        this._details.classList.add(\"as-side-details\");\r\n\r\n        this._sliderToggle = document.querySelector(\".es_slider_toggle\");\r\n        this._sliderToggle.addEventListener(\"click\", () => { this._toggleView(); });\r\n\r\n        if (LocalStorage.get(\"expand_slider\")) {\r\n            this._toggleView();\r\n        }\r\n\r\n        /*\r\n         * Prevent the slider toggle from overlapping a sketchfab model's \"X\"\r\n         * Example: https://steamcommunity.com/sharedfiles/filedetails/?id=606009216\r\n         */\r\n        const sketchfabNode = document.querySelector(\".highlight_sketchfab_model\");\r\n        if (sketchfabNode) {\r\n            const container = document.getElementById(\"highlight_player_area\");\r\n            container.addEventListener(\"mouseenter\", () => {\r\n                if (sketchfabNode.style.display === \"none\") { return; }\r\n                this._sliderToggle.style.top = \"32px\";\r\n            });\r\n            container.addEventListener(\"mouseleave\", () => {\r\n                this._sliderToggle.style.top = null;\r\n            });\r\n        }\r\n    }\r\n\r\n    _toggleView() {\r\n\r\n        const expand = !this._sliderToggle.classList.contains(\"es_expanded\");\r\n\r\n        LocalStorage.set(\"expand_slider\", expand);\r\n\r\n        for (const node of document.querySelectorAll(\r\n            \".es_slider_toggle, #game_highlights, .workshop_item_header, .as-side-details\"\r\n        )) {\r\n            node.classList.toggle(\"es_expanded\", expand);\r\n        }\r\n\r\n        this._details.addEventListener(\"transitionend\", () => {\r\n\r\n            if (this.context.type === ContextType.APP) {\r\n                this._handleApp(expand);\r\n            } else if (this.context.type === ContextType.SHARED_FILES) {\r\n                this._handleWorkshop(expand);\r\n            }\r\n\r\n            /*\r\n             * The transitionend event might not get fired when a transition is triggered immediately after appending it to the DOM\r\n             * (which happens here).\r\n             * This mostly happens when the page is still loading, I assume there is a race condition with the rendering calls.\r\n             * https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Transitions/Using_CSS_transitions#javascript_examples\r\n             */\r\n            setTimeout(() => { this._details.style.opacity = null; }, 0);\r\n        }, {\"once\": true});\r\n\r\n        this._details.style.opacity = 0;\r\n    }\r\n\r\n    _handleApp(expand) {\r\n        const clsList = this._details.classList;\r\n        clsList.toggle(\"block\", expand);\r\n        clsList.toggle(\"responsive_apppage_details_left\", expand);\r\n        clsList.toggle(\"rightcol\", !expand);\r\n\r\n        if (expand) {\r\n            document.querySelector(\".rightcol.game_meta_data\").insertAdjacentElement(\"afterbegin\", this._details);\r\n        } else {\r\n            document.getElementById(\"game_highlights\").insertAdjacentElement(\"afterbegin\", this._details);\r\n        }\r\n\r\n        Page.runInPageContext(() => {\r\n            window.SteamFacade.adjustVisibleAppTags(\".popular_tags\");\r\n\r\n            /*\r\n             * Triggers the adjustment of the slider scroll bar.\r\n             * https://github.com/SteamDatabase/SteamTracking/blob/ad4e85261f2322eae0b0125e46d7d753bf755730/store.steampowered.com/public/javascript/gamehighlightplayer.js#L101\r\n             */\r\n            window.SteamFacade.jqTrigger(window, \"resize.GameHighlightPlayer\");\r\n        });\r\n    }\r\n\r\n    _handleWorkshop(expand) {\r\n\r\n        this._details.classList.toggle(\"panel\", expand);\r\n\r\n        if (expand) {\r\n            document.querySelector(\".sidebar\").insertAdjacentElement(\"afterbegin\", this._details);\r\n        } else {\r\n            document.querySelector(\".highlight_ctn\").insertAdjacentElement(\"afterend\", this._details);\r\n        }\r\n\r\n        this._details.addEventListener(\"transitionend\", () => {\r\n\r\n            // https://github.com/SteamDatabase/SteamTracking/blob/8e19832027cf425b5db71c09c878739b5630c66a/steamcommunity.com/public/javascript/workshop_previewplayer.js#L123\r\n            Page.runInPageContext(() => {\r\n                const f = window.SteamFacade;\r\n                const player = f.global(\"g_player\");\r\n\r\n                // g_player is null when the shared file only has one screenshot and therefore no highlight strip\r\n                if (player === null) { return; }\r\n\r\n                const elemSlider = f.global(\"$\")(\"highlight_slider\");\r\n                const nSliderWidth = player.m_elemStripScroll.getWidth() - player.m_elemStrip.getWidth();\r\n\r\n                // Shared files with too few screenshots won't have a slider\r\n                if (typeof player.slider !== \"undefined\") {\r\n                    player.slider.dispose();\r\n                }\r\n\r\n                if (nSliderWidth > 0) {\r\n                    const newValue = player.slider.value * (nSliderWidth / player.slider.range.end);\r\n\r\n                    player.slider = new (f.global(\"Control\").Slider)(\r\n                        elemSlider.down(\".handle\"),\r\n                        elemSlider,\r\n                        {\r\n                            \"range\": f.global(\"$R\")(0, nSliderWidth),\r\n                            \"sliderValue\": newValue,\r\n                            \"onSlide\": player.SliderOnChange.bind(player),\r\n                            \"onChange\": player.SliderOnChange.bind(player),\r\n                        }\r\n                    );\r\n\r\n                    f.sliderOnChange(newValue);\r\n                } else {\r\n                    elemSlider.hide();\r\n                }\r\n            });\r\n        }, {\"once\": true});\r\n    }\r\n}\r\n","import {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Feature, Prices} from \"../../../modulesContent\";\r\n\r\nexport default class FITADPrices extends Feature {\r\n    checkPrerequisites() {\r\n        return SyncedStorage.get(\"showlowestprice\");\r\n    }\r\n\r\n    apply() {\r\n        const prices = new Prices();\r\n\r\n        prices.subids = this.context.getAllSubids();\r\n\r\n        prices.bundleids = [];\r\n        for (const node of document.querySelectorAll(\"[data-ds-bundleid]\")) {\r\n            prices.bundleids.push(node.dataset.dsBundleid);\r\n        }\r\n\r\n        prices.priceCallback = function(type, id, contentNode) {\r\n            let node;\r\n            let placement = \"beforebegin\";\r\n            if (type === \"sub\") {\r\n                node = document.querySelector(`input[name=subid][value=\"${id}\"]`).closest(\".game_area_purchase_game\");\r\n            } else if (type === \"bundle\") {\r\n                node = document.querySelector(`.game_area_purchase_game_wrapper[data-ds-bundleid=\"${id}\"]`);\r\n                if (node) {\r\n                    placement = \"afterbegin\";\r\n\r\n                    // Move any \"Complete your Collection!\" banner out of the way\r\n                    const banner = node.querySelector(\".ds_completetheset\");\r\n                    const newParent = node.querySelector(\".game_area_purchase_game\");\r\n                    if (banner && newParent) {\r\n                        newParent.appendChild(banner);\r\n                    }\r\n                } else {\r\n                    node = document.querySelector(`.game_area_purchase_game[data-ds-bundleid=\"${id}\"]`);\r\n                }\r\n            }\r\n\r\n            node.insertAdjacentElement(placement, contentNode);\r\n        };\r\n\r\n        prices.bundleCallback = function(html) {\r\n\r\n            HTML.afterEnd(\"#game_area_purchase\",\r\n                `<h2 class=\"gradientbg es_external_icon\">${Localization.str.bundle.header}</h2>\r\n                ${html}`);\r\n        };\r\n\r\n        prices.load();\r\n    }\r\n}\r\n","import {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {ContextType, Feature} from \"../../../modulesContent\";\r\n\r\nexport default class FDRMWarnings extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        if (!SyncedStorage.get(\"showdrm\")) { return false; }\r\n\r\n        // Prevent false-positives\r\n        return (this.context.appid !== 216900 // Resident Evil 5, at Capcom's request\r\n            && this.context.appid !== 1157970 // Special K\r\n        );\r\n    }\r\n\r\n    apply() {\r\n\r\n        const isAppPage = this.context.type === ContextType.APP;\r\n\r\n        function getTextFromDRMNotices() {\r\n            if (!isAppPage) { return []; }\r\n\r\n            const value = [];\r\n            for (const node of document.querySelectorAll(\".DRM_notice\")) {\r\n                if (!node.querySelector(\"a[onclick^=ShowEULA]\")) {\r\n                    value.push(node.textContent);\r\n                }\r\n            }\r\n            return value;\r\n        }\r\n\r\n        function getTextFromGameDetails() {\r\n            if (isAppPage) { return \"\"; } // Only bundle/sub pages have DRM info in game details\r\n\r\n            let value = \"\";\r\n            let node = document.querySelector(\".language_list\");\r\n            if (!node) { return \"\"; }\r\n            node = node.nextSibling;\r\n            while (node !== null) {\r\n                value += node.textContent;\r\n                node = node.nextSibling;\r\n            }\r\n            return value;\r\n        }\r\n\r\n        let text = \"\";\r\n        for (const node of document.querySelectorAll(\".game_area_sys_req, #game_area_legal\")) {\r\n            text += node.textContent;\r\n        }\r\n\r\n        const drmNotices = getTextFromDRMNotices();\r\n        text += drmNotices.join(\"\");\r\n\r\n        const gameDetails = getTextFromGameDetails();\r\n        text += gameDetails;\r\n\r\n        text = text.toLowerCase();\r\n\r\n        // Games for Windows Live detection\r\n        const gfwl\r\n                = text.includes(\"games for windows live\")\r\n            || text.includes(\"games for windows - live\")\r\n            || text.includes(\"online play requires log-in to games for windows\")\r\n            || text.includes(\"installation of the games for windows live software\")\r\n            || text.includes(\"multiplayer play and other live features included at no charge\")\r\n            || text.includes(\"www.gamesforwindows.com/live\");\r\n\r\n        // Ubisoft Uplay detection\r\n        const uplay\r\n                = text.includes(\"uplay\")\r\n            || text.includes(\"ubisoft account\");\r\n\r\n        // Securom detection\r\n        const securom = text.includes(\"securom\");\r\n\r\n        // Tages detection\r\n        const tages\r\n                = text.match(/\\b(tages|solidshield)\\b/)\r\n            && !text.match(/angebote des tages/);\r\n\r\n        // Stardock account detection\r\n        const stardock = text.includes(\"stardock account\");\r\n\r\n        // Rockstar social club detection\r\n        const rockstar\r\n                = text.includes(\"rockstar social club\")\r\n            || text.includes(\"rockstar games social club\");\r\n\r\n        // Kalypso Launcher detection\r\n        const kalypso = text.includes(\"requires a kalypso account\");\r\n\r\n        // Denuvo Antitamper detection\r\n        const denuvo = text.includes(\"denuvo\");\r\n\r\n        // EA origin detection\r\n        const origin = text.includes(\"origin client\");\r\n\r\n        // Microsoft Xbox Live account detection\r\n        const xbox = text.includes(\"xbox live\");\r\n\r\n        const drmNames = [\r\n            [gfwl, \"Games for Windows Live\"],\r\n            [uplay, \"Ubisoft Connect\"],\r\n            [securom, \"SecuROM\"],\r\n            [tages, \"Tages\"],\r\n            [stardock, \"Stardock Account required\"],\r\n            [rockstar, \"Rockstar Social Club\"],\r\n            [kalypso, \"Kalypso Launcher\"],\r\n            [denuvo, \"Denuvo Anti-Tamper\"],\r\n            [origin, \"EA Origin\"],\r\n            [xbox, \"Microsoft Xbox Live\"],\r\n        ].flatMap(([enabled, name]) => { return enabled ? [name] : []; });\r\n\r\n        let drmString;\r\n        if (drmNames.length > 0) {\r\n            drmString = isAppPage ? Localization.str.drm_third_party : Localization.str.drm_third_party_sub;\r\n            drmString = drmString.replace(\"__drmlist__\", `(${drmNames.join(\", \")})`);\r\n        } else {\r\n            const regex = /\\b(drm|account|steam)\\b/i;\r\n\r\n            // Display the first \"DRM Notice\" or the text in game details that matches DRM/3rd party accounts\r\n            if (isAppPage) {\r\n                drmString = drmNotices.find(text => regex.test(text));\r\n            } else {\r\n                drmString = regex.test(gameDetails) && gameDetails;\r\n            }\r\n        }\r\n\r\n        if (drmString) {\r\n            const html = `<div class=\"es_drm_warning\"><span>${drmString}</span></div>`;\r\n\r\n            // Insert the notice after the \"Buy this game as a gift for a friend\" note if present\r\n            const node = document.querySelector(\"#game_area_purchase .game_area_description_bodylabel\");\r\n            if (node) {\r\n                HTML.afterEnd(node, html);\r\n            } else {\r\n                HTML.afterBegin(\"#game_area_purchase, #game_area_purchase_top\", html);\r\n            }\r\n        }\r\n    }\r\n}\r\n","import {HTML, HTMLParser, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {ContextType, Feature} from \"../../../modulesContent\";\r\n\r\nexport default class FExtraLinks extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        const context = this.context;\r\n\r\n        if (context.type === ContextType.APP) {\r\n            this._type = \"app\";\r\n            this._gameid = context.appid;\r\n\r\n            if (context.isErrorPage) {\r\n                this._node = document.querySelector(\"#error_box\");\r\n            } else {\r\n                this._node = document.querySelector(\"#shareEmbedRow\");\r\n            }\r\n        } else if (context.type === ContextType.SUB) {\r\n            this._type = \"sub\";\r\n            this._gameid = context.subid;\r\n            this._node = document.querySelector(\".share\").parentNode;\r\n        } else if (context.type === ContextType.BUNDLE) {\r\n            this._type = \"bundle\";\r\n            this._gameid = context.bundleid;\r\n            this._node = document.querySelector(\".share, .rightcol .game_details\");\r\n        }\r\n\r\n        if (!this._node) {\r\n            console.warn(\"Couldn't find element to insert extra links\");\r\n        }\r\n\r\n        return this._node !== null && (\r\n\r\n            // Even if the user doesn't want to see any extra links, the position of the share/embed links is changed\r\n            this._type === \"app\"\r\n\r\n            // Preferences for links shown on all pages\r\n            || (SyncedStorage.get(\"showbartervg\")\r\n            || SyncedStorage.get(\"showsteamdb\")\r\n            || SyncedStorage.get(\"showitadlinks\"))\r\n        );\r\n    }\r\n\r\n    apply() {\r\n\r\n        const isAppPage = this._type === \"app\";\r\n        const appName = typeof this.context.appName === \"string\" && HTMLParser.clearSpecialSymbols(this.context.appName);\r\n\r\n        // Note: Links should be rendered in the same order as displayed on the options page\r\n        const links = [\r\n            {\r\n                \"iconClass\": \"itad_ico\",\r\n                \"link\": `https://isthereanydeal.com/steam/${this._type}/${this._gameid}/`,\r\n                \"text\": Localization.str.view_on_website.replace(\"__website__\", \"IsThereAnyDeal\"),\r\n                \"enabled\": SyncedStorage.get(\"showitadlinks\"),\r\n            },\r\n            {\r\n                \"iconClass\": \"steamdb_ico\",\r\n                \"link\": `https://steamdb.info/${this._type}/${this._gameid}/`,\r\n                \"text\": Localization.str.view_on_website.replace(\"__website__\", \"SteamDB\"),\r\n                \"enabled\": SyncedStorage.get(\"showsteamdb\"),\r\n            },\r\n            {\r\n                \"iconClass\": \"bartervg_ico\",\r\n                \"link\": `https://barter.vg/steam/${this._type}/${this._gameid}/`,\r\n                \"text\": Localization.str.view_on_website.replace(\"__website__\", \"Barter.vg\"),\r\n                \"enabled\": SyncedStorage.get(\"showbartervg\"),\r\n            },\r\n            {\r\n                \"iconClass\": \"cardexchange_btn\",\r\n                \"link\": `https://www.steamcardexchange.net/index.php?gamepage-appid-${this.context.communityAppid}/`,\r\n                \"text\": Localization.str.view_on_website.replace(\"__website__\", \"Steam Card Exchange\"),\r\n                \"enabled\": isAppPage && this.context.hasCards && SyncedStorage.get(\"showsteamcardexchange\"),\r\n            },\r\n            {\r\n                \"iconClass\": \"protondb_btn\",\r\n                \"link\": `https://www.protondb.com/app/${this.context.appid}/`,\r\n                \"text\": Localization.str.view_on_website.replace(\"__website__\", \"ProtonDB\"),\r\n                \"enabled\": isAppPage && SyncedStorage.get(\"showprotondb\"),\r\n            },\r\n            {\r\n                \"iconClass\": \"completionistme_btn\",\r\n                \"link\": `https://completionist.me/steam/app/${this.context.appid}/`,\r\n                \"text\": Localization.str.view_on_website.replace(\"__website__\", \"Completionist.me\"),\r\n                \"enabled\": isAppPage && SyncedStorage.get(\"showcompletionistme\"),\r\n            },\r\n            {\r\n                \"iconClass\": \"pcgw_btn\",\r\n                \"link\": `https://pcgamingwiki.com/api/appid.php?appid=${this.context.appid}`,\r\n                \"text\": Localization.str.wiki_article.replace(\"__pcgw__\", \"PCGamingWiki\"),\r\n                \"enabled\": isAppPage && SyncedStorage.get(\"showpcgw\"),\r\n            },\r\n            {\r\n                \"iconClass\": \"twitch_btn\",\r\n                \"link\": `https://www.twitch.tv/directory/game/${encodeURIComponent(appName)}`,\r\n                \"text\": Localization.str.view_on_website.replace(\"__website__\", \"Twitch\"),\r\n                \"enabled\": isAppPage && appName && SyncedStorage.get(\"showtwitch\"),\r\n            },\r\n            {\r\n                \"iconClass\": \"as_youtube_btn\",\r\n                \"link\": `https://www.youtube.com/results?search_query=${encodeURIComponent(appName)}`,\r\n                \"text\": Localization.str.view_on_website.replace(\"__website__\", \"YouTube\"),\r\n                \"enabled\": isAppPage && appName && SyncedStorage.get(\"showyoutube\"),\r\n            },\r\n            {\r\n                \"iconClass\": \"as_youtube_btn\",\r\n                \"link\": `https://www.youtube.com/results?search_query=${encodeURIComponent(`${appName} \"PC Gameplay\"`)}`,\r\n                \"text\": Localization.str.youtube_gameplay,\r\n                \"enabled\": isAppPage && appName && SyncedStorage.get(\"showyoutubegameplay\"),\r\n            },\r\n            {\r\n                \"iconClass\": \"as_youtube_btn\",\r\n                \"link\": `https://www.youtube.com/results?search_query=${encodeURIComponent(`${appName} \"PC\" intitle:Review`)}`,\r\n                \"text\": Localization.str.youtube_reviews,\r\n                \"enabled\": isAppPage && appName && SyncedStorage.get(\"showyoutubereviews\"),\r\n            },\r\n        ];\r\n\r\n        if (isAppPage) {\r\n\r\n            if (this.context.isErrorPage) {\r\n\r\n                // Add a Community Hub button to roughly where it normally is\r\n                HTML.beforeBegin(\"h2.pageheader\",\r\n                    `<div class=\"es_apphub_OtherSiteInfo\">\r\n                        <a class=\"btnv6_blue_hoverfade btn_medium\" href=\"//steamcommunity.com/app/${this._gameid}/\">\r\n                            <span>${Localization.str.community_hub}</span>\r\n                        </a>\r\n                    </div>`);\r\n            } else {\r\n\r\n                // Move share/embed links to the top of the right column\r\n                const sideDetails = document.querySelector(\".es_side_details_wrap\");\r\n                if (sideDetails) {\r\n                    sideDetails.insertAdjacentElement(\"afterend\", this._node);\r\n                } else {\r\n                    document.querySelector(\"div.rightcol.game_meta_data\").insertAdjacentElement(\"afterbegin\", this._node);\r\n                }\r\n            }\r\n\r\n            // custom app link\r\n            for (const customLink of SyncedStorage.get(\"app_custom_link\")) {\r\n\r\n                const link = `//${HTML.escape(customLink.url\r\n                    .replace(\"[NAME]\", appName ? encodeURIComponent(appName) : \"\")\r\n                    .replace(\"[ID]\", this._gameid))}`;\r\n                const text = Localization.str.view_on_website.replace(\"__website__\", HTML.escape(customLink.name));\r\n                const iconUrl = customLink.icon ? `url(//${HTML.escape(customLink.icon)})` : \"none\";\r\n\r\n                links.push({link, text, iconUrl, \"enabled\": customLink.enabled});\r\n            }\r\n        }\r\n\r\n        let html = \"\";\r\n        for (const link of links) {\r\n            if (!link.enabled) { continue; }\r\n\r\n            const icon = link.iconClass ? \"\" : `style=\"background: ${link.iconUrl}; background-size: contain;\"`;\r\n            html += `<a class=\"btnv6_blue_hoverfade btn_medium es_app_btn ${link.iconClass || \"\"}\" target=\"_blank\" href=\"${link.link}\">\r\n                        <span><i class=\"ico16\" ${icon}></i>${link.text}</span>\r\n                    </a>`;\r\n        }\r\n\r\n        if (html) {\r\n            if (this.context.isErrorPage) {\r\n                HTML.afterEnd(this._node, `<div class=\"es_extralinks_ctn\">${html}</div>`);\r\n            } else {\r\n                HTML.afterBegin(this._node, html);\r\n            }\r\n        }\r\n    }\r\n}\r\n","import {SyncedStorage} from \"../../modulesCore\";\r\nimport {BackgroundSimple} from \"../BackgroundSimple\";\r\n\r\nclass UserNotesAdapter {\r\n\r\n    static getAdapter() {\r\n\r\n        if (typeof UserNotesAdapter._adapter === \"undefined\") {\r\n\r\n            let Adapter = UserNotesAdapter.adapters[SyncedStorage.get(\"user_notes_adapter\")];\r\n\r\n            if (typeof Adapter === \"undefined\") {\r\n                SyncedStorage.remove(\"user_notes_adapter\");\r\n                Adapter = UserNotesAdapter.adapters[SyncedStorage.defaults.user_notes_adapter];\r\n            }\r\n\r\n            UserNotesAdapter._adapter = new Adapter();\r\n        }\r\n\r\n        return UserNotesAdapter._adapter;\r\n    }\r\n\r\n    static async changeAdapter(toType) {\r\n\r\n        const currentAdapter = UserNotesAdapter.getAdapter();\r\n        const newAdapter = new UserNotesAdapter.adapters[toType]();\r\n\r\n        await newAdapter.import(await currentAdapter.export());\r\n        await currentAdapter.clear();\r\n\r\n        UserNotesAdapter._adapter = newAdapter;\r\n        return UserNotesAdapter._adapter;\r\n    }\r\n}\r\n\r\nclass OutOfCapacityError extends Error {\r\n    constructor(ratio, ...params) {\r\n        super(...params);\r\n\r\n        this.name = this.constructor.name;\r\n\r\n        this.ratio = ratio;\r\n    }\r\n}\r\n\r\nclass CapacityInfo {\r\n    constructor(closeToFull = false, utilization = null) {\r\n        this.closeToFull = closeToFull;\r\n        this.utilization = utilization;\r\n    }\r\n}\r\n\r\nclass SyncedStorageAdapter {\r\n\r\n    constructor() {\r\n        this._notes = SyncedStorage.get(\"user_notes\");\r\n    }\r\n\r\n    get(appid) {\r\n        return this._notes[appid] || null;\r\n    }\r\n\r\n    async set(appid, note) {\r\n\r\n        const oldNote = this._notes[appid];\r\n        this._notes[appid] = note;\r\n\r\n        const storageUsage = this._getNotesSize() / SyncedStorage.QUOTA_BYTES_PER_ITEM;\r\n        if (storageUsage > 1) {\r\n            this._notes[appid] = oldNote;\r\n            throw new OutOfCapacityError(storageUsage, \"Can't set this user note, out of capacity\");\r\n        }\r\n\r\n        await SyncedStorage.set(\"user_notes\", this._notes);\r\n\r\n        return new CapacityInfo(storageUsage > 0.85, storageUsage);\r\n    }\r\n\r\n    delete(appid) {\r\n        delete this._notes[appid];\r\n        return SyncedStorage.set(\"user_notes\", this._notes);\r\n    }\r\n\r\n    export() {\r\n        return this._notes;\r\n    }\r\n\r\n    import(notes) {\r\n\r\n        const storageUsage = this._getNotesSize(notes) / SyncedStorage.QUOTA_BYTES_PER_ITEM;\r\n        if (storageUsage > 1) {\r\n            throw new OutOfCapacityError(storageUsage, \"Import to synced storage failed, too much data for this adapter\");\r\n        }\r\n\r\n        this._notes = notes;\r\n        return SyncedStorage.set(\"user_notes\", this._notes);\r\n    }\r\n\r\n    clear() {\r\n        return SyncedStorage.remove(\"user_notes\");\r\n    }\r\n\r\n    _getNotesSize(notes = this._notes) {\r\n        return \"user_notes\".length + JSON.stringify(notes).length;\r\n    }\r\n}\r\n\r\nclass IdbAdapter {\r\n\r\n    get(appid) {\r\n        return BackgroundSimple.action(\"notes.get\", appid);\r\n    }\r\n\r\n    set(appid, note) {\r\n        return BackgroundSimple.action(\"notes.set\", appid, note);\r\n    }\r\n\r\n    delete(appid) {\r\n        return BackgroundSimple.action(\"notes.delete\", appid);\r\n    }\r\n\r\n    export() {\r\n        return BackgroundSimple.action(\"notes.getall\");\r\n    }\r\n\r\n    import(notes) {\r\n        return BackgroundSimple.action(\"notes.setall\", notes);\r\n    }\r\n\r\n    clear() {\r\n        return BackgroundSimple.action(\"notes.clear\");\r\n    }\r\n}\r\n\r\n/*\r\n * TODO Implement\r\n * class ItadAdapter extends IdbAdapter {}\r\n */\r\n\r\nUserNotesAdapter.adapters = Object.freeze({\r\n    \"synced_storage\": SyncedStorageAdapter,\r\n    \"idb\": IdbAdapter,\r\n    // \"itad\": ItadAdapter,\r\n});\r\n\r\nexport {CapacityInfo, OutOfCapacityError, UserNotesAdapter};\r\n","import {Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Messenger} from \"../../../modulesContent\";\r\nimport {Page} from \"../../Page\";\r\nimport {CapacityInfo, OutOfCapacityError, UserNotesAdapter} from \"../../../../Core/Storage/UserNotesAdapter\";\r\n\r\nclass UserNotes {\r\n    constructor() {\r\n        this._str = Localization.str.user_note;\r\n        this._adapter = UserNotesAdapter.getAdapter();\r\n\r\n        this.noteModalTemplate\r\n            = `<div class=\"es_note_prompt newmodal_prompt_with_textarea gray_bevel fullwidth\">\r\n                <textarea name=\"es_note_input\" id=\"es_note_input\" rows=\"6\" cols=\"12\">__note__</textarea>\r\n            </div>`;\r\n    }\r\n\r\n    get(...args) { return this._adapter.get(...args); }\r\n\r\n    async set(...args) {\r\n\r\n        let capInfo = null;\r\n\r\n        try {\r\n            capInfo = await this._adapter.set(...args);\r\n        } catch (err) {\r\n            if (err instanceof OutOfCapacityError) {\r\n                return (await this._showDialog(true, err.ratio)) ? this.set(...args) : false;\r\n            }\r\n\r\n            throw err;\r\n        }\r\n\r\n        if (capInfo instanceof CapacityInfo && capInfo.closeToFull) {\r\n            await this._showDialog(false, capInfo.utilization);\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    delete(...args) { return this._adapter.delete(...args); }\r\n\r\n    async showModalDialog(appname, appid, noteEl, onNoteUpdate) {\r\n\r\n        let note = await this.get(appid) || \"\";\r\n\r\n        // Partly copied `ShowConfirmDialog` from shared_global.js\r\n        Page.runInPageContext((title, template, strSave, strCancel) => {\r\n            /* eslint-disable no-undef, new-cap, camelcase */\r\n\r\n            const deferred = new jQuery.Deferred();\r\n            function fnOk() {\r\n                deferred.resolve(\r\n                    document.querySelector(\"#es_note_input\").value\r\n                        .trim()\r\n                        .replace(/\\s\\s+/g, \" \")\r\n                );\r\n            }\r\n\r\n            function fnCancel() {\r\n                deferred.reject();\r\n            }\r\n\r\n            const buttons = [];\r\n\r\n            const okBtn = _BuildDialogButton(strSave, true);\r\n            okBtn.click(fnOk);\r\n            buttons.push(okBtn);\r\n\r\n            const cancelBtn = _BuildDialogButton(strCancel, false);\r\n            cancelBtn.click(fnCancel);\r\n            buttons.push(cancelBtn);\r\n\r\n            const modal = _BuildDialog(title, template, buttons, fnCancel);\r\n\r\n            _BindOnEnterKeyPressForDialog(modal, deferred, fnOk);\r\n            deferred.always(() => modal.Dismiss());\r\n\r\n            const noteInput = document.getElementById(\"es_note_input\");\r\n            noteInput.focus();\r\n            noteInput.setSelectionRange(0, noteInput.textLength);\r\n\r\n            // Native keyup handler ignores events on <textarea>'s https://github.com/SteamDatabase/SteamTracking/blob/b8f3721153355d82005e621b167969f6c1f27bdf/steamcommunity.com/public/shared/javascript/shared_global.js#L459\r\n            noteInput.addEventListener(\"keydown\", e => {\r\n                if (e.key === \"Enter\" && !e.shiftKey) {\r\n                    okBtn.trigger(\"click\");\r\n                }\r\n            });\r\n\r\n            deferred.promise(modal);\r\n\r\n            modal\r\n                .done(note => {\r\n                    window.sessionStorage.removeItem(\"es_note_autosave\");\r\n                    window.Messenger.postMessage(\"noteClosed\", note);\r\n                })\r\n                .fail(() => {\r\n                    if (noteInput.value.trim() !== \"\") {\r\n                        window.sessionStorage.setItem(\"es_note_autosave\", noteInput.value);\r\n                    }\r\n                    window.Messenger.postMessage(\"noteClosed\", null);\r\n                });\r\n\r\n            modal.Show();\r\n            /* eslint-enable no-undef, new-cap, camelcase */\r\n        },\r\n        [\r\n            this._str.add_for_game.replace(\"__gamename__\", appname),\r\n            this.noteModalTemplate.replace(\"__note__\", note || window.sessionStorage.getItem(\"es_note_autosave\") || \"\"),\r\n            Localization.str.save,\r\n            Localization.str.cancel,\r\n        ]);\r\n\r\n        const oldNote = note;\r\n\r\n        note = await Messenger.onMessage(\"noteClosed\");\r\n        if (note === null || note === oldNote) { return; }\r\n\r\n        if (note.length === 0) {\r\n            this.delete(appid);\r\n            noteEl.textContent = this._str.add;\r\n        } else {\r\n            if (!await this.set(appid, note)) {\r\n                window.sessionStorage.setItem(\"es_note_autosave\", note);\r\n                return;\r\n            }\r\n            noteEl.textContent = `\"${note}\"`;\r\n        }\r\n\r\n        onNoteUpdate(noteEl, note.length !== 0);\r\n    }\r\n\r\n    async _showDialog(exceeded, ratio) {\r\n\r\n        const str = this._str;\r\n\r\n        const desc\r\n            = `${(exceeded ? str.not_enough_space_desc : str.close_on_storage_desc).replace(\"__perc__\", (ratio * 100).toFixed(0))}\r\n            <br>\r\n            ${str.storage_warning_desc}`;\r\n\r\n        Page.runInPageContext((title, desc, strCloudStorage, strCancel, strLocalStorage) => {\r\n            const modal = window.SteamFacade.showConfirmDialog(title, desc, strLocalStorage, strCancel);\r\n\r\n            modal\r\n                .done(res => window.Messenger.postMessage(\"storageOption\", res))\r\n                .fail(() => window.Messenger.postMessage(\"storageOption\", null));\r\n        },\r\n        [\r\n            exceeded ? str.not_enough_space : str.close_on_storage,\r\n            desc,\r\n            str.save_itad,\r\n            str.save_synced_storage,\r\n            str.save_local,\r\n        ]);\r\n\r\n        const buttonPressed = await Messenger.onMessage(\"storageOption\");\r\n        let adapterType;\r\n\r\n        if (buttonPressed === \"OK\") {\r\n            adapterType = \"idb\";\r\n        } else {\r\n            return false;\r\n        }\r\n\r\n        this._adapter = await UserNotesAdapter.changeAdapter(adapterType);\r\n        await SyncedStorage.set(\"user_notes_adapter\", adapterType);\r\n        return true;\r\n    }\r\n}\r\n\r\nexport {UserNotes};\r\n","import {GameId, HTML, Localization, SyncedStorage} from \"../../../modulesCore\";\r\nimport {DOMHelper, DynamicStore, Feature, ITAD, Inventory} from \"../../modulesContent\";\r\nimport {Page} from \"../Page\";\r\n\r\nexport default class FHighlightsTags extends Feature {\r\n\r\n    async apply() {\r\n\r\n        await Page.runInPageContext(() => new Promise(resolve => {\r\n            window.SteamFacade.onDynamicStoreReady(() => { resolve(); });\r\n        }), null, true);\r\n\r\n        return Promise.all([\r\n            FHighlightsTags.highlightTitle(this.context.appid),\r\n            FHighlightsTags.highlightAndTag(),\r\n        ]);\r\n    }\r\n\r\n    static highlightTitle(appid) {\r\n\r\n        const title = document.querySelector(\".apphub_AppName\");\r\n        if (!title) { return null; }\r\n\r\n        title.dataset.dsAppid = appid;\r\n\r\n        return FHighlightsTags.highlightAndTag([title], false);\r\n    }\r\n\r\n    /**\r\n     * Highlights and tags DOM nodes that are owned, wishlisted, ignored, collected, waitlisted\r\n     * or that the user has a gift, a guest pass or coupon for.\r\n     *\r\n     * @param {NodeList|Array} nodes - The nodes that should get highlighted\r\n     * (defaults to all known nodes that are highlightable and taggable)\r\n     * @param {boolean} hasDsInfo - Whether or not the supplied nodes contain dynamic store info (defaults to true)\r\n     * @param {Object} options - Option overrides that should be applied\r\n     * @returns {Promise} - Resolved once the highlighting and tagging completed for the nodes\r\n     */\r\n    /* eslint-disable complexity -- FIXME */\r\n    static async highlightAndTag(nodes, hasDsInfo = true, options = {}) {\r\n\r\n        if (typeof FHighlightsTags._options === \"undefined\") {\r\n            FHighlightsTags._options = {\r\n                \"owned\": SyncedStorage.get(\"highlight_owned\") || SyncedStorage.get(\"tag_owned\"),\r\n                \"wishlisted\": SyncedStorage.get(\"highlight_wishlist\") || SyncedStorage.get(\"tag_wishlist\"),\r\n                \"ignored\": SyncedStorage.get(\"highlight_notinterested\") || SyncedStorage.get(\"tag_notinterested\"),\r\n                \"collected\": SyncedStorage.get(\"highlight_collection\") || SyncedStorage.get(\"tag_collection\"),\r\n                \"waitlisted\": SyncedStorage.get(\"highlight_waitlist\") || SyncedStorage.get(\"tag_waitlist\"),\r\n                \"gift\": SyncedStorage.get(\"highlight_inv_gift\") || SyncedStorage.get(\"tag_inv_gift\"),\r\n                \"guestPass\": SyncedStorage.get(\"highlight_inv_guestpass\") || SyncedStorage.get(\"tag_inv_guestpass\"),\r\n                \"coupon\": SyncedStorage.get(\"highlight_coupon\") || SyncedStorage.get(\"tag_coupon\"),\r\n            };\r\n        }\r\n\r\n        const opts = {...this._options, ...options};\r\n        if (!Object.values(opts).some(x => x)) { return; }\r\n\r\n        const _nodes = nodes || document.querySelectorAll(this._selector);\r\n        if (_nodes.length === 0) { return; }\r\n\r\n        const storeIdsMap = new Map();\r\n\r\n        for (const node of _nodes) {\r\n            let nodeToHighlight = node;\r\n\r\n            if (node.classList.contains(\"item\")) {\r\n                nodeToHighlight = node.querySelector(\".info\");\r\n            } else if (node.classList.contains(\"home_area_spotlight\")) {\r\n                nodeToHighlight = node.querySelector(\".spotlight_content\");\r\n            } else if (node.parentNode.classList.contains(\"steam_curator_recommendation\")\r\n                && node.parentNode.classList.contains(\"big\")) {\r\n                nodeToHighlight = node.nextElementSibling;\r\n            } else if (node.parentNode.parentNode.classList.contains(\"curations\")) {\r\n                nodeToHighlight = node.parentNode;\r\n            } else if (node.classList.contains(\"special_img_ctn\") && node.parentElement.classList.contains(\"special\")) {\r\n                nodeToHighlight = node.parentElement;\r\n            } else if (node.classList.contains(\"blotter_userstats_game\")) {\r\n\r\n                // Small game capsules on activity page (e.g. when posting a status about a game)\r\n                nodeToHighlight = node.parentElement;\r\n            }\r\n\r\n            const aNode = node.querySelector(\"a\");\r\n\r\n            const appid = GameId.getAppid(node) || GameId.getAppid(aNode) || GameId.getAppidFromId(node.id);\r\n            const subid = GameId.getSubid(node) || GameId.getSubid(aNode);\r\n            const bundleid = GameId.getBundleid(node) || GameId.getBundleid(aNode);\r\n\r\n            let storeId;\r\n            if (appid) {\r\n                storeId = `app/${appid}`;\r\n            } else if (bundleid) {\r\n                storeId = `bundle/${bundleid}`;\r\n            } else if (subid) {\r\n                storeId = `sub/${subid}`;\r\n            }\r\n\r\n            if (storeId) {\r\n                if (storeIdsMap.has(storeId)) {\r\n                    storeIdsMap.get(storeId).push(nodeToHighlight);\r\n                } else {\r\n                    storeIdsMap.set(storeId, [nodeToHighlight]);\r\n                }\r\n            }\r\n\r\n\r\n            if (hasDsInfo) {\r\n                try {\r\n                    if (opts.owned && node.querySelector(\".ds_owned_flag\") !== null) {\r\n                        this.highlightOwned(nodeToHighlight);\r\n                    }\r\n                    if (opts.wishlisted && node.querySelector(\".ds_wishlist_flag\") !== null) {\r\n                        this.highlightWishlist(nodeToHighlight);\r\n                    }\r\n                    if (opts.ignored && node.querySelector(\".ds_ignored_flag\") !== null) {\r\n                        this.highlightIgnored(nodeToHighlight);\r\n                    }\r\n                } catch (err) {\r\n                    console.error(\"Failed to highlight / tag node\", err);\r\n                }\r\n            }\r\n        }\r\n\r\n        const storeIds = Array.from(storeIdsMap.keys());\r\n        if (storeIds.length === 0) { return; }\r\n\r\n        const trimmedStoreIds = storeIds.map(id => GameId.trimStoreId(id));\r\n\r\n        const includeDsInfo = !hasDsInfo && (opts.owned || opts.wishlisted || opts.ignored);\r\n\r\n        const [dsStatus, itadStatus, invStatus] = await Promise.all([\r\n            includeDsInfo ? DynamicStore.getAppStatus(storeIds) : Promise.resolve(),\r\n            ITAD.getAppStatus(storeIds, {\r\n                \"waitlist\": opts.waitlisted,\r\n                \"collection\": opts.collected,\r\n            }),\r\n            Inventory.getAppStatus(trimmedStoreIds, {\r\n                \"giftsAndPasses\": opts.gift || opts.guestPass,\r\n                \"coupons\": opts.coupon,\r\n            }),\r\n        ]);\r\n\r\n        const it = trimmedStoreIds.values();\r\n        for (const [storeid, nodes] of storeIdsMap) {\r\n\r\n            const operations = [];\r\n\r\n            if (dsStatus) {\r\n                if (opts.owned && dsStatus[storeid].owned) {\r\n                    operations.push(this.highlightOwned);\r\n                }\r\n                if (opts.wishlisted && dsStatus[storeid].wishlisted) {\r\n                    operations.push(this.highlightWishlist);\r\n                }\r\n                if (opts.ignored && dsStatus[storeid].ignored) {\r\n                    operations.push(this.highlightIgnored);\r\n                }\r\n            }\r\n\r\n            /*\r\n             * Don't need to check for the opts object here, since the result contains\r\n             * false for every property if the highlight has been disabled\r\n             */\r\n            if (itadStatus) {\r\n                if (itadStatus[storeid].collected) {\r\n                    operations.push(this.highlightCollection);\r\n                }\r\n                if (itadStatus[storeid].waitlisted) {\r\n                    operations.push(this.highlightWaitlist);\r\n                }\r\n            }\r\n\r\n            if (invStatus) {\r\n                const trimmedId = it.next().value;\r\n                if (opts.gift && invStatus[trimmedId].gift) {\r\n                    operations.push(this.highlightInvGift);\r\n                }\r\n\r\n                if (opts.guestPass && invStatus[trimmedId].guestPass) {\r\n                    operations.push(this.highlightInvGuestpass);\r\n                }\r\n\r\n                // Same as for the ITAD highlights (don't need to check)\r\n                if (invStatus[trimmedId].coupon) {\r\n                    operations.push(this.highlightInvCoupon);\r\n                }\r\n            }\r\n\r\n            for (let operation of operations) {\r\n                operation = operation.bind(this);\r\n\r\n                for (const node of nodes) {\r\n                    try {\r\n                        operation(node);\r\n                    } catch (err) {\r\n                        console.error(\"Failed to highlight / tag node\", err);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    static _addTag(node, tag) {\r\n\r\n        if (!this._tagCssLoaded) {\r\n            this._tagCssLoaded = true;\r\n\r\n            const tagCss = [];\r\n\r\n            for (const name of this._types) {\r\n                const color = SyncedStorage.get(`tag_${name}_color`);\r\n                tagCss.push(`.es_tag_${name} { background-color: ${color}; }`);\r\n            }\r\n\r\n            DOMHelper.insertCSS(tagCss.join(\"\\n\"));\r\n        }\r\n\r\n        // Add the tags container if needed\r\n        let container = node.querySelector(\".es_tags\");\r\n        if (!container) {\r\n            container = document.createElement(\"div\");\r\n            container.classList.add(\"es_tags\");\r\n            if (SyncedStorage.get(\"tag_short\")) {\r\n                container.classList.add(\"es_tags_short\");\r\n            }\r\n\r\n            if (node.classList.contains(\"tab_item\")) {\r\n                node.querySelector(\".tab_item_details\").insertAdjacentElement(\"afterbegin\", container);\r\n            } else if (node.classList.contains(\"newonsteam_headercap\") || node.classList.contains(\"comingsoon_headercap\")) {\r\n                node.querySelector(\".discount_block\").insertAdjacentElement(\"beforebegin\", container);\r\n            } else if (node.classList.contains(\"search_result_row\")) {\r\n                node.querySelector(\".search_name > div\").insertAdjacentElement(\"afterbegin\", container);\r\n            } else if (node.classList.contains(\"browse_tag_game\")) {\r\n                node.querySelector(\".browse_tag_game_price\").insertAdjacentElement(\"afterend\", container);\r\n            } else if (node.classList.contains(\"game_area_dlc_row\")) {\r\n                node.querySelector(\".game_area_dlc_price\").insertAdjacentElement(\"afterbegin\", container);\r\n            } else if (node.classList.contains(\"wishlist_row\")) {\r\n                node.querySelector(\".addedon\").insertAdjacentElement(\"afterbegin\", container);\r\n            } else if (node.classList.contains(\"match\")) {\r\n                node.querySelector(\".match_price\").insertAdjacentElement(\"afterbegin\", container);\r\n            } else if (node.classList.contains(\"recommendation_highlight\")) {\r\n                node.querySelector(\".highlight_description\").insertAdjacentElement(\"afterbegin\", container);\r\n            } else if (node.classList.contains(\"similar_grid_item\")) {\r\n                node.querySelector(\".regular_price, .discount_block\").append(container);\r\n            } else if (node.classList.contains(\"recommendation_carousel_item\")) {\r\n                node.querySelector(\".buttons\").insertAdjacentElement(\"beforebegin\", container);\r\n            } else if (node.classList.contains(\"friendplaytime_game\")) {\r\n                node.querySelector(\".friendplaytime_buttons\").insertAdjacentElement(\"beforebegin\", container);\r\n            }\r\n        }\r\n\r\n        if (!container.querySelector(`.es_tag_${tag}`)) {\r\n            HTML.beforeEnd(container, `<span class=\"es_tag_${tag}\">${Localization.str.tag[tag]}</span>`);\r\n        }\r\n    }\r\n    /* eslint-enable complexity */\r\n\r\n    static _highlightNode(node, type) {\r\n\r\n        if (SyncedStorage.get(\"highlight_excludef2p\")) {\r\n\r\n            let _node = node.querySelector(\"[data-ds-tagids]\") || node.closest(\"[data-ds-tagids]\");\r\n            // Check for the \"Free to Play\" tag\r\n            if (_node && JSON.parse(_node.dataset.dsTagids).includes(113)) { return; }\r\n            // Check if the price is \"Free\", only works for English users\r\n            _node = node.querySelector(\".discount_final_price, .regular_price, .search_price, .game_area_dlc_price, .browse_tag_game_price\");\r\n            if (_node && /\\bFree\\b/.test(_node.textContent)) { return; }\r\n        }\r\n\r\n        node.classList.add(\"es_highlighted\", `es_highlighted_${type}`);\r\n\r\n        if (!this._highlightCssLoaded) {\r\n            this._highlightCssLoaded = true;\r\n\r\n            const hlCss = [];\r\n\r\n            for (const name of this._types) {\r\n                const color = SyncedStorage.get(`highlight_${name}_color`);\r\n                hlCss.push(\r\n                    `.es_highlighted_${name} {\r\n                        background: ${color} linear-gradient(135deg, rgba(0, 0, 0, 0.70) 10%, rgba(0, 0, 0, 0) 100%) !important;\r\n                    }\r\n                    .carousel_items .es_highlighted_${name}.price_inline, .curator_giant_capsule.es_highlighted_${name},\r\n                    .hero_capsule.es_highlighted_${name}, .blotter_userstatus_game.es_highlighted_${name} {\r\n                        outline: solid ${color};\r\n                    }\r\n                    #search_suggestion_contents .focus.es_highlighted_${name} {\r\n                        box-shadow: -5px 0 0 ${color};\r\n                    }\r\n                    .apphub_AppName.es_highlighted_${name} {\r\n                        background: none !important; color: ${color};\r\n                    }`\r\n                );\r\n            }\r\n\r\n            DOMHelper.insertCSS(hlCss.join(\"\\n\"));\r\n        }\r\n\r\n        let _node = node;\r\n\r\n        // Carousel item\r\n        if (_node.classList.contains(\"cluster_capsule\")) {\r\n            _node = _node.querySelector(\".main_cap_content\").parentNode;\r\n        } else if (_node.classList.contains(\"large_cap\")) {\r\n\r\n            // Genre Carousel items\r\n            _node = _node.querySelector(\".large_cap_content\");\r\n        } else if (_node.parentNode.classList.contains(\"steam_curator_recommendation\")\r\n            && _node.parentNode.classList.contains(\"big\")) {\r\n            _node = _node.previousElementSibling;\r\n        }\r\n\r\n        // Recommendations on front page when scrolling down\r\n        if (_node.classList.contains(\"single\")) {\r\n            _node = _node.querySelector(\".gamelink\");\r\n        }\r\n\r\n        if (_node.parentNode.parentNode.classList.contains(\"apps_recommended_by_curators_v2\")) {\r\n            let r = _node.querySelectorAll(\".ds_flag\");\r\n            r.forEach(node => node.remove());\r\n            r = _node.querySelectorAll(\".ds_flagged\");\r\n            r.forEach(node => node.classList.remove(\"ds_flagged\"));\r\n        } else {\r\n\r\n            if (_node.classList.contains(\"info\") || _node.classList.contains(\"spotlight_content\")) {\r\n                _node = _node.parentElement;\r\n            }\r\n\r\n            let r = _node.querySelector(\".ds_flag\");\r\n            if (r) { r.remove(); }\r\n            r = _node.querySelector(\".ds_flagged\");\r\n            if (r) {\r\n                r.classList.remove(\"ds_flagged\");\r\n            }\r\n        }\r\n\r\n        _node.classList.remove(\"ds_flagged\");\r\n    }\r\n\r\n    static _highlightItem(node, name) {\r\n        node.classList.add(\"es_highlight_checked\");\r\n\r\n        if (SyncedStorage.get(`highlight_${name}`)) {\r\n            this._highlightNode(node, name);\r\n        }\r\n\r\n        if (SyncedStorage.get(`tag_${name}`)) {\r\n            this._addTag(node, name);\r\n        }\r\n    }\r\n\r\n    static highlightOwned(node) {\r\n        this._highlightItem(node, \"owned\");\r\n    }\r\n\r\n    static highlightWishlist(node) {\r\n        this._highlightItem(node, \"wishlist\");\r\n    }\r\n\r\n    static highlightInvCoupon(node) {\r\n        this._highlightItem(node, \"coupon\");\r\n    }\r\n\r\n    static highlightInvGift(node) {\r\n        this._highlightItem(node, \"inv_gift\");\r\n    }\r\n\r\n    static highlightInvGuestpass(node) {\r\n        this._highlightItem(node, \"inv_guestpass\");\r\n    }\r\n\r\n    static highlightIgnored(node) {\r\n        this._highlightItem(node, \"notinterested\");\r\n    }\r\n\r\n    static highlightCollection(node) {\r\n        this._highlightItem(node, \"collection\");\r\n    }\r\n\r\n    static highlightWaitlist(node) {\r\n        this._highlightItem(node, \"waitlist\");\r\n    }\r\n}\r\n\r\nFHighlightsTags._highlightCssLoaded = false;\r\nFHighlightsTags._tagCssLoaded = false;\r\n\r\n/*\r\n * Attention, the sequence of these entries determines the precendence of the highlights!\r\n * The later it appears in the array, the higher its precedence\r\n */\r\nFHighlightsTags._types = [\r\n    \"notinterested\",\r\n    \"waitlist\",\r\n    \"wishlist\",\r\n    \"collection\",\r\n    \"owned\",\r\n    \"coupon\",\r\n    \"inv_guestpass\",\r\n    \"inv_gift\",\r\n];\r\n\r\nFHighlightsTags._selector = [\r\n    \".store_main_capsule\", // \"Featured & Recommended\"\r\n    \"a.game_area_dlc_row\", // DLC on app pages\r\n    \"a.small_cap\", // Featured storefront items and \"recommended\" section on app pages\r\n    \".home_content_item\", // Small items under \"Keep scrolling for more recommendations\"\r\n    \".home_content.single\", // Big items under \"Keep scrolling for more recommendations\"\r\n    \".home_area_spotlight\", // \"Special offers\" big items\r\n    \"a.search_result_row\", // Search result rows\r\n    \"a.match\", // Search suggestions rows\r\n    \".highlighted_app\", // For example \"Recently Recommended\" on curators page\r\n    \"div.recommendation_highlight\", // Recommendation pages\r\n    \"div.recommendation_carousel_item\", // Recommendation pages\r\n    \"div.friendplaytime_game\", // Recommendation pages\r\n    \".recommendation_row\", // \"Recent recommendations by friends\"\r\n    \".friendactivity_tab_row\", // \"Most played\" and \"Most wanted\" tabs on recommendation pages\r\n    \".friend_game_block\", // \"Friends recently bought\"\r\n    \".recommendation\", // Curator pages and the new DLC pages\r\n    \".curator_giant_capsule\",\r\n    \"div.carousel_items.curator_featured > div\", // Carousel items on Curator pages\r\n    \"div.item_ctn\", // Curator list item\r\n    \".store_capsule\", // All sorts of items on almost every page\r\n    \".newonsteam_headercap\", // explore/new/\r\n    \".comingsoon_headercap\", // explore/upcoming/\r\n    \".home_marketing_message\", // \"Updates and offers\"\r\n    \"div.dlc_page_purchase_dlc\", // DLC page rows\r\n    \"div.home_area_spotlight\", // Midweek and weekend deals\r\n    \"div.browse_tag_game\", // Tagged games\r\n    \"div.similar_grid_item\", // Items on the \"Similarly tagged\" pages\r\n    \".tab_item\", // Item rows on storefront/tag/genre pages\r\n    \".special > .special_img_ctn\", // new homepage specials\r\n    \".special.special_img_ctn\",\r\n].map(sel => `${sel}:not(.es_highlighted)`)\r\n    .join(\",\");\r\n","import {ExtensionResources, GameId, HTML, Language, Localization, SyncedStorage} from \"../../../modulesCore\";\r\nimport {Background, Feature} from \"../../modulesContent\";\r\n\r\nexport default class FEarlyAccess extends Feature {\r\n\r\n    apply() {\r\n        FEarlyAccess.show();\r\n    }\r\n\r\n    static async show(nodes) {\r\n        if (!SyncedStorage.get(\"show_early_access\")) { return; }\r\n\r\n        const _nodes = nodes || document.querySelectorAll(this._selector);\r\n        if (_nodes.length === 0) { return; }\r\n\r\n        if (!this._container) {\r\n\r\n            // TODO add missing images for supported locales\r\n            let imageName = \"img/overlay/early_access_banner_english.png\";\r\n            if (Language.isCurrentLanguageOneOf([\r\n                \"brazilian\",\r\n                \"french\",\r\n                \"italian\",\r\n                \"japanese\",\r\n                \"koreana\",\r\n                \"polish\",\r\n                \"portuguese\",\r\n                \"russian\",\r\n                \"schinese\",\r\n                \"spanish\",\r\n                \"latam\",\r\n                \"tchinese\",\r\n                \"thai\"\r\n            ])) {\r\n                imageName = `img/overlay/early_access_banner_${Language.getCurrentSteamLanguage()}.png`;\r\n            }\r\n\r\n            const imageUrl = ExtensionResources.getURL(imageName);\r\n\r\n            this._container = HTML.element(\r\n                `<span class=\"es_overlay_container\">\r\n                    <span class=\"es_overlay\">\r\n                        <img title=\"${Localization.str.early_access}\" src=\"${imageUrl}\">\r\n                    </span>\r\n                </span>`\r\n            );\r\n        }\r\n\r\n        for (const node of await this.getEaNodes(_nodes)) {\r\n\r\n            /*\r\n             * TODO It's possible a child element has been checked already, remove when not needed\r\n             * e.g. duplicate elements on the storefront (More Curator Recommendations)\r\n             * and when called with the same arguments as highlighting (observing changes in CStoreBase)\r\n             */\r\n            if (node.querySelector(\".es_overlay_container\") !== null) { continue; }\r\n\r\n            node.classList.add(\"es_early_access\");\r\n\r\n            const imgHeader = node.querySelector(\"img\");\r\n            if (!imgHeader) { continue; }\r\n\r\n            const container = this._container.cloneNode(true);\r\n            imgHeader.insertAdjacentElement(\"afterend\", container);\r\n            container.append(imgHeader);\r\n        }\r\n    }\r\n\r\n    static async getEaNodes(nodes) {\r\n\r\n        const appidsMap = new Map();\r\n\r\n        for (const node of nodes) {\r\n\r\n            node.classList.add(\"es_ea_checked\");\r\n\r\n            // Skip the live streams section since the thumbnail is shown on top\r\n            if (node.classList.contains(\"store_capsule\") && node.querySelector(\".capsule[id^=broadcast]\") !== null) {\r\n                continue;\r\n            }\r\n\r\n            let appid = GameId.getAppid(node)\r\n                || GameId.getAppid(node.querySelector(\"a\"))\r\n                || GameId.getAppidImgSrc(node.querySelector(\"img\"));\r\n\r\n            if (appid) {\r\n                appid = String(appid);\r\n                if (appidsMap.has(appid)) {\r\n                    appidsMap.get(appid).push(node);\r\n                } else {\r\n                    appidsMap.set(appid, [node]);\r\n                }\r\n            }\r\n        }\r\n\r\n        if (appidsMap.size === 0) { return []; }\r\n\r\n        const eaStatus = await Background.action(\"isea\", Array.from(appidsMap.keys()));\r\n\r\n        return Array.from(appidsMap).flatMap(([appid, nodesArray]) => {\r\n            return eaStatus[appid] ? nodesArray : [];\r\n        });\r\n    }\r\n}\r\n\r\n// TODO support React-based sales pages, curator lists, etc.\r\nFEarlyAccess._selector = [\r\n    // Store only, selectors for the Community are split into relevant contexts\r\n    \".tab_item\", // Item rows on storefront, genre, category, tags etc. pages\r\n    \".quadscreenshot_carousel a\", // Top carousel on genre, category, tags etc. pages\r\n    \".newonsteam_headercap\", // explore/new\r\n    \".comingsoon_headercap\", // explore/upcoming\r\n    \".store_capsule\",\r\n    \".dailydeal_ctn\",\r\n    \".special.special_img_ctn\", // explore/new, cart/\r\n    /*\r\n     * These use CSS backgrounds instead of img elements, unsupported for now\r\n     * \".store_main_capsule\", // Featured & Recommended\r\n     * \".home_marketing_message\", // Updates and Offers\r\n     */\r\n    \".home_area_spotlight\", // Special Offers, specials/\r\n    \".curator_giant_capsule\", // Curator Recommendations\r\n    \".home_content_item\",\r\n    \".home_content.single\",\r\n    \".highlighted_app_header\", // curators/\r\n    \"#curator_avatar_image\", // Header image on dlc pages\r\n    \".curator_featured a\", // Featured items on curator, developer, publisher, franchise, dlc etc. pages\r\n    \".search_result_row\",\r\n    \".small_cap\", // \"recommended\" section on app pages\r\n    \".browse_tag_game_cap\", // tag/browse\r\n    \".header_image\", // recommended/morelike, friendactivity header\r\n    \".similar_grid_capsule\", // recommended/morelike\r\n    \".friend_game_block a[data-ds-appid]\",\r\n    \".friendactivity_tab_row\",\r\n    \".recommendation_app\",\r\n    \".recommendation_carousel_item\",\r\n    \".app_header\",\r\n    \".friendplaytime_appheader\",\r\n].map(sel => `${sel}:not(.es_ea_checked)`)\r\n    .join(\",\");\r\n","import {HTML, SyncedStorage} from \"../../../modulesCore\";\r\nimport {ContextType, Feature} from \"../../modulesContent\";\r\n\r\nexport default class FHideTrademarks extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return SyncedStorage.get(\"hidetmsymbols\");\r\n    }\r\n\r\n    apply() {\r\n\r\n        // TODO I would try to reduce number of selectors here\r\n        let selectors = \"title, .apphub_AppName, .breadcrumbs, h1, h4\";\r\n        if (this.context.type === ContextType.STORE_DEFAULT) {\r\n            selectors\r\n                += \".game_area_already_owned, .details_block, .game_description_snippet, \"\r\n                + \".game_area_description p, .glance_details, .game_area_dlc_bubble game_area_bubble, .package_contents, \"\r\n                + \".game_area_dlc_name, .tab_desc, .tab_item_name\";\r\n        } else {\r\n            selectors\r\n                += \".game_suggestion, .appHubShortcut_Title, .apphub_CardContentNewsTitle, \"\r\n                + \".apphub_CardTextContent, .apphub_CardContentAppName, .apphub_AppName\";\r\n        }\r\n\r\n        // Replaces \"R\", \"C\" and \"TM\" signs\r\n        function replaceSymbols(node) {\r\n\r\n            // tfedor I don't trust this won't break any inline JS\r\n            if (!node || !node.innerHTML) { return; }\r\n            HTML.inner(node, node.innerHTML.replace(/[\\u00AE\\u00A9\\u2122]/g, \"\"));\r\n        }\r\n\r\n        for (const node of document.querySelectorAll(selectors)) {\r\n            replaceSymbols(node);\r\n        }\r\n\r\n        const observer = new MutationObserver(mutations => {\r\n            mutations.forEach(mutation => {\r\n                mutation.addedNodes.forEach(node => {\r\n                    replaceSymbols(node);\r\n                });\r\n            });\r\n        });\r\n\r\n        const nodes = document.querySelectorAll(\"#game_select_suggestions,#search_suggestion_contents,.tab_content_ctn\");\r\n        for (const node of nodes) {\r\n            observer.observe(node, {\"childList\": true, \"subtree\": true});\r\n        }\r\n    }\r\n}\r\n","import {ExtensionResources, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {ContextType, DOMHelper, Feature} from \"../../../modulesContent\";\r\n\r\nexport default class FAlternativeLinuxIcon extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return SyncedStorage.get(\"show_alternative_linux_icon\");\r\n    }\r\n\r\n    apply() {\r\n        const url = ExtensionResources.getURL(\"img/alternative_linux_icon.png\");\r\n\r\n        let cssText = `span.platform_img.linux { background-image: url(${url}) !important; }`;\r\n\r\n        if (this.context.type === ContextType.STORE_FRONT) {\r\n            cssText += \".tab_item.focus .tab_item_details span.platform_img.linux { filter: brightness(20%); }\";\r\n        }\r\n\r\n        DOMHelper.insertCSS(cssText);\r\n    }\r\n}\r\n","import {HTML, Localization} from \"../../../../modulesCore\";\r\nimport {Feature} from \"../../../modulesContent\";\r\nimport {Page} from \"../../Page\";\r\n\r\nexport default class FReplaceDevPubLinks extends Feature {\r\n\r\n    apply() {\r\n\r\n        const devs = [document.querySelector(\".details_block > .dev_row:first-of-type > a\")];\r\n        const highlightsDev = document.getElementById(\"developers_list\")?.parentElement;\r\n\r\n        if (highlightsDev) { devs.push(highlightsDev.querySelector(\"a\")); }\r\n\r\n        const pubs = [document.querySelector(\".details_block > .dev_row:nth-of-type(2) > a\")];\r\n        const highlightsPub = highlightsDev?.nextElementSibling;\r\n\r\n        if (highlightsPub) { pubs.push(highlightsPub.querySelector(\"a\")); }\r\n\r\n        let franchise = document.querySelector(\".details_block > .dev_row:nth-of-type(3) > a\");\r\n        franchise = franchise ? [franchise] : [];\r\n\r\n        for (const node of [...devs, ...pubs, ...franchise]) {\r\n            const homepageLink = new URL(node.href);\r\n            if (homepageLink.pathname.startsWith(\"/search/\")) { continue; }\r\n\r\n            let type;\r\n            if (devs.includes(node)) {\r\n                type = \"developer\";\r\n            } else if (pubs.includes(node)) {\r\n                type = \"publisher\";\r\n            } else if (franchise === node) {\r\n                type = \"franchise\";\r\n            }\r\n            if (!type) { continue; }\r\n\r\n            node.href = `https://store.steampowered.com/search/?${type}=${encodeURIComponent(node.textContent)}`;\r\n            HTML.afterEnd(node, ` (<a href=\"${homepageLink.href}\">${Localization.str.options.homepage}</a>)`);\r\n        }\r\n\r\n        for (const moreBtn of document.querySelectorAll(\".dev_row > .more_btn\")) {\r\n            moreBtn.remove();\r\n        }\r\n\r\n        Page.runInPageContext(() => {\r\n            window.SteamFacade.collapseLongStrings(\".dev_row .summary.column\");\r\n        });\r\n    }\r\n}\r\n","import {ExtensionResources, HTML, Localization} from \"../../../../modulesCore\";\r\nimport {DynamicStore, Feature, User} from \"../../../modulesContent\";\r\nimport {Page} from \"../../Page\";\r\n\r\nexport default class FRemoveFromWishlist extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return User.isSignedIn && !this.context.isOwned;\r\n    }\r\n\r\n    apply() {\r\n\r\n        const successBtn = document.querySelector(\"#add_to_wishlist_area_success > a\");\r\n\r\n        // Update tooltip for wishlisted items\r\n        successBtn.dataset.tooltipText = Localization.str.remove_from_wishlist_tooltip;\r\n\r\n        const imgNode = successBtn.querySelector(\"img:last-child\");\r\n        imgNode.classList.add(\"es-in-wl\");\r\n        HTML.beforeBegin(imgNode,\r\n            `<img class=\"es-remove-wl\" src=\"${ExtensionResources.getURL(\"img/remove.png\")}\" style=\"display: none;\">\r\n            <img class=\"es-loading-wl\" src=\"//steamcommunity-a.akamaihd.net/public/images/login/throbber.gif\" style=\"display: none;\">`);\r\n\r\n        successBtn.addEventListener(\"click\", async e => {\r\n            e.preventDefault();\r\n\r\n            const parent = successBtn.closest(\".queue_actions_ctn\");\r\n            if (parent.classList.contains(\"loading\")) { return; }\r\n            parent.classList.add(\"loading\");\r\n\r\n            const removeWaitlist = Boolean(\r\n                document.querySelector(\".queue_btn_wishlist + .queue_btn_ignore_menu.owned_elsewhere\")\r\n            );\r\n\r\n            try {\r\n                await Promise.all([\r\n                    this.context.removeFromWishlist(),\r\n                    removeWaitlist ? this.context.removeFromWaitlist() : Promise.resolve(),\r\n                ]);\r\n\r\n                if (this.context.onWishAndWaitlistRemove) { this.context.onWishAndWaitlistRemove(); }\r\n\r\n                document.getElementById(\"add_to_wishlist_area\").style.display = \"\";\r\n\r\n                DynamicStore.clear();\r\n\r\n                Page.runInPageContext(() => { window.SteamFacade.dynamicStoreInvalidateCache(); });\r\n            } catch (err) {\r\n                document.getElementById(\"add_to_wishlist_area_fail\").style.display = \"\";\r\n                this.logError(err, \"Failed to remove app from wishlist\");\r\n            } finally {\r\n                document.getElementById(\"add_to_wishlist_area_success\").style.display = \"none\";\r\n                parent.classList.remove(\"loading\");\r\n            }\r\n        });\r\n\r\n        for (const node of document.querySelectorAll(\"#add_to_wishlist_area, #add_to_wishlist_area_success, .queue_btn_ignore\")) {\r\n            node.addEventListener(\"click\", DynamicStore.clear);\r\n        }\r\n    }\r\n}\r\n","import {Feature} from \"../../../Modules/Feature/Feature\";\r\nimport {SyncedStorage} from \"../../../../Core/Storage/SyncedStorage\";\r\n\r\nexport default class FForceMP4 extends Feature {\r\n    checkPrerequisites() {\r\n        return SyncedStorage.get(\"mp4video\");\r\n    }\r\n\r\n    apply() {\r\n        for (const node of document.querySelectorAll(\"[data-webm-source]\")) {\r\n            const mp4 = node.dataset.mp4Source;\r\n            const mp4hd = node.dataset.mp4HdSource;\r\n            if (!mp4 || !mp4hd) { continue; }\r\n\r\n            node.dataset.webmSource = mp4;\r\n            node.dataset.webmHdSource = mp4hd;\r\n\r\n            const video = node.querySelector(\"video\");\r\n            if (!video) { continue; }\r\n\r\n            video.dataset.sdSrc = mp4;\r\n            video.dataset.hdSrc = mp4hd;\r\n            this.context.toggleVideoDefinition(video, false);\r\n        }\r\n    }\r\n}\r\n","import {Feature} from \"../../../Modules/Feature/Feature\";\r\nimport {HTML, LocalStorage, TimeUtils} from \"../../../../modulesCore\";\r\n\r\nexport default class FHDPlayer extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return document.querySelector(\"div.highlight_movie\");\r\n    }\r\n\r\n    apply() {\r\n\r\n        const that = this;\r\n        const movieNode = document.querySelector(\"div.highlight_movie\");\r\n        let playInHD = LocalStorage.get(\"playback_hd\");\r\n\r\n        function toggleFullscreen(videoControl) {\r\n            const fullscreenAvailable = document.fullscreenEnabled || document.mozFullScreenEnabled;\r\n\r\n            // Mozilla unprefixed in v64\r\n            if (!fullscreenAvailable) { return; }\r\n\r\n            const container = videoControl.parentNode;\r\n            const isFullscreen = document.fullscreenElement || document.mozFullScreenElement || document.webkitFullscreenElement;\r\n\r\n            /*\r\n             * Mozilla unprefixed in v64\r\n             * Chrome unprefixed in v53\r\n             */\r\n\r\n            if (isFullscreen) {\r\n                if (document.exitFullscreen) {\r\n                    document.exitFullscreen();\r\n                } else if (document.mozCancelFullScreen) {\r\n                    document.mozCancelFullScreen(); // Mozilla unprefixed in v64\r\n                }\r\n            } else {\r\n                let response = null;\r\n                if (container.requestFullscreen) {\r\n                    response = container.requestFullscreen();\r\n                } else if (container.mozRequestFullScreen) {\r\n                    response = container.mozRequestFullScreen(); // Mozilla unprefixed in v64\r\n                } else if (container.webkitRequestFullscreen) {\r\n                    container.webkitRequestFullscreen(); // Chrome unprefixed in v69, no promise\r\n                }\r\n\r\n                // if response is a promise, catch any errors it throws\r\n                Promise.resolve(response).catch(err => console.error(err));\r\n            }\r\n        }\r\n\r\n        async function addHDControl(videoControl) {\r\n\r\n            playInHD = LocalStorage.get(\"playback_hd\");\r\n\r\n            // prevents a bug in Chrome which causes videos to stop playing after changing the src\r\n            await TimeUtils.timer(150);\r\n\r\n            // Add \"HD\" button to the video\r\n            if (videoControl.dataset.hdSrc) {\r\n                const node = videoControl.parentNode.querySelector(\".time\");\r\n                if (node) {\r\n                    HTML.afterEnd(node, '<div class=\"es_hd_toggle\"><span>HD</span></div>');\r\n                }\r\n            }\r\n\r\n            // Override Valve's auto switch to HD when putting a video in fullscreen\r\n            let node = videoControl.parentNode.querySelector(\".fullscreen_button\");\r\n            if (node) {\r\n                let newNode = document.createElement(\"div\");\r\n                newNode.classList.add(\"fullscreen_button\");\r\n                newNode.addEventListener(\"click\", (() => toggleFullscreen(videoControl)), false);\r\n                node.replaceWith(newNode);\r\n                node = null; // prevent memory leak\r\n                newNode = null;\r\n            }\r\n\r\n            // Toggle fullscreen on video double click\r\n            videoControl.addEventListener(\"dblclick\", (() => toggleFullscreen(videoControl)), false);\r\n\r\n            that.context.toggleVideoDefinition(videoControl, playInHD);\r\n        }\r\n\r\n        // Add HD Control to each video as it's added to the DOM\r\n        const firstVideoIsPlaying = movieNode.querySelector(\"video.highlight_movie\");\r\n        if (firstVideoIsPlaying) {\r\n            addHDControl(firstVideoIsPlaying);\r\n        }\r\n\r\n        const observer = new MutationObserver(mutations => {\r\n            for (const mutation of mutations) {\r\n                for (const node of mutation.addedNodes) {\r\n                    if (!node.matches(\"video.highlight_movie\")) { continue; }\r\n                    addHDControl(node);\r\n                }\r\n            }\r\n        });\r\n        for (const node of document.querySelectorAll(\"div.highlight_movie\")) {\r\n            observer.observe(node, {\"childList\": true});\r\n        }\r\n\r\n        // When the \"HD\" button is clicked change the definition for all videos accordingly\r\n        document.querySelector(\"#highlight_player_area\").addEventListener(\"click\", ev => {\r\n\r\n            if (!ev.target.closest(\".es_hd_toggle\")) { return; }\r\n\r\n            ev.preventDefault();\r\n            ev.stopPropagation();\r\n\r\n            const videoControl = ev.target.closest(\"div.highlight_movie\").querySelector(\"video\");\r\n            const playInHD = this.context.toggleVideoDefinition(videoControl);\r\n\r\n            for (const node of document.querySelectorAll(\"video.highlight_movie\")) {\r\n                if (node === videoControl) { continue; }\r\n                this.context.toggleVideoDefinition(node, playInHD);\r\n            }\r\n\r\n            LocalStorage.set(\"playback_hd\", playInHD);\r\n        }, true);\r\n\r\n        // When the slider is expanded first time after the page was loaded set videos definition to HD\r\n        for (const node of document.querySelectorAll(\".es_slider_toggle\")) {\r\n            node.addEventListener(\"click\", function clickInitialHD(ev) {\r\n\r\n                ev.currentTarget.removeEventListener(\"click\", clickInitialHD, false);\r\n                if (!ev.target.classList.contains(\"es_expanded\")) { return; }\r\n                for (const node of document.querySelectorAll(\"video.highlight_movie.es_video_sd\")) {\r\n                    that.context.toggleVideoDefinition(node, true);\r\n                }\r\n                LocalStorage.set(\"playback_hd\", true);\r\n            }, false);\r\n        }\r\n    }\r\n}\r\n","import {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Feature, User} from \"../../../modulesContent\";\r\n\r\nexport default class FUserNotes extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return User.isSignedIn && SyncedStorage.get(\"user_notes_app\");\r\n    }\r\n\r\n    async apply() {\r\n\r\n        HTML.beforeBegin(\".queue_actions_ctn > :last-child\",\r\n            `<div id=\"esi-user-note-button\" class=\"queue_control_button\">\r\n                <div class=\"esi-add-note btnv6_blue_hoverfade btn_medium\">\r\n                    <span>${Localization.str.user_note.add}</span>\r\n                </div>\r\n                <div class=\"esi-update-note btnv6_blue_hoverfade btn_medium\">\r\n                    <span>${Localization.str.user_note.update}</span>\r\n                </div>\r\n            </div>`);\r\n\r\n        HTML.beforeEnd(\".queue_actions_ctn\",\r\n            '<div id=\"esi-store-user-note\" class=\"esi-note esi-note--store ellipsis\"></div>');\r\n\r\n        const button = document.querySelector(\"#esi-user-note-button\");\r\n        const noteEl = document.querySelector(\"#esi-store-user-note\");\r\n\r\n        const userNotes = this.context.userNotes;\r\n        const note = await userNotes.get(this.context.appid);\r\n\r\n        if (note !== null) {\r\n            button.classList.add(\"esi-has-note\");\r\n\r\n            noteEl.textContent = `\"${note}\"`;\r\n            noteEl.classList.add(\"esi-has-note\");\r\n        }\r\n\r\n        const handler = () => {\r\n            userNotes.showModalDialog(\r\n                this.context.appName,\r\n                this.context.appid,\r\n                noteEl,\r\n                (node, active) => {\r\n                    button.classList.toggle(\"esi-has-note\", active);\r\n                    node.classList.toggle(\"esi-has-note\", active);\r\n                }\r\n            );\r\n        };\r\n\r\n        button.addEventListener(\"click\", handler);\r\n        noteEl.addEventListener(\"click\", handler);\r\n    }\r\n}\r\n","import {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Background, Feature} from \"../../../modulesContent\";\r\nimport {Page} from \"../../Page\";\r\n\r\nexport default class FWaitlistDropdown extends Feature {\r\n\r\n    async checkPrerequisites() {\r\n        return SyncedStorage.get(\"add_to_waitlist\")\r\n            && document.querySelector(\"#add_to_wishlist_area\") !== null\r\n            && (await Background.action(\"itad.isconnected\")) === true;\r\n    }\r\n\r\n    async apply() {\r\n\r\n        // Remove Steam's temp notice and native dropdown menu\r\n        for (const node of document.querySelectorAll(\"#add_to_wishlist_area_success > div\")) {\r\n            node.remove();\r\n        }\r\n\r\n        const wishlistDivs = document.querySelectorAll(\"#add_to_wishlist_area,#add_to_wishlist_area_success\");\r\n        const [wishlistArea, wishlistSuccessArea] = wishlistDivs;\r\n\r\n        HTML.afterEnd(\".queue_actions_ctn :first-child\",\r\n            `<div style=\"position: relative; display: inline-block;\">\r\n                <div class=\"queue_control_button as_btn_wishlist\"></div>\r\n            </div>`);\r\n\r\n        /*\r\n         * Creating a common parent for #add_to_wishlist_area and #add_to_wishlist_area_success\r\n         * makes it easier to apply the dropdown menu\r\n         */\r\n        const wrapper = document.querySelector(\".as_btn_wishlist\");\r\n\r\n        // Move the wrapper such that there can't be any other elements in between the dropdown and other buttons (see #690)\r\n        document.querySelector(\".queue_actions_ctn\").insertBefore(wrapper.parentNode, wishlistArea);\r\n\r\n        wrapper.append(...wishlistDivs);\r\n\r\n        HTML.afterEnd(wrapper,\r\n            `<div class=\"queue_control_button queue_btn_menu as_btn_wishlist_menu\">\r\n                <div class=\"queue_menu_arrow btn_medium\">\r\n                    <span><img src=\"https://steamstore-a.akamaihd.net/public/images/v6/btn_arrow_down_padded.png\"></span>\r\n                </div>\r\n                <div class=\"queue_menu_flyout\">\r\n                    <div class=\"queue_menu_flyout_content\">\r\n                        <div class=\"queue_menu_option\" id=\"queue_menu_option_on_wishlist\">\r\n                            <div>\r\n                                <img class=\"queue_ignore_menu_option_image selected\" src=\"https://steamstore-a.akamaihd.net/public/images/v6/ico/ico_selected_bright.png\">\r\n                                <img class=\"queue_ignore_menu_option_image unselected\" src=\"https://steamstore-a.akamaihd.net/public/images/v6/ico/ico_unselected_bright.png\">\r\n                            </div>\r\n                            <div class=\"queue_menu_option_label\">\r\n                                <div class=\"option_title\">${Localization.str.wishlist} (${Localization.str.theworddefault})</div>\r\n                                <div class=\"option_subtitle\">${Localization.str.add_to_wishlist}</div>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"queue_menu_option\" id=\"queue_menu_option_on_waitlist\">\r\n                            <div>\r\n                                <img class=\"queue_ignore_menu_option_image selected\" src=\"https://steamstore-a.akamaihd.net/public/images/v6/ico/ico_selected_bright.png\">\r\n                                <img class=\"queue_ignore_menu_option_image unselected\" src=\"https://steamstore-a.akamaihd.net/public/images/v6/ico/ico_unselected_bright.png\">\r\n                            </div>\r\n                            <div class=\"queue_menu_option_label\">\r\n                                <div class=\"option_title\">Waitlist</div>\r\n                                <div class=\"option_subtitle\">${Localization.str.add_to_waitlist}</div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>`);\r\n\r\n        let wishlisted = document.querySelector(\"#add_to_wishlist_area\").style.display === \"none\";\r\n        let waitlisted = await Background.action(\"itad.inwaitlist\", this.context.storeid);\r\n\r\n        const menu = document.querySelector(\".as_btn_wishlist_menu\");\r\n        const menuArrow = menu.querySelector(\".queue_menu_arrow\");\r\n        const wishlistOption = document.querySelector(\"#queue_menu_option_on_wishlist\");\r\n        const waitlistOption = document.querySelector(\"#queue_menu_option_on_waitlist\");\r\n\r\n        function updateDiv() {\r\n            const oneActive = Boolean(wishlisted) || Boolean(waitlisted);\r\n\r\n            menuArrow.classList.toggle(\"queue_btn_active\", oneActive);\r\n\r\n            menu.classList.toggle(\"on_wishlist\", wishlisted);\r\n            menu.classList.toggle(\"on_waitlist\", waitlisted);\r\n\r\n            wishlistArea.style.display = oneActive ? \"none\" : \"\";\r\n            wishlistSuccessArea.style.display = oneActive ? \"\" : \"none\";\r\n\r\n            let text;\r\n            if (wishlisted && !waitlisted) {\r\n                text = Localization.str.on_wishlist;\r\n            } else if (!wishlisted && waitlisted) {\r\n                text = Localization.str.on_waitlist;\r\n            } else if (wishlisted && waitlisted) {\r\n                text = `${Localization.str.on_wishlist} & ${Localization.str.on_waitlist}`;\r\n            } else {\r\n                document.querySelector(\"#add_to_wishlist_area span\").textContent = ` ${Localization.str.add_to_wishlist}`;\r\n                return;\r\n            }\r\n\r\n            document.querySelector(\"#add_to_wishlist_area_success span\").lastChild.textContent = ` ${text}`;\r\n        }\r\n\r\n        updateDiv();\r\n\r\n        wishlistArea.querySelector(\"a\").addEventListener(\"click\", async() => {\r\n\r\n            await Page.runInPageContext(() => new Promise(resolve => {\r\n                const d = window.SteamFacade.jq(document);\r\n                d.ajaxComplete(function handler(e, xhr, {url}) {\r\n                    if (url === \"https://store.steampowered.com/api/addtowishlist\") {\r\n                        resolve();\r\n                        d.unbind(\"ajaxComplete\", handler);\r\n                    }\r\n                });\r\n            }), null, true);\r\n\r\n            wishlisted = !wishlisted;\r\n            updateDiv();\r\n        });\r\n\r\n        this.context.onWishAndWaitlistRemove = () => {\r\n            wishlisted = false;\r\n            waitlisted = false;\r\n            updateDiv();\r\n        };\r\n\r\n        wishlistOption.addEventListener(\"click\", async() => {\r\n            if (wishlisted) {\r\n                await this.context.removeFromWishlist();\r\n                wishlisted = !wishlisted;\r\n                updateDiv();\r\n            } else {\r\n                wishlistArea.querySelector(\"a\").click();\r\n            }\r\n        });\r\n\r\n        waitlistOption.addEventListener(\"click\", async() => {\r\n            if (waitlisted) {\r\n                await this.context.removeFromWaitlist();\r\n            } else {\r\n                await Background.action(\"itad.addtowaitlist\", this.context.appid);\r\n            }\r\n            waitlisted = !waitlisted;\r\n            updateDiv();\r\n        });\r\n    }\r\n}\r\n","import {HTML, Localization} from \"../../../../modulesCore\";\r\nimport {Feature} from \"../../../modulesContent\";\r\nimport {Page} from \"../../Page\";\r\n\r\nexport default class FNewQueue extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return document.querySelector(\".finish_queue_text\") !== null;\r\n    }\r\n\r\n    apply() {\r\n\r\n        HTML.afterEnd(\".btn_next_in_queue\",\r\n            `<div id=\"es_new_queue\" class=\"btn_next_in_queue btn_next_in_queue_trigger\" data-tooltip-text=\"${Localization.str.queue.new_tooltip}\">\r\n                <div class=\"next_in_queue_content\">\r\n                    <span class=\"finish_queue_text\">${Localization.str.queue.new}</span>\r\n                </div>\r\n            </div>`);\r\n\r\n        Page.runInPageContext(() => {\r\n            const f = window.SteamFacade;\r\n            f.vTooltip(\"#es_new_queue\");\r\n\r\n            f.jqOnClick(\"#es_new_queue\", () => {\r\n                const queueType = f.global(\"g_eDiscoveryQueueType\");\r\n                f.jqAjax({\r\n                    \"url\": `https://store.steampowered.com/explore/next/${queueType}/`,\r\n                    \"type\": \"POST\",\r\n                    \"data\": f.jq(\"#next_in_queue_form\").serialize(),\r\n                    \"success\": () => { window.location.href = `https://store.steampowered.com/explore/startnew/${queueType}/`; }\r\n\r\n                    // TODO error handling, waiting on #231 and #275 to merge\r\n                });\r\n            });\r\n        });\r\n    }\r\n}\r\n","import {Feature} from \"../../../Modules/Feature/Feature\";\r\nimport {HTML} from \"../../../../modulesCore\";\r\n\r\nexport default class FFullscreenScreenshotView extends Feature {\r\n\r\n    apply() {\r\n\r\n        function toggleFullScreen(ev) {\r\n            if (document.fullscreenElement) {\r\n                document.exitFullscreen();\r\n            } else {\r\n                ev.target.closest(\".screenshot_popup_modal_content\").requestFullscreen();\r\n            }\r\n        }\r\n\r\n        function initFSVButtons() {\r\n            const modalFooter = document.querySelector(\".screenshot_popup_modal_footer\");\r\n            const nextButton = modalFooter.querySelector(\".next\");\r\n            let nextButtonOffsetWidth = nextButton.offsetWidth;\r\n            if (nextButton.style.display === \"none\") {\r\n                nextButton.style.display = \"\";\r\n                nextButtonOffsetWidth = nextButton.offsetWidth;\r\n                nextButton.style.display = \"none\";\r\n            }\r\n            HTML.beforeEnd(modalFooter,\r\n                `<div class=\"btnv6_blue_hoverfade btn_medium es_screenshot_fullscreen_toggle\" style=\"right: calc(${nextButtonOffsetWidth}px + 0.5em)\"><i></i></div>`);\r\n            const fsvButton = modalFooter.querySelector(\".es_screenshot_fullscreen_toggle\");\r\n            fsvButton.addEventListener(\"click\", toggleFullScreen);\r\n\r\n            const modalTitleLink = modalFooter.parentElement.querySelector(\".screenshot_popup_modal_title > a\");\r\n            HTML.beforeEnd(modalFooter,\r\n                `<div class=\"btnv6_blue_hoverfade btn_medium es_screenshot_open_btn\" style=\"right: calc(${nextButtonOffsetWidth + fsvButton.offsetWidth}px + 1em)\"><i></i></div>`);\r\n            const openButton = modalFooter.querySelector(\".es_screenshot_open_btn\");\r\n            openButton.addEventListener(\"click\", () => {\r\n                window.open(modalTitleLink.href, \"_blank\");\r\n            });\r\n        }\r\n\r\n        const observer = new MutationObserver(mutations => {\r\n            for (const mutation of mutations) {\r\n                for (const node of mutation.addedNodes) {\r\n                    if (node.classList.contains(\"screenshot_popup_modal\")) {\r\n                        initFSVButtons();\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        observer.observe(document.body, {\"childList\": true});\r\n    }\r\n}\r\n","import {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {CurrencyManager, Feature, Inventory, Price} from \"../../../modulesContent\";\r\n\r\nexport default class FShowCoupon extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return SyncedStorage.get(\"show_coupon\");\r\n    }\r\n\r\n    async apply() {\r\n        const coupon = await Inventory.getCoupon(this.context.appid);\r\n        if (!coupon) { return; }\r\n\r\n        const couponDate = coupon.valid && coupon.valid.replace(/\\[date](.+)\\[\\/date]/, (m0, m1) => { return new Date(m1 * 1000).toLocaleString(); });\r\n\r\n        HTML.beforeBegin(\"#game_area_purchase\",\r\n            `<div class=\"early_access_header es_coupon_info\">\r\n                <div class=\"heading\">\r\n                    <h1 class=\"inset\">${Localization.str.coupon_available}</h1>\r\n                    <h2 class=\"inset\">${Localization.str.coupon_application_note}</h2>\r\n                    <p>${Localization.str.coupon_learn_more}</p>\r\n                </div>\r\n                <div class=\"devnotes\">\r\n                    <div style=\"display:flex;padding-top:10px\">\r\n                        <img src=\"//steamcommunity-a.akamaihd.net/economy/image/${coupon.image_url}\" style=\"width:96px;height:64px;\">\r\n                        <div style=\"display:flex;flex-direction:column;margin-left:10px\">\r\n                            <h1 style=\"margin-top:2px\">${coupon.title}</h1>\r\n                            <div>${coupon.discount_note || \"\"}</div>\r\n                            <div style=\"color:#a75124\">${couponDate}</div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>`);\r\n\r\n        // Update the purchase box with the discounted price\r\n        const purchaseDiv = document.querySelector(\".game_area_purchase_game_wrapper .game_purchase_action\");\r\n        if (!purchaseDiv) { return; }\r\n\r\n        if (purchaseDiv.querySelector(\".game_purchase_discount\") && coupon.discount_doesnt_stack) {\r\n            return;\r\n        }\r\n\r\n        const priceNode = purchaseDiv.querySelector(\"[data-price-final]\");\r\n        if (!priceNode) { return; }\r\n\r\n        const currency = CurrencyManager.fromType(CurrencyManager.storeCurrency);\r\n        const scaleFactor = 10 ** currency.format.decimalPlaces;\r\n\r\n        const originalPrice = Number(priceNode.dataset.priceFinal) / 100;\r\n        const discountPrice = Math.floor(originalPrice * (coupon.discount / 100) * scaleFactor) / scaleFactor;\r\n        const newFinalPrice = originalPrice - discountPrice;\r\n\r\n        HTML.replace(priceNode,\r\n            `<div class=\"discount_block game_purchase_discount\">\r\n                <div class=\"discount_pct\">-${coupon.discount}%</div>\r\n                <div class=\"discount_prices\">\r\n                    <div class=\"discount_original_price\">${new Price(originalPrice)}</div>\r\n                    <div class=\"discount_final_price\">${new Price(newFinalPrice)}</div>\r\n                </div>\r\n            </div>`);\r\n    }\r\n}\r\n","import {HTML, Localization} from \"../../../../modulesCore\";\r\nimport {Background, Feature} from \"../../../modulesContent\";\r\nimport Config from \"../../../../config\";\r\n\r\nexport default class FDLCInfo extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return this.context.isDlc;\r\n    }\r\n\r\n    async apply() {\r\n\r\n        let response;\r\n\r\n        try {\r\n            response = await Background.action(\"dlcinfo\", {\"appid\": this.context.appid, \"appname\": this.context.appName});\r\n            // TODO remove when suggestion link is fixed\r\n            if (!response || !response.length) { return; }\r\n        } catch (err) {\r\n            console.error(err);\r\n            return;\r\n        }\r\n\r\n        // const suggestUrl = `${Config.PublicHost}/gamedata/dlc_category_suggest.php?appid=${this.context.appid}&appname=${encodeURIComponent(this.context.appName)}`;\r\n\r\n        let html = `<div class=\"block responsive_apppage_details_right heading\">${Localization.str.dlc_details}</div>\r\n                   <div class=\"block es_dlc_info\">\r\n                   <div class=\"block_content\"><div class=\"block_content_inner\"><div class=\"details_block\">`;\r\n\r\n        for (const item of response) {\r\n            const iconUrl = `${Config.PublicHost}/gamedata/icons/${encodeURIComponent(item.icon)}`;\r\n            const title = HTML.escape(item.desc);\r\n            const name = HTML.escape(item.name);\r\n\r\n            html += `<div class=\"game_area_details_specs\">\r\n                        <div class=\"icon\"><img src=\"${iconUrl}\"></div>\r\n                        <a class=\"name\" title=\"${title}\">${name}</a>\r\n                    </div>`;\r\n        }\r\n\r\n        html += \"</div>\";\r\n        // html += `<br><a class=\"linkbar es_external_icon\" href=\"${suggestUrl}\" target=\"_blank\">${Localization.str.dlc_suggest}</a>`;\r\n        html += \"</div></div></div>\";\r\n\r\n        HTML.beforeBegin(document.querySelector(\"#category_block\"), html);\r\n    }\r\n}\r\n","import {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Feature} from \"../../../Modules/Feature/Feature\";\r\n\r\nexport default class FMetacriticUserScore extends Feature {\r\n\r\n    async checkPrerequisites() {\r\n        if (!SyncedStorage.get(\"showmcus\") || !document.querySelector(\"#game_area_metascore\")) {\r\n            return false;\r\n        }\r\n\r\n        const result = await this.context.data;\r\n        if (!result || !result.data || !result.data.userscore) {\r\n            return false;\r\n        }\r\n\r\n        this._data = result.data.userscore;\r\n        return true;\r\n    }\r\n\r\n    apply() {\r\n\r\n        const metauserscore = this._data * 10;\r\n        if (isNaN(metauserscore)) { return; }\r\n\r\n        let rating;\r\n        if (metauserscore >= 75) {\r\n            rating = \"high\";\r\n        } else if (metauserscore >= 50) {\r\n            rating = \"medium\";\r\n        } else {\r\n            rating = \"low\";\r\n        }\r\n\r\n        HTML.afterEnd(\"#game_area_metascore\",\r\n            `<div id=\"game_area_userscore\">\r\n                <div class=\"score ${rating}\">${metauserscore}</div>\r\n                <div class=\"logo\"></div>\r\n                <div class=\"wordmark\">\r\n                    <div class=\"metacritic\">${Localization.str.user_score}</div>\r\n                </div>\r\n            </div>`);\r\n    }\r\n}\r\n","import {ExtensionResources, HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Feature} from \"../../../modulesContent\";\r\n\r\nexport default class FOpenCritic extends Feature {\r\n\r\n    async checkPrerequisites() {\r\n        if (!SyncedStorage.get(\"showoc\")) { return false; }\r\n\r\n        const result = await this.context.data;\r\n        if (!result || !result.oc || !result.oc.url) {\r\n            return false;\r\n        }\r\n\r\n        this._data = result.oc;\r\n        return true;\r\n    }\r\n\r\n    apply() {\r\n\r\n        const data = this._data;\r\n        const ocImg = ExtensionResources.getURL(\"img/opencritic.png\");\r\n        const award = data.award || \"NA\";\r\n\r\n        let node = document.querySelector(\"#game_area_metascore\");\r\n        if (node) {\r\n            node = node.parentNode;\r\n        } else {\r\n            node = document.querySelector(\".game_details\");\r\n        }\r\n\r\n        HTML.afterEnd(node,\r\n            `<div class=\"block responsive_apppage_reviewblock\">\r\n                <div id=\"game_area_opencritic\">\r\n                    <div class=\"score ${award.toLowerCase()}\">${data.score ? data.score : \"--\"}</div>\r\n                    <div class=\"logo\"><img src=\"${ocImg}\"></div>\r\n                    <div class=\"wordmark\">\r\n                        <div class=\"metacritic\">OpenCritic</div>\r\n                        <div id=\"game_area_metalink\">${award} - <a href=\"${data.url}?utm_source=enhanced-steam-itad&utm_medium=average\" target=\"_blank\">${Localization.str.read_reviews}</a>\r\n                            <img src=\"https://steamstore-a.akamaihd.net/public/images/ico/iconExternalLink.gif\" border=\"0\" align=\"bottom\">\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div style=\"clear: both;\"></div>\r\n            </div>`);\r\n\r\n        let reviews = \"\";\r\n        for (const review of data.reviews) {\r\n            const date = new Date(review.date).toLocaleDateString();\r\n            reviews += `<p>\"${review.snippet}\"<br>${review.dScore} - <a href=\"${review.rUrl}\" target=\"_blank\" data-tooltip-text=\"${review.author}, ${date}\">${review.name}</a></p>`;\r\n        }\r\n\r\n        if (reviews) {\r\n            const html = `<div id=\"es_opencritic_reviews\">\r\n                ${reviews}\r\n                <div class=\"chart-footer\">\r\n                    ${Localization.str.read_more_reviews}\r\n                    <a href=\"${data.url}?utm_source=enhanced-steam-itad&utm_medium=reviews\" target=\"_blank\">OpenCritic.com</a>\r\n                </div>\r\n            </div>`;\r\n\r\n            // Add data to the review section in the left column, or create one if that block doesn't exist\r\n            const reviewsNode = document.getElementById(\"game_area_reviews\");\r\n            if (reviewsNode) {\r\n                HTML.beforeEnd(reviewsNode, html);\r\n            } else {\r\n                HTML.beforeBegin(document.getElementById(\"game_area_description\").parentElement.parentElement,\r\n                    `<div id=\"game_area_reviews\" class=\"game_area_description\">\r\n                        <h2>${Localization.str.reviews}</h2>\r\n                        ${html}\r\n                    </div>`);\r\n            }\r\n        }\r\n    }\r\n}\r\n","import {Background, Feature} from \"../../../modulesContent\";\r\nimport {HTML, Localization} from \"../../../../modulesCore\";\r\n\r\nexport default class FOwnedElsewhere extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return !this.context.isOwned && Background.action(\"itad.isconnected\");\r\n    }\r\n\r\n    async apply() {\r\n        const response = await Background.action(\"itad.getfromcollection\", this.context.storeid);\r\n        if (!response) { return; }\r\n\r\n        const storeList = response.map(store => `<strong>${store}</strong>`).join(\", \");\r\n\r\n        HTML.afterEnd(\".queue_overflow_ctn\",\r\n            `<div class=\"game_area_already_owned page_content\" style=\"background-image: linear-gradient(to right, #856d0e 0%, #d1a906 100%);\">\r\n                <div class=\"ds_owned_flag ds_flag\" style=\"background-color: #856d0e;\">${Localization.str.coll.in_collection.toUpperCase()}&nbsp;&nbsp;</div>\r\n                <div class=\"already_in_library\" style=\"color: #ffe000;\">${Localization.str.owned_elsewhere.replace(\"__gametitle__\", this.context.appName).replace(\"__storelist__\", storeList)}</div>\r\n            </div>`);\r\n    }\r\n}\r\n","import {Language, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Feature, User} from \"../../../modulesContent\";\r\n\r\nexport default class FPurchaseDate extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        if (User.isSignedIn && SyncedStorage.get(\"purchase_dates\")) {\r\n            this._node = document.querySelector(\".game_area_already_owned .already_in_library\");\r\n            return this._node;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    async apply() {\r\n        const appname = this.context.appName.replace(/:/g, \"\").trim();\r\n        const date = await User.getPurchaseDate(Language.getCurrentSteamLanguage(), appname);\r\n        if (!date) {\r\n            console.warn(\"Failed to retrieve purchase date\");\r\n            return;\r\n        }\r\n\r\n        this._node.textContent += ` ${Localization.str.purchase_date.replace(\"__date__\", date)}`;\r\n    }\r\n}\r\n","import {HTML, LocalStorage, Localization} from \"../../../../modulesCore\";\r\nimport {Background, Feature} from \"../../../modulesContent\";\r\nimport {Page} from \"../../Page\";\r\nimport FHighlightsTags from \"../../Common/FHighlightsTags\";\r\n\r\nexport default class FSteamPeek extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        this._moreLikeThis = document.querySelector(\"#recommended_block\");\r\n        return this._moreLikeThis;\r\n    }\r\n\r\n    async apply() {\r\n\r\n        HTML.afterEnd(this._moreLikeThis.querySelector(\".block_header\"),\r\n            `<div class=\"es_tabs\">\r\n                <div class=\"home_tabs_row\">\r\n                    <div id=\"es_tab_steamsimilar\" class=\"es_tab home_tab active\">\r\n                        <div class=\"tab_content\">Steam</div>\r\n                    </div>\r\n                    <div id=\"es_tab_steampeek\" class=\"es_tab home_tab\">\r\n                        <div class=\"tab_content\">SteamPeek</div>\r\n                    </div>\r\n                </div>\r\n            </div>`);\r\n\r\n        HTML.beforeEnd(\r\n            this._moreLikeThis.querySelector(\".store_horizontal_autoslider_ctn\"),\r\n            `<div class=\"block_responsive_horizontal_scroll store_horizontal_autoslider block_content nopad\"\r\n                        id=\"es_steampeek_content\"></div>`,\r\n        );\r\n\r\n        // TODO Create a global handler for DS loading\r\n        await Page.runInPageContext(() => new Promise(resolve => {\r\n            window.SteamFacade.onDynamicStoreReady(() => { resolve(); });\r\n        }), null, true);\r\n\r\n        const [steamTab, steamPeekTab, content] = this._moreLikeThis\r\n            .querySelectorAll(\"#es_tab_steamsimilar, #es_tab_steampeek, #recommended_block_content\");\r\n\r\n        steamTab.addEventListener(\"click\", () => {\r\n            steamPeekTab.classList.remove(\"active\");\r\n            steamTab.classList.add(\"active\");\r\n            content.classList.remove(\"es_sp_active\");\r\n            content.classList.add(\"es_steam_active\");\r\n\r\n            LocalStorage.set(\"steampeek\", false);\r\n\r\n            this._adjustScroller();\r\n        });\r\n\r\n        let spLoaded = false;\r\n        steamPeekTab.addEventListener(\"click\", async() => {\r\n            steamPeekTab.classList.add(\"active\");\r\n            steamTab.classList.remove(\"active\");\r\n            content.classList.add(\"es_sp_active\");\r\n            content.classList.remove(\"es_steam_active\");\r\n\r\n            LocalStorage.set(\"steampeek\", true);\r\n\r\n            if (!spLoaded) {\r\n                spLoaded = true;\r\n\r\n                for (const node of content.querySelectorAll(\":scope > a\")) {\r\n                    node.classList.add(\"es_steam_similar\");\r\n                }\r\n\r\n                const data = await Background.action(\"steampeek\", this.context.appid);\r\n                if (!data) { return; }\r\n\r\n                const lastChild = content.querySelector(\":scope > :last-child\");\r\n\r\n                for (const {title, appid} of data) {\r\n                    HTML.beforeBegin(lastChild,\r\n                        `<a class=\"small_cap es_sp_similar\" data-ds-appid=\"${appid}\" href=\"https://store.steampowered.com/app/${appid}/\">\r\n                            <img src=\"https://steamcdn-a.akamaihd.net/steam/apps/${appid}/capsule_184x69.jpg\" class=\"small_cap_img\"></img>\r\n                            <h4>${title}</h4>\r\n                        </a>`);\r\n\r\n\r\n                    Page.runInPageContext(appid => {\r\n                        window.SteamFacade.storeItemDataBindHover(\"#recommended_block_content > a:last-of-type\", appid);\r\n                    }, [appid]);\r\n                }\r\n\r\n                Page.runInPageContext(() => {\r\n                    window.SteamFacade.dynamicStoreDecorateItems(\"#recommended_block_content > a.es_sp_similar\");\r\n                });\r\n\r\n                FHighlightsTags.highlightAndTag(content.querySelectorAll(\"a.es_sp_similar\"), true);\r\n\r\n                HTML.beforeBegin(lastChild,\r\n                    `<a class=\"small_cap es_sp_similar\" href=\"http://steampeek.hu/?appid=${this.context.appid}\" target=\"_blank\">\r\n                        <div class=\"es_sp_similar__link\">${Localization.str.more_on_steampeek}</div>\r\n                    </a>`);\r\n            }\r\n\r\n            this._adjustScroller();\r\n        });\r\n\r\n        if (LocalStorage.get(\"steampeek\")) {\r\n            steamPeekTab.click();\r\n        }\r\n    }\r\n\r\n    _adjustScroller() {\r\n        Page.runInPageContext(() => {\r\n            window.SteamFacade.jq(\"#recommended_block_content\").trigger(\"v_contentschanged\");\r\n        });\r\n    }\r\n}\r\n","import {ExtensionResources, HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Feature} from \"../../../Modules/Feature/Feature\";\r\n\r\nexport default class FWidescreenCertification extends Feature {\r\n\r\n    constructor(context) {\r\n        super(context);\r\n\r\n        this._levelMap = {\r\n            \"A\": \"gold\",\r\n            \"B\": \"silver\",\r\n            \"C\": \"limited\",\r\n            \"Incomplete\": \"incomplete\",\r\n            \"Unsupported\": \"unsupported\"\r\n        };\r\n    }\r\n\r\n    async checkPrerequisites() {\r\n        if (!SyncedStorage.get(\"showwsgf\")\r\n            || this.context.isDlcLike\r\n            || this.context.isVideoOrHardware) {\r\n            return false;\r\n        }\r\n\r\n        const result = await this.context.data;\r\n        if (!result || !result.wsgf) {\r\n            return false;\r\n        }\r\n\r\n        this._data = result.wsgf;\r\n        return true;\r\n    }\r\n\r\n    _getType(value, imgPrefix, typeName) {\r\n\r\n        let icon = \"\";\r\n        let text = \"\";\r\n\r\n        const level = this._levelMap[value];\r\n        if (level) {\r\n            icon = ExtensionResources.getURL(`img/wsgf/${imgPrefix}-${level}.png`);\r\n            text = Localization.str.wsgf[level].replace(/__type__/g, typeName);\r\n        }\r\n        return [icon, text];\r\n    }\r\n\r\n    apply() {\r\n\r\n        const {\r\n            \"Path\": path,\r\n            \"WideScreenGrade\": wsg,\r\n            \"MultiMonitorGrade\": mmg,\r\n            \"Grade4k\": fkg,\r\n            \"UltraWideScreenGrade\": uws,\r\n        } = this._data;\r\n\r\n        const [wsgIcon, wsgText] = this._getType(wsg, \"ws\", \"Widescreen\");\r\n        const [mmgIcon, mmgText] = this._getType(mmg, \"mm\", \"Multi-Monitor\");\r\n        const [uwsIcon, uwsText] = this._getType(uws, \"uw\", \"Ultra-Widescreen\");\r\n        const [fkgIcon, fkgText] = this._getType(fkg, \"4k\", \"4k UHD\");\r\n\r\n        HTML.afterEnd(\"div.game_details\",\r\n            `<div class=\"block responsive_apppage_details_right heading\">${Localization.str.wsgf.certifications}</div>\r\n            <div class=\"block underlined_links es_wsgf\">\r\n                <div class=\"block_content\">\r\n                    <div class=\"block_content_inner\">\r\n                        <div class=\"details_block\">\r\n                            ${wsg ? `<img src=\"${HTML.escape(wsgIcon)}\" title=\"${HTML.escape(wsgText)}\">` : \"\"}\r\n                            ${mmg ? `<img src=\"${HTML.escape(mmgIcon)}\" title=\"${HTML.escape(mmgText)}\">` : \"\"}\r\n                            ${uws ? `<img src=\"${HTML.escape(uwsIcon)}\" title=\"${HTML.escape(uwsText)}\">` : \"\"}\r\n                            ${fkg ? `<img src=\"${HTML.escape(fkgIcon)}\" title=\"${HTML.escape(fkgText)}\">` : \"\"}\r\n                        </div>\r\n                        <br>\r\n                        <a class=\"linkbar es_external_icon\" target=\"_blank\" href=\"${HTML.escape(path)}\">${Localization.str.rating_details}</a>\r\n                    </div>\r\n                </div>\r\n            </div>`);\r\n    }\r\n}\r\n","import {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Feature} from \"../../../modulesContent\";\r\n\r\nexport default class FHowLongToBeat extends Feature {\r\n\r\n    async checkPrerequisites() {\r\n        if (!SyncedStorage.get(\"showhltb\")\r\n            || this.context.isDlcLike\r\n            || this.context.isVideoOrHardware) {\r\n            return false;\r\n        }\r\n\r\n        const result = await this.context.data;\r\n        if (!result || !result.hltb) {\r\n            return false;\r\n        }\r\n\r\n        // TODO remove when suggestion link is fixed\r\n        if (!result.hltb.success) { return false; }\r\n\r\n        this._data = result.hltb;\r\n        return true;\r\n    }\r\n\r\n    apply() {\r\n\r\n        const data = this._data;\r\n\r\n        let html = `<div class=\"block responsive_apppage_details_right heading\">${Localization.str.hltb.title}</div>\r\n                    <div class=\"block game_details underlined_links es_hltb\">\r\n                    <div class=\"block_content\"><div class=\"block_content_inner\"><div class=\"details_block\">`;\r\n\r\n        if (data.success) {\r\n            if (data.main_story) {\r\n                html += `<b>${Localization.str.hltb.main}:</b><span>${HTML.escape(data.main_story)}</span><br>`;\r\n            }\r\n            if (data.main_extras) {\r\n                html += `<b>${Localization.str.hltb.main_e}:</b><span>${HTML.escape(data.main_extras)}</span><br>`;\r\n            }\r\n            if (data.comp) {\r\n                html += `<b>${Localization.str.hltb.compl}:</b><span>${HTML.escape(data.comp)}</span><br>`;\r\n            }\r\n\r\n            html += `</div>\r\n                    <a class=\"linkbar es_external_icon\" href=\"${HTML.escape(data.url)}\" target=\"_blank\">${Localization.str.more_information}</a>\r\n                    <a class=\"linkbar es_external_icon\" href=\"${HTML.escape(data.submit_url)}\" target=\"_blank\">${Localization.str.hltb.submit}</a>`;\r\n        } else {\r\n            html += `${Localization.str.hltb.no_data}</div>`;\r\n        }\r\n\r\n        html += \"</div></div></div>\";\r\n\r\n        HTML.afterEnd(\"div.game_details\", html);\r\n    }\r\n}\r\n","import {Feature} from \"../../../Modules/Feature/Feature\";\r\nimport {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\n\r\nexport default class FFamilySharingNotice extends Feature {\r\n\r\n    async checkPrerequisites() {\r\n        if (!SyncedStorage.get(\"exfgls\")) { return false; }\r\n\r\n        const result = await this.context.data;\r\n        if (!result || !result.exfgls || !result.exfgls.excluded) {\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    apply() {\r\n        HTML.beforeBegin(\"#game_area_purchase\",\r\n            `<div>\r\n                <div class=\"notice_box_top\"></div>\r\n                    <div class=\"notice_box_content\">${Localization.str.family_sharing_notice}</div>\r\n                <div class=\"notice_box_bottom\"></div>\r\n            </div>`);\r\n    }\r\n}\r\n","import {HTML, Localization} from \"../../../../modulesCore\";\r\nimport {CurrencyManager, Feature, Price} from \"../../../modulesContent\";\r\n\r\nexport default class FPackBreakdown extends Feature {\r\n\r\n    apply() {\r\n\r\n        for (const node of document.querySelectorAll(\".game_area_purchase_game_wrapper:not(.bundle_hidden_by_preferences)\")) {\r\n\r\n            // prevent false positives on packages e.g. Doom 3\r\n            if (node.querySelector(\".btn_packageinfo\")) { continue; }\r\n\r\n            let title = node.querySelector(\"h1\").textContent;\r\n            title = title.toLowerCase().replace(/-/g, \" \");\r\n\r\n            let text = \"\";\r\n            if (node.querySelector(\"p\")) {\r\n                text = node.querySelector(\"p\").textContent;\r\n            }\r\n\r\n            if (title.includes(\"2 pack\")\r\n                || title.includes(\"two pack\")\r\n                || title.includes(\"tower wars friend pack\")\r\n                || text.includes(\"gift copy\")\r\n                || text.includes(\"extra copy\")) {\r\n\r\n                this._splitPack(node, 2);\r\n\r\n            } else if (title.includes(\"3 pack\")\r\n                || title.includes(\"three pack\")\r\n                || title.includes(\"tower wars team pack\")) {\r\n\r\n                this._splitPack(node, 3);\r\n\r\n            } else if (title.includes(\"4 pack\")\r\n                || title.includes(\"four pack\")\r\n                || title.includes(\"clan pack\")) {\r\n\r\n                this._splitPack(node, 4);\r\n\r\n            } else if (title.includes(\"5 pack\")\r\n                || title.includes(\"five pack\")) {\r\n\r\n                this._splitPack(node, 5);\r\n\r\n            } else if (title.includes(\"6 pack\")\r\n                || title.includes(\"six pack\")) {\r\n\r\n                this._splitPack(node, 6);\r\n            }\r\n        }\r\n    }\r\n\r\n    _splitPack(node, ways) {\r\n        const priceNode = node.querySelector(\"[data-price-final]\");\r\n        if (!priceNode) { return; }\r\n\r\n        const currency = CurrencyManager.fromType(CurrencyManager.storeCurrency);\r\n        const scaleFactor = 10 ** currency.format.decimalPlaces;\r\n\r\n        let unitPrice = Number(priceNode.dataset.priceFinal) / 100 / ways;\r\n        unitPrice = Math.ceil(unitPrice * scaleFactor) / scaleFactor;\r\n\r\n        HTML.afterBegin(node.querySelector(\".game_purchase_action_bg\"),\r\n            `<div class=\"es_each_box\">\r\n                <div class=\"es_each_price\">${new Price(unitPrice)}</div>\r\n                <div class=\"es_each\">${Localization.str.each}</div>\r\n            </div>`);\r\n    }\r\n}\r\n","import {Feature} from \"../../../Modules/Feature/Feature\";\r\nimport {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\n\r\nexport default class FPackageInfoButton extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return SyncedStorage.get(\"show_package_info\");\r\n    }\r\n\r\n    apply() {\r\n\r\n        /**\r\n         * Exclude\r\n         * 1. free items (no form element to get subid, excluded by class selector)\r\n         * 2. blurred out items (no purchase option thus no form element to get subid)\r\n         * 3. subscriptions (no subid)\r\n         * 4. bundles\r\n         */\r\n        for (const node of document.querySelectorAll(\r\n            \".game_area_purchase_game_wrapper:not(.bundle_hidden_by_preferences, .game_purchase_sub_dropdown, .dynamic_bundle_description)\"\r\n        )) {\r\n            // Exclude entries that already have a \"Package info\" button\r\n            if (node.querySelector(\".btn_packageinfo\")) { return; }\r\n\r\n            const subid = node.querySelector(\"input[name=subid]\");\r\n            if (!subid) { continue; } // This should never happen; non-applicable items should ideally be excluded by the selector\r\n\r\n            HTML.afterBegin(node.querySelector(\".game_purchase_action\"),\r\n                `<div class=\"game_purchase_action_bg\">\r\n                    <div class=\"btn_addtocart btn_packageinfo\">\r\n                        <a class=\"btn_blue_steamui btn_medium\" href=\"//store.steampowered.com/sub/${subid.value}/\">\r\n                            <span>${Localization.str.package_info}</span>\r\n                        </a>\r\n                    </div>\r\n                </div>`);\r\n        }\r\n    }\r\n}\r\n","import {Feature} from \"../../../Modules/Feature/Feature\";\r\nimport {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\n\r\nexport default class FSteamChart extends Feature {\r\n\r\n    async checkPrerequisites() {\r\n        if (!SyncedStorage.get(\"show_steamchart_info\")\r\n            || this.context.isDlcLike\r\n            || this.context.isVideoOrHardware) {\r\n            return false;\r\n        }\r\n\r\n        const result = await this.context.data;\r\n        if (!result || !result.charts || !result.charts.chart || !result.charts.chart.peakall) {\r\n            return false;\r\n        }\r\n\r\n        this._chart = result.charts.chart;\r\n        return true;\r\n    }\r\n\r\n    apply() {\r\n\r\n        HTML.beforeBegin(document.querySelector(\".sys_req\").parentNode,\r\n            `<div id=\"steam-charts\" class=\"game_area_description\">\r\n                <h2>${Localization.str.charts.current}</h2>\r\n                <div class=\"chart-content\">\r\n                    <div class=\"chart-stat\"><span class=\"num\">${HTML.escape(this._chart.current)}</span><br>${Localization.str.charts.playing_now}</div>\r\n                    <div class=\"chart-stat\"><span class=\"num\">${HTML.escape(this._chart.peaktoday)}</span><br>${Localization.str.charts.peaktoday}</div>\r\n                    <div class=\"chart-stat\"><span class=\"num\">${HTML.escape(this._chart.peakall)}</span><br>${Localization.str.charts.peakall}</div>\r\n                </div>\r\n                <span class=\"chart-footer\">${Localization.str.powered_by.replace(\"__link__\", `<a href=\"https://steamcharts.com/app/${this.context.appid}\" target=\"_blank\">SteamCharts.com</a>`)}</span>\r\n            </div>`);\r\n    }\r\n}\r\n","import {Feature} from \"../../../Modules/Feature/Feature\";\r\nimport {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\n\r\nexport default class FSteamSpy extends Feature {\r\n\r\n    async checkPrerequisites() {\r\n        if (!SyncedStorage.get(\"show_steamspy_info\")\r\n            || this.context.isDlcLike\r\n            || this.context.isVideoOrHardware) {\r\n            return false;\r\n        }\r\n\r\n        const result = await this.context.data;\r\n        if (!result || !result.steamspy || !result.steamspy.owners) {\r\n            return false;\r\n        }\r\n\r\n        this._data = result.steamspy;\r\n        return true;\r\n    }\r\n\r\n    apply() {\r\n\r\n        const owners = this._data.owners.split(\"..\");\r\n        const ownersFrom = HTML.escape(owners[0].trim());\r\n        const ownersTo = HTML.escape(owners[1].trim());\r\n        const averageTotal = this._getTimeString(this._data.average_forever);\r\n        const average2weeks = this._getTimeString(this._data.average_2weeks);\r\n\r\n        HTML.beforeBegin(document.querySelector(\".sys_req\").parentNode,\r\n            `<div id=\"steam-spy\" class=\"game_area_description\">\r\n                <h2>${Localization.str.spy.player_data}</h2>\r\n                <div class=\"chart-content\">\r\n                    <div class=\"chart-stat\"><span class=\"num\">${ownersFrom}<br>-<br>${ownersTo}</span><br>${Localization.str.spy.owners}</div>\r\n                    <div class=\"chart-stat\"><span class=\"num\">${averageTotal}</span><br>${Localization.str.spy.average_playtime}</div>\r\n                    <div class=\"chart-stat\"><span class=\"num\">${average2weeks}</span><br>${Localization.str.spy.average_playtime_2weeks}</div>\r\n                </div>\r\n                <span class=\"chart-footer\">${Localization.str.powered_by.replace(\"__link__\", `<a href=\"https://steamspy.com/app/${this.context.appid}\" target=\"_blank\">steamspy.com</a>`)}</span>\r\n            </div>`);\r\n    }\r\n\r\n    _getTimeString(value) {\r\n\r\n        let _value = value;\r\n        const result = [];\r\n\r\n        const days = Math.trunc(_value / 1440);\r\n        if (days > 0) { result.push(`${days}d`); }\r\n        _value -= days * 1440;\r\n\r\n        const hours = Math.trunc(_value / 60);\r\n        result.push(`${hours}h`);\r\n        _value -= hours * 60;\r\n\r\n        const minutes = _value;\r\n        result.push(`${minutes}m`);\r\n\r\n        return result.join(\" \");\r\n    }\r\n}\r\n","import {Feature} from \"../../../Modules/Feature/Feature\";\r\nimport {HTML, Localization} from \"../../../../modulesCore\";\r\n\r\nexport default class FSurveyData extends Feature {\r\n\r\n    async checkPrerequisites() {\r\n        if (this.context.isDlcLike || this.context.isVideoOrHardware) {\r\n            return false;\r\n        }\r\n\r\n        const result = await this.context.data;\r\n        if (!result || !result.survey) {\r\n            return false;\r\n        }\r\n\r\n        this._survey = result.survey;\r\n        return true;\r\n    }\r\n\r\n    apply() {\r\n\r\n        const survey = this._survey;\r\n        let html = `<div id=\"performance_survey\" class=\"game_area_description\"><h2>${Localization.str.survey.performance_survey}</h2>`;\r\n\r\n        if (survey.success) {\r\n            html += `<p>${Localization.str.survey.users.replace(\"__users__\", survey.responses)}</p>`;\r\n\r\n            html += `<p><b>${Localization.str.survey.framerate}</b>: ${Math.round(survey.frp)}% ${Localization.str.survey.framerate_response}`;\r\n            switch (survey.fr) {\r\n                case \"30\": html += ` <span style=\"color: #8f0e10;\">${Localization.str.survey.framerate_30}</span>`; break;\r\n                case \"fi\": html += ` <span style=\"color: #e1c48a;\">${Localization.str.survey.framerate_fi}</span>`; break;\r\n                case \"va\": html += ` <span style=\"color: #8BC53F;\">${Localization.str.survey.framerate_va}</span>`; break;\r\n            }\r\n\r\n            html += `<br><b>${Localization.str.survey.resolution}</b>: ${Localization.str.survey.resolution_support}`;\r\n            switch (survey.mr) {\r\n                case \"less\": html += ` <span style=\"color: #8f0e10;\">${Localization.str.survey.resolution_less.replace(\"__pixels__\", \"1920x1080\")}</span>`; break;\r\n                case \"hd\": html += ` <span style=\"color: #8BC53F;\">${Localization.str.survey.resolution_up.replace(\"__pixels__\", \"1920x1080 (HD)\")}</span>`; break;\r\n                case \"wqhd\": html += ` <span style=\"color: #8BC53F;\">${Localization.str.survey.resolution_up.replace(\"__pixels__\", \"2560x1440 (WQHD)\")}</span>`; break;\r\n                case \"4k\": html += ` <span style=\"color: #8BC53F;\">${Localization.str.survey.resolution_up.replace(\"__pixels__\", \"3840x2160 (4K)\")}</span>`; break;\r\n            }\r\n\r\n            html += `<br><b>${Localization.str.survey.graphics_settings}</b>:`;\r\n            if (survey.gs) {\r\n                html += ` <span style=\"color: #8BC53F;\">${Localization.str.survey.gs_y}</span></p>`;\r\n            } else {\r\n                html += ` <span style=\"color: #8f0e10;\">${Localization.str.survey.gs_n}</span></p>`;\r\n            }\r\n\r\n            if ([\"nvidia\", \"amd\", \"intel\", \"other\"].some(key => key in survey)) {\r\n                html += `<p><b>${Localization.str.survey.satisfaction}</b>:</p><div class=\"performance-graph\">`;\r\n\r\n                if (\"nvidia\" in survey) { html += this._getBarHtml(\"Nvidia\", survey.nvidia); }\r\n                if (\"amd\" in survey) { html += this._getBarHtml(\"AMD\", survey.amd); }\r\n                if (\"intel\" in survey) { html += this._getBarHtml(\"Intel\", survey.intel); }\r\n                if (\"other\" in survey) { html += this._getBarHtml(\"Other\", survey.other); }\r\n\r\n                html += \"</div>\";\r\n            }\r\n        } else {\r\n            html += `<p>${Localization.str.survey.nobody}</p>`;\r\n        }\r\n\r\n        /*\r\n         * FIXME\r\n         * if (this.context.isOwnedAndPlayed) {\r\n         *   html += `<a class=\"btnv6_blue_blue_innerfade btn_medium es_btn_systemreqs\"\r\n         *      href=\"${Config.PublicHost}/survey/?appid=${this.context.appid}\"><span>${Localization.str.survey.take}</span></a>`;\r\n         * }\r\n         */\r\n\r\n        html += \"</div>\";\r\n\r\n        HTML.beforeBegin(document.querySelector(\".sys_req\").parentNode, html);\r\n    }\r\n\r\n    _getBarHtml(name, data) {\r\n        if (data > 90 || data < 10) {\r\n            return `<div class=\"row\"><div class=\"left-bar ${name.toLowerCase()}\" style=\"width: ${parseInt(data)}%;\"><span>${name}&nbsp;${data}%</span></div><div class=\"right-bar\" style=\"width: ${parseInt(100 - data)}%;\"></div></div>`;\r\n        } else {\r\n            return `<div class=\"row\"><div class=\"left-bar ${name.toLowerCase()}\" style=\"width: ${parseInt(data)}%;\"><span>${name}</span></div><div class=\"right-bar\" style=\"width: ${parseInt(100 - data)}%;\"><span>${data}%</span></div></div>`;\r\n        }\r\n    }\r\n}\r\n","import {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {ContextType, Feature, Messenger} from \"../../../modulesContent\";\r\nimport {Page} from \"../../Page\";\r\n\r\nexport default class FCustomizer extends Feature {\r\n\r\n    apply() {\r\n\r\n        HTML.afterBegin(\"#cart_status_data\",\r\n            `<div class=\"store_header_btn_gray store_header_btn\" id=\"es_customize_btn\">\r\n                <div class=\"es_customize_title\">${Localization.str.customize}<img src=\"//steamstore-a.akamaihd.net/public/images/v6/btn_arrow_down_padded_white.png\"></div>\r\n                <div class=\"home_viewsettings_popup\">\r\n                    <div class=\"home_viewsettings_instructions\">${Localization.str.apppage_sections}</div>\r\n                </div>\r\n            </div>`);\r\n\r\n        const customizeBtn = document.getElementById(\"es_customize_btn\");\r\n\r\n        customizeBtn.addEventListener(\"click\", () => {\r\n            customizeBtn.classList.toggle(\"active\");\r\n        });\r\n\r\n        customizeBtn.querySelector(\".home_viewsettings_popup\").addEventListener(\"click\", e => {\r\n            e.stopPropagation();\r\n        });\r\n\r\n        customizeBtn.addEventListener(\"mouseleave\", () => {\r\n            customizeBtn.classList.remove(\"active\");\r\n        });\r\n\r\n        if (this.context.type === ContextType.APP) {\r\n            this._customizeAppPage();\r\n        } else if (this.context.type === ContextType.STORE_FRONT) {\r\n\r\n            Messenger.onMessage(\"renderComplete\").then(() => { this._customizeFrontPage(); });\r\n\r\n            /*\r\n             * Run our customizer when GHomepage.bInitialRenderComplete is set to `true`\r\n             * https://github.com/SteamDatabase/SteamTracking/blob/d22d8df5db80e844f7ae1157dbb8b59532dfe4f8/store.steampowered.com/public/javascript/home.js#L432\r\n             */\r\n            Page.runInPageContext(() => {\r\n\r\n                // eslint-disable-next-line no-undef\r\n                if (GHomepage.bInitialRenderComplete) {\r\n                    window.Messenger.postMessage(\"renderComplete\");\r\n                    return;\r\n                }\r\n\r\n                // eslint-disable-next-line no-undef\r\n                GHomepage = new Proxy(GHomepage, {\r\n                    set(target, prop, value, ...args) {\r\n                        if (prop === \"bInitialRenderComplete\" && value === true) {\r\n                            window.Messenger.postMessage(\"renderComplete\");\r\n                        }\r\n\r\n                        return Reflect.set(target, prop, value, ...args);\r\n                    }\r\n                });\r\n            });\r\n        }\r\n    }\r\n\r\n    _customizeAppPage() {\r\n\r\n        function getParentEl(selector) {\r\n            const el = document.querySelector(selector);\r\n            return el && el.closest(\".game_page_autocollapse_ctn\");\r\n        }\r\n\r\n        const customizer = new FCustomizer.Customizer(\"customize_apppage\");\r\n        customizer\r\n            .add(\"franchisenotice\", \".franchise_notice\", Localization.str.apppage_franchise)\r\n            .add(\"eaheader\", \".early_access_header:not(.es_coupon_info)\", Localization.str.apppage_eaheader)\r\n            .add(\"eabanner\", \".early_access_banner\", Localization.str.apppage_eabanner)\r\n            .add(\"recentupdates\", \"[data-featuretarget=events-row]\", Localization.str.apppage_recentupdates)\r\n            .add(\"reviews\", \"#game_area_reviews\")\r\n            .add(\"about\", getParentEl(\"#game_area_description\"))\r\n            .add(\"contentwarning\", getParentEl(\"#game_area_content_descriptors\"))\r\n            .add(\"steamchart\", \"#steam-charts\")\r\n            .add(\"surveys\", \"#performance_survey\")\r\n            .add(\"steamspy\", \"#steam-spy\")\r\n            .add(\"sysreq\", getParentEl(\".sys_req\"))\r\n            .add(\"legal\", getParentEl(\"#game_area_legal\"), Localization.str.apppage_legal)\r\n            .add(\"moredlcfrombasegame\", \"#moredlcfrombasegame_block\")\r\n            .add(\"franchise\", \"#franchise_block\", Localization.str.apppage_morefromfranchise)\r\n            .add(\"morelikethis\", \"#recommended_block\")\r\n            .add(\"recommendedbycurators\", \".steam_curators_block\")\r\n            .add(\"customerreviews\", \"#app_reviews_hash\")\r\n            .add(\"workshop\", getParentEl(\"[href^='https://steamcommunity.com/workshop/browse']\"), Localization.str.apppage_workshop)\r\n            .add(\"greenlight\", getParentEl(\"[href^='https://steamcommunity.com/greenlight']\"), Localization.str.apppage_greenlight);\r\n\r\n        customizer.build();\r\n    }\r\n\r\n    _customizeFrontPage() {\r\n\r\n        function getParentEl(selector) {\r\n            const el = document.querySelector(selector);\r\n            return el && el.closest(\".home_ctn\");\r\n        }\r\n\r\n        const customizer = new FCustomizer.Customizer(\"customize_frontpage\");\r\n        customizer\r\n            .add(\"featuredrecommended\", \".home_cluster_ctn\")\r\n            .add(\"trendingamongfriends\", \".friends_recently_purchased\", \"\", true)\r\n            .add(\"discoveryqueue\", \".discovery_queue_ctn\")\r\n            .add(\"curators\", \".steam_curators_ctn\", Localization.str.homepage_curators)\r\n            .add(\"morecuratorrecommendations\", \".apps_recommended_by_curators_ctn\", Localization.str.homepage_curators)\r\n            .add(\"fromdevelopersandpublishersthatyouknow\", \".recommended_creators_ctn\")\r\n            .add(\"popularvrgames\", \".best_selling_vr_ctn\")\r\n            .add(\"homepagetabs\", \".tab_container\", Localization.str.homepage_tabs)\r\n            .add(\"gamesstreamingnow\", \".live_streams_ctn\", \"\", true)\r\n            .add(\"updatesandoffers\", \".marketingmessage_area\", \"\", true)\r\n            .add(\"topnewreleases\", \".top_new_releases\", Localization.str.homepage_topnewreleases)\r\n            .add(\"homepagesidebar\", \"body:not(.no_home_gutter) .home_page_gutter\", Localization.str.homepage_sidebar)\r\n            .add(\"specialoffers\", getParentEl(\".special_offers\"))\r\n            .add(\"browsesteam\", getParentEl(\".big_buttons.home_page_content\"))\r\n            .add(\"recentlyupdated\", getParentEl(\".recently_updated_block\"))\r\n            .add(\"under\", getParentEl(\"[class*='specials_under']\"));\r\n\r\n        for (const node of document.querySelectorAll(\r\n            \".home_page_body_ctn .home_ctn:not(.esi-customizer), .home_pagecontent_ctn\"\r\n        )) {\r\n            if (node.closest(\".esi-customizer\")\r\n                || node.querySelector(\".esi-customizer\")\r\n                || node.style.display === \"none\") { continue; }\r\n\r\n            customizer.addDynamic(node);\r\n        }\r\n\r\n        customizer.build();\r\n    }\r\n}\r\n\r\nFCustomizer.Customizer = class {\r\n\r\n    constructor(settingsName) {\r\n        this.settingsName = settingsName;\r\n        this.settings = SyncedStorage.get(settingsName);\r\n    }\r\n\r\n    _textValue(node) {\r\n        const textNode = node.querySelector(\"h1, h2, .home_title, .home_section_title\");\r\n        if (!textNode) { return \"\"; }\r\n        let str = \"\";\r\n        for (const node of textNode.childNodes) {\r\n            if (node.nodeType === Node.TEXT_NODE) {\r\n                str += node.textContent.trim();\r\n            }\r\n        }\r\n        return str;\r\n    }\r\n\r\n    _updateState(name, state) {\r\n        this.settings[name] = state;\r\n        SyncedStorage.set(this.settingsName, this.settings);\r\n    }\r\n\r\n    _getState(name) {\r\n        const state = this.settings[name];\r\n        return (typeof state === \"undefined\") || state;\r\n    }\r\n\r\n    add(name, targets, text, forceShow = false) {\r\n\r\n        let _text = text;\r\n        let elements;\r\n\r\n        if (typeof targets === \"string\") {\r\n            elements = document.querySelectorAll(targets);\r\n        } else if (targets instanceof Element) {\r\n            elements = [targets];\r\n        } else if (targets instanceof NodeList) {\r\n            elements = targets;\r\n        } else {\r\n            return this;\r\n        }\r\n\r\n        if (!elements.length) { return this; }\r\n\r\n        const state = this._getState(name);\r\n\r\n        for (const element of elements) {\r\n\r\n            if (getComputedStyle(element).display === \"none\" && !forceShow) {\r\n                continue;\r\n            }\r\n\r\n            if (typeof _text !== \"string\" || _text === \"\") {\r\n                _text = this._textValue(element).toLowerCase();\r\n                if (_text === \"\") { continue; }\r\n            }\r\n \r\n            element.classList.toggle(\"esi-shown\", state);\r\n            element.classList.toggle(\"esi-hidden\", !state);\r\n            element.classList.add(\"esi-customizer\");\r\n            element.dataset.esName = name;\r\n            element.dataset.esText = _text;\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    addDynamic(node) {\r\n        const text = this._textValue(node).toLowerCase();\r\n        if (text === \"\") { return; }\r\n\r\n        this.add(`dynamic_${text}`, node, text);\r\n    }\r\n\r\n    build() {\r\n\r\n        const customizerEntries = new Map();\r\n\r\n        for (const element of document.querySelectorAll(\".esi-customizer\")) {\r\n\r\n            const name = element.dataset.esName;\r\n\r\n            if (customizerEntries.has(name)) {\r\n                customizerEntries.get(name).push(element);\r\n            } else {\r\n\r\n                const state = element.classList.contains(\"esi-shown\");\r\n                const text = element.dataset.esText;\r\n\r\n                HTML.beforeEnd(\"#es_customize_btn .home_viewsettings_popup\",\r\n                    `<div class=\"home_viewsettings_checkboxrow ellipsis\" id=\"${name}\">\r\n                        <div class=\"home_viewsettings_checkbox ${state ? \"checked\" : \"\"}\"></div>\r\n                        <div class=\"home_viewsettings_label\">${text}</div>\r\n                    </div>`);\r\n\r\n                customizerEntries.set(name, [element]);\r\n            }\r\n        }\r\n\r\n        for (const [name, elements] of customizerEntries) {\r\n            const checkboxrow = document.getElementById(name);\r\n            checkboxrow.addEventListener(\"click\", e => {\r\n                const state = !checkboxrow.querySelector(\".checked\");\r\n\r\n                for (const element of elements) {\r\n                    element.classList.toggle(\"esi-shown\", state);\r\n                    element.classList.toggle(\"esi-hidden\", !state);\r\n                }\r\n\r\n                e.target.closest(\".home_viewsettings_checkboxrow\")\r\n                    .querySelector(\".home_viewsettings_checkbox\").classList.toggle(\"checked\", state);\r\n\r\n                this._updateState(name, state);\r\n            });\r\n        }\r\n    }\r\n};\r\n","import {HTML, Localization} from \"../../../../modulesCore\";\r\nimport {Feature, Price, User} from \"../../../modulesContent\";\r\n\r\nexport default class FDLCCheckboxes extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        // check if the page has at least one purchasable DLC available\r\n        return document.querySelector(\".game_area_dlc_section .game_area_dlc_list input[name^=subid]\") !== null;\r\n    }\r\n\r\n    apply() {\r\n\r\n        const dlcSection = document.querySelector(\".game_area_dlc_section\");\r\n\r\n        for (const dlcRow of dlcSection.querySelectorAll(\".game_area_dlc_row\")) {\r\n            const subidNode = dlcRow.querySelector(\"input[name^=subid]\");\r\n            if (!subidNode) { continue; }\r\n\r\n            const label = document.createElement(\"label\");\r\n            label.classList.add(\"es_dlc_label\");\r\n\r\n            // Add dsinfo to label for use with select/unselect all\r\n            if (dlcRow.classList.contains(\"ds_wishlist\")) {\r\n                label.classList.add(\"es_dlc_wishlist\");\r\n            } else if (dlcRow.classList.contains(\"ds_owned\")) {\r\n                label.classList.add(\"es_dlc_owned\");\r\n            }\r\n\r\n            const checkbox = document.createElement(\"input\");\r\n            checkbox.type = \"checkbox\";\r\n            checkbox.dataset.esDlcSubid = subidNode.value;\r\n\r\n            // Must check \".discount_final_price\" first to get the correct price\r\n            const priceNode = dlcRow.querySelector(\".discount_final_price\")\r\n                || dlcRow.querySelector(\".game_area_dlc_price\");\r\n\r\n            const price = Price.parseFromString(priceNode.textContent);\r\n            if (price !== null) {\r\n                checkbox.dataset.esDlcPrice = price.value;\r\n            }\r\n\r\n            label.append(checkbox);\r\n            dlcRow.insertAdjacentElement(\"beforebegin\", label);\r\n        }\r\n\r\n        // Toggle dsinfo on label when adding/removing wishlist via ds_options dropdown\r\n        new MutationObserver(mutations => {\r\n            for (const {target} of mutations) {\r\n                if (!target.classList.contains(\"game_area_dlc_row\")) { continue; }\r\n                target.previousElementSibling.classList.toggle(\"es_dlc_wishlist\", target.classList.contains(\"ds_wishlist\"));\r\n            }\r\n        }).observe(dlcSection.querySelector(\".gameDlcBlocks\"), {\"subtree\": true, \"attributeFilter\": [\"class\"]});\r\n\r\n        const html = `<div class=\"game_purchase_action game_purchase_action_bg\" id=\"es_selected_btn\">\r\n                <div class=\"game_purchase_price price\"></div>\r\n                <div class=\"btn_addtocart\">\r\n                    <a class=\"btn_green_steamui btn_medium\">\r\n                        <span>${Localization.str.add_selected_dlc_to_cart}</span>\r\n                    </a>\r\n                </div>\r\n            </div>`;\r\n\r\n        const expandedNode = dlcSection.querySelector(\"#game_area_dlc_expanded\");\r\n        if (expandedNode) {\r\n            HTML.afterEnd(expandedNode, html);\r\n            HTML.afterEnd(dlcSection, '<div style=\"clear: both;\"></div>');\r\n        } else {\r\n            HTML.afterEnd(dlcSection.querySelector(\".gameDlcBlocks\"), html);\r\n        }\r\n\r\n        const cartForm = document.createElement(\"form\");\r\n        cartForm.name = \"add_selected_dlc_to_cart\";\r\n        cartForm.action = \"/cart/\";\r\n        cartForm.method = \"POST\";\r\n\r\n        const cartBtn = dlcSection.querySelector(\"#es_selected_btn\");\r\n        cartBtn.insertAdjacentElement(\"beforebegin\", cartForm);\r\n        cartBtn.addEventListener(\"click\", () => { cartForm.submit(); });\r\n\r\n        HTML.afterEnd(dlcSection.querySelector(\".gradientbg\"),\r\n            `<div id=\"es_dlc_option_panel\">\r\n                <div class=\"es_dlc_option\" id=\"unowned_dlc_check\">${Localization.str.dlc_select.unowned_dlc}</div>\r\n                <div class=\"es_dlc_option\" id=\"wl_dlc_check\">${Localization.str.dlc_select.wishlisted_dlc}</div>\r\n                <div class=\"es_dlc_option\" id=\"no_dlc_check\">${Localization.str.dlc_select.none}</div>\r\n            </div>`);\r\n\r\n        dlcSection.querySelector(\"#unowned_dlc_check\").addEventListener(\"click\", () => {\r\n            const nodes = dlcSection.querySelectorAll(\".es_dlc_label:not(.es_dlc_owned) > input\");\r\n            for (const node of nodes) {\r\n                node.checked = true;\r\n            }\r\n            dlcSection.dispatchEvent(new Event(\"change\"));\r\n        });\r\n\r\n        dlcSection.querySelector(\"#wl_dlc_check\").addEventListener(\"click\", () => {\r\n            const nodes = dlcSection.querySelectorAll(\".es_dlc_label.es_dlc_wishlist > input\");\r\n            for (const node of nodes) {\r\n                node.checked = true;\r\n            }\r\n            dlcSection.dispatchEvent(new Event(\"change\"));\r\n        });\r\n\r\n        dlcSection.querySelector(\"#no_dlc_check\").addEventListener(\"click\", () => {\r\n            const nodes = dlcSection.querySelectorAll(\".es_dlc_label > input:checked\");\r\n            for (const node of nodes) {\r\n                node.checked = false;\r\n            }\r\n            dlcSection.dispatchEvent(new Event(\"change\"));\r\n        });\r\n\r\n        function createHiddenInput(name, value) {\r\n            const input = document.createElement(\"input\");\r\n            input.type = \"hidden\";\r\n            input.name = name;\r\n            input.value = value;\r\n\r\n            return input;\r\n        }\r\n\r\n        const inputAction = createHiddenInput(\"action\", \"add_to_cart\");\r\n        const inputSessionId = createHiddenInput(\"sessionid\", User.sessionId);\r\n\r\n        dlcSection.addEventListener(\"change\", () => {\r\n\r\n            cartForm.innerHTML = \"\";\r\n            cartForm.append(inputAction, inputSessionId);\r\n\r\n            let total = 0;\r\n            for (const node of dlcSection.querySelectorAll(\".es_dlc_label > input:checked\")) {\r\n\r\n                cartForm.append(createHiddenInput(\"subid[]\", node.dataset.esDlcSubid));\r\n\r\n                if (node.dataset.esDlcPrice) {\r\n                    total += Number(node.dataset.esDlcPrice);\r\n                }\r\n            }\r\n\r\n            if (total > 0) {\r\n                cartBtn.querySelector(\".game_purchase_price\").textContent = new Price(total);\r\n                cartBtn.style.display = \"block\";\r\n            } else {\r\n                cartBtn.style.display = \"none\";\r\n            }\r\n        });\r\n    }\r\n}\r\n","import {Background, DOMHelper, Feature, User} from \"../../../modulesContent\";\r\nimport {HTML, HTMLParser, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\n\r\nexport default class FBadgeProgress extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return this.context.hasCards && User.isSignedIn && SyncedStorage.get(\"show_badge_progress\");\r\n    }\r\n\r\n    async apply() {\r\n\r\n        DOMHelper.insertStylesheet(\"//steamcommunity-a.akamaihd.net/public/css/skin_1/badges.css\");\r\n\r\n        HTML.afterEnd(\"#category_block\",\r\n            `<div id=\"es_badge_progress\" class=\"block responsive_apppage_details_right heading\">\r\n                ${Localization.str.badge_progress}\r\n            </div>\r\n            <div id=\"es_badge_progress_content\" class=\"block responsive_apppage_details_right\">\r\n                <div class=\"block_content_inner es_badges_progress_block\" style=\"display:none;\">\r\n                    <div class=\"es_normal_badge_progress es_progress_block\" style=\"display:none;\"></div>\r\n                    <div class=\"es_foil_badge_progress es_progress_block\" style=\"display:none;\"></div>\r\n                </div>\r\n            </div>`);\r\n\r\n        const appid = this.context.communityAppid;\r\n\r\n        try {\r\n            await Promise.all([\r\n                Background.action(\"cards\", appid)\r\n                    .then(result => { this._loadBadgeContent(\".es_normal_badge_progress\", result); }),\r\n                Background.action(\"cards\", appid, true)\r\n                    .then(result => { this._loadBadgeContent(\".es_foil_badge_progress\", result); }),\r\n            ]);\r\n        } catch (err) {\r\n            document.getElementById(\"es_badge_progress\").remove();\r\n            document.getElementById(\"es_badge_progress_content\").remove();\r\n            throw err;\r\n        }\r\n    }\r\n\r\n    _loadBadgeContent(targetSelector, result) {\r\n        const dummy = HTMLParser.htmlToDOM(result);\r\n\r\n        /*\r\n         * grap badge and game cards\r\n         * when there is no badge (e.g. dlc), badge_gamecard_page class won't appear\r\n         */\r\n        const badge = dummy.querySelector(\".badge_gamecard_page\");\r\n        if (badge) {\r\n            this._displayBadgeInfo(targetSelector, badge);\r\n        } else {\r\n            document.getElementById(\"es_badge_progress\").remove();\r\n            document.getElementById(\"es_badge_progress_content\").remove();\r\n        }\r\n    }\r\n\r\n    _displayBadgeInfo(targetSelector, badgeNode) {\r\n        const blockSel = document.querySelector(targetSelector);\r\n\r\n        // show Steam badge info card\r\n        const badge = badgeNode.querySelector(\".badge_current\");\r\n        blockSel.append(badge);\r\n\r\n        // count card\r\n        const cardNumOwned = badgeNode.querySelectorAll(\".badge_detail_tasks .owned\").length;\r\n        const cardNumTotal = badgeNode.querySelectorAll(\".badge_detail_tasks .badge_card_set_card\").length;\r\n\r\n        // check if badge is completed\r\n        const progress = badgeNode.querySelector(\".gamecard_badge_progress\");\r\n        const progressTextLength = progress ? progress.textContent.trim().length : 0;\r\n        const nextLevelEmptyBadge = badgeNode.querySelectorAll(\".gamecard_badge_progress .badge_info\").length;\r\n        const badgeCompleted = (progressTextLength > 0 && nextLevelEmptyBadge === 0);\r\n\r\n        const showCardNum = (cardNumOwned > 0 && !badgeCompleted);\r\n        const isNormalBadge = targetSelector === \".es_normal_badge_progress\";\r\n\r\n        if (isNormalBadge || (cardNumOwned > 0 || !blockSel.querySelector(\".badge_empty_circle\"))) {\r\n            blockSel.parentNode.style.display = \"block\";\r\n            blockSel.style.display = \"block\";\r\n\r\n            const progressBold = badgeNode.querySelector(\".progress_info_bold\");\r\n\r\n            HTML.beforeEnd(blockSel,\r\n                `<div class=\"es_cards_numbers\">\r\n                    <div class=\"es_cards_remaining\">${progressBold ? progressBold.textContent : \"\"}</div>\r\n                </div>\r\n                <div class=\"game_area_details_specs\">\r\n                    <div class=\"icon\"><img src=\"//store.steampowered.com/public/images/v6/ico/ico_cards.png\" class=\"category_icon\"></div>\r\n                    <a href=\"//steamcommunity.com/my/gamecards/${this.context.communityAppid}${isNormalBadge ? \"/\" : \"?border=1\"}\" class=\"name\">${badgeCompleted ? Localization.str.view_badge : Localization.str.view_badge_progress}</a>\r\n                </div>`);\r\n\r\n            if (showCardNum) {\r\n                HTML.beforeEnd(blockSel.querySelector(\".es_cards_numbers\"),\r\n                    `<div class=\"es_cards_owned\">${Localization.str.cards_owned.replace(\"__owned__\", cardNumOwned).replace(\"__possible__\", cardNumTotal)}</div>`);\r\n            }\r\n\r\n            const last = blockSel.querySelector(\".badge_empty_right div:last-child\");\r\n            if (last) {\r\n                last.classList.add(\"badge_empty_name\");\r\n                last.style = \"\";\r\n                last.textContent = Localization.str.badge_not_unlocked;\r\n            }\r\n        }\r\n    }\r\n}\r\n","import {Feature} from \"../../../Modules/Feature/Feature\";\r\nimport {ExtensionResources, HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\n\r\n// todo maybe integrate with other useful links?\r\nexport default class FAStatsLink extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return SyncedStorage.get(\"showastatslink\") && this.context.hasAchievements;\r\n    }\r\n\r\n    apply() {\r\n        const imgUrl = ExtensionResources.getURL(\"img/ico/astatsnl.png\");\r\n        const url = `https://astats.astats.nl/astats/Steam_Game_Info.php?AppID=${this.context.communityAppid}`;\r\n\r\n        HTML.beforeEnd(\"#achievement_block\",\r\n            `<div class=\"game_area_details_specs\">\r\n                <div class=\"icon\"><img class=\"astats_icon\" src=\"${imgUrl}\"></div>\r\n                <a class=\"name es_external_icon\" href=\"${url}\" target=\"_blank\">${Localization.str.view_astats}</a>\r\n            </div>`);\r\n    }\r\n}\r\n","import {HTML, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Feature, Stats} from \"../../../modulesContent\";\r\n\r\nexport default class FAchievementBar extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return SyncedStorage.get(\"showachinstore\")\r\n            && this.context.hasAchievements\r\n            && this.context.isOwnedAndPlayed;\r\n    }\r\n\r\n    async apply() {\r\n        const achieveBar = await Stats.getAchievementBar(\"/my\", this.context.communityAppid);\r\n        if (!achieveBar) {\r\n            console.warn(\"Failed to retrieve achievement stats\");\r\n            return;\r\n        }\r\n\r\n        HTML.afterBegin(\"#my_activity\", `<div class=\"es-achieveBar-store\">${achieveBar}</div>`);\r\n    }\r\n}\r\n","import {HTMLParser} from \"../../Core/Html/HtmlParser\";\r\nimport {Localization} from \"../../Core/Localization/Localization\";\r\nimport {Background} from \"./Background\";\r\n\r\nclass Stats {\r\n\r\n    static async getAchievementBar(path, appid) {\r\n\r\n        const html = await Background.action(\"stats\", path, appid);\r\n        const dummy = HTMLParser.htmlToDOM(html);\r\n        const achNode = dummy.querySelector(\"#topSummaryAchievements\");\r\n\r\n        if (!achNode) { return null; }\r\n\r\n        achNode.style.whiteSpace = \"nowrap\";\r\n\r\n        if (!achNode.querySelector(\"img\")) {\r\n\r\n            // The size of the achievement bars for games without leaderboards/other stats is fine, return\r\n            return achNode.innerHTML;\r\n        }\r\n\r\n        const stats = achNode.innerHTML.match(/(\\d+) of (\\d+) \\((\\d{1,3})%\\)/);\r\n\r\n        // 1 full match, 3 group matches\r\n        if (!stats || stats.length !== 4) {\r\n            return null;\r\n        }\r\n\r\n        const achievementStr = Localization.str.achievements.summary\r\n            .replace(\"__unlocked__\", stats[1])\r\n            .replace(\"__total__\", stats[2])\r\n            .replace(\"__percentage__\", stats[3]);\r\n\r\n        return `<div>${achievementStr}</div>\r\n                <div class=\"achieveBar\">\r\n                    <div style=\"width: ${stats[3]}%;\" class=\"achieveBarProgress\"></div>\r\n                </div>`;\r\n    }\r\n\r\n    static async getAchievementBarForGamelist(path, appid) {\r\n\r\n        const html = await Background.action(\"stats\", path, appid);\r\n        const dummy = HTMLParser.htmlToDOM(html);\r\n        const achNode = dummy.querySelector(\"#topSummaryAchievements\");\r\n\r\n        if (!achNode) { return null; }\r\n\r\n        achNode.style.whiteSpace = \"nowrap\";\r\n\r\n        const stats = achNode.innerText.match(/(\\d+)\\D+(\\d+)\\D+(\\d{1,3})%/);\r\n\r\n        // 1 full match, 3 group matches\r\n        if (!stats || stats.length !== 4) {\r\n            return null;\r\n        }\r\n\r\n        const achievementStr = Localization.str.achievements.summary\r\n            .replace(\"__unlocked__\", stats[1])\r\n            .replace(\"__total__\", stats[2])\r\n            .replace(\"__percentage__\", stats[3]);\r\n\r\n        // https://github.com/SteamDatabase/SteamTracking/blob/master/steamcommunity.com/public/javascript/profile_gameslist_functions.js#L216-L217\r\n        const achBarWidth = 185 * (stats[1] / stats[2]) || 0; // For some reason some games report 0 total achievements, check for NaN\r\n        const achBarWidthRemainder = 185 - achBarWidth;\r\n\r\n        return `<div class=\"recentAchievements\">\r\n            ${achievementStr}\r\n            <br>\r\n            <img src=\"https://community.akamai.steamstatic.com/public/images/skin_1/achieveBarLeft.gif\" width=\"2\" height=\"12\" border=\"0\">\r\n            <img src=\"https://community.akamai.steamstatic.com/public/images/skin_1/achieveBarFull.gif\" width=\"${achBarWidth}\" height=\"12\" border=\"0\">\r\n            <img src=\"https://community.akamai.steamstatic.com/public/images/skin_1/achieveBarEmpty.gif\" width=\"${achBarWidthRemainder}\" height=\"12\" border=\"0\">\r\n            <img src=\"https://community.akamai.steamstatic.com/public/images/skin_1/achieveBarRight.gif\" width=\"2\" height=\"12\" border=\"0\">\r\n            <br>\r\n        </div>`.replace(/>\\s+</g, \"><\"); // Remove whitespace between tags to avoid layout issues\r\n    }\r\n}\r\n\r\nexport {Stats};\r\n","import {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {CurrencyManager, Feature, Price, RequestData, User} from \"../../../modulesContent\";\r\n\r\nexport default class FRegionalPricing extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        const countries = SyncedStorage.get(\"regional_countries\");\r\n        return countries && countries.length > 0 && SyncedStorage.get(\"showregionalprice\") !== \"off\";\r\n    }\r\n\r\n    async apply() {\r\n\r\n        const showRegionalPrice = SyncedStorage.get(\"showregionalprice\");\r\n        const countries = SyncedStorage.get(\"regional_countries\");\r\n        const localCountry = User.storeCountry.toLowerCase();\r\n\r\n        if (!countries.includes(localCountry)) {\r\n            countries.push(localCountry);\r\n        }\r\n\r\n        for (const subid of this.context.getAllSubids()) {\r\n\r\n            const prices = {};\r\n\r\n            await Promise.all(countries.map(async country => {\r\n                const result = await RequestData.getJson(\r\n                    `https://store.steampowered.com/api/packagedetails/?packageids=${subid}&cc=${country}`\r\n                );\r\n\r\n                if (!result || !result[subid] || !result[subid].success || !result[subid].data.price) { return; }\r\n                prices[country] = result[subid].data.price;\r\n            }));\r\n\r\n            const node = document.querySelector(`input[name=subid][value=\"${subid}\"]`)\r\n                .closest(\".game_area_purchase_game_wrapper, #game_area_purchase\")\r\n                .querySelector(\".game_purchase_action\");\r\n\r\n            const apiPrice = prices[User.storeCountry.toLowerCase()];\r\n\r\n            // For paid titles that have F2P versions with their own subid (see #894)\r\n            if (typeof apiPrice === \"undefined\") { continue; }\r\n\r\n            let priceLocal;\r\n            try {\r\n                priceLocal = new Price(apiPrice.final / 100, apiPrice.currency).inCurrency(CurrencyManager.customCurrency);\r\n            } catch (err) {\r\n                console.group(\"Regional pricing\");\r\n                console.error(err);\r\n                console.warn(\"Can't show relative price differences to any other currencies\");\r\n                console.groupEnd();\r\n            }\r\n\r\n            const pricingDiv = document.createElement(\"div\");\r\n            pricingDiv.classList.add(\"es_regional_container\");\r\n\r\n            if (showRegionalPrice === \"mouse\") {\r\n                HTML.afterBegin(pricingDiv, '<div class=\"es_regional_arrow\"></div>');\r\n            }\r\n\r\n            for (const country of countries) {\r\n                const apiPrice = prices[country];\r\n                let html = \"\";\r\n\r\n                if (apiPrice) {\r\n                    const priceRegion = new Price(apiPrice.final / 100, apiPrice.currency);\r\n                    let priceUser;\r\n                    try {\r\n                        priceUser = priceRegion.inCurrency(CurrencyManager.customCurrency);\r\n                    } catch (err) {\r\n                        console.group(\"Regional pricing\");\r\n                        console.error(err);\r\n                        console.warn(\r\n                            'Not able to show converted price and relative price differences for country code \"%s\"',\r\n                            country.toUpperCase()\r\n                        );\r\n                        console.groupEnd();\r\n                    }\r\n\r\n                    html = `<div class=\"es-regprice es-flag es-flag--${country}\">${priceRegion}`;\r\n\r\n                    if (priceLocal && priceUser) {\r\n                        let percentageIndicator = \"equal\";\r\n                        let percentage = (((priceUser.value / priceLocal.value) * 100) - 100).toFixed(2);\r\n\r\n                        if (percentage < 0) {\r\n                            percentage = Math.abs(percentage);\r\n                            percentageIndicator = \"lower\";\r\n                        } else if (percentage > 0) {\r\n                            percentageIndicator = \"higher\";\r\n                        }\r\n\r\n                        html\r\n                            += `<span class=\"es-regprice__converted\">${priceUser}</span>\r\n                                <span class=\"es-regprice__perc es-regprice__perc--${percentageIndicator}\">${percentage}%</span>`;\r\n                    }\r\n\r\n                    html += \"</div>\";\r\n                } else {\r\n                    html\r\n                        = ` <div class=\"es-regprice es-flag es-flag--${country}\">\r\n                                <span class=\"es-regprice__none\">${Localization.str.region_unavailable}</span>\r\n                            </div>`;\r\n                }\r\n\r\n                HTML.beforeEnd(pricingDiv, html);\r\n            }\r\n\r\n            const purchaseArea = node.closest(\".game_area_purchase_game\");\r\n            purchaseArea.classList.add(\"es_regional_prices\");\r\n\r\n            if (showRegionalPrice === \"always\") {\r\n                node.insertAdjacentElement(\"beforebegin\", pricingDiv);\r\n                purchaseArea.classList.add(\"es_regional_always\");\r\n            } else {\r\n                const priceNode = node.querySelector(\".price, .discount_prices\");\r\n                priceNode.insertAdjacentElement(\"beforeend\", pricingDiv);\r\n                priceNode.classList.add(\"es_regional_onmouse\");\r\n\r\n                if (!SyncedStorage.get(\"regional_hideworld\")) {\r\n                    priceNode.classList.add(\"es_regional_icon\");\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n","import {Feature} from \"../../../Modules/Feature/Feature\";\r\nimport {HTML, LocalStorage, Localization} from \"../../../../modulesCore\";\r\n\r\nexport default class FReviewToggleButton extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return document.getElementById(\"review_create\") !== null;\r\n    }\r\n\r\n    apply() {\r\n        const head = document.querySelector(\"#review_create h1\");\r\n\r\n        // Reparent review section nodes\r\n        const newParent = document.createElement(\"div\");\r\n        newParent.classList.add(\"es_review_section\");\r\n        newParent.append(\r\n            ...document.getElementById(\"review_create\").querySelectorAll(\"p, .avatar_block, .content\")\r\n        );\r\n\r\n        head.insertAdjacentElement(\"afterend\", newParent);\r\n\r\n        // Insert review toggle button\r\n        HTML.beforeEnd(head,\r\n            `<div class=\"btnv6_lightblue_blue btn_medium\" id=\"es_review_toggle\">\r\n                <div data-tooltip-text=\"${Localization.str.expand_slider}\" class=\"es_review_expand\">▼</div>\r\n                <div data-tooltip-text=\"${Localization.str.contract_slider}\" class=\"es_review_contract\">▲</div>\r\n            </div>`);\r\n\r\n        document.querySelector(\"#es_review_toggle\").addEventListener(\"click\", () => {\r\n            this._toggleReviews();\r\n        });\r\n\r\n        this._toggleReviews(LocalStorage.get(\"show_review_section\"));\r\n    }\r\n\r\n    _toggleReviews(state) {\r\n\r\n        let _state = state;\r\n\r\n        if (typeof _state === \"undefined\") {\r\n            _state = !LocalStorage.get(\"show_review_section\");\r\n            LocalStorage.set(\"show_review_section\", _state);\r\n        }\r\n\r\n        document.getElementById(\"review_create\").classList.toggle(\"es_contracted\", !_state);\r\n    }\r\n}\r\n","import {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Feature, User} from \"../../../modulesContent\";\r\n\r\nexport default class FOwnedActionsButtons extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return User.isSignedIn && document.querySelector(\".game_area_play_stats .already_owned_actions\");\r\n    }\r\n\r\n    apply() {\r\n\r\n        const node = document.querySelector(\".game_area_play_stats .already_owned_actions\");\r\n        const appid = this.context.appid;\r\n\r\n        // handle Install Steam button\r\n        const btn = node.querySelector(\"a[href^='https://store.steampowered.com/about/']\");\r\n        const option = SyncedStorage.get(\"installsteam\");\r\n        if (option === \"hide\") {\r\n            btn.remove();\r\n        } else if (option === \"replace\") {\r\n            btn.querySelector(\"span\").textContent = Localization.str.viewinclient;\r\n            btn.href = `steam://store/${appid}`;\r\n        }\r\n\r\n        // add view in library button\r\n        if (SyncedStorage.get(\"showviewinlibrary\")) {\r\n            HTML.afterBegin(node,\r\n                `<div class=\"game_area_already_owned_btn\">\r\n                    <a class=\"btnv6_lightblue_blue btnv6_border_2px btn_medium\" href=\"steam://nav/games/details/${appid}\">\r\n                        <span>${Localization.str.view_in_library}</span>\r\n                    </a>\r\n                </div>`);\r\n        }\r\n\r\n        // add help button\r\n        HTML.afterEnd(node,\r\n            `<div class=\"game_area_already_owned_btn\">\r\n                <a class=\"btnv6_lightblue_blue btnv6_border_2px btn_medium\" href=\"//help.steampowered.com/wizard/HelpWithGame/?appid=${appid}\">\r\n                    <span>${Localization.str.get_help}</span>\r\n                </a>\r\n            </div>`);\r\n    }\r\n}\r\n","import {GameId, HTML, LocalStorage, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Background, Feature} from \"../../../modulesContent\";\r\n\r\nexport default class FSupportInfo extends Feature {\r\n\r\n    async checkPrerequisites() {\r\n        if (!SyncedStorage.get(\"showsupportinfo\")) { return false; }\r\n\r\n        let cache = LocalStorage.get(\"support_info\");\r\n\r\n        // todo IDB\r\n        if (!cache || !cache.expiry || cache.expiry < Date.now()) {\r\n            cache = {\r\n                \"data\": {},\r\n                \"expiry\": Date.now() + (31 * 86400 * 1000) // 31 days\r\n            };\r\n        }\r\n\r\n        // Attempt to get appid of parent app first for DLCs and Soundtracks\r\n        const appid = GameId.getAppid(document.querySelector(\".glance_details a\")) || this.context.appid;\r\n        this._supportInfo = cache.data[appid];\r\n\r\n        if (!this._supportInfo) {\r\n            const response = await Background.action(\"appdetails\", appid, \"support_info\");\r\n            if (!response || !response.success) {\r\n                console.warn(\"Failed to retrieve support info\");\r\n                return false;\r\n            }\r\n\r\n            this._supportInfo = response.data.support_info;\r\n\r\n            cache.data[appid] = this._supportInfo;\r\n            LocalStorage.set(\"support_info\", cache);\r\n        }\r\n\r\n        return Boolean(this._supportInfo.url || this._supportInfo.email);\r\n    }\r\n\r\n    apply() {\r\n\r\n        let {url, email} = this._supportInfo;\r\n        const links = [];\r\n\r\n        if (url) {\r\n            url = /^https?:\\/\\//.test(url) ? url : `//${url}`;\r\n            links.push(`<a href=\"${url}\">${Localization.str.website}</a>`);\r\n        }\r\n\r\n        if (email) {\r\n\r\n            // From https://emailregex.com/\r\n            const emailRegex\r\n                = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n\r\n            if (emailRegex.test(email)) {\r\n                links.push(`<a href=\"mailto:${email}\">${Localization.str.email}</a>`);\r\n            } else {\r\n                links.push(`<a href=\"${email}\">${Localization.str.contact}</a>`);\r\n            }\r\n        }\r\n\r\n        HTML.beforeEnd(\".glance_ctn_responsive_left\",\r\n            `<div class=\"release_date\" style=\"padding-bottom: 0;\">\r\n                <div class=\"subtitle column\">${Localization.str.support}:</div>\r\n                <div class=\"summary column\">${links.join(\", \")}</div>\r\n            </div>`);\r\n    }\r\n}\r\n","import {SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Feature} from \"../../../modulesContent\";\r\nimport {Page} from \"../../Page\";\r\n\r\nexport default class FRemoveBroadcasts extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return SyncedStorage.get(\"removebroadcasts\")\r\n            && document.querySelector(\"[data-featuretarget=broadcast-embed]\") !== null;\r\n    }\r\n\r\n    apply() {\r\n\r\n        document.querySelector(\"[data-featuretarget=broadcast-embed]\").remove();\r\n\r\n        Page.runInPageContext(() => {\r\n            const bcStore = window.uiBroadcastWatchStore;\r\n            if (bcStore && bcStore.m_activeVideo) {\r\n                // eslint-disable-next-line new-cap\r\n                bcStore.StopVideo(bcStore.m_activeVideo);\r\n            }\r\n        });\r\n    }\r\n}\r\n","import {Feature} from \"../../../modulesContent\";\r\nimport {HTML, Localization} from \"../../../../modulesCore\";\r\n\r\nexport default class FDemoAbovePurchase extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        const rightcolDemoBtn = document.querySelector(\".rightcol.game_meta_data a[href^='javascript:ShowGotSteamModal']\");\r\n        this._demoLink = rightcolDemoBtn && rightcolDemoBtn.href;\r\n\r\n        return Boolean(this._demoLink) && document.querySelector(\".demo_above_purchase\") === null;\r\n    }\r\n\r\n    apply() {\r\n\r\n        // Determine available platforms from the system requirments section\r\n        const winIcon = document.querySelector(\"[data-os=win]\") ? '<span class=\"platform_img win\"></span>' : \"\";\r\n        const macIcon = document.querySelector(\"[data-os=mac]\") ? '<span class=\"platform_img mac\"></span>' : \"\";\r\n        const linuxIcon = document.querySelector(\"[data-os=linux]\") ? '<span class=\"platform_img linux\"></span>' : \"\";\r\n\r\n        const html = `<div class=\"game_area_purchase_game demo_above_purchase\">\r\n            <div class=\"game_area_purchase_platform\">\r\n                ${winIcon}${macIcon}${linuxIcon}\r\n            </div>\r\n            <h1>${Localization.str.download_demo_header.replace(\"__gamename__\", this.context.appName)}</h1>\r\n            <div class=\"game_purchase_action\">\r\n                <div class=\"game_purchase_action_bg\">\r\n                    <div class=\"btn_addtocart\">\r\n                        <a class=\"btn_green_steamui btn_medium\">\r\n                            <span>${Localization.str.export.download}</span>\r\n                        </a>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>`;\r\n\r\n        const purchaseNote = document.getElementById(\"purchase_note\");\r\n        if (purchaseNote) {\r\n            HTML.afterEnd(purchaseNote, html);\r\n        } else {\r\n            HTML.afterBegin(document.getElementById(\"game_area_purchase\"), html);\r\n        }\r\n\r\n        // Prevent sanitizing javascript link (comes from page, safe source)\r\n        document.querySelector(\".demo_above_purchase .btn_green_steamui\").href = this._demoLink;\r\n    }\r\n}\r\n","import {Feature, Messenger} from \"../../../modulesContent\";\r\nimport {LocalStorage} from \"../../../../modulesCore\";\r\nimport {Page} from \"../../Page\";\r\n\r\nexport default class FSaveReviewFilters extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return !document.querySelector(\"#noReviewsWriteOne\");\r\n    }\r\n\r\n    apply() {\r\n\r\n        Messenger.addMessageListener(\"filtersChanged\", () => {\r\n\r\n            const context = document.querySelector(\"#review_context\").value;\r\n            const language = document.querySelector(\"input[name=review_language]:checked\").id;\r\n            const minPlaytime = document.querySelector(\"#app_reviews_playtime_range_min\")?.value;\r\n            const maxPlaytime = document.querySelector(\"#app_reviews_playtime_range_max\")?.value;\r\n\r\n            const value = LocalStorage.get(\"review_filters\");\r\n            value.context = context;\r\n            value.language = language;\r\n            if (minPlaytime) { value.minPlaytime = minPlaytime; }\r\n            if (maxPlaytime) { value.maxPlaytime = maxPlaytime; }\r\n\r\n            LocalStorage.set(\"review_filters\", value);\r\n        });\r\n\r\n        Page.runInPageContext(({context, language, minPlaytime, maxPlaytime}) => {\r\n            const oldShowFilteredReviews = window.ShowFilteredReviews;\r\n\r\n            window.ShowFilteredReviews = function() {\r\n                oldShowFilteredReviews();\r\n                window.Messenger.postMessage(\"filtersChanged\");\r\n            };\r\n\r\n            const f = window.SteamFacade;\r\n            let filtersChanged = false;\r\n\r\n            if (context && context !== \"summary\") {\r\n                filtersChanged = true;\r\n                document.querySelector(\"#review_context\").value = context;\r\n            }\r\n\r\n            if (language && language !== \"review_language_mine\") {\r\n                filtersChanged = true;\r\n                document.querySelector(`#${language}`).checked = true;\r\n            }\r\n\r\n            // Playtime filters may not be available on apps with too few reviews\r\n            if (document.querySelector(\"#app_reviews_playtime_range_min\") !== null\r\n                && ((minPlaytime && minPlaytime !== \"0\") || (maxPlaytime && maxPlaytime !== \"0\"))\r\n            ) {\r\n                filtersChanged = true;\r\n\r\n                const upperBound = 100;\r\n\r\n                const min = Number(minPlaytime);\r\n\r\n                /**\r\n                 * No maximum means the upper bound, but is stored as 0\r\n                 * https://github.com/SteamDatabase/SteamTracking/blob/9c64b223ab168c4ce4dacf14fccc3e527f5975ef/store.steampowered.com/public/javascript/game.js#L1651\r\n                 */\r\n                const max = Number(maxPlaytime);\r\n\r\n                // Update playtime silder text and hidden inputs (required, the rest are just for visuals)\r\n                f.updatePlaytimeFilterValues(min, max);\r\n\r\n                /**\r\n                 * Update playtime preset checkbox state\r\n                 * https://github.com/SteamDatabase/SteamTracking/blob/9c64b223ab168c4ce4dacf14fccc3e527f5975ef/store.steampowered.com/public/javascript/game.js#L1594\r\n                 */\r\n                f.jq(\"input[name=review_playtime_preset]\").attr(\"checked\", false); // uncheck all radio buttons\r\n\r\n                if (max === 0) {\r\n                    f.jq(`#review_playtime_preset_${min}`).attr(\"checked\", true);\r\n                }\r\n\r\n                /**\r\n                 * Update playtime slider display\r\n                 * https://github.com/SteamDatabase/SteamTracking/blob/9c64b223ab168c4ce4dacf14fccc3e527f5975ef/store.steampowered.com/public/javascript/game.js#L1608\r\n                 */\r\n                f.jq(\"#app_reviews_playtime_slider\").slider(\"values\", 0, min * 60 * 60);\r\n                f.jq(\"#app_reviews_playtime_slider\").slider(\"values\", 1, (max || upperBound) * 60 * 60);\r\n            }\r\n\r\n            if (!filtersChanged) { return; }\r\n\r\n            const loadingEl = document.querySelector(\"#Reviews_loading\");\r\n\r\n            // Refresh displayed reviews if our script is ran after reviews have started loading\r\n            if (loadingEl.style.display === \"none\") {\r\n                oldShowFilteredReviews();\r\n            } else if (loadingEl.style.display === \"block\") {\r\n                new MutationObserver((mutations, observer) => {\r\n                    observer.disconnect();\r\n                    oldShowFilteredReviews();\r\n                }).observe(loadingEl, {\"attributes\": true});\r\n            }\r\n        }, [LocalStorage.get(\"review_filters\")]);\r\n    }\r\n}\r\n","import {StorePage} from \"../../StorePage\";\r\nimport {CApp} from \"./CApp\";\r\n\r\n(new StorePage()).run(CApp);\r\n","import {Page} from \"./Page\";\r\n\r\nclass StorePage extends Page {}\r\n\r\nexport {StorePage};\r\n","import {GameId, LocalStorage, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Background, ContextType, User} from \"../../../modulesContent\";\r\nimport FMediaExpander from \"../../Common/FMediaExpander\";\r\nimport FITADPrices from \"../Common/FITADPrices\";\r\nimport FDRMWarnings from \"../Common/FDRMWarnings\";\r\nimport FExtraLinks from \"../Common/FExtraLinks\";\r\nimport {UserNotes} from \"../Common/UserNotes\";\r\nimport {CStore} from \"../Common/CStore\";\r\nimport FReplaceDevPubLinks from \"./FReplaceDevPubLinks\";\r\nimport FRemoveFromWishlist from \"./FRemoveFromWishlist\";\r\nimport FForceMP4 from \"./FForceMP4\";\r\nimport FHDPlayer from \"./FHDPlayer\";\r\nimport FUserNotes from \"./FUserNotes\";\r\nimport FWaitlistDropdown from \"./FWaitlistDropdown\";\r\nimport FNewQueue from \"./FNewQueue\";\r\nimport FFullscreenScreenshotView from \"./FFullscreenScreenshotView\";\r\nimport FShowCoupon from \"./FShowCoupon\";\r\nimport FDLCInfo from \"./FDLCInfo\";\r\nimport FMetacriticUserScore from \"./FMetacriticUserScore\";\r\nimport FOpenCritic from \"./FOpenCritic\";\r\nimport FOwnedElsewhere from \"./FOwnedElsewhere\";\r\nimport FPurchaseDate from \"./FPurchaseDate\";\r\nimport FSteamPeek from \"./FSteamPeek\";\r\nimport FWidescreenCertification from \"./FWidescreenCertification\";\r\nimport FHowLongToBeat from \"./FHowLongToBeat\";\r\nimport FFamilySharingNotice from \"./FFamilySharingNotice\";\r\nimport FPackBreakdown from \"./FPackBreakdown\";\r\nimport FPackageInfoButton from \"./FPackageInfoButton\";\r\nimport FSteamChart from \"./FSteamChart\";\r\nimport FSteamSpy from \"./FSteamSpy\";\r\nimport FSurveyData from \"./FSurveyData\";\r\nimport FCustomizer from \"../Common/FCustomizer\";\r\nimport FDLCCheckboxes from \"./FDLCCheckboxes\";\r\nimport FBadgeProgress from \"./FBadgeProgress\";\r\nimport FAStatsLink from \"./FAStatsLink\";\r\nimport FAchievementBar from \"./FAchievementBar\";\r\nimport FRegionalPricing from \"../Common/FRegionalPricing\";\r\nimport FReviewToggleButton from \"./FReviewToggleButton\";\r\nimport FOwnedActionsButtons from \"./FOwnedActionsButtons\";\r\nimport FSupportInfo from \"./FSupportInfo\";\r\nimport FRemoveBroadcasts from \"./FRemoveBroadcasts\";\r\nimport FDemoAbovePurchase from \"./FDemoAbovePurchase\";\r\nimport FSaveReviewFilters from \"./FSaveReviewFilters\";\r\n\r\nexport class CApp extends CStore {\r\n\r\n    constructor() {\r\n        // Only add extra links if there's an error message (e.g. region-locked, age-gated)\r\n        if (document.getElementById(\"error_box\") !== null) {\r\n            super(ContextType.APP, [FExtraLinks]);\r\n\r\n            this.isErrorPage = true;\r\n            this.appid = GameId.getAppid(window.location.host + window.location.pathname);\r\n\r\n            return;\r\n        }\r\n\r\n        super(ContextType.APP, [\r\n            FReplaceDevPubLinks,\r\n            FRemoveFromWishlist,\r\n            FForceMP4,\r\n            FHDPlayer,\r\n            FUserNotes,\r\n            FWaitlistDropdown,\r\n            FNewQueue,\r\n            FFullscreenScreenshotView,\r\n            FShowCoupon,\r\n            FITADPrices,\r\n            FDLCInfo,\r\n            FDRMWarnings,\r\n            FMetacriticUserScore,\r\n            FOpenCritic,\r\n            FOwnedElsewhere,\r\n            FPurchaseDate,\r\n            FSteamPeek,\r\n            FWidescreenCertification,\r\n            FHowLongToBeat,\r\n            FExtraLinks,\r\n            FFamilySharingNotice,\r\n            FPackBreakdown,\r\n            FPackageInfoButton,\r\n            FSteamChart,\r\n            FSteamSpy,\r\n            FSurveyData,\r\n            FCustomizer,\r\n            FDLCCheckboxes,\r\n            FBadgeProgress,\r\n            FAStatsLink,\r\n            FAchievementBar,\r\n            FRegionalPricing,\r\n            FReviewToggleButton,\r\n            FOwnedActionsButtons,\r\n            FSupportInfo,\r\n            FMediaExpander,\r\n            FRemoveBroadcasts,\r\n            FDemoAbovePurchase,\r\n            FSaveReviewFilters,\r\n        ]);\r\n\r\n        this.appid = GameId.getAppid(window.location.host + window.location.pathname);\r\n        this.storeid = `app/${this.appid}`;\r\n\r\n        // Some games (e.g. 201270, 201271) have different appid in store page and community\r\n        this.communityAppid = GameId.getAppidImgSrc(document.querySelector(\".apphub_AppIcon img\")?.getAttribute(\"src\")) ?? this.appid;\r\n\r\n        this.appName = document.querySelector(\".apphub_AppName\")?.textContent ?? \"\";\r\n\r\n        this.metalink = document.querySelector(\"#game_area_metalink a\")?.getAttribute(\"href\") ?? null;\r\n\r\n        // TODO this check is unreliable; some apps and dlcs have card category yet no card, and vice versa\r\n        this.hasCards = document.querySelector('#category_block img[src$=\"/ico_cards.png\"]') !== null;\r\n\r\n        // #achievement_block is also used for point shop items\r\n        this.hasAchievements = document.querySelector(\".communitylink_achievement_images\") !== null;\r\n\r\n        this.isOwned = document.querySelector(\".game_area_already_owned\") !== null;\r\n        this.isOwnedAndPlayed = this.isOwned && document.querySelector(\"#my_activity\") !== null;\r\n\r\n        this.isDlc = document.querySelector(\".game_area_dlc_bubble\") !== null;\r\n        this.isDlcLike = this.isDlc || document.querySelector(\".game_area_soundtrack_bubble\") !== null;\r\n\r\n        const category = new URLSearchParams(document.querySelector(\".breadcrumbs a\")?.search).get(\"category1\");\r\n\r\n        /**\r\n         * `true` for non-application items, or if system requirements section is missing (usually hardware)\r\n         * Previous check for videos: document.querySelector(\".game_area_purchase_game span[class*=streaming], div.series_seasons\") !== null;\r\n         */\r\n        this.isVideoOrHardware = category === \"992\" || category === \"993\" || !document.querySelector(\".sys_req\");\r\n\r\n        this.onWishAndWaitlistRemove = null;\r\n        this.userNotes = new UserNotes();\r\n        this.data = this.storePageDataPromise().catch(err => { console.error(err); });\r\n\r\n        // The customizer has to wait on this data to be added in order to find the HTML elements\r\n        FCustomizer.dependencies = [FSteamSpy, FSteamChart, FSurveyData];\r\n        FCustomizer.weakDependency = true;\r\n\r\n        // FPackBreakdown skips purchase options with a package info button to avoid false positives\r\n        FPackageInfoButton.dependencies = [FPackBreakdown];\r\n        FPackageInfoButton.weakDependency = true;\r\n    }\r\n\r\n    storePageDataPromise() {\r\n        return Background.action(\"storepagedata\", this.appid, this.metalink, SyncedStorage.get(\"showoc\"));\r\n    }\r\n\r\n    removeFromWishlist() {\r\n        return Background.action(\"wishlist.remove\", this.appid, User.sessionId);\r\n    }\r\n\r\n    removeFromWaitlist() {\r\n        return Background.action(\"itad.removefromwaitlist\", this.appid);\r\n    }\r\n\r\n    toggleVideoDefinition(videoControl, setHD) {\r\n        let videoIsHD = false;\r\n\r\n        const videoIsVisible = videoControl.parentNode.offsetHeight > 0 && videoControl.parentNode.offsetWidth > 0,\r\n            loadedSrc = videoControl.classList.contains(\"es_loaded_src\"),\r\n            playInHD = LocalStorage.get(\"playback_hd\") || videoControl.classList.contains(\"es_video_hd\");\r\n\r\n        const videoPosition = videoControl.currentTime || 0,\r\n            videoPaused = videoControl.paused;\r\n\r\n        /** @this {HTMLVideoElement} The video element */\r\n        function onLoadedMetaData() {\r\n            this.currentTime = videoPosition;\r\n            if (!videoPaused && videoControl.play) {\r\n\r\n                Promise.resolve(videoControl.play()).catch(() => {\r\n                    // FIXME Why?\r\n\r\n                    // If response is a promise, suppress any errors it throws\r\n                });\r\n            }\r\n            videoControl.removeEventListener(\"loadedmetadata\", onLoadedMetaData, false);\r\n        }\r\n\r\n        if (videoIsVisible) {\r\n            videoControl.preload = \"metadata\";\r\n            videoControl.addEventListener(\"loadedmetadata\", onLoadedMetaData, false);\r\n        }\r\n\r\n        if ((!playInHD && typeof setHD === \"undefined\") || setHD === true) {\r\n            videoIsHD = true;\r\n            videoControl.src = videoControl.dataset.hdSrc;\r\n        } else if (loadedSrc) {\r\n            videoControl.src = videoControl.dataset.sdSrc;\r\n        }\r\n\r\n        if (videoIsVisible && loadedSrc) {\r\n            videoControl.load();\r\n        }\r\n\r\n        videoControl.classList.add(\"es_loaded_src\");\r\n        videoControl.classList.toggle(\"es_video_sd\", !videoIsHD);\r\n        videoControl.classList.toggle(\"es_video_hd\", videoIsHD);\r\n        videoControl.parentNode.classList.toggle(\"es_playback_sd\", !videoIsHD);\r\n        videoControl.parentNode.classList.toggle(\"es_playback_hd\", videoIsHD);\r\n\r\n        return videoIsHD;\r\n    }\r\n}\r\n","import {CStoreBase} from \"./CStoreBase\";\r\n\r\nexport class CStore extends CStoreBase {\r\n\r\n    getAllSubids() {\r\n        const result = [];\r\n        for (const node of document.querySelectorAll(\"input[name=subid]\")) {\r\n            if (node.value) {\r\n                result.push(node.value);\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n}\r\n","import {Context, ContextType} from \"../../../modulesContent\";\r\nimport FHighlightsTags from \"../../Common/FHighlightsTags\";\r\nimport FEarlyAccess from \"../../Common/FEarlyAccess\";\r\nimport FHideTrademarks from \"../../Common/FHideTrademarks\";\r\nimport FAlternativeLinuxIcon from \"./FAlternativeLinuxIcon\";\r\n\r\nexport class CStoreBase extends Context {\r\n\r\n    constructor(type = ContextType.STORE_DEFAULT, features = []) {\r\n\r\n        features.push(\r\n            FHighlightsTags,\r\n            FEarlyAccess,\r\n            FHideTrademarks,\r\n            FAlternativeLinuxIcon,\r\n        );\r\n\r\n        super(type, features);\r\n\r\n        this._observeChanges();\r\n    }\r\n\r\n    _observeChanges() {\r\n\r\n        // search box on the navigation bar\r\n        const searchBox = document.querySelector(\"#search_suggestion_contents\");\r\n        if (searchBox) {\r\n            new MutationObserver(mutations => {\r\n                this.decorateStoreCapsules(mutations[0].addedNodes);\r\n            }).observe(searchBox, {\"childList\": true});\r\n        }\r\n\r\n        // genre, category, tags etc. pages\r\n        const tabContent = document.querySelector(\".tab_content_ctn\");\r\n        if (tabContent) {\r\n            new MutationObserver(mutations => {\r\n                for (const {addedNodes} of mutations) {\r\n                    if (addedNodes.length > 1) {\r\n                        const nodes = Array.from(addedNodes)\r\n                            .filter(el => el instanceof Element && el.classList.contains(\"tab_item\"));\r\n\r\n                        this.decorateStoreCapsules(nodes);\r\n                    }\r\n                }\r\n            }).observe(tabContent, {\"childList\": true, \"subtree\": true});\r\n\r\n            return;\r\n        }\r\n\r\n        // recommended/friendactivity\r\n        const friendactivityTab = document.querySelector(\"#friendactivity_tabarea\");\r\n        if (friendactivityTab) {\r\n            new MutationObserver(mutations => {\r\n                for (const {addedNodes} of mutations) {\r\n                    if (addedNodes.length > 1) {\r\n                        const nodes = Array.from(addedNodes)\r\n                            .filter(el => el instanceof Element && el.querySelector(\".friendactivity_game_link\") !== null);\r\n\r\n                        this.decorateStoreCapsules(nodes);\r\n                    }\r\n                }\r\n            }).observe(friendactivityTab, {\"childList\": true, \"subtree\": true});\r\n\r\n            return;\r\n        }\r\n\r\n        const container = document.querySelector([\r\n            \"#tag_browse_games_ctn\", // tag/browse\r\n            \"#RecommendationsRows\", // curator, developer, publisher, franchise, dlc etc. pages\r\n            \"#CuratorsRows\", // curators/recommendedcurators\r\n        ].join(\",\"));\r\n\r\n        if (container) {\r\n            new MutationObserver(mutations => {\r\n                for (const {addedNodes} of mutations) {\r\n                    if (addedNodes.length > 0 && addedNodes[0] instanceof Element) {\r\n                        const nodes = addedNodes[0].querySelectorAll(\".browse_tag_game, .store_capsule, .recommendation\");\r\n                        this.decorateStoreCapsules(nodes);\r\n                    }\r\n                }\r\n            }).observe(container, {\"childList\": true, \"subtree\": true});\r\n        }\r\n    }\r\n\r\n    decorateStoreCapsules(nodes, hasDsInfo) {\r\n        FHighlightsTags.highlightAndTag(nodes, hasDsInfo);\r\n        FEarlyAccess.show(nodes);\r\n    }\r\n}\r\n","import {FeatureManager} from \"../Feature/FeatureManager\";\r\n\r\nclass Context {\r\n\r\n    constructor(type, features) {\r\n        this._callbacks = [];\r\n        this.type = type;\r\n        this.features = features.map(Ref => new Ref(this));\r\n    }\r\n\r\n    applyFeatures() {\r\n        return FeatureManager.apply(this.features);\r\n    }\r\n\r\n    registerCallback(fn) {\r\n        this._callbacks.push(fn);\r\n    }\r\n\r\n    triggerCallbacks(...params) {\r\n        for (const callback of this._callbacks) {\r\n            callback(...params);\r\n        }\r\n    }\r\n}\r\n\r\nexport {Context};\r\n"],"names":["LoginError","Error","constructor","type","super","this","name","ServerOutageError","msg","HTTPError","code","message","FeatureDependencyError","featureName","Errors","HTML","static","str","map","replace","m","html","template","document","createElement","innerHTML","DOMPurify","sanitize","content","fragment","firstElementChild","node","_node","console","warn","querySelector","Element","_getNode","outerHTML","wrapper","startEl","endEl","_startEl","_endEl","parentElement","lastElementChild","wrappedNodes","cur","nextElementSibling","push","_wrapper","element","replaceWith","append","position","insertAdjacentHTML","adjacent","HTMLParser","string","text","regex","RegExp","match","parseInt","JSON","parse","dom","querySelectorAll","value","getVariableFromText","textContent","CookieStorage","defaultValue","_name","trim","cache","has","get","val","ttl","_val","set","encodeURIComponent","cookie","delete","Map","key","split","kv","decodeURIComponent","init","ContextType","Object","freeze","currentContext","browser","extension","getBackgroundPage","bgPage","window","BACKGROUND","OPTIONS","CONTENT_SCRIPT","Environment","Language","_currentSteamLanguage","script","language","URL","src","searchParams","isContentScript","languages","array","includes","getCurrentSteamLanguage","BackgroundSimple","runtime","sendMessage","requested","params","length","ExtensionResources","pathname","getURL","fetch","then","r","json","Storage","prototype","hasOwnProperty","call","defaults","_adapter","entries","remove","prefix","keys","filter","k","startsWith","force","tmp","persistent","reduce","acc","option","clear","import","area","storage","sync","caches","onChanged","addListener","changes","eventArea","assign","onDone","onCatch","promise","_initialized","Promise","resolve","stringify","Info","getManifest","version","local","QUOTA_BYTES_PER_ITEM","getJSON","_promise","currentSteamLanguage","storedSteamLanguage","deepAssign","target","source","action","getLanguageCode","codes","all","lc","loadLocalization","english","path","reverse","current","pop","LocalStorage","migrate","migrationDone","location","hostname","async","localStorage","getItem","err","error","removeItem","Timer","duration","_id","setTimeout","onSuccess","onFail","clearTimeout","ResettableTimer","reset","running","_running","TimeUtils","Math","trunc","Date","now","GameId","id","_text","HTMLElement","appid","dataset","dsAppid","parseId","href","subid","dsPackageid","bundleid","dsBundleid","storeId","Number","slice","indexOf","HTMLImageElement","hasAttribute","getAttribute","imageUrl","res","exec","ctxPermissions","Version","major","minor","patch","assert","isInteger","fromString","Array","isArray","fromArray","v","from","toString","toArray","toJSON","isCurrent","isSameOrAfter","isSame","_version","coerce","isBefore","isSameOrBefore","isAfter","ProgressBar","afterEnd","_progress","setAttribute","requests","classList","style","width","initiated","progress","completed","_value","add","warningNode","nodeError","_failedRequests","Background","result","startRequest","finishRequest","errObj","errStr","info","serverOutage","_errorHandlers","some","handler","failed","RequestData","url","settings","responseType","_url","_settings","origin","response","protocol","_fetchFn","ok","status","statusText","formData","returnJSON","getHttp","bind","storeCountry","country","_storeCountry","substr","avatarNode","loginPromise","profileUrl","profilePath","login","isSignedIn","steamId","catch","newCountry","endsWith","getElementsByTagName","config","COUNTRY","group","groupEnd","sessionId","_sessionId","getVariableFromDom","lang","appName","_appName","clearSpecialSymbols","getJson","success","data","webapi_token","allSettled","promises","reason","DynamicStore","multiple","trimmedIds","statusList","trimStoreId","dsStatusList","i","trimmedId","owned","_fetch","Inventory","appids","options","getStatusObject","giftsAndPasses","hasCoupon","Boolean","opts","coupons","results","marketHashes","Feature","context","checkPrerequisites","apply","logError","args","_activeDropLists","_lastSelectHideTime","addEventListener","e","closest","_hide","index","bSetSelected","droplist","trigger","rgItems","item","highlightedItem","className","yOffset","offsetTop","clientHeight","curVisibleOffset","scrollTop","bScrolledDown","nMaxLoopIterations","nLoopCounter","inner","input","dispatchEvent","Event","contains","focus","_show","initialOption","changeFn","storageOption","reversed","box","getTrimmedValue","onChange","reverseEl","_onFocus","_onBlur","_onTriggerClick","ul","trimmedOption","toggle","beforeEnd","a","_highlightItem","DOMHelper","container","parent","parentNode","insertBefore","removeChild","selector","nodes","stylesheet","rel","head","appendChild","onload","isAsync","HorizontalScroller","controlLeftNode","controlRightNode","lastScroll","preventDefault","stopPropagation","deltaY","click","AugmentedSteam","afterBegin","SteamFacade","showMenu","hideMenu","clearCache","reload","btn","body","scroll","scrollY","stopShowingHandler","el","getElementById","insertAdjacentElement","currentLanguage","warningLanguage","strings","_addWarning","using_language","using_language_return","ChangeLanguage","wishlistLink","removeLinkFilter","link","URLSearchParams","search","MutationObserver","mutations","mutation","addedNodes","nodeType","Node","ELEMENT_NODE","observe","beforeBegin","logoutNode","accountName","communityName","pageHeader","test","title","getRandomApp","gamename","gameid","fullgame","playGameStr","visitStore","showConfirmDialog","done","ShowGotSteamModal","steamUrl","checked","tab","links","create","_loginWarningAdded","host","_addBackToTop","_addMenu","_addLanguageWarning","_handleInstallSteamButton","_disableLinkFilter","_skipGotSteam","_keepSteamSubscriberAgreementState","_defaultCommunityTab","_horizontalScrolling","_cartLink","_addUsernameSubmenuLinks","_addRedeemLink","_replaceAccountName","_launchRandomButton","_bindLogout","StringUtils","SteamCurrency","abbr","symbol","hint","multiplier","unit","formatPlaces","formatHidePlaces","formatSymbol","formatGroupSeparator","formatGroupSize","formatDecimalSeparator","formatPostfixSymbol","format","valueOf","price","_price","groupSeparator","decimalSeparator","parseFloat","isNaN","withSymbol","sign","decimals","s","abs","toFixed","decimalPlaces","g","j","groupSize","unshift","substring","join","hidePlacesWhenZero","postfix","placeholder","regExp","escapeRegExp","CurrencyManager","currencyNode","walletCurrency","g_rgWalletInfo","wallet_currency","currencyNumberToType","currency","_getCurrencyFromDom","_getCurrencyFromWallet","to","_rates","fromType","number","fromNumber","_indices","_defaultCurrency","storeCurrency","_getStoreCurrency","currencySetting","customCurrency","toCurrencies","_isInitialized","currencies","symbols","_loadCurrency","_loadRates","onFailure","ITAD","onHover","updateLastImport","htmlStr","toLocaleString","hover","syncDiv","timeout","display","timer","storeIds","collection","waitlist","resolved","inCollection","inWaitlist","Messenger","msgID","postMessage","callback","information","removeEventListener","Price","formattedValue","otherPrice","_otherPrice","inCurrency","desiredCurrency","rate","getRate","currencyType","Prices","subids","bundleids","priceCallback","bundleCallback","_bundles","_getApiParams","apiParams","stores","cc","coupon","_getPricingStrings","priceData","pricingStr","prices","pricesStr","cutStr","cut","store","_processPrices","meta","hasData","lowestData","lowest","bundledCount","bundles","count","urlData","urls","voucherStr","price_voucher","voucher","escape","with_voucher","storeStr","drmStr","drm","infoUrl","storeUrl","lowest_price","historical","dateStr","recorded","toLocaleDateString","history","historical_low","bundledUrl","bundle_history","bundledStr","bundle_count","bundled","_processBundles","purchase","bundle","live","tiers","endDate","expiry","currentDate","getTime","bundleNormalized","page","sorted","t","games","sort","bundlePrice","tierNum","tier","tierName","note","tierPrice","gameList","details","load","initialized","ev","localStack","stack","insertScript","strTitle","strDescription","rgModalParams","ShowDialog","strOKButton","strCancelButton","strSecondaryActionButton","ShowConfirmDialog","ShowAlertDialog","ShowBlockingWaitDialog","ShowNicknameModal","CModal","DismissActiveModal","elemLink","elemPopup","align","valign","bLinkHasBorder","ShowMenu","HideMenu","CollapseLongStrings","AdjustVisibleAppTags","$J","hourMin","hourMax","UpdatePlaytimeFilterValues","BindAutoFlyoutEvents","g_player","SliderOnChange","GDynamicStore","InvalidateCache","bForceRecalculate","DecorateDynamicItems","OnReady","unAppID","unPackageID","unBundleID","rgAdditionalParams","GStoreItemData","BindHoverEvents","isHtml","isStore","v_tooltip","amount","publisherFee","CalculateFeeAmount","currencyCode","v_currencyformat","ToggleManageFriends","chatId","OpenFriendChatInWebChat","SubmitGuide","InitMiniprofileHovers","Modal","groupID","steamIDInvitee","InviteUserToGroup","GetCheckedAccounts","navid","ExecFriendAction","CScrollOffsetWatcher","ForceRecalc","strCookieName","strValue","expiryInDays","V_SetCookie","callbackFunc","CheckAgeGateSubmit","elTarget","strGroup","LoadImageGroupOnScroll","titleBarText","titleBarURL","sizeToFit","ShowModalContent","InventoryFirstPage","InventoryLastPage","InventoryGoToPage","ReloadCommunityInventory","itemDesc","GetMarketHashName","pricehistory_zoomDays","g_plotPriceHistory","g_timePriceHistoryEarliest","g_timePriceHistoryLatest","SellItemDialog","m_plotPriceHistory","m_timePriceHistoryEarliest","m_timePriceHistoryLatest","UpdateSelection","SelectAll","SelectNone","SelectInverse","on","ajax","post","eventName","registerErrorHandler","addLoginWarning","fun","withPromise","argsString","msgId","_msgCounter","onMessage","documentElement","ContextClass","purifyConfig","ADD_ATTR","addHook","attrName","attrValue","keepAttr","setConfig","setup","log","loading","onUpdate","lastVersion","changelogPromise","_showChangelog","_migrateSettings","dialog","connectBtn","itadConnected","updatedStr","showAlertDialog","oldVersion","emoticons","checkVersion","_pageSpecificFeatures","applyFeatures","FMediaExpander","_details","_sliderToggle","_toggleView","sketchfabNode","top","expand","_handleApp","_handleWorkshop","opacity","clsList","adjustVisibleAppTags","jqTrigger","f","player","global","elemSlider","nSliderWidth","m_elemStripScroll","getWidth","m_elemStrip","slider","dispose","newValue","range","end","down","sliderOnChange","hide","FITADPrices","getAllSubids","contentNode","placement","banner","newParent","FDRMWarnings","isAppPage","drmNotices","getTextFromDRMNotices","gameDetails","nextSibling","getTextFromGameDetails","toLowerCase","drmNames","flatMap","enabled","drmString","find","FExtraLinks","_type","_gameid","isErrorPage","communityAppid","hasCards","sideDetails","customLink","iconUrl","icon","iconClass","UserNotesAdapter","Adapter","adapters","toType","currentAdapter","getAdapter","newAdapter","export","OutOfCapacityError","ratio","CapacityInfo","closeToFull","utilization","_notes","oldNote","storageUsage","_getNotesSize","notes","UserNotes","_str","noteModalTemplate","capInfo","_showDialog","appname","noteEl","onNoteUpdate","strSave","strCancel","deferred","jQuery","Deferred","fnOk","fnCancel","reject","buttons","okBtn","_BuildDialogButton","cancelBtn","modal","_BuildDialog","_BindOnEnterKeyPressForDialog","always","Dismiss","noteInput","setSelectionRange","textLength","shiftKey","sessionStorage","fail","setItem","Show","add_for_game","exceeded","desc","not_enough_space_desc","close_on_storage_desc","storage_warning_desc","adapterType","strCloudStorage","strLocalStorage","not_enough_space","close_on_storage","save_itad","save_synced_storage","save_local","changeAdapter","FHighlightsTags","onDynamicStoreReady","highlightTitle","highlightAndTag","hasDsInfo","_options","values","x","_nodes","_selector","storeIdsMap","nodeToHighlight","aNode","getAppid","getAppidFromId","getSubid","getBundleid","highlightOwned","wishlisted","highlightWishlist","ignored","highlightIgnored","trimmedStoreIds","includeDsInfo","dsStatus","itadStatus","invStatus","getAppStatus","waitlisted","collected","gift","guestPass","it","storeid","operations","highlightCollection","highlightWaitlist","next","highlightInvGift","highlightInvGuestpass","highlightInvCoupon","operation","tag","_tagCssLoaded","tagCss","_types","color","insertCSS","dsTagids","_highlightCssLoaded","hlCss","previousElementSibling","forEach","_highlightNode","_addTag","sel","FEarlyAccess","show","_container","imageName","isCurrentLanguageOneOf","getEaNodes","imgHeader","cloneNode","appidsMap","getAppidImgSrc","String","size","eaStatus","nodesArray","FHideTrademarks","selectors","replaceSymbols","observer","FAlternativeLinuxIcon","cssText","FReplaceDevPubLinks","devs","highlightsDev","pubs","highlightsPub","franchise","homepageLink","moreBtn","collapseLongStrings","FRemoveFromWishlist","isOwned","successBtn","tooltipText","imgNode","removeWaitlist","removeFromWishlist","removeFromWaitlist","onWishAndWaitlistRemove","dynamicStoreInvalidateCache","FForceMP4","mp4","mp4Source","mp4hd","mp4HdSource","webmSource","webmHdSource","video","sdSrc","hdSrc","toggleVideoDefinition","FHDPlayer","that","movieNode","playInHD","toggleFullscreen","videoControl","fullscreenEnabled","mozFullScreenEnabled","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","exitFullscreen","mozCancelFullScreen","requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","addHDControl","newNode","firstVideoIsPlaying","matches","clickInitialHD","currentTarget","FUserNotes","button","userNotes","showModalDialog","active","FWaitlistDropdown","wishlistDivs","wishlistArea","wishlistSuccessArea","menu","menuArrow","wishlistOption","waitlistOption","updateDiv","oneActive","lastChild","d","jq","ajaxComplete","xhr","unbind","FNewQueue","vTooltip","jqOnClick","queueType","jqAjax","serialize","FFullscreenScreenshotView","toggleFullScreen","initFSVButtons","modalFooter","nextButton","nextButtonOffsetWidth","offsetWidth","fsvButton","modalTitleLink","open","FShowCoupon","getCoupon","couponDate","valid","m0","m1","image_url","discount_note","purchaseDiv","discount_doesnt_stack","priceNode","scaleFactor","originalPrice","priceFinal","newFinalPrice","floor","discount","FDLCInfo","isDlc","FMetacriticUserScore","userscore","_data","metauserscore","rating","FOpenCritic","oc","ocImg","award","score","reviews","review","date","snippet","dScore","rUrl","author","reviewsNode","FOwnedElsewhere","storeList","FPurchaseDate","FSteamPeek","_moreLikeThis","steamTab","steamPeekTab","_adjustScroller","spLoaded","storeItemDataBindHover","dynamicStoreDecorateItems","FWidescreenCertification","_levelMap","isDlcLike","isVideoOrHardware","wsgf","_getType","imgPrefix","typeName","level","wsg","mmg","fkg","uws","wsgIcon","wsgText","mmgIcon","mmgText","uwsIcon","uwsText","fkgIcon","fkgText","FHowLongToBeat","hltb","main_story","main_extras","comp","submit_url","FFamilySharingNotice","exfgls","excluded","FPackBreakdown","_splitPack","ways","unitPrice","ceil","FPackageInfoButton","FSteamChart","charts","chart","peakall","_chart","peaktoday","FSteamSpy","steamspy","owners","ownersFrom","ownersTo","averageTotal","_getTimeString","average_forever","average2weeks","average_2weeks","days","hours","minutes","FSurveyData","survey","_survey","responses","round","frp","fr","mr","gs","_getBarHtml","nvidia","amd","intel","other","FCustomizer","customizeBtn","_customizeAppPage","_customizeFrontPage","GHomepage","bInitialRenderComplete","Proxy","prop","Reflect","getParentEl","customizer","Customizer","build","addDynamic","settingsName","_textValue","textNode","childNodes","TEXT_NODE","_updateState","state","_getState","targets","forceShow","elements","NodeList","getComputedStyle","esName","esText","customizerEntries","checkboxrow","FDLCCheckboxes","dlcSection","dlcRow","subidNode","label","checkbox","esDlcSubid","parseFromString","esDlcPrice","expandedNode","cartForm","method","cartBtn","createHiddenInput","submit","inputAction","inputSessionId","total","FBadgeProgress","insertStylesheet","_loadBadgeContent","targetSelector","badge","htmlToDOM","_displayBadgeInfo","badgeNode","blockSel","cardNumOwned","cardNumTotal","progressTextLength","nextLevelEmptyBadge","badgeCompleted","showCardNum","isNormalBadge","progressBold","last","FAStatsLink","hasAchievements","imgUrl","FAchievementBar","isOwnedAndPlayed","achieveBar","achNode","whiteSpace","stats","innerText","achievementStr","achBarWidth","getAchievementBar","FRegionalPricing","countries","showRegionalPrice","localCountry","apiPrice","priceLocal","final","pricingDiv","priceRegion","priceUser","toUpperCase","percentageIndicator","percentage","purchaseArea","FReviewToggleButton","_toggleReviews","_state","FOwnedActionsButtons","FSupportInfo","_supportInfo","support_info","email","FRemoveBroadcasts","bcStore","uiBroadcastWatchStore","m_activeVideo","StopVideo","FDemoAbovePurchase","rightcolDemoBtn","_demoLink","purchaseNote","FSaveReviewFilters","addMessageListener","minPlaytime","maxPlaytime","oldShowFilteredReviews","ShowFilteredReviews","filtersChanged","upperBound","min","max","updatePlaytimeFilterValues","attr","loadingEl","disconnect","run","features","_callbacks","Ref","_promisesMap","_stats","feature","_generateFeatureChain","dependency","ready","dependencies","dep","ftr","previousCheck","prev","weakDependency","every","fulfilled","registerCallback","fn","triggerCallbacks","_observeChanges","searchBox","decorateStoreCapsules","tabContent","friendactivityTab","metalink","category","storePageDataPromise","setHD","videoIsHD","videoIsVisible","offsetHeight","loadedSrc","videoPosition","currentTime","videoPaused","paused","preload","onLoadedMetaData","play"],"sourceRoot":""}