{"version":3,"file":"js/store/wishlist.js","mappings":"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","sources":["webpack:///./src/js/Core/Errors/Errors.js","webpack:///./src/js/Core/Html/Html.js","webpack:///./src/js/Core/Html/HtmlParser.js","webpack:///./src/js/Core/Storage/CookieStorage.js","webpack:///./src/js/Core/Environment.js","webpack:///./src/js/Core/Localization/Language.js","webpack:///./src/js/Core/BackgroundSimple.js","webpack:///./src/js/Core/ExtensionResources.js","webpack:///./src/js/Core/Storage/Storage.js","webpack:///./src/js/Core/Info.js","webpack:///./src/js/Core/Storage/SyncedStorage.js","webpack:///./src/js/Core/Localization/Localization.js","webpack:///./src/js/Core/Storage/LocalStorage.js","webpack:///./src/js/Core/Utils/TimeUtils.js","webpack:///./src/js/Core/GameId.js","webpack:///./src/js/Core/Permissions.js","webpack:///./src/js/Core/Version.js","webpack:///./src/js/Content/Modules/Widgets/ProgressBar.js","webpack:///./src/js/Content/Modules/Background.js","webpack:///./src/js/Core/Errors/ErrorParser.js","webpack:///./src/js/Content/Modules/RequestData.js","webpack:///./src/js/Content/Modules/User.js","webpack:///./src/js/Content/Modules/Feature/FeatureManager.js","webpack:///./src/js/Content/Modules/Context/ContextType.js","webpack:///./src/js/Content/Modules/Data/DynamicStore.js","webpack:///./src/js/Content/Modules/Data/Inventory.js","webpack:///./src/js/Content/Modules/Feature/Feature.js","webpack:///./src/js/Content/Modules/Feature/CallbackFeature.js","webpack:///./src/js/Content/Modules/Widgets/SortBox.js","webpack:///./src/js/Content/Modules/DOMHelper.js","webpack:///./src/js/Content/Modules/Widgets/HorizontalScroller.js","webpack:///./src/js/config.js","webpack:///./src/js/Content/Modules/AugmentedSteam.js","webpack:///./src/js/Core/Utils/StringUtils.js","webpack:///./src/js/Content/Modules/CurrencyManager.js","webpack:///./src/js/Content/Modules/ITAD.js","webpack:///./src/js/Content/Modules/Messenger.js","webpack:///./src/js/Content/Modules/Price.js","webpack:///./src/js/Content/Modules/Prices.js","webpack:///./src/js/setup.js","webpack:///./src/js/Content/Features/Page.js","webpack:///./src/js/Content/Modules/SteamFacade.js","webpack:///./src/js/Content/Modules/UpdateHandler.js","webpack:///./src/js/Content/Features/Common/FHighlightsTags.js","webpack:///./src/js/Content/Features/Common/FEarlyAccess.js","webpack:///./src/js/Content/Features/Common/FHideTrademarks.js","webpack:///./src/js/Content/Features/Store/Common/FAlternativeLinuxIcon.js","webpack:///./src/js/Content/Features/Store/Wishlist/FWishlistHighlights.js","webpack:///./src/js/Content/Features/Store/Wishlist/FWishlistITADPrices.js","webpack:///./src/js/Core/Storage/UserNotesAdapter.js","webpack:///./src/js/Content/Features/Store/Common/UserNotes.js","webpack:///./src/js/Content/Features/Store/Wishlist/FWishlistUserNotes.js","webpack:///./src/js/Content/Features/Store/Wishlist/FWishlistStats.js","webpack:///./src/js/Content/Features/Store/Wishlist/FExportWishlist.js","webpack:///./src/js/Content/Modules/Clipboard.js","webpack:///./src/js/Core/Downloader.js","webpack:///./src/js/Content/Features/Store/Wishlist/FEmptyWishlist.js","webpack:///./src/js/Content/Features/Store/Wishlist/FKeepEditableRanking.js","webpack:///./src/js/Content/Features/Store/Wishlist/FOneClickRemoveFromWishlist.js","webpack:///./src/js/Content/Features/Store/Wishlist/PWishlist.js","webpack:///./src/js/Content/Features/StorePage.js","webpack:///./src/js/Content/Features/Store/Wishlist/CWishlist.js","webpack:///./src/js/Content/Features/Store/Common/CStoreBase.js","webpack:///./src/js/Content/Modules/Context/Context.js"],"sourcesContent":["\r\nclass LoginError extends Error {\r\n    constructor(type) {\r\n        super(type);\r\n        this.name = \"LoginError\";\r\n    }\r\n}\r\n\r\nclass ServerOutageError extends Error {\r\n    constructor(msg) {\r\n        super(msg);\r\n        this.name = \"ServerOutageError\";\r\n    }\r\n}\r\n\r\nclass HTTPError extends Error {\r\n    constructor(code, message) {\r\n        super(message);\r\n        this.code = code;\r\n    }\r\n}\r\n\r\n\r\nclass FeatureDependencyError extends Error {\r\n    constructor(msg, featureName) {\r\n        super(msg);\r\n        this.featureName = featureName;\r\n    }\r\n}\r\n\r\nconst Errors = {\r\n    \"LoginError\": LoginError,\r\n    \"ServerOutageError\": ServerOutageError,\r\n    \"HTTPError\": HTTPError,\r\n    \"FeatureDependencyError\": FeatureDependencyError\r\n};\r\n\r\nexport {Errors};\r\n","// TODO Accept NodeLists to insert HTML for every node in the list\r\nclass HTML {\r\n\r\n    static escape(str) {\r\n\r\n        // @see https://stackoverflow.com/a/4835406\r\n        const map = {\r\n            \"&\": \"&amp;\",\r\n            \"<\": \"&lt;\",\r\n            \">\": \"&gt;\",\r\n            '\"': \"&quot;\",\r\n            \"'\": \"&#039;\"\r\n        };\r\n\r\n        return str.replace(/[&<>\"']/g, (m) => { return map[m]; });\r\n    }\r\n\r\n    static fragment(html) {\r\n        const template = document.createElement(\"template\");\r\n        template.innerHTML = DOMPurify.sanitize(html);\r\n        return template.content;\r\n    }\r\n\r\n    static element(html) {\r\n        return HTML.fragment(html).firstElementChild;\r\n    }\r\n\r\n    static _getNode(node) {\r\n        let _node = node;\r\n\r\n        if (typeof _node == \"undefined\" || _node === null) {\r\n            console.warn(`${_node} is not an Element.`);\r\n            return null;\r\n        }\r\n        if (typeof _node == \"string\") {\r\n            _node = document.querySelector(_node);\r\n        }\r\n        if (!(_node instanceof Element)) {\r\n            console.warn(`${_node} is not an Element.`);\r\n            return null;\r\n        }\r\n\r\n        return _node;\r\n    }\r\n\r\n    static inner(node, html) {\r\n        const _node = HTML._getNode(node);\r\n\r\n        if (_node) {\r\n            _node.innerHTML = DOMPurify.sanitize(html);\r\n        }\r\n        return _node;\r\n    }\r\n\r\n    static replace(node, html) {\r\n        const _node = HTML._getNode(node);\r\n\r\n        if (_node) {\r\n            _node.outerHTML = DOMPurify.sanitize(html);\r\n        }\r\n        return _node;\r\n    }\r\n\r\n    static wrap(wrapper, startEl, endEl = startEl) {\r\n        const _startEl = HTML._getNode(startEl);\r\n\r\n        if (!_startEl) { return null; }\r\n\r\n        const _endEl = endEl === null ? _startEl.parentElement.lastElementChild : HTML._getNode(endEl);\r\n\r\n        const wrappedNodes = [_startEl];\r\n        for (let cur = _startEl; cur.nextElementSibling !== null && cur !== _endEl; cur = cur.nextElementSibling) {\r\n            wrappedNodes.push(cur.nextElementSibling);\r\n        }\r\n\r\n        const _wrapper = HTML.element(wrapper);\r\n        _startEl.replaceWith(_wrapper);\r\n        _wrapper.append(...wrappedNodes);\r\n        return _wrapper;\r\n    }\r\n\r\n    static adjacent(node, position, html) {\r\n        const _node = HTML._getNode(node);\r\n\r\n        if (_node) {\r\n            _node.insertAdjacentHTML(position, DOMPurify.sanitize(html));\r\n        }\r\n        return _node;\r\n    }\r\n\r\n    static beforeBegin(node, html) {\r\n        HTML.adjacent(node, \"beforebegin\", html);\r\n    }\r\n\r\n    static afterBegin(node, html) {\r\n        HTML.adjacent(node, \"afterbegin\", html);\r\n    }\r\n\r\n    static beforeEnd(node, html) {\r\n        HTML.adjacent(node, \"beforeend\", html);\r\n    }\r\n\r\n    static afterEnd(node, html) {\r\n        HTML.adjacent(node, \"afterend\", html);\r\n    }\r\n}\r\n\r\nexport {HTML};\r\n","import {HTML} from \"./Html\";\r\n\r\nclass HTMLParser {\r\n\r\n    static clearSpecialSymbols(string) {\r\n        return string.replace(/[\\u00AE\\u00A9\\u2122]/g, \"\");\r\n    }\r\n\r\n    static htmlToDOM(html) {\r\n        return HTML.fragment(html);\r\n    }\r\n\r\n    static htmlToElement(html) {\r\n        return HTML.element(html);\r\n    }\r\n\r\n    static getVariableFromText(text, name, type) {\r\n        let regex;\r\n        if (type === \"object\") {\r\n            regex = new RegExp(`${name}\\\\s*=\\\\s*(\\\\{.+?\\\\});`);\r\n        } else if (type === \"array\") {\r\n            regex = new RegExp(`${name}\\\\s*=\\\\s*(\\\\[.+?\\\\]);`);\r\n        } else if (type === \"int\") {\r\n            regex = new RegExp(`${name}\\\\s*=\\\\s*(.+?);`);\r\n        } else if (type === \"string\") {\r\n            regex = new RegExp(`${name}\\\\s*=\\\\s*(\\\\\".+?\\\\\");`);\r\n        } else {\r\n            return null;\r\n        }\r\n\r\n        const m = text.match(regex);\r\n        if (m) {\r\n            if (type === \"int\") {\r\n                return parseInt(m[1]);\r\n            }\r\n            return JSON.parse(m[1]);\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    static getVariableFromDom(name, type, dom = document) {\r\n        for (const node of dom.querySelectorAll(\"script\")) {\r\n            const value = HTMLParser.getVariableFromText(node.textContent, name, type);\r\n\r\n            if (value !== null) {\r\n                return value;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n}\r\n\r\nexport {HTMLParser};\r\n","\r\nclass CookieStorage {\r\n\r\n    static get(name, defaultValue) {\r\n        const _name = name.trim();\r\n\r\n        if (!CookieStorage.cache.has(_name)) {\r\n            return defaultValue;\r\n        }\r\n        return CookieStorage.cache.get(_name);\r\n    }\r\n\r\n    static set(name, val, ttl = 60 * 60 * 24 * 365) {\r\n        let _name = name.trim();\r\n        let _val = val.trim();\r\n\r\n        CookieStorage.cache.set(_name, _val);\r\n\r\n        _name = encodeURIComponent(_name);\r\n        _val = encodeURIComponent(_val);\r\n        document.cookie = `${_name}=${_val}; max-age=${ttl}`;\r\n    }\r\n\r\n    static remove(name) {\r\n        let _name = name.trim();\r\n        CookieStorage.cache.delete(_name);\r\n        _name = encodeURIComponent(_name);\r\n        document.cookie = `${_name}; expires=Thu, 01 Jan 1970 00:00:00 GMT`;\r\n    }\r\n\r\n    static init() {\r\n        CookieStorage.cache = new Map();\r\n        for (let [key, val] of document.cookie.split(\";\").map(kv => kv.split(\"=\"))) {\r\n            key = key.trim();\r\n            CookieStorage.cache.set(key, decodeURIComponent(val));\r\n        }\r\n    }\r\n}\r\n\r\nCookieStorage.init();\r\n\r\nexport {CookieStorage};\r\n","\r\nconst ContextType = Object.freeze({\r\n    \"BACKGROUND\": 1,\r\n    \"CONTENT_SCRIPT\": 2,\r\n    \"OPTIONS\": 3,\r\n});\r\n\r\nlet currentContext;\r\nif (browser.extension.getBackgroundPage) {\r\n    const bgPage = browser.extension.getBackgroundPage();\r\n\r\n    currentContext = (bgPage === window)\r\n        ? ContextType.BACKGROUND\r\n        : ContextType.OPTIONS;\r\n} else {\r\n    currentContext = ContextType.CONTENT_SCRIPT;\r\n}\r\n\r\nclass Environment {\r\n\r\n    static isBackgroundScript() {\r\n        return currentContext === ContextType.BACKGROUND;\r\n    }\r\n\r\n    static isContentScript() {\r\n        return currentContext === ContextType.CONTENT_SCRIPT;\r\n    }\r\n\r\n    static isOptions() {\r\n        return currentContext === ContextType.OPTIONS;\r\n    }\r\n}\r\n\r\nexport {Environment};\r\n","import {CookieStorage} from \"../Storage/CookieStorage\";\r\nimport {Environment} from \"../Environment\";\r\n\r\nclass Language {\r\n\r\n    static getCurrentSteamLanguage() {\r\n        if (this._currentSteamLanguage !== null) {\r\n            return this._currentSteamLanguage;\r\n        }\r\n\r\n        for (const script of document.querySelectorAll(\"script[src]\")) {\r\n            const language = new URL(script.src).searchParams.get(\"l\");\r\n            if (language) {\r\n                Language._currentSteamLanguage = language;\r\n                return this._currentSteamLanguage;\r\n            }\r\n        }\r\n\r\n        // In a Content Context, we can check for a cookie\r\n        if (Environment.isContentScript()) {\r\n            Language._currentSteamLanguage = CookieStorage.get(\"Steam_Language\") || null;\r\n        }\r\n\r\n        return this._currentSteamLanguage;\r\n    }\r\n\r\n    static getLanguageCode(language) {\r\n        const code = Language.languages[language];\r\n        return code || \"en\";\r\n    }\r\n\r\n    static isCurrentLanguageOneOf(array) {\r\n        return array.includes(Language.getCurrentSteamLanguage());\r\n    }\r\n}\r\n\r\nLanguage._currentSteamLanguage = null;\r\nLanguage.languages = {\r\n    \"english\": \"en\",\r\n    \"bulgarian\": \"bg\",\r\n    \"czech\": \"cs\",\r\n    \"danish\": \"da\",\r\n    \"dutch\": \"nl\",\r\n    \"finnish\": \"fi\",\r\n    \"french\": \"fr\",\r\n    \"greek\": \"el\",\r\n    \"german\": \"de\",\r\n    \"hungarian\": \"hu\",\r\n    \"italian\": \"it\",\r\n    \"japanese\": \"ja\",\r\n    \"koreana\": \"ko\",\r\n    \"norwegian\": \"no\",\r\n    \"polish\": \"pl\",\r\n    \"portuguese\": \"pt-PT\",\r\n    \"brazilian\": \"pt-BR\",\r\n    \"russian\": \"ru\",\r\n    \"romanian\": \"ro\",\r\n    \"schinese\": \"zh-CN\",\r\n    \"spanish\": \"es-ES\",\r\n    \"latam\": \"es-419\",\r\n    \"swedish\": \"sv-SE\",\r\n    \"tchinese\": \"zh-TW\",\r\n    \"thai\": \"th\",\r\n    \"turkish\": \"tr\",\r\n    \"ukrainian\": \"ua\",\r\n    \"vietnamese\": \"vi\",\r\n};\r\n\r\nexport {Language};\r\n","\r\nclass BackgroundSimple {\r\n    static message(message) {\r\n        return browser.runtime.sendMessage(message);\r\n    }\r\n\r\n    static action(requested, ...params) {\r\n        if (!params.length) { return this.message({\"action\": requested}); }\r\n        return this.message({\"action\": requested, \"params\": params});\r\n    }\r\n}\r\n\r\nexport {BackgroundSimple};\r\n","\r\nclass ExtensionResources {\r\n\r\n    static getURL(pathname) {\r\n        return browser.runtime.getURL(pathname);\r\n    }\r\n\r\n    static get(pathname) {\r\n        return fetch(ExtensionResources.getURL(pathname));\r\n    }\r\n\r\n    static getJSON(pathname) {\r\n        return ExtensionResources.get(pathname).then(r => r.json());\r\n    }\r\n\r\n    static getText(pathname) {\r\n        return ExtensionResources.get(pathname).then(r => r.text());\r\n    }\r\n}\r\n\r\nexport {ExtensionResources};\r\n","class Storage {\r\n\r\n    static has(key) {\r\n        return Object.prototype.hasOwnProperty.call(this.cache, key);\r\n    }\r\n\r\n    static get(key) {\r\n        if (typeof this.cache[key] !== \"undefined\" || typeof this.defaults === \"undefined\") {\r\n            return this.cache[key];\r\n        }\r\n        if (typeof this.defaults[key] === \"undefined\") {\r\n            console.warn('Unrecognized storage key \"%s\"', key);\r\n        }\r\n        return this.defaults[key];\r\n    }\r\n\r\n    static set(key, value) {\r\n        this.cache[key] = value;\r\n        return this._adapter.set({[key]: value});\r\n    }\r\n\r\n    static import(entries) {\r\n        for (const [key, value] of Object.entries(entries)) {\r\n            this.cache[key] = value;\r\n        }\r\n        return this._adapter.set(entries);\r\n    }\r\n\r\n    static remove(key) {\r\n        if (typeof this.cache[key] !== \"undefined\") {\r\n            delete this.cache[key];\r\n        }\r\n        return this._adapter.remove(key);\r\n    }\r\n\r\n    static keys(prefix = \"\") {\r\n        return Object.keys(this.cache).filter(k => k.startsWith(prefix));\r\n    }\r\n\r\n    static entries() {\r\n        return Object.entries(this.cache);\r\n    }\r\n\r\n    static async clear(force = false) {\r\n\r\n        let tmp;\r\n        if (!force) {\r\n            tmp = (this.persistent ?? []).reduce((acc, option) => {\r\n                acc[option] = this.cache[option];\r\n                return acc;\r\n            }, {});\r\n        }\r\n\r\n        await this._adapter.clear();\r\n        this.cache = {};\r\n\r\n        if (!force) {\r\n            await this.import(tmp);\r\n        }\r\n    }\r\n\r\n    // load whole storage and make local copy\r\n    static async init() {\r\n\r\n        const area = this._adapter === browser.storage.sync ? \"sync\" : \"local\";\r\n        const cache = Storage.caches[area];\r\n\r\n        if (typeof cache !== \"undefined\") {\r\n            this.cache = cache;\r\n            return this.cache;\r\n        }\r\n\r\n        Storage.caches[area] = {};\r\n        this.cache = Storage.caches[area];\r\n\r\n        browser.storage.onChanged.addListener((changes, eventArea) => {\r\n\r\n            if (area !== eventArea) { return; }\r\n\r\n            for (const [key, {\"newValue\": val}] of Object.entries(changes)) {\r\n                this.cache[key] = val;\r\n            }\r\n        });\r\n\r\n        return Object.assign(this.cache, await this._adapter.get(null));\r\n    }\r\n\r\n    static then(onDone, onCatch) {\r\n        const promise = this._initialized ? Promise.resolve(this.cache) : this.init();\r\n        this._initialized = true;\r\n        return promise.then(onDone, onCatch);\r\n    }\r\n\r\n    static toJson() {\r\n        return JSON.stringify(this.cache);\r\n    }\r\n}\r\n\r\nStorage.caches = {};\r\n\r\nexport {Storage};\r\n","\r\nconst Info = {\r\n    \"version\": browser.runtime.getManifest().version,\r\n    \"db_version\": 3,\r\n};\r\n\r\nexport {Info};\r\n","import {Storage} from \"./Storage\";\r\nimport {Info} from \"../Info\";\r\n\r\n/*\r\n * browser.storage.sync limits\r\n * QUOTA_BYTES = 102400 // 100KB\r\n * QUOTA_BYTES_PER_ITEM = 8192 // 8KB\r\n * MAX_ITEMS = 512\r\n * MAX_WRITE_OPERATIONS_PER_HOUR = 1800\r\n * MAX_WRITE_OPERATIONS_PER_MINUTE = 120\r\n */\r\nclass SyncedStorage extends Storage {}\r\n\r\nSyncedStorage._adapter = browser.storage.sync || browser.storage.local;\r\n\r\n/*\r\n * 8KiB is the limit for storage.sync https://chromium.googlesource.com/chromium/src/+/refs/heads/main/extensions/common/api/storage.json#227\r\n * 5MiB is the limit for storage.local (overall size) https://chromium.googlesource.com/chromium/src/+/refs/heads/main/extensions/common/api/storage.json#227\r\n * 2KiB are subtracted in order to save some space for other configuration options\r\n */\r\nSyncedStorage.QUOTA_BYTES_PER_ITEM = browser.storage.sync ? 8192 : 5242880 - 2048;\r\n\r\nSyncedStorage.defaults = Object.freeze({\r\n    \"language\": \"english\",\r\n\r\n    \"version\": Info.version,\r\n    \"version_show\": true,\r\n\r\n    \"highlight_owned_color\": \"#00ce67\",\r\n    \"highlight_wishlist_color\": \"#0491bf\",\r\n    \"highlight_coupon_color\": \"#a26426\",\r\n    \"highlight_inv_gift_color\": \"#800040\",\r\n    \"highlight_inv_guestpass_color\": \"#513c73\",\r\n    \"highlight_notinterested_color\": \"#4f4f4f\",\r\n    \"highlight_collection_color\": \"#856d0e\",\r\n    \"highlight_waitlist_color\": \"#4c7521\",\r\n\r\n    \"tag_owned_color\": \"#00b75b\",\r\n    \"tag_wishlist_color\": \"#0383b4\",\r\n    \"tag_coupon_color\": \"#c27120\",\r\n    \"tag_inv_gift_color\": \"#b10059\",\r\n    \"tag_inv_guestpass_color\": \"#65449a\",\r\n    \"tag_notinterested_color\": \"#4f4f4f\",\r\n    \"tag_collection_color\": \"#856d0e\",\r\n    \"tag_waitlist_color\": \"#4c7521\",\r\n\r\n    \"highlight_owned\": true,\r\n    \"highlight_wishlist\": true,\r\n    \"highlight_coupon\": false,\r\n    \"highlight_inv_gift\": false,\r\n    \"highlight_inv_guestpass\": false,\r\n    \"highlight_notinterested\": false,\r\n    \"highlight_excludef2p\": false,\r\n    \"highlight_collection\": true,\r\n    \"highlight_waitlist\": true,\r\n\r\n    \"tag_owned\": false,\r\n    \"tag_wishlist\": false,\r\n    \"tag_coupon\": false,\r\n    \"tag_inv_gift\": false,\r\n    \"tag_inv_guestpass\": false,\r\n    \"tag_notinterested\": true,\r\n    \"tag_collection\": false,\r\n    \"tag_waitlist\": false,\r\n    \"tag_short\": false,\r\n\r\n    \"hidetmsymbols\": false,\r\n\r\n    \"showlowestprice\": true,\r\n    \"showlowestprice_onwishlist\": true,\r\n    \"showlowestpricecoupon\": true,\r\n    \"showallstores\": true,\r\n    \"stores\": [],\r\n    \"override_price\": \"auto\",\r\n    \"showregionalprice\": \"mouse\",\r\n    \"regional_countries\": [\"us\", \"gb\", \"ru\", \"br\", \"au\", \"jp\"],\r\n\r\n    \"show_es_homepagetabs\": true,\r\n    \"showmarkettotal\": false,\r\n    \"showsteamrepapi\": true,\r\n    \"showmcus\": true,\r\n    \"showoc\": true,\r\n    \"showhltb\": true,\r\n    \"showyoutube\": true,\r\n    \"showtwitch\": true,\r\n    \"showpcgw\": true,\r\n    \"showcompletionistme\": false,\r\n    \"showprotondb\": false,\r\n    \"showviewinlibrary\": false,\r\n    \"showsteamcardexchange\": false,\r\n    \"showitadlinks\": true,\r\n    \"showsteamdb\": true,\r\n    \"showbartervg\": false,\r\n    \"showastatslink\": true,\r\n    \"showyoutubegameplay\": true,\r\n    \"showyoutubereviews\": true,\r\n    \"showwsgf\": true,\r\n    \"exfgls\": true,\r\n    \"app_custom_link\": [\r\n        {\r\n            \"enabled\": false,\r\n            \"name\": \"Google\",\r\n            \"url\": \"google.com/search?q=[ID]+[NAME]\",\r\n            \"icon\": \"www.google.com/images/branding/product/ico/googleg_lodp.ico\"\r\n        },\r\n    ],\r\n\r\n    \"customize_apppage\": {\r\n        \"recentupdates\": true,\r\n        \"reviews\": true,\r\n        \"about\": true,\r\n        \"contentwarning\": true,\r\n        \"steamchart\": true,\r\n        \"steamspy\": true,\r\n        \"surveys\": true,\r\n        \"sysreq\": true,\r\n        \"legal\": true,\r\n        \"morelikethis\": true,\r\n        \"recommendedbycurators\": true,\r\n        \"customerreviews\": true\r\n    },\r\n\r\n    \"customize_frontpage\": {\r\n        \"featuredrecommended\": true,\r\n        \"specialoffers\": true,\r\n        \"trendingamongfriends\": true,\r\n        \"discoveryqueue\": true,\r\n        \"browsesteam\": true,\r\n        \"curators\": true,\r\n        \"morecuratorrecommendations\": true,\r\n        \"recentlyupdated\": true,\r\n        \"fromdevelopersandpublishersthatyouknow\": true,\r\n        \"popularvrgames\": true,\r\n        \"homepagetabs\": true,\r\n        \"gamesstreamingnow\": true,\r\n        \"under\": true,\r\n        \"updatesandoffers\": true,\r\n        \"homepagesidebar\": true\r\n    },\r\n\r\n    // 'show_keylol_links': false, // not in use, option is commented out\r\n    \"show_package_info\": false,\r\n    \"show_steamchart_info\": true,\r\n    \"show_steamspy_info\": true,\r\n    \"show_early_access\": true,\r\n    \"show_alternative_linux_icon\": false,\r\n    \"show_itad_button\": false,\r\n    \"skip_got_steam\": false,\r\n\r\n    \"installsteam\": \"show\",\r\n    \"openinnewtab\": false,\r\n    \"keepssachecked\": false,\r\n    \"showemptywishlist\": true,\r\n    \"user_notes_app\": true,\r\n    \"user_notes_wishlist\": true,\r\n    \"showwishliststats\": true,\r\n    \"oneclickremovewl\": false,\r\n    \"user_notes\": {},\r\n    \"user_notes_adapter\": \"synced_storage\",\r\n    \"replaceaccountname\": true,\r\n    \"showlanguagewarning\": true,\r\n    \"showlanguagewarninglanguage\": \"english\",\r\n    \"homepage_tab_selection\": \"remember\",\r\n    \"homepage_tab_last\": null,\r\n    \"send_age_info\": true,\r\n    \"removebroadcasts\": false,\r\n    \"mp4video\": false,\r\n    \"horizontalscrolling\": true,\r\n    \"showsupportinfo\": true,\r\n    \"showdrm\": true,\r\n    \"regional_hideworld\": false,\r\n    \"showinvnav\": true,\r\n    \"quickinv\": true,\r\n    \"quickinv_diff\": -0.01,\r\n    \"community_default_tab\": \"\",\r\n    \"showallachievements\": false,\r\n    \"showallstats\": true,\r\n    \"replacecommunityhublinks\": false,\r\n    \"hideannouncementcomments\": false,\r\n    \"showachinstore\": true,\r\n    \"hideactivelistings\": false,\r\n    \"showlowestmarketprice\": true,\r\n    \"hidespamcomments\": false,\r\n    \"spamcommentregex\": \"[\\\\u2500-\\\\u25FF]\",\r\n    \"wlbuttoncommunityapp\": true,\r\n    \"removeguideslanguagefilter\": false,\r\n    \"disablelinkfilter\": false,\r\n    \"sortfriendsby\": \"default_ASC\",\r\n    \"sortreviewsby\": \"default_ASC\",\r\n    \"sortgroupsby\": \"default_ASC\",\r\n    \"show1clickgoo\": true,\r\n    \"show_profile_link_images\": \"gray\",\r\n    \"show_custom_themes\": true,\r\n    \"profile_pinned_bg\": false,\r\n    \"profile_steamrepcn\": true,\r\n    \"profile_steamgifts\": true,\r\n    \"profile_steamtrades\": true,\r\n    \"profile_bartervg\": true,\r\n    \"profile_steamrep\": true,\r\n    \"profile_steamdbcalc\": true,\r\n    \"profile_astats\": true,\r\n    \"profile_backpacktf\": true,\r\n    \"profile_astatsnl\": true,\r\n    \"profile_steamid\": true,\r\n    \"profile_custom_link\": [\r\n        {\r\n            \"enabled\": true,\r\n            \"name\": \"Google\",\r\n            \"url\": \"google.com/search?q=[ID]\",\r\n            \"icon\": \"www.google.com/images/branding/product/ico/googleg_lodp.ico\"\r\n        },\r\n    ],\r\n    \"fav_emoticons\": [],\r\n    \"group_steamgifts\": true,\r\n    \"steamcardexchange\": true,\r\n    \"purchase_dates\": true,\r\n    \"show_badge_progress\": true,\r\n    \"show_coupon\": true,\r\n    \"show_wishlist_link\": true,\r\n    \"show_wishlist_count\": true,\r\n    \"show_progressbar\": true,\r\n    \"show_backtotop\": false,\r\n\r\n    \"profile_showcase_twitch\": true,\r\n    \"profile_showcase_own_twitch\": false,\r\n    \"profile_showcase_twitch_profileonly\": false,\r\n\r\n    \"itad_import_library\": false,\r\n    \"itad_import_wishlist\": false,\r\n    \"add_to_waitlist\": false,\r\n\r\n    \"context_steam_store\": false,\r\n    \"context_steam_market\": false,\r\n    \"context_itad\": false,\r\n    \"context_bartervg\": false,\r\n    \"context_steamdb\": false,\r\n    \"context_steamdb_instant\": false,\r\n    \"context_steam_keys\": false,\r\n});\r\nSyncedStorage.persistent = [\r\n    \"user_notes\",\r\n    \"user_notes_adapter\",\r\n];\r\n\r\nexport {SyncedStorage};\r\n","import {BackgroundSimple} from \"../BackgroundSimple\";\r\nimport {ExtensionResources} from \"../ExtensionResources\";\r\nimport {Language} from \"./Language\";\r\nimport {SyncedStorage} from \"../Storage/SyncedStorage\";\r\n\r\n\r\nclass Localization {\r\n\r\n    static loadLocalization(code) {\r\n        return ExtensionResources.getJSON(`/localization/${code}.json`);\r\n    }\r\n\r\n    static init() {\r\n        if (Localization._promise) { return Localization._promise; }\r\n\r\n        let currentSteamLanguage = Language.getCurrentSteamLanguage();\r\n        const storedSteamLanguage = SyncedStorage.get(\"language\");\r\n        if (currentSteamLanguage === null) {\r\n            currentSteamLanguage = storedSteamLanguage;\r\n        } else if (currentSteamLanguage !== storedSteamLanguage) {\r\n            SyncedStorage.set(\"language\", currentSteamLanguage);\r\n            BackgroundSimple.action(\"clearpurchases\");\r\n        }\r\n\r\n        function deepAssign(target, source) {\r\n\r\n            // Object.assign() but deep-assigning objects recursively\r\n            for (const [key, val] of Object.entries(source)) {\r\n                if (typeof target[key] === \"undefined\") {\r\n                    console.warn(\"The key %s doesn't exist in the English localization file\", key);\r\n                    continue;\r\n                }\r\n                if (typeof val === \"object\") {\r\n                    deepAssign(target[key], val);\r\n                } else if (val !== \"\") {\r\n                    target[key] = val;\r\n                }\r\n            }\r\n            return target;\r\n        }\r\n\r\n        const local = Language.getLanguageCode(currentSteamLanguage);\r\n        const codes = [\"en\"];\r\n        if (local !== null && local !== \"en\") {\r\n            codes.push(local);\r\n        }\r\n        Localization._promise = Promise.all(\r\n            codes.map(lc => Localization.loadLocalization(lc))\r\n        ).then(([english, local]) => {\r\n            Localization.str = english;\r\n            if (local) {\r\n                deepAssign(Localization.str, local);\r\n            }\r\n            return Localization.str;\r\n        });\r\n        return Localization._promise;\r\n    }\r\n\r\n    static then(onDone, onCatch) {\r\n        return Localization.init().then(onDone, onCatch);\r\n    }\r\n\r\n    static getString(key) {\r\n\r\n        // Source: http://stackoverflow.com/a/24221895\r\n        const path = key.split(\".\").reverse();\r\n        let current = Localization.str;\r\n\r\n        while (path.length) {\r\n            if (typeof current !== \"object\") {\r\n                return null;\r\n            }\r\n            current = current[path.pop()];\r\n        }\r\n        return current;\r\n    }\r\n}\r\n\r\nLocalization._promise = null;\r\n\r\n\r\nexport {Localization};\r\n","\r\nimport {Storage} from \"./Storage\";\r\nimport {Environment} from \"../Environment\";\r\n\r\nclass LocalStorage extends Storage {\r\n\r\n    static async init() {\r\n        await super.init();\r\n\r\n        if (this === LocalStorage) {\r\n            // TODO Remove after some versions\r\n            return this.migrate();\r\n        }\r\n        return null;\r\n    }\r\n\r\n    static async migrate() {\r\n\r\n        const migrationDone = this.get(\"local_storage_migration\");\r\n\r\n        let type;\r\n\r\n        if (location.hostname === \"store.steampowered.com\") {\r\n            type = \"store\";\r\n        } else if (location.hostname === \"steamcommunity.com\") {\r\n            type = \"community\";\r\n        } else if (Environment.isContentScript()) {\r\n            return null;\r\n        } else {\r\n            type = \"extension\";\r\n        }\r\n\r\n        if (migrationDone[type]) { return null; }\r\n\r\n        await Promise.all(Object.keys(LocalStorage.defaults).map(async key => {\r\n\r\n            let value = localStorage.getItem(key);\r\n            if (value === null) { return; }\r\n\r\n            try {\r\n                value = JSON.parse(value);\r\n            } catch (err) {\r\n                console.error(\"Can't parse value\", value);\r\n                throw err;\r\n            }\r\n\r\n            await LocalStorage.set(key, value);\r\n            localStorage.removeItem(key);\r\n        }));\r\n\r\n        migrationDone[type] = true;\r\n        return LocalStorage.set(\"local_storage_migration\", migrationDone);\r\n    }\r\n}\r\n\r\nLocalStorage._adapter = browser.storage.local;\r\n\r\nLocalStorage.defaults = Object.freeze({\r\n    \"access_token\": null,\r\n    \"lastItadImport\": {\"from\": null, \"to\": null},\r\n    \"login\": {\"steamId\": null, \"profilePath\": null},\r\n    \"storeCountry\": null,\r\n    \"expand_slider\": false,\r\n    \"es_guide_tags\": {}, // TODO remove prefix\r\n    \"market_stats\": {\"startListing\": null, \"purchaseTotal\": 0, \"saleTotal\": 0},\r\n    \"popular_refresh\": false,\r\n    \"workshop_state\": \"\",\r\n    \"playback_hd\": false,\r\n    \"show_review_section\": true,\r\n    \"steampeek\": false,\r\n    \"support_info\": null,\r\n    \"hide_login_warn_store\": false,\r\n    \"hide_login_warn_community\": false,\r\n    \"review_filters\": {},\r\n    \"local_storage_migration\": {\"store\": false, \"community\": false, \"extension\": false},\r\n});\r\n\r\nexport {LocalStorage};\r\n","class Timer {\r\n\r\n    constructor(duration) {\r\n        this._promise = new Promise(resolve => {\r\n            this._id = setTimeout(() => { resolve(); }, duration);\r\n        });\r\n    }\r\n\r\n    then(onSuccess, onFail) {\r\n        if (this._promise) {\r\n            return this._promise.then(onSuccess, onFail);\r\n        }\r\n\r\n        throw new Error(\"Timer has been cleared before\");\r\n    }\r\n\r\n    clear() {\r\n        clearTimeout(this._id);\r\n        this._promise = null;\r\n    }\r\n}\r\n\r\nclass ResettableTimer {\r\n\r\n    constructor(onDone, duration) {\r\n        this.onDone = onDone;\r\n        this.duration = duration;\r\n\r\n        this.reset();\r\n    }\r\n\r\n    get running() { return this._running; }\r\n\r\n    reset() {\r\n        if (typeof this._id !== \"undefined\") {\r\n            clearTimeout(this._id);\r\n        }\r\n\r\n        this._id = setTimeout(async() => {\r\n            await this.onDone();\r\n            this._running = false;\r\n        }, this.duration);\r\n\r\n        this._running = true;\r\n    }\r\n}\r\n\r\nclass TimeUtils {\r\n\r\n    static timer(duration) {\r\n        return new Timer(duration);\r\n    }\r\n\r\n    static resettableTimer(onDone, duration) {\r\n        return new ResettableTimer(onDone, duration);\r\n    }\r\n\r\n    static now() {\r\n        return Math.trunc(Date.now() / 1000);\r\n    }\r\n}\r\n\r\nexport {TimeUtils};\r\n","\r\nclass GameId {\r\n\r\n    static parseId(id) {\r\n        if (!id) { return null; }\r\n\r\n        const intId = parseInt(id);\r\n        if (!intId) { return null; }\r\n\r\n        return intId;\r\n    }\r\n\r\n    static getAppid(text) {\r\n        let _text = text;\r\n\r\n        if (!_text) { return null; }\r\n\r\n        if (_text instanceof HTMLElement) {\r\n            const appid = _text.dataset.dsAppid;\r\n            if (appid) { return GameId.parseId(appid); }\r\n            _text = _text.href;\r\n            if (!_text) { return null; }\r\n        }\r\n\r\n        // app, games (legacy official group page), market/listing\r\n        const m = _text.match(/(?:store\\.steampowered|steamcommunity)\\.com\\/(?:app|games|market\\/listings)\\/(\\d+)\\/?/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static getSubid(text) {\r\n        let _text = text;\r\n\r\n        if (!_text) { return null; }\r\n\r\n        if (_text instanceof HTMLElement) {\r\n            const subid = _text.dataset.dsPackageid;\r\n            if (subid) { return GameId.parseId(subid); }\r\n            _text = _text.href;\r\n            if (!_text) { return null; }\r\n        }\r\n\r\n        const m = _text.match(/(?:store\\.steampowered|steamcommunity)\\.com\\/sub\\/(\\d+)\\/?/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static getBundleid(text) {\r\n        let _text = text;\r\n\r\n        if (!_text) { return null; }\r\n\r\n        if (_text instanceof HTMLElement) {\r\n            const bundleid = _text.dataset.dsBundleid;\r\n            if (bundleid) { return GameId.parseId(bundleid); }\r\n            _text = _text.href;\r\n            if (!_text) { return null; }\r\n        }\r\n\r\n        const m = _text.match(/(?:store\\.steampowered|steamcommunity)\\.com\\/bundle\\/(\\d+)\\/?/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static trimStoreId(storeId) {\r\n        return Number(storeId.slice(storeId.indexOf(\"/\") + 1));\r\n    }\r\n\r\n    static getAppidImgSrc(text) {\r\n        let _text = text;\r\n\r\n        if (!_text) { return null; }\r\n\r\n        if (_text instanceof HTMLImageElement) {\r\n            if (_text.hasAttribute(\"src\")) {\r\n                _text = _text.getAttribute(\"src\");\r\n            } else {\r\n                _text = _text.dataset.imageUrl;\r\n            }\r\n            if (!_text) { return null; }\r\n        }\r\n\r\n        // TODO support Steam's CDN option\r\n        const m = _text.match(/(?:cdn\\.(?:akamai|cloudflare)\\.steamstatic\\.com\\/steam|steamcdn-a\\.akamaihd\\.net\\/steam|steamcommunity\\/public\\/images)\\/apps\\/(\\d+)\\//);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static getAppidUriQuery(text) {\r\n        if (!text) { return null; }\r\n        const m = text.match(/appid=(\\d+)/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static getAppids(text) {\r\n        const regex = /(?:store\\.steampowered|steamcommunity)\\.com\\/app\\/(\\d+)\\/?/g;\r\n        const res = [];\r\n        let m;\r\n        while ((m = regex.exec(text)) !== null) {\r\n            const id = GameId.parseId(m[1]);\r\n            if (id) {\r\n                res.push(id);\r\n            }\r\n        }\r\n        return res;\r\n    }\r\n\r\n    static getAppidFromId(text) {\r\n        if (!text) { return null; }\r\n        const m = text.match(/game_(\\d+)/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static getAppidFromGameCard(text) {\r\n        if (!text) { return null; }\r\n        const m = text.match(/\\/gamecards\\/(\\d+)/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n}\r\n\r\nexport {GameId};\r\n","import {SyncedStorage} from \"./Storage/SyncedStorage\";\r\n\r\nconst ctxPermissions = __BROWSER__ === \"firefox\" ? [] : [\"contextMenus\"];\r\n\r\nconst PermissionOptions = Object.freeze({\r\n    \"context_steam_store\": {\r\n        \"persistent\": true,\r\n        \"permissions\": ctxPermissions,\r\n    },\r\n    \"context_steam_market\": {\r\n        \"persistent\": true,\r\n        \"permissions\": ctxPermissions,\r\n    },\r\n    \"context_itad\": {\r\n        \"persistent\": true,\r\n        \"permissions\": ctxPermissions,\r\n    },\r\n    \"context_bartervg\": {\r\n        \"persistent\": true,\r\n        \"permissions\": ctxPermissions,\r\n    },\r\n    \"context_steamdb\": {\r\n        \"persistent\": true,\r\n        \"permissions\": ctxPermissions,\r\n    },\r\n    \"context_steamdb_instant\": {\r\n        \"persistent\": true,\r\n        \"permissions\": ctxPermissions,\r\n    },\r\n    \"context_steam_keys\": {\r\n        \"persistent\": true,\r\n        \"permissions\": ctxPermissions,\r\n    },\r\n});\r\n\r\nclass Permissions {\r\n\r\n    /**\r\n     * @return Promise\r\n     */\r\n    static contains(permissionList) {\r\n        return browser.permissions.contains({\"permissions\": permissionList});\r\n    }\r\n\r\n    /**\r\n     * @return Promise\r\n     */\r\n    static request(permissionList) {\r\n        return browser.permissions.request({\"permissions\": permissionList});\r\n    }\r\n\r\n    /**\r\n     * @return Promise\r\n     */\r\n    static remove(permissionList) {\r\n        if (permissionList.includes(\"contextMenus\")) {\r\n            browser.contextMenus.removeAll();\r\n        }\r\n        return browser.permissions.remove({\"permissions\": permissionList});\r\n    }\r\n\r\n    static async when(permission, onAdded, onRemoved) {\r\n        if (onAdded) {\r\n            if (await Permissions.contains([permission])) {\r\n                onAdded();\r\n            }\r\n\r\n            browser.permissions.onAdded.addListener(p => {\r\n                if (p.permissions.includes(permission)) {\r\n                    onAdded();\r\n                }\r\n            });\r\n        }\r\n\r\n        if (onRemoved) {\r\n            browser.permissions.onRemoved.addListener(p => {\r\n                if (p.permissions.includes(permission)) {\r\n                    onRemoved();\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    static requestOption(option) {\r\n        return Permissions.request(PermissionOptions[option].permissions);\r\n    }\r\n\r\n    static removeOption(optionToRemove) {\r\n\r\n        // If any of the permissions is in use by another option, don't remove.\r\n        const unusedPermissions = Permissions._getUnusedPermissions(optionToRemove);\r\n        if (unusedPermissions.length === 0) {\r\n            return Promise.resolve(true);\r\n        }\r\n\r\n        return Permissions.remove(unusedPermissions);\r\n    }\r\n\r\n    static _getUnusedPermissions(option) {\r\n        const used = new Set();\r\n        for (const [key, setup] of Object.entries(PermissionOptions)) {\r\n            if (option === key || (setup.persistent && !SyncedStorage.get(key))) {\r\n                continue;\r\n            }\r\n\r\n            for (const p of setup.permissions) {\r\n                used.add(p);\r\n            }\r\n        }\r\n\r\n        const unused = new Set();\r\n        for (const p of PermissionOptions[option].permissions) {\r\n            if (!used.has(p)) {\r\n                unused.add(p);\r\n            }\r\n        }\r\n\r\n        return Array.from(unused.values());\r\n    }\r\n}\r\n\r\nexport {PermissionOptions, Permissions};\r\n","import {Info} from \"./Info\";\r\n\r\nclass Version {\r\n\r\n    constructor(major, minor = 0, patch = 0) {\r\n        console.assert([major, minor, patch].filter(Number.isInteger).length === 3, `${major}.${minor}.${patch} must be integers`);\r\n        this.major = major;\r\n        this.minor = minor;\r\n        this.patch = patch;\r\n    }\r\n\r\n    static from(version) {\r\n        if (version instanceof Version) {\r\n            return new Version(version.major, version.minor, version.patch);\r\n        }\r\n        if (typeof version == \"string\") {\r\n            return Version.fromString(version);\r\n        }\r\n        if (Array.isArray(version)) {\r\n            return Version.fromArray(version);\r\n        }\r\n        throw new Error(`Could not construct a Version from ${version}`);\r\n    }\r\n\r\n    static fromArray(version) {\r\n        return new Version(...version.map(v => parseInt(v)));\r\n    }\r\n\r\n    static fromString(version) {\r\n        return Version.fromArray(version.split(\".\"));\r\n    }\r\n\r\n    static coerce(version) {\r\n        if (version instanceof Version) {\r\n            return version;\r\n        }\r\n        return Version.from(version);\r\n    }\r\n\r\n    toString() {\r\n        return `${this.major}.${this.minor}.${this.patch}`;\r\n    }\r\n\r\n    toArray() {\r\n        return [this.major, this.minor, this.patch];\r\n    }\r\n\r\n    toJSON() {\r\n        return this.toString();\r\n    }\r\n\r\n    isCurrent() {\r\n        return this.isSameOrAfter(Info.version);\r\n    }\r\n\r\n    isSame(version) {\r\n        const _version = Version.coerce(version);\r\n        return this.major === _version.major\r\n            && this.minor === _version.minor\r\n            && this.patch === _version.patch;\r\n    }\r\n\r\n    isBefore(version) {\r\n        const _version = Version.coerce(version);\r\n        if (this.major < _version.major) { return true; }\r\n        if (this.major > _version.major) { return false; }\r\n\r\n        // this.major == _version.major\r\n        if (this.minor < _version.minor) { return true; }\r\n        if (this.minor > _version.minor) { return false; }\r\n\r\n        // this.minor == _version.minor\r\n        if (this.patch < _version.patch) { return true; }\r\n        return false;\r\n    }\r\n\r\n    isSameOrBefore(version) {\r\n        return this.isSame(version) || this.isBefore(version);\r\n    }\r\n\r\n    isAfter(version) {\r\n        const _version = Version.coerce(version);\r\n        return _version.isBefore(this);\r\n    }\r\n\r\n    isSameOrAfter(version) {\r\n        const _version = Version.coerce(version);\r\n        return _version.isSameOrBefore(this);\r\n    }\r\n}\r\n\r\nexport {Version};\r\n","import {SyncedStorage} from \"../../../Core/Storage/SyncedStorage\";\r\nimport {HTML} from \"../../../Core/Html/Html\";\r\nimport {Localization} from \"../../../Core/Localization/Localization\";\r\n\r\nclass ProgressBar {\r\n    static create() {\r\n        if (!SyncedStorage.get(\"show_progressbar\")) { return; }\r\n\r\n        HTML.afterEnd(\"#global_actions\",\r\n            `<div class=\"es_progress__wrap\">\r\n                <div class=\"es_progress es_progress--complete\" title=\"${Localization.str.ready.ready}\">\r\n                    <div class=\"es_progress__bar\">\r\n                        <div class=\"es_progress__value\"></div>\r\n                    </div>\r\n                </div>\r\n            </div>`);\r\n        ProgressBar._progress = document.querySelector(\".es_progress\");\r\n    }\r\n\r\n    static loading() {\r\n        if (!ProgressBar._progress) { return; }\r\n\r\n        ProgressBar._progress.setAttribute(\"title\", Localization.str.ready.loading);\r\n\r\n        ProgressBar.requests = {\"initiated\": 0, \"completed\": 0};\r\n        ProgressBar._progress.classList.remove(\"es_progress--complete\");\r\n        ProgressBar._progress.querySelector(\".es_progress__value\").style.width = \"18px\";\r\n    }\r\n\r\n    static startRequest() {\r\n        if (!ProgressBar.requests) { return; }\r\n        ProgressBar.requests.initiated++;\r\n        ProgressBar.progress();\r\n    }\r\n\r\n    static finishRequest() {\r\n        if (!ProgressBar.requests) { return; }\r\n        ProgressBar.requests.completed++;\r\n        ProgressBar.progress();\r\n    }\r\n\r\n    static progress(value) {\r\n        if (!ProgressBar._progress) { return; }\r\n\r\n        let _value = value;\r\n\r\n        if (!_value) {\r\n            if (!ProgressBar.requests) { return; }\r\n            if (ProgressBar.requests.initiated > 0) {\r\n                _value = 100 * ProgressBar.requests.completed / ProgressBar.requests.initiated;\r\n            }\r\n        }\r\n        if (_value > 100) {\r\n            _value = 100;\r\n        }\r\n\r\n        ProgressBar._progress.querySelector(\".es_progress__value\").style.width = `${_value}px`;\r\n\r\n        if (_value >= 100) {\r\n            ProgressBar._progress.classList.add(\"es_progress--complete\");\r\n            ProgressBar._progress.setAttribute(\"title\", Localization.str.ready.ready);\r\n            ProgressBar.requests = null;\r\n        }\r\n    }\r\n\r\n    static serverOutage() {\r\n        if (!ProgressBar._progress) { return; }\r\n\r\n        ProgressBar._progress.classList.add(\"es_progress--warning\");\r\n        ProgressBar.requests = null;\r\n\r\n        if (!ProgressBar._progress.parentElement.querySelector(\".es_progress__warning, .es_progress__error\")) {\r\n            HTML.afterEnd(\r\n                ProgressBar._progress,\r\n                `<div class=\"es_progress__warning\">${Localization.str.ready.server_outage}</div>`\r\n            );\r\n        }\r\n    }\r\n\r\n    static failed() {\r\n        if (!ProgressBar._progress) { return; }\r\n\r\n        const warningNode = ProgressBar._progress.parentElement.querySelector(\".es_progress__warning\");\r\n        if (warningNode) {\r\n            ProgressBar._progress.classList.remove(\"es_progress--warning\"); // Errors have higher precedence\r\n            warningNode.remove();\r\n        }\r\n        ProgressBar._progress.classList.add(\"es_progress--error\");\r\n        ProgressBar.requests = null;\r\n\r\n        const nodeError = ProgressBar._progress.parentElement.querySelector(\".es_progress__error\");\r\n        if (nodeError) {\r\n            nodeError.textContent = Localization.str.ready.failed.replace(\"__amount__\", ++ProgressBar._failedRequests);\r\n        } else {\r\n            HTML.afterEnd(\r\n                ProgressBar._progress,\r\n                `<div class=\"es_progress__error\">${\r\n                    Localization.str.ready.failed.replace(\"__amount__\", ++ProgressBar._failedRequests)\r\n                }</div>`\r\n            );\r\n        }\r\n    }\r\n}\r\n\r\nProgressBar._progress = null;\r\nProgressBar._failedRequests = 0;\r\n\r\nexport {ProgressBar};\r\n","import {BackgroundSimple} from \"../../Core/BackgroundSimple\";\r\nimport {ErrorParser} from \"../../Core/Errors/ErrorParser\";\r\nimport {ProgressBar} from \"./Widgets/ProgressBar\";\r\n\r\nclass Background extends BackgroundSimple {\r\n    static async message(message) {\r\n        ProgressBar.startRequest();\r\n\r\n        let result;\r\n        try {\r\n            result = await super.message(message);\r\n            ProgressBar.finishRequest();\r\n            return result;\r\n        } catch (err) {\r\n            const errObj = ErrorParser.parse(err.message);\r\n\r\n            switch (errObj.name) {\r\n                case \"ServerOutageError\":\r\n                    ProgressBar.serverOutage();\r\n                    break;\r\n                default: {\r\n                    if (!Background._errorHandlers.some(handler => handler(errObj))) {\r\n                        ProgressBar.failed();\r\n                    }\r\n                }\r\n            }\r\n            throw err;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @callback registerErrorHandlerCallback\r\n     * @param {string} name - The error name\r\n     * @param {string} msg - The error message\r\n     * @returns {boolean} - Whether the error has been handled\r\n     */\r\n\r\n    /**\r\n     * @param {registerErrorHandlerCallback} handler - The callback that will (eventually) handle the error\r\n     */\r\n    static registerErrorHandler(handler) {\r\n        Background._errorHandlers.push(handler);\r\n    }\r\n}\r\nBackground._errorHandlers = [];\r\n\r\nexport {Background};\r\n","\r\n/**\r\n * Convenience class for passing errors between contexts.\r\n * Errors thrown in the context of a message callback on the background page are\r\n * {@link https://github.com/mozilla/webextension-polyfill/blob/87bdfa844da054d189ac28423cf01b64ebfe1e5b/src/browser-polyfill.js#L418\r\n *  cut down to only send the message of the error},\r\n * losing information about the type.\r\n */\r\nclass ErrorParser {\r\n\r\n    /**\r\n     * Takes an Error string and parses it by splitting it into name and message\r\n     * @param {String} errStr a string created by Error.prototype.toString\r\n     * @returns {{name: String, msg: String}} an object containing information about the error name and its message\r\n     */\r\n    static parse(errStr) {\r\n        const info = errStr.match(/(.*):\\s(.+)/);\r\n\r\n        return {\"name\": info[1] || \"\", \"msg\": info[2] || \"\"};\r\n    }\r\n}\r\n\r\nexport {ErrorParser};\r\n","import {ProgressBar} from \"./Widgets/ProgressBar\";\r\nimport {Errors} from \"../../Core/Errors/Errors\";\r\n\r\nclass RequestData {\r\n\r\n    static async getHttp(url, settings = {}, responseType = \"text\") {\r\n\r\n        let _url = url;\r\n        const _settings = {\r\n            \"method\": \"GET\",\r\n            \"credentials\": \"include\",\r\n            \"headers\": {\"origin\": window.location.origin},\r\n            \"referrer\": window.location.origin + window.location.pathname,\r\n            ...settings\r\n        };\r\n\r\n        ProgressBar.startRequest();\r\n\r\n        if (_url.startsWith(\"//\")) { // TODO remove when not needed\r\n            _url = window.location.protocol + url;\r\n            console.warn(\"Requesting URL without protocol, please update\");\r\n        }\r\n\r\n        let response;\r\n\r\n        try {\r\n            response = await RequestData._fetchFn(_url, _settings);\r\n\r\n            if (!response.ok) {\r\n                throw new Errors.HTTPError(response.status, `HTTP ${response.status} ${response.statusText} for ${response.url}`);\r\n            }\r\n        } catch (err) {\r\n            ProgressBar.failed();\r\n            throw err;\r\n        }\r\n\r\n        ProgressBar.finishRequest();\r\n\r\n        return response[responseType]();\r\n    }\r\n\r\n    static post(url, formData, settings, returnJSON) {\r\n        return RequestData.getHttp(url, Object.assign(settings || {}, {\r\n            \"method\": \"POST\",\r\n            \"body\": formData\r\n        }), returnJSON ? \"json\" : \"text\");\r\n    }\r\n\r\n    static getJson(url, settings) {\r\n        return RequestData.getHttp(url, settings, \"json\");\r\n    }\r\n\r\n    static getBlob(url, settings) {\r\n        return RequestData.getHttp(url, settings, \"blob\");\r\n    }\r\n}\r\n\r\n/**\r\n * In Firefox, the global fetch lies in the sandbox environment, thus we have to\r\n * access the fetch function of the content window.\r\n * See https://bugzilla.mozilla.org/show_bug.cgi?id=1579347#c5\r\n */\r\nRequestData._fetchFn\r\n    // eslint-disable-next-line no-undef\r\n    = (typeof content !== \"undefined\" && content && content.fetch) // content is only available in FF environments\r\n    || fetch.bind(window);\r\n\r\nexport {RequestData};\r\n","import {CookieStorage} from \"../../Core/Storage/CookieStorage\";\r\nimport {HTMLParser} from \"../../Core/Html/HtmlParser\";\r\nimport {Background} from \"./Background\";\r\nimport {RequestData} from \"./RequestData\";\r\n\r\nclass User {\r\n\r\n    static get storeCountry() {\r\n\r\n        const url = new URL(window.location.href);\r\n\r\n        let country;\r\n        if (url.searchParams && url.searchParams.has(\"cc\")) {\r\n            country = url.searchParams.get(\"cc\");\r\n        } else {\r\n            country = User._storeCountry;\r\n            if (!country) {\r\n                country = CookieStorage.get(\"steamCountry\");\r\n            }\r\n        }\r\n\r\n        if (!country) {\r\n            console.warn(\"Failed to detect store country, falling back to US\");\r\n            country = \"US\";\r\n        }\r\n\r\n        return country.substr(0, 2);\r\n    }\r\n\r\n    static promise() {\r\n        if (User._promise) { return User._promise; }\r\n\r\n        const avatarNode = document.querySelector(\"#global_actions > a.user_avatar\");\r\n        let loginPromise;\r\n\r\n        if (avatarNode) {\r\n            User.profileUrl = avatarNode.href;\r\n            User.profilePath = avatarNode.pathname;\r\n\r\n            loginPromise = Background.action(\"login\", User.profilePath)\r\n                .then(login => {\r\n                    if (!login) { return; }\r\n                    User.isSignedIn = true;\r\n                    User.steamId = login.steamId;\r\n                });\r\n        } else {\r\n            loginPromise = Background.action(\"logout\");\r\n        }\r\n\r\n        User._promise = loginPromise\r\n            .then(() => Background.action(\"storecountry\"))\r\n            .catch(({message}) => { console.error(message); })\r\n            .then(country => {\r\n                if (country) {\r\n                    User._storeCountry = country;\r\n                    return null;\r\n                }\r\n\r\n                let newCountry;\r\n\r\n                if (window.location.hostname.endsWith(\"steampowered.com\")) {\r\n\r\n                    // Search through all scripts in case the order gets changed or a new one gets added\r\n                    for (const script of document.getElementsByTagName(\"script\")) {\r\n                        const match = script.textContent.match(/GDynamicStore\\.Init\\(.+?, '([A-Z]{2})/);\r\n                        if (match) {\r\n                            newCountry = match[1];\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                } else if (window.location.hostname === \"steamcommunity.com\") {\r\n                    const config = document.querySelector(\"#webui_config,#application_config\");\r\n                    if (config) {\r\n                        newCountry = JSON.parse(config.dataset.config).COUNTRY;\r\n                    }\r\n                }\r\n\r\n                if (newCountry) {\r\n                    User._storeCountry = newCountry;\r\n                    return Background.action(\"storecountry\", newCountry)\r\n                        .catch(({message}) => { console.error(message); });\r\n                } else {\r\n                    throw new Error(\"Script with user store country not found\");\r\n                }\r\n\r\n            })\r\n            .catch(err => {\r\n                console.group(\"Store country detection\");\r\n                console.warn(\"Failed to detect store country from page\");\r\n                console.error(err);\r\n                console.groupEnd();\r\n            });\r\n\r\n        return User._promise;\r\n    }\r\n\r\n    static then(onDone, onCatch) {\r\n        return User.promise().then(onDone, onCatch);\r\n    }\r\n\r\n    static get sessionId() {\r\n        if (!User._sessionId) {\r\n            User._sessionId = HTMLParser.getVariableFromDom(\"g_sessionID\", \"string\");\r\n        }\r\n        return User._sessionId;\r\n    }\r\n\r\n    static getPurchaseDate(lang, appName) {\r\n        const _appName = HTMLParser.clearSpecialSymbols(appName);\r\n        return Background.action(\"purchases\", _appName, lang);\r\n    }\r\n\r\n    /*\r\n     * Retrieve user access token to use in new style WebAPI calls (Services)\r\n     * https://github.com/Revadike/UnofficialSteamWebAPI/wiki/Get-Points-Summary-Config\r\n     */\r\n    static async getUserToken() {\r\n        // Use relative URL, so it matches domain (works on any steam domain)\r\n        const response = await RequestData.getJson(\"/pointssummary/ajaxgetasyncconfig\").catch(() => false);\r\n        if (!response || !response.success) {\r\n            throw new Error(\"Failed to get webapi token\");\r\n        }\r\n\r\n        return response.data.webapi_token;\r\n    }\r\n}\r\n\r\nexport {User};\r\n","import {Errors} from \"../../../Core/Errors/Errors\";\r\n\r\n// Polyfill from https://gist.github.com/davidbarral/d0d4da70fa9e6f615595d01f54276e0b#file-promises-js\r\nif (!Promise.allSettled) {\r\n    Promise.allSettled = promises => Promise.all(\r\n        promises.map(promise => promise\r\n            .then(value => ({\r\n                \"status\": \"fulfilled\",\r\n                value,\r\n            }))\r\n            .catch(reason => ({\r\n                \"status\": \"rejected\",\r\n                reason,\r\n            })))\r\n    );\r\n}\r\n\r\nclass FeatureManager {\r\n    static async apply(features) {\r\n\r\n        this._promisesMap = new Map();\r\n\r\n        this._stats = {\r\n            \"completed\": 0,\r\n            \"failed\": 0,\r\n            \"dependency\": 0,\r\n        };\r\n\r\n        while (features.length > 0) {\r\n\r\n            const feature = features.pop();\r\n            const promise = this._generateFeatureChain(feature);\r\n\r\n            if (promise === null) {\r\n                features.unshift(feature);\r\n            } else {\r\n                this._promisesMap.set(feature.constructor, promise);\r\n            }\r\n        }\r\n\r\n        await Promise.allSettled(Array.from(this._promisesMap.values()));\r\n\r\n        console.log(\r\n            \"Feature loading complete, %i successfully loaded, %i failed to load, %i didn't load due to dependency errors\",\r\n            this._stats.completed,\r\n            this._stats.failed,\r\n            this._stats.dependency\r\n        );\r\n    }\r\n\r\n    static _generateFeatureChain(feature) {\r\n\r\n        let ready = true;\r\n        let promise = Promise.resolve(true);\r\n\r\n        if (Array.isArray(feature.constructor.dependencies)) {\r\n\r\n            // Ensure that all dependencies have generated a dependency chain for themselves\r\n            for (const dep of feature.constructor.dependencies) {\r\n                if (this._promisesMap.has(dep)) { continue; }\r\n\r\n                ready = false;\r\n                break;\r\n            }\r\n\r\n            if (ready) {\r\n\r\n                // Promise that waits for all dependencies to finish executing\r\n                promise = Promise.all(\r\n                    Array.from(this._promisesMap.entries())\r\n                        .filter(([ftr]) => feature.constructor.dependencies.includes(ftr))\r\n                        .map(([, promise]) => promise)\r\n                );\r\n            }\r\n        }\r\n\r\n        if (!ready) { return null; }\r\n\r\n        return promise\r\n            .then(previousCheck => { // Check if the dependencies have all their prerequisites fulfilled\r\n                let prev = true;\r\n\r\n                if (!feature.constructor.weakDependency) {\r\n                    if (Array.isArray(previousCheck)) {\r\n                        prev = previousCheck.every(res => res);\r\n                    } else {\r\n                        prev = previousCheck;\r\n                    }\r\n                }\r\n\r\n                return prev && feature.checkPrerequisites();\r\n            })\r\n            .then(async fulfilled => { // If the feature's prerequisites are fulfilled, apply it\r\n                if (fulfilled) {\r\n                    await feature.apply();\r\n                    ++this._stats.completed;\r\n                }\r\n                return fulfilled;\r\n            })\r\n            .catch(err => {\r\n\r\n                const featureName = feature.constructor.name;\r\n\r\n                if (err instanceof Errors.FeatureDependencyError) {\r\n                    console.warn(\r\n                        \"Not applying feature %s due to an error in the dependency chain (namely %s)\",\r\n                        featureName,\r\n                        err.featureName\r\n                    );\r\n                    ++this._stats.dependency;\r\n                    throw err;\r\n                }\r\n\r\n                console.group(featureName);\r\n                console.error(\"Error while applying feature %s\", featureName);\r\n                console.error(err);\r\n                console.groupEnd();\r\n\r\n                ++this._stats.failed;\r\n                throw new Errors.FeatureDependencyError(\"Failed to apply\", featureName);\r\n            });\r\n\r\n    }\r\n}\r\n\r\nexport {FeatureManager};\r\n","\r\nexport default Object.freeze({\r\n    \"ACCOUNT\": 1,\r\n    \"APP\": 2,\r\n    \"BUNDLE\": 3,\r\n    \"STORE_DEFAULT\": 4,\r\n    \"FUNDS\": 5,\r\n    \"REGISTER_KEY\": 6,\r\n    \"SALE\": 7, // unused\r\n    \"SEARCH\": 8,\r\n    \"STATS\": 9,\r\n    \"STORE_FRONT\": 10,\r\n    \"SUB\": 11,\r\n    \"WISHLIST\": 12,\r\n    \"AGECHECK\": 13,\r\n    \"COMMUNITY_DEFAULT\": 14,\r\n    \"WORKSHOP\": 15,\r\n    \"PROFILE_ACTIVITY\": 16,\r\n    \"GAMES\": 17,\r\n    \"PROFILE_EDIT\": 18,\r\n    \"BADGES\": 19,\r\n    \"GAME_CARD\": 20,\r\n    \"FRIENDS_THAT_PLAY\": 21,\r\n    \"FRIENDS\": 22, // unused\r\n    \"MARKET_SEARCH\": 23,\r\n    \"INVENTORY\": 24,\r\n    \"MARKET_LISTING\": 25,\r\n    \"MARKET_HOME\": 26,\r\n    \"PROFILE_HOME\": 27,\r\n    \"GROUP_HOME\": 28,\r\n    \"GUIDES\": 29,\r\n    \"COMMUNITY_APP\": 30,\r\n    \"COMMUNITY_STATS\": 31,\r\n    \"MY_WORKSHOP\": 32,\r\n    \"SHARED_FILES\": 33,\r\n    \"WORKSHOP_BROWSE\": 34,\r\n    \"EDIT_GUIDE\": 35,\r\n    \"RECOMMENDED\": 36,\r\n    \"BOOSTER_CREATOR\": 37,\r\n    \"TRADE_OFFER\": 38,\r\n    \"FRIENDS_AND_GROUPS\": 39,\r\n    \"POINTS_SHOP\": 40,\r\n});\r\n\r\n","import {GameId} from \"../../../Core/GameId\";\r\nimport {Background} from \"../Background\";\r\nimport {User} from \"../User\";\r\n\r\nclass DynamicStore {\r\n\r\n    /*\r\n     * FIXME\r\n     *  1. Check usage of `await DynamicStore`, currently it does nothing\r\n     *  2. getAppStatus() is not properly waiting for initialization of the DynamicStore\r\n     *  3. There is no guarante that `User` is initialized before `_fetch()` is called\r\n     *  4. getAppStatus() should probably be simplified if we force array even when only one storeId was requested\r\n     */\r\n\r\n    static clear() {\r\n        return Background.action(\"dynamicstore.clear\");\r\n    }\r\n\r\n    static async getAppStatus(storeId) {\r\n        const multiple = Array.isArray(storeId);\r\n        let promise;\r\n        let trimmedIds;\r\n\r\n        if (multiple) {\r\n            trimmedIds = storeId.map(id => GameId.trimStoreId(id));\r\n            promise = Background.action(\"dynamicstorestatus\", trimmedIds);\r\n        } else {\r\n            promise = Background.action(\"dynamicstorestatus\", GameId.trimStoreId(storeId));\r\n        }\r\n\r\n        let statusList;\r\n        const dsStatusList = await promise;\r\n\r\n        if (multiple) {\r\n            statusList = {};\r\n            for (let i = 0; i < storeId.length; ++i) {\r\n                const trimmedId = trimmedIds[i];\r\n                const id = storeId[i];\r\n                statusList[id] = {\r\n                    \"ignored\": dsStatusList[trimmedId].includes(\"ignored\"),\r\n                    \"wishlisted\": dsStatusList[trimmedId].includes(\"wishlisted\"),\r\n                };\r\n                if (id.startsWith(\"app/\")) {\r\n                    statusList[id].owned = dsStatusList[trimmedId].includes(\"ownedApps\");\r\n                } else if (id.startsWith(\"sub/\")) {\r\n                    statusList[id].owned = dsStatusList[trimmedId].includes(\"ownedPackages\");\r\n                }\r\n            }\r\n        } else {\r\n            statusList = {\r\n                \"ignored\": dsStatusList.includes(\"ignored\"),\r\n                \"wishlisted\": dsStatusList.includes(\"wishlisted\"),\r\n            };\r\n            if (storeId.startsWith(\"app/\")) {\r\n                statusList.owned = dsStatusList.includes(\"ownedApps\");\r\n            } else if (storeId.startsWith(\"sub/\")) {\r\n                statusList.owned = dsStatusList.includes(\"ownedPackages\");\r\n            }\r\n        }\r\n\r\n        return statusList;\r\n    }\r\n\r\n    static async getRandomApp() {\r\n        await DynamicStore._fetch();\r\n        return Background.action(\"dynamicStore.randomApp\");\r\n    }\r\n\r\n    static _fetch() {\r\n        if (!User.isSignedIn) {\r\n            return DynamicStore.clear();\r\n        }\r\n        return Promise.resolve(null);\r\n    }\r\n\r\n    static then(onDone, onCatch) {\r\n        if (!DynamicStore._promise) {\r\n            DynamicStore._promise = DynamicStore._fetch();\r\n        }\r\n        return DynamicStore._promise.then(onDone, onCatch);\r\n    }\r\n}\r\n\r\nexport {DynamicStore};\r\n","import {Background} from \"../Background\";\r\n\r\nclass Inventory {\r\n\r\n    static getCoupon(appid) {\r\n        return Background.action(\"coupon\", appid);\r\n    }\r\n\r\n    static async getAppStatus(appids, options) {\r\n\r\n        function getStatusObject(giftsAndPasses, hasCoupon) {\r\n            return {\r\n                \"gift\": giftsAndPasses.includes(\"gifts\"),\r\n                \"guestPass\": giftsAndPasses.includes(\"passes\"),\r\n                \"coupon\": Boolean(hasCoupon),\r\n            };\r\n        }\r\n\r\n        const opts = {\"giftsAndPasses\": true,\r\n            \"coupons\": true,\r\n            ...options};\r\n\r\n        if (!opts.giftsAndPasses && !opts.coupons) { return null; }\r\n\r\n        const multiple = Array.isArray(appids);\r\n\r\n        try {\r\n            const [giftsAndPasses, coupons] = await Promise.all([\r\n                opts.giftsAndPasses ? Background.action(\"hasgiftsandpasses\", appids) : Promise.resolve(),\r\n                opts.coupons ? Background.action(\"hascoupon\", appids) : Promise.resolve(),\r\n            ]);\r\n\r\n            if (multiple) {\r\n                const results = {};\r\n\r\n                for (const id of appids) {\r\n                    results[id] = getStatusObject(giftsAndPasses ? giftsAndPasses[id] : [], coupons ? coupons[id] : false);\r\n                }\r\n\r\n                return results;\r\n            }\r\n            return getStatusObject(giftsAndPasses || [], typeof coupons === \"undefined\" ? false : coupons);\r\n        } catch (err) {\r\n            if (multiple) {\r\n                const results = {};\r\n                for (const id of appids) {\r\n                    results[id] = getStatusObject([], false);\r\n                }\r\n                return results;\r\n            }\r\n\r\n            return getStatusObject([], false);\r\n        }\r\n    }\r\n\r\n    static hasInMarketInventory(marketHashes) {\r\n        return Background.action(\"hasitem\", marketHashes);\r\n    }\r\n}\r\n\r\nexport {Inventory};\r\n","\r\nclass Feature {\r\n\r\n    /**\r\n     * @param {Context} context\r\n     */\r\n    constructor(context) {\r\n        this.context = context;\r\n    }\r\n\r\n    checkPrerequisites() {\r\n        return true;\r\n    }\r\n\r\n    apply() {\r\n        throw new Error(\"Stub\");\r\n    }\r\n\r\n    logError(err, msg, ...args) {\r\n        console.group(this.constructor.name);\r\n        console.error(msg, ...args);\r\n        console.error(err);\r\n        console.groupEnd();\r\n    }\r\n}\r\n\r\nexport {Feature};\r\n","import {Feature} from \"./Feature\";\r\n\r\nclass CallbackFeature extends Feature {\r\n\r\n    apply() {\r\n        this.context.registerCallback((...params) => { this.callback(...params); });\r\n\r\n        if (typeof this.setup === \"function\") {\r\n            this.setup();\r\n        }\r\n    }\r\n}\r\n\r\nexport {CallbackFeature};\r\n","\r\n// Most of the code here comes from dselect.js\r\nimport {HTML} from \"../../../Core/Html/Html\";\r\nimport {Localization} from \"../../../Core/Localization/Localization\";\r\nimport {SyncedStorage} from \"../../../Core/Storage/SyncedStorage\";\r\n\r\nclass Sortbox {\r\n\r\n    static init() {\r\n        this._activeDropLists = {};\r\n        this._lastSelectHideTime = 0;\r\n\r\n        // Hide droplist when clicking outside\r\n        document.addEventListener(\"mousedown\", e => {\r\n            for (const key of Object.keys(this._activeDropLists)) {\r\n                if (this._activeDropLists[key] && !e.target.closest(`#${key}_container`)) {\r\n                    this._hide(key);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    static _highlightItem(id, index, bSetSelected) {\r\n        const droplist = document.querySelector(`#${id}_droplist`);\r\n        const trigger = document.querySelector(`#${id}_trigger`);\r\n        const rgItems = droplist.getElementsByTagName(\"a\");\r\n\r\n        if (index >= 0 && index < rgItems.length) {\r\n            const item = rgItems[index];\r\n\r\n            if (typeof trigger.highlightedItem !== \"undefined\" && trigger.highlightedItem !== index) {\r\n                rgItems[trigger.highlightedItem].className = \"inactive_selection\";\r\n            }\r\n\r\n            trigger.highlightedItem = index;\r\n            rgItems[index].className = \"highlighted_selection\";\r\n\r\n            let yOffset = rgItems[index].offsetTop + rgItems[index].clientHeight;\r\n            let curVisibleOffset = droplist.scrollTop + droplist.clientHeight;\r\n            let bScrolledDown = false;\r\n            const nMaxLoopIterations = rgItems.length;\r\n            let nLoopCounter = 0;\r\n\r\n            while (curVisibleOffset < yOffset && nLoopCounter++ < nMaxLoopIterations) {\r\n                droplist.scrollTop += rgItems[index].clientHeight;\r\n                curVisibleOffset = droplist.scrollTop + droplist.clientHeight;\r\n                bScrolledDown = true;\r\n            }\r\n\r\n            if (!bScrolledDown) {\r\n                nLoopCounter = 0;\r\n                yOffset = rgItems[index].offsetTop;\r\n                curVisibleOffset = droplist.scrollTop;\r\n                while (curVisibleOffset > yOffset && nLoopCounter++ < nMaxLoopIterations) {\r\n                    droplist.scrollTop -= rgItems[index].clientHeight;\r\n                    curVisibleOffset = droplist.scrollTop;\r\n                }\r\n            }\r\n\r\n            if (bSetSelected) {\r\n                HTML.inner(trigger, item.innerHTML);\r\n                const input = document.querySelector(`#${id}`);\r\n                input.value = item.id;\r\n                input.dispatchEvent(new Event(\"change\"));\r\n\r\n                this._hide(id);\r\n            }\r\n        }\r\n    }\r\n\r\n    static _onFocus(id) {\r\n        this._activeDropLists[id] = true;\r\n    }\r\n\r\n    static _onBlur(id) {\r\n        if (!document.querySelector(`#${id}_trigger`).classList.contains(\"activetrigger\")) {\r\n            this._activeDropLists[id] = false;\r\n        }\r\n    }\r\n\r\n    static _hide(id) {\r\n        const droplist = document.querySelector(`#${id}_droplist`);\r\n        const trigger = document.querySelector(`#${id}_trigger`);\r\n\r\n        this._lastSelectHideTime = Date.now();\r\n\r\n        trigger.className = \"trigger\";\r\n        droplist.className = \"dropdownhidden\";\r\n        this._activeDropLists[id] = false;\r\n        trigger.focus();\r\n    }\r\n\r\n    static _show(id) {\r\n        if (Date.now() - this._lastSelectHideTime < 50) { return; }\r\n\r\n        const droplist = document.querySelector(`#${id}_droplist`);\r\n        const trigger = document.querySelector(`#${id}_trigger`);\r\n\r\n        trigger.className = \"activetrigger\";\r\n        droplist.className = \"dropdownvisible\";\r\n        this._activeDropLists[id] = true;\r\n        trigger.focus();\r\n    }\r\n\r\n    static _onTriggerClick(id) {\r\n        if (!document.querySelector(`#${id}_trigger`).classList.contains(\"activetrigger\")) {\r\n            this._show(id);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * NOTE FOR ADDON REVIEWER:\r\n     * Elements returned by this function are already sanitized (calls to HTML class),\r\n     * so they can be safely inserted without being sanitized again.\r\n     * If we would sanitize them again, all event listeners would be lost due to\r\n     * DOMPurify only returning HTML strings.\r\n     */\r\n    static get(name, options, initialOption, changeFn, storageOption) {\r\n\r\n        const id = `sort_by_${name}`;\r\n        let reversed = initialOption.endsWith(\"_DESC\");\r\n\r\n        const arrowDown = \"\";\r\n        const arrowUp = \"\";\r\n\r\n        const box = HTML.element(\r\n            `<div class=\"es-sortbox es-sortbox--${name}\">\r\n                <div class=\"es-sortbox__label\">${Localization.str.sort_by}</div>\r\n                <div id=\"${id}_container\" class=\"es-sortbox__container\">\r\n                    <input id=\"${id}\" type=\"hidden\" name=\"${name}\" value=\"${initialOption}\">\r\n                    <a id=\"${id}_trigger\" class=\"trigger\"></a>\r\n                    <div class=\"es-dropdown\">\r\n                        <ul id=\"${id}_droplist\" class=\"dropdownhidden\"></ul>\r\n                    </div>\r\n                </div>\r\n                <span class=\"es-sortbox__reverse\">${reversed ? arrowUp : arrowDown}</span>\r\n            </div>`\r\n        );\r\n\r\n        const input = box.querySelector(`#${id}`);\r\n\r\n        function getTrimmedValue(val) { return val.replace(/(_ASC|_DESC)$/, \"\"); }\r\n\r\n        function onChange(val, reversed) {\r\n            const _val = getTrimmedValue(val);\r\n            changeFn(_val, reversed);\r\n            if (storageOption) { SyncedStorage.set(storageOption, `${_val}_${reversed ? \"DESC\" : \"ASC\"}`); }\r\n        }\r\n\r\n        input.addEventListener(\"change\", () => { onChange(input.value.replace(`${id}_`, \"\"), reversed); });\r\n\r\n        // Trigger changeFn for initial option\r\n        if (initialOption !== \"default_ASC\") {\r\n            input.dispatchEvent(new Event(\"change\"));\r\n        }\r\n\r\n        const reverseEl = box.querySelector(\".es-sortbox__reverse\");\r\n        reverseEl.addEventListener(\"click\", () => {\r\n            reversed = !reversed;\r\n            reverseEl.textContent = reversed ? arrowUp : arrowDown;\r\n            onChange(input.value.replace(`${id}_`, \"\"), reversed);\r\n        });\r\n\r\n        const trigger = box.querySelector(`#${id}_trigger`);\r\n        trigger.addEventListener(\"focus\", () => this._onFocus(id));\r\n        trigger.addEventListener(\"blur\", () => this._onBlur(id));\r\n        trigger.addEventListener(\"click\", () => this._onTriggerClick(id));\r\n\r\n        const ul = box.querySelector(\"ul\");\r\n        const trimmedOption = getTrimmedValue(initialOption);\r\n        for (let i = 0; i < options.length; ++i) {\r\n            const [key, text] = options[i];\r\n\r\n            let toggle = \"inactive\";\r\n            if (key === trimmedOption) {\r\n                input.value = key;\r\n                trigger.textContent = text;\r\n                toggle = \"highlighted\";\r\n            }\r\n\r\n            HTML.beforeEnd(ul,\r\n                `<li>\r\n                    <a class=\"${toggle}_selection\" tabindex=\"99999\" id=\"${id}_${key}\">${text}</a>\r\n                </li>`);\r\n\r\n            const a = ul.querySelector(\"li:last-child > a\");\r\n\r\n            // a.href = \"javascript:DSelectNoop()\";\r\n            a.addEventListener(\"mouseover\", () => this._highlightItem(id, i, false));\r\n            a.addEventListener(\"click\", () => this._highlightItem(id, i, true));\r\n        }\r\n\r\n        return box;\r\n    }\r\n}\r\n\r\nSortbox.init();\r\n\r\nexport {Sortbox};\r\n","\r\nclass DOMHelper {\r\n\r\n    static wrap(container, node) {\r\n        const parent = node.parentNode;\r\n        parent.insertBefore(container, node);\r\n        parent.removeChild(node);\r\n        container.append(node);\r\n    }\r\n\r\n    static remove(selector) {\r\n        const node = document.querySelector(selector);\r\n        if (!node) { return; }\r\n        node.remove();\r\n    }\r\n\r\n    // TODO extend Node itself?\r\n    static selectLastNode(parent, selector) {\r\n        const nodes = parent.querySelectorAll(selector);\r\n        return nodes.length === 0 ? null : nodes[nodes.length - 1];\r\n    }\r\n\r\n    static insertStylesheet(href) {\r\n        const stylesheet = document.createElement(\"link\");\r\n        stylesheet.rel = \"stylesheet\";\r\n        stylesheet.type = \"text/css\";\r\n        stylesheet.href = href;\r\n        document.head.appendChild(stylesheet);\r\n    }\r\n\r\n    static insertScript({src, content}, id, onload, isAsync = true) {\r\n        const script = document.createElement(\"script\");\r\n\r\n        if (onload) { script.onload = onload; }\r\n        if (id) { script.id = id; }\r\n        if (src) { script.src = src; }\r\n        if (content) { script.textContent = content; }\r\n        if (isAsync) { script.setAttribute(\"async\", \"\"); }\r\n\r\n        document.head.appendChild(script);\r\n    }\r\n\r\n    static insertCSS(content, id) {\r\n        const style = document.createElement(\"style\");\r\n\r\n        if (id) { style.id = id; }\r\n        style.textContent = content;\r\n\r\n        document.head.appendChild(style);\r\n    }\r\n}\r\n\r\nexport {DOMHelper};\r\n","\r\nclass HorizontalScroller {\r\n\r\n    static create(parentNode, controlLeftNode, controlRightNode) {\r\n\r\n        let lastScroll = 0;\r\n\r\n        parentNode.addEventListener(\"wheel\", e => {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n\r\n            if (Date.now() - lastScroll < 200) { return; }\r\n            lastScroll = Date.now();\r\n\r\n            const isScrollDown = e.deltaY > 0;\r\n            if (isScrollDown) {\r\n                controlRightNode.click();\r\n            } else {\r\n                controlLeftNode.click();\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nexport {HorizontalScroller};\r\n","// This is the basic configuration for the Augmented Steam extension\r\n\r\nexport default {\r\n    \"ApiServerHost\": \"https://esapi.isthereanydeal.com\",\r\n    \"PublicHost\": \"https://augmentedsteam.com\",\r\n    \"ITADApiServerHost\": \"https://api.isthereanydeal.com\",\r\n    \"ITADClientId\": \"5fe78af07889f43a\"\r\n};\r\n","import {HTML} from \"../../Core/Html/Html\";\r\nimport {ExtensionResources} from \"../../Core/ExtensionResources\";\r\nimport {Localization} from \"../../Core/Localization/Localization\";\r\nimport {SyncedStorage} from \"../../Core/Storage/SyncedStorage\";\r\nimport {Language} from \"../../Core/Localization/Language\";\r\nimport {LocalStorage} from \"../../Core/Storage/LocalStorage\";\r\nimport {Background} from \"./Background\";\r\nimport {DOMHelper} from \"./DOMHelper\";\r\nimport {HorizontalScroller} from \"./Widgets/HorizontalScroller\";\r\nimport {DynamicStore} from \"./Data/DynamicStore\";\r\nimport {User} from \"./User\";\r\nimport {Page} from \"../Features/Page\";\r\nimport config from \"../../config\";\r\n\r\nclass AugmentedSteam {\r\n\r\n    static _addMenu() {\r\n\r\n        HTML.afterBegin(\"#global_action_menu\",\r\n            `<div id=\"es_menu\">\r\n                <span id=\"es_pulldown\" class=\"pulldown global_action_link\">Augmented Steam</span>\r\n                <div id=\"es_popup\" class=\"popup_block_new\">\r\n                    <div class=\"popup_body popup_menu\">\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"${ExtensionResources.getURL(\"html/options.html\")}\">${Localization.str.thewordoptions}</a>\r\n                        <a class=\"popup_menu_item\" id=\"es_clear_cache\" href=\"#clear_cache\">${Localization.str.clear_cache}</a>\r\n                        <div class=\"hr\"></div>\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"https://github.com/IsThereAnyDeal/AugmentedSteam\">${Localization.str.contribute}</a>\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"https://github.com/IsThereAnyDeal/AugmentedSteam/issues\">${Localization.str.bug_feature}</a>\r\n                        <div class=\"hr\"></div>\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"${config.PublicHost}\">${Localization.str.website}</a>\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"https://isthereanydeal.com/\">IsThereAnyDeal</a>\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"https://discord.gg/yn57q7f\">Discord</a>\r\n                    </div>\r\n                </div>\r\n            </div>`);\r\n\r\n        document.querySelector(\"#es_pulldown\").addEventListener(\"click\", () => {\r\n            Page.runInPageContext(() => {\r\n                window.SteamFacade.showMenu(\"es_pulldown\", \"es_popup\", \"right\", \"bottom\", true);\r\n            });\r\n        });\r\n\r\n        document.querySelector(\"#es_menu\").addEventListener(\"click\", e => {\r\n            e.stopPropagation();\r\n        });\r\n\r\n        document.querySelector(\"#es_popup\").addEventListener(\"click\", () => {\r\n            Page.runInPageContext(() => {\r\n                window.SteamFacade.hideMenu(\"es_pulldown\", \"es_popup\");\r\n            });\r\n        });\r\n\r\n        document.querySelector(\"#es_clear_cache\").addEventListener(\"click\", async e => {\r\n            e.preventDefault();\r\n\r\n            await AugmentedSteam.clearCache();\r\n            window.location.reload();\r\n        });\r\n    }\r\n\r\n    static _addBackToTop() {\r\n        if (!SyncedStorage.get(\"show_backtotop\")) { return; }\r\n\r\n        // Remove Steam's back-to-top button\r\n        DOMHelper.remove(\"#BackToTop\");\r\n\r\n        const btn = document.createElement(\"div\");\r\n        btn.classList.add(\"es_btt\");\r\n        btn.textContent = \"\";\r\n\r\n        document.body.append(btn);\r\n\r\n        btn.addEventListener(\"click\", () => {\r\n            window.scroll({\r\n                \"top\": 0,\r\n                \"left\": 0,\r\n                \"behavior\": \"smooth\"\r\n            });\r\n        });\r\n\r\n        window.addEventListener(\"scroll\", () => {\r\n            btn.classList.toggle(\"is-visible\", window.scrollY >= 400);\r\n        });\r\n    }\r\n\r\n    static _bindLogout() {\r\n\r\n        // TODO there should be a better detection of logout, probably\r\n        const logoutNode = document.querySelector(\"a[href$='javascript:Logout();']\");\r\n        logoutNode.addEventListener(\"click\", () => {\r\n            AugmentedSteam.clearCache();\r\n        });\r\n    }\r\n\r\n    static _addWarning(innerHTML, stopShowingHandler) {\r\n        const el = HTML.element(\r\n            `<div class=\"es_warn js-warn\">\r\n                <div class=\"es_warn__cnt\">\r\n                    <div>${innerHTML}</div>\r\n                    <div class=\"es_warn__control\">\r\n                        <a class=\"es_warn__btn js-warn-close\">${Localization.str.update.dont_show}</a>\r\n                        <a class=\"es_warn__btn js-warn-hide\">${Localization.str.hide}</a>\r\n                    </div>\r\n                </div>\r\n            </div>`\r\n        );\r\n\r\n        el.querySelector(\".js-warn-close\").addEventListener(\"click\", () => {\r\n            if (stopShowingHandler) {\r\n                stopShowingHandler();\r\n            }\r\n            el.closest(\".js-warn\").remove();\r\n        });\r\n\r\n        el.querySelector(\".js-warn-hide\").addEventListener(\"click\", () => {\r\n            el.closest(\".js-warn\").remove();\r\n        });\r\n\r\n        document.getElementById(\"global_header\").insertAdjacentElement(\"afterend\", el);\r\n    }\r\n\r\n    /**\r\n     * Display warning if browsing using a different language\r\n     */\r\n    static _addLanguageWarning() {\r\n        if (!SyncedStorage.get(\"showlanguagewarning\")) { return; }\r\n\r\n        const currentLanguage = Language.getCurrentSteamLanguage();\r\n        if (!currentLanguage) { return; }\r\n\r\n        if (!SyncedStorage.has(\"showlanguagewarninglanguage\")) {\r\n            SyncedStorage.set(\"showlanguagewarninglanguage\", currentLanguage);\r\n        }\r\n\r\n        const warningLanguage = SyncedStorage.get(\"showlanguagewarninglanguage\");\r\n\r\n        if (currentLanguage === warningLanguage) { return; }\r\n\r\n        Localization.loadLocalization(Language.getLanguageCode(warningLanguage)).then((strings) => {\r\n            AugmentedSteam._addWarning(\r\n                `${strings.using_language.replace(\"__current__\", strings.options.lang[currentLanguage] || currentLanguage)}\r\n                <a href=\"#\" id=\"es_reset_language_code\">\r\n                ${strings.using_language_return.replace(\"__base__\", strings.options.lang[warningLanguage] || warningLanguage)}\r\n                </a>`,\r\n                () => { SyncedStorage.set(\"showlanguagewarning\", false); }\r\n            );\r\n\r\n            document.querySelector(\"#es_reset_language_code\").addEventListener(\"click\", (e) => {\r\n                e.preventDefault();\r\n                // eslint-disable-next-line no-undef, new-cap\r\n                Page.runInPageContext(warningLanguage => { ChangeLanguage(warningLanguage); }, [warningLanguage]);\r\n            });\r\n        });\r\n    }\r\n\r\n    static _handleInstallSteamButton() {\r\n        const option = SyncedStorage.get(\"installsteam\");\r\n        if (option === \"hide\") {\r\n            DOMHelper.remove(\"div.header_installsteam_btn\");\r\n        } else if (option === \"replace\") {\r\n            const btn = document.querySelector(\"div.header_installsteam_btn > a\");\r\n            btn.textContent = Localization.str.viewinclient;\r\n            btn.href = `steam://openurl/${window.location.href}`;\r\n            btn.classList.add(\"es_steamclient_btn\");\r\n        }\r\n    }\r\n\r\n    static _addUsernameSubmenuLinks() {\r\n        // There are two menus; one for responsive (mobile) and one for \"unresponsive\" (desktop) design\r\n        for (const node of document.querySelectorAll(\".submenu_username\")) {\r\n            HTML.afterEnd(\r\n                node.querySelector(\"a\"),\r\n                `<a class=\"submenuitem\" href=\"//steamcommunity.com/my/games/\">${Localization.str.games}</a>`\r\n            );\r\n            HTML.afterEnd(\r\n                node.querySelector(\"a:nth-child(2)\"),\r\n                `<a class=\"submenuitem\" href=\"//store.steampowered.com/wishlist/\">${Localization.str.wishlist}</a>`\r\n            );\r\n            HTML.beforeEnd(\r\n                node,\r\n                `<a class=\"submenuitem\" href=\"//steamcommunity.com/my/recommended/\">${Localization.str.reviews}</a>`\r\n            );\r\n        }\r\n    }\r\n\r\n    static _cartLink() {\r\n        // There are two menus; one for responsive (mobile) and one for \"unresponsive\" (desktop) design\r\n        for (const wishlistLink of document.querySelectorAll(\".submenu_store > .submenuitem[href='https://steamcommunity.com/my/wishlist/']\")) {\r\n            HTML.afterEnd(wishlistLink, `<a class=\"submenuitem\" href=\"https://store.steampowered.com/cart/\">${Localization.str.cart}</a>`);\r\n        }\r\n    }\r\n\r\n    static _disableLinkFilter() {\r\n        if (!SyncedStorage.get(\"disablelinkfilter\")) { return; }\r\n\r\n        function removeLinkFilter(parent = document) {\r\n            const selector = \"a[href*='/linkfilter/']\";\r\n\r\n            for (const link of parent.querySelectorAll(selector)) {\r\n                link.href = new URLSearchParams(link.search).get(\"url\");\r\n            }\r\n        }\r\n\r\n        removeLinkFilter();\r\n\r\n        new MutationObserver(mutations => {\r\n            for (const mutation of mutations) {\r\n                for (const node of mutation.addedNodes) {\r\n                    if (node.nodeType !== Node.ELEMENT_NODE) { continue; }\r\n                    removeLinkFilter(node);\r\n                }\r\n            }\r\n        }).observe(document, {\"childList\": true, \"subtree\": true});\r\n    }\r\n\r\n    static _addRedeemLink() {\r\n        HTML.beforeBegin(\r\n            \"#account_language_pulldown\",\r\n            `<a class=\"popup_menu_item\" href=\"https://store.steampowered.com/account/registerkey\">${Localization.str.activate}</a>`\r\n        );\r\n    }\r\n\r\n    static _replaceAccountName() {\r\n        if (!SyncedStorage.get(\"replaceaccountname\")) { return; }\r\n\r\n        const logoutNode = document.querySelector(\"#account_dropdown .persona.online\");\r\n        const accountName = logoutNode.textContent.trim();\r\n        const communityName = document.querySelector(\"#account_pulldown\").textContent.trim();\r\n\r\n        logoutNode.textContent = communityName;\r\n\r\n        // Replace page header on account related pages\r\n        if (location.href.startsWith(\"https://store.steampowered.com/account\")) {\r\n            const pageHeader = document.querySelector(\"h2.pageheader\");\r\n            if (pageHeader) {\r\n                pageHeader.textContent = pageHeader.textContent.replace(new RegExp(accountName, \"i\"), communityName);\r\n            }\r\n        }\r\n\r\n        // Don't replace title on user pages that aren't mine\r\n        const isUserPage = /.*(id|profiles)\\/.+/g.test(location.pathname);\r\n        if (!isUserPage || location.pathname.includes(User.profilePath)) {\r\n            document.title = document.title.replace(accountName, communityName);\r\n        }\r\n    }\r\n\r\n    static _launchRandomButton() {\r\n\r\n        HTML.beforeEnd(\r\n            \"#es_popup .popup_menu\",\r\n            `<div class=\"hr\"></div>\r\n             <a id=\"es_random_game\" class=\"popup_menu_item\" style=\"cursor: pointer;\">${Localization.str.launch_random}</a>`\r\n        );\r\n\r\n        document.querySelector(\"#es_random_game\").addEventListener(\"click\", async() => {\r\n            const appid = await DynamicStore.getRandomApp();\r\n            if (!appid) { return; }\r\n\r\n            Background.action(\"appdetails\", appid).then(response => {\r\n                if (!response || !response.success) { return; }\r\n                const data = response.data;\r\n\r\n                let gameid = appid;\r\n                let gamename;\r\n                if (data.fullgame) {\r\n                    gameid = data.fullgame.appid;\r\n                    gamename = data.fullgame.name;\r\n                } else {\r\n                    gamename = data.name;\r\n                }\r\n\r\n                Page.runInPageContext((playGameStr, gameid, visitStore) => {\r\n                    const prompt = window.SteamFacade.showConfirmDialog(\r\n                        playGameStr,\r\n                        `<img src=\"//steamcdn-a.akamaihd.net/steam/apps/${gameid}/header.jpg\">`,\r\n                        null,\r\n                        null,\r\n                        visitStore\r\n                    );\r\n\r\n                    prompt.done(result => {\r\n                        if (result === \"OK\") { window.location.assign(`steam://run/${gameid}`); }\r\n                        if (result === \"SECONDARY\") { window.location.assign(`//store.steampowered.com/app/${gameid}`); }\r\n                    });\r\n                },\r\n                [\r\n                    Localization.str.play_game.replace(\"__gamename__\", gamename.replace(\"'\", \"\").trim()),\r\n                    gameid,\r\n                    Localization.str.visit_store,\r\n                ]);\r\n            });\r\n        });\r\n    }\r\n\r\n    static _skipGotSteam() {\r\n        if (!SyncedStorage.get(\"skip_got_steam\")) { return; }\r\n\r\n        // https://github.com/SteamDatabase/SteamTracking/blob/cdf367ce61926a896fe54d710b3ed25d66d7e333/store.steampowered.com/public/javascript/game.js#L1785\r\n        Page.runInPageContext(() => {\r\n            window.ShowGotSteamModal = function(steamUrl) { window.location.assign(steamUrl); };\r\n        });\r\n    }\r\n\r\n    static _keepSteamSubscriberAgreementState() {\r\n        const nodes = document.querySelectorAll(\"#market_sell_dialog_accept_ssa,#market_buyorder_dialog_accept_ssa,#accept_ssa\");\r\n        for (const node of nodes) {\r\n            node.checked = SyncedStorage.get(\"keepssachecked\");\r\n\r\n            node.addEventListener(\"click\", () => {\r\n                SyncedStorage.set(\"keepssachecked\", !SyncedStorage.get(\"keepssachecked\"));\r\n            });\r\n        }\r\n    }\r\n\r\n    static _defaultCommunityTab() {\r\n        const tab = SyncedStorage.get(\"community_default_tab\");\r\n        if (!tab) { return; }\r\n\r\n        const links = document.querySelectorAll(\"a[href^='https://steamcommunity.com/app/']\");\r\n        for (const link of links) {\r\n            if (link.classList.contains(\"apphub_sectionTab\")) { continue; }\r\n            if (!/^\\/app\\/[0-9]+\\/?$/.test(link.pathname)) { continue; }\r\n            if (!link.pathname.endsWith(\"/\")) {\r\n                link.pathname += \"/\";\r\n            }\r\n            link.pathname += `${tab}/`;\r\n        }\r\n    }\r\n\r\n    static _horizontalScrolling() {\r\n        if (!SyncedStorage.get(\"horizontalscrolling\")) { return; }\r\n\r\n        for (const node of document.querySelectorAll(\".slider_ctn:not(.spotlight)\")) {\r\n            HorizontalScroller.create(\r\n                node.parentNode.querySelector(\"#highlight_strip, .store_horizontal_autoslider_ctn\"),\r\n                node.querySelector(\".slider_left\"),\r\n                node.querySelector(\".slider_right\"),\r\n            );\r\n        }\r\n    }\r\n\r\n    static addLoginWarning(type) {\r\n        if (AugmentedSteam._loginWarningAdded || LocalStorage.get(`hide_login_warn_${type}`)) { return; }\r\n\r\n        let host;\r\n\r\n        if (type === \"store\") {\r\n            host = \"store.steampowered.com\";\r\n        } else if (type === \"community\") {\r\n            host = \"steamcommunity.com\";\r\n        } else {\r\n            console.warn(\"Unknown login warning type %s\", type);\r\n            return;\r\n        }\r\n\r\n        AugmentedSteam._addWarning(\r\n            `${Localization.str.login_warning.replace(\"__link__\", `<a href=\"https://${host}/login/\">${host}</a>`)}`,\r\n            () => { LocalStorage.set(`hide_login_warn_${type}`, true); }\r\n        );\r\n        AugmentedSteam._loginWarningAdded = true;\r\n\r\n        console.warn(\"Are you logged into %s?\", host);\r\n    }\r\n\r\n    static clearCache() {\r\n        return Background.action(\"cache.clear\");\r\n    }\r\n\r\n    static init() {\r\n        AugmentedSteam._addBackToTop();\r\n        AugmentedSteam._addMenu();\r\n        AugmentedSteam._addLanguageWarning();\r\n        AugmentedSteam._handleInstallSteamButton();\r\n        AugmentedSteam._disableLinkFilter();\r\n        AugmentedSteam._skipGotSteam();\r\n        AugmentedSteam._keepSteamSubscriberAgreementState();\r\n        AugmentedSteam._defaultCommunityTab();\r\n        AugmentedSteam._horizontalScrolling();\r\n        AugmentedSteam._cartLink();\r\n\r\n        if (User.isSignedIn) {\r\n            AugmentedSteam._addUsernameSubmenuLinks();\r\n            AugmentedSteam._addRedeemLink();\r\n            AugmentedSteam._replaceAccountName();\r\n            AugmentedSteam._launchRandomButton();\r\n            AugmentedSteam._bindLogout();\r\n        }\r\n    }\r\n}\r\n\r\nexport {AugmentedSteam};\r\n","\r\nclass StringUtils {\r\n\r\n    // https://stackoverflow.com/a/6969486/7162651\r\n    static escapeRegExp(str) {\r\n        return str.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\"); // $& means the whole matched string\r\n    }\r\n}\r\n\r\nexport {StringUtils};\r\n","import {SyncedStorage} from \"../../Core/Storage/SyncedStorage\";\r\nimport {StringUtils} from \"../../Core/Utils/StringUtils\";\r\nimport {Background} from \"./Background\";\r\nimport {Page} from \"../Features/Page\";\r\n\r\nclass SteamCurrency {\r\n\r\n    /*\r\n     * Example:\r\n     * {\r\n     *  \"id\": 1,\r\n     *  \"abbr\": \"USD\",\r\n     *  \"symbol\": \"$\",\r\n     *  \"hint\": \"United States Dollars\",\r\n     *  \"multiplier\": 100,\r\n     *  \"unit\": 1,\r\n     *  \"format\": {\r\n     *      \"places\": 2,\r\n     *      \"hidePlacesWhenZero\": false,\r\n     *      \"symbolFormat\": \"$\",\r\n     *      \"thousand\": \",\",\r\n     *      \"decimal\": \".\",\r\n     *      \"right\": false\r\n     *  }\r\n     * }\r\n     */\r\n\r\n    constructor({\r\n        id,\r\n        abbr = \"USD\",\r\n        symbol = \"$\",\r\n        hint = \"Default Currency\",\r\n        multiplier = 100,\r\n        unit = 1,\r\n        \"format\": {\r\n            \"places\": formatPlaces = 2,\r\n            \"hidePlacesWhenZero\": formatHidePlaces = false,\r\n            \"symbolFormat\": formatSymbol = \"$\",\r\n            \"thousand\": formatGroupSeparator = \",\",\r\n            \"group\": formatGroupSize = 3,\r\n            \"decimal\": formatDecimalSeparator = \".\",\r\n            \"right\": formatPostfixSymbol = false,\r\n        },\r\n    }) {\r\n\r\n        // console.assert(id && Number.isInteger(id))\r\n        Object.assign(this, {\r\n            \"id\": id, // Steam Currency ID, integer, 1-41 (at time of writing)\r\n            \"abbr\": abbr, // TLA for the currency\r\n            \"symbol\": symbol, // Symbol used to represent/recognize the currency, this is NULL for CNY to avoid collision with JPY\r\n            \"hint\": hint, // English label for the currency to reduce mistakes editing the JSON\r\n            \"multiplier\": multiplier, // multiplier used by Steam when writing values\r\n            \"unit\": unit, // Minimum transactional unit required by Steam.\r\n            \"format\": {\r\n                \"decimalPlaces\": formatPlaces, // How many decimal places does this currency have?\r\n                \"hidePlacesWhenZero\": formatHidePlaces, // Does this currency show decimal places for a .0 value?\r\n                \"symbol\": formatSymbol, // Symbol used when generating a string value of this currency\r\n                \"groupSeparator\": formatGroupSeparator, // Thousands separator\r\n                \"groupSize\": formatGroupSize, // Digits to a \"thousand\" for the thousands separator\r\n                \"decimalSeparator\": formatDecimalSeparator,\r\n                \"postfix\": formatPostfixSymbol, // Should format.symbol be post-fixed?\r\n            },\r\n        });\r\n        Object.freeze(this.format);\r\n        Object.freeze(this);\r\n    }\r\n\r\n    valueOf(price) {\r\n\r\n        // remove separators\r\n        let _price = price.trim()\r\n            .replace(this.format.groupSeparator, \"\");\r\n        if (this.format.decimalSeparator !== \".\") {\r\n            _price = _price.replace(this.format.decimalSeparator, \".\");\r\n        } // as expected by parseFloat()\r\n        _price = _price.replace(/[^\\d.]/g, \"\");\r\n\r\n        const value = parseFloat(_price);\r\n\r\n        if (Number.isNaN(value)) { return null; }\r\n        return value; // this.multiplier?\r\n    }\r\n\r\n    stringify(value, withSymbol = true) {\r\n        const sign = value < 0 ? \"-\" : \"\";\r\n        const _value = Math.abs(value);\r\n\r\n        let s = _value.toFixed(this.format.decimalPlaces),\r\n            decimals;\r\n\r\n        [s, decimals] = s.split(\".\");\r\n\r\n        const g = [];\r\n        let j = s.length;\r\n\r\n        for (; j > this.format.groupSize; j -= this.format.groupSize) {\r\n            g.unshift(s.substring(j - this.format.groupSize, j));\r\n        }\r\n        g.unshift(s.substring(0, j));\r\n        s = [sign, g.join(this.format.groupSeparator)];\r\n        if (this.format.decimalPlaces > 0) {\r\n            if (!this.format.hidePlacesWhenZero || parseInt(decimals) > 0) {\r\n                s.push(this.format.decimalSeparator);\r\n                s.push(decimals);\r\n            }\r\n        }\r\n        if (withSymbol) {\r\n            if (this.format.postfix) {\r\n                s.push(this.format.symbol);\r\n            } else {\r\n                s.unshift(this.format.symbol);\r\n            }\r\n        }\r\n        return s.join(\"\");\r\n    }\r\n\r\n    placeholder() {\r\n        let str = `1${this.format.groupSeparator}`;\r\n        let cur = 2;\r\n        for (let i = 0; i < this.format.groupSize; ++i, ++cur) {\r\n            str += cur;\r\n        }\r\n\r\n        if (this.format.decimalPlaces === 0) {\r\n            return str;\r\n        }\r\n\r\n        str += this.format.decimalSeparator;\r\n        for (let i = 0; i < this.format.decimalPlaces; ++i, ++cur) {\r\n            str += cur;\r\n        }\r\n        return str;\r\n    }\r\n\r\n    regExp() {\r\n        let regex = `^(?:\\\\d{1,${\r\n            this.format.groupSize\r\n        }}(?:${\r\n            StringUtils.escapeRegExp(this.format.groupSeparator)\r\n        }\\\\d{${\r\n            this.format.groupSize\r\n        }})+|\\\\d*)`;\r\n\r\n        if (this.format.decimalPlaces > 0) {\r\n            regex += `(?:${StringUtils.escapeRegExp(this.format.decimalSeparator)}\\\\d{0,${this.format.decimalPlaces}})?`;\r\n        }\r\n        regex += \"$\";\r\n\r\n        return new RegExp(regex);\r\n    }\r\n}\r\n\r\nclass CurrencyManager {\r\n\r\n    static _getCurrencyFromDom() {\r\n        const currencyNode = document.querySelector('meta[itemprop=\"priceCurrency\"]');\r\n        if (currencyNode && currencyNode.hasAttribute(\"content\")) {\r\n            return currencyNode.getAttribute(\"content\");\r\n        }\r\n        return null;\r\n    }\r\n\r\n    static async _getCurrencyFromWallet() {\r\n        const walletCurrency = await Page.runInPageContext(\r\n            // eslint-disable-next-line no-undef, camelcase\r\n            () => (typeof g_rgWalletInfo !== \"undefined\" && g_rgWalletInfo ? g_rgWalletInfo.wallet_currency : null),\r\n            null,\r\n            \"walletCurrency\"\r\n        );\r\n\r\n        if (walletCurrency) {\r\n            return CurrencyManager.currencyNumberToType(walletCurrency);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    static async _getStoreCurrency(context) {\r\n        let currency = CurrencyManager._getCurrencyFromDom();\r\n\r\n        if (!currency) {\r\n            currency = await CurrencyManager._getCurrencyFromWallet(context);\r\n        }\r\n\r\n        if (!currency) {\r\n            try {\r\n                currency = await Background.action(\"currency\");\r\n            } catch (error) {\r\n                console.error(`Couldn't load currency${error}`);\r\n            }\r\n        }\r\n\r\n        if (!currency) {\r\n            currency = \"USD\"; // fallback\r\n        }\r\n\r\n        return currency;\r\n    }\r\n\r\n    static getRate(from, to) {\r\n        if (from === to) { return 1; }\r\n\r\n        if (CurrencyManager._rates[from] && CurrencyManager._rates[from][to]) {\r\n            return CurrencyManager._rates[from][to];\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    static getCurrencySymbolFromString(str) {\r\n        const re = /(?:R\\$|S\\$|\\$|RM|kr|Rp|||||p|P|||TL||Mex\\$|CDN\\$|A\\$|HK\\$|NT\\$||SR|R |DH|CHF|CLP\\$|S\\/\\.|COL\\$|NZ\\$|ARS\\$||||KD|z|QR|\\$U)/;\r\n        const match = str.match(re);\r\n        return match ? match[0] : \"\";\r\n    }\r\n\r\n    static currencyTypeToNumber(type) {\r\n        return CurrencyManager.fromType(type).id;\r\n    }\r\n\r\n    static currencyNumberToType(number) {\r\n        return CurrencyManager.fromNumber(number).abbr;\r\n    }\r\n\r\n    /**\r\n     * @return SteamCurrency\r\n     */\r\n    static fromType(type) {\r\n        return CurrencyManager._indices.abbr[type] || CurrencyManager._defaultCurrency;\r\n    }\r\n\r\n    /**\r\n     * @return SteamCurrency\r\n     */\r\n    static fromNumber(number) {\r\n        return CurrencyManager._indices.id[number] || CurrencyManager._defaultCurrency;\r\n    }\r\n\r\n    static async _loadCurrency(context) {\r\n        CurrencyManager.storeCurrency = await CurrencyManager._getStoreCurrency(context);\r\n        const currencySetting = SyncedStorage.get(\"override_price\");\r\n        CurrencyManager.customCurrency = (currencySetting === \"auto\")\r\n            ? CurrencyManager.storeCurrency\r\n            : currencySetting;\r\n    }\r\n\r\n    static async _loadRates() {\r\n        const toCurrencies = [CurrencyManager.storeCurrency];\r\n        if (CurrencyManager.customCurrency !== CurrencyManager.storeCurrency) {\r\n            toCurrencies.push(CurrencyManager.customCurrency);\r\n        }\r\n        CurrencyManager._rates = await Background.action(\"rates\", toCurrencies);\r\n    }\r\n\r\n    static async init(context) {\r\n        if (CurrencyManager._isInitialized) { return; }\r\n\r\n        const currencies = await Background.action(\"steam.currencies\");\r\n\r\n        for (let currency of currencies) {\r\n\r\n            currency = new SteamCurrency(currency);\r\n            CurrencyManager._indices.abbr[currency.abbr] = currency;\r\n            CurrencyManager._indices.id[currency.id] = currency;\r\n\r\n            if (currency.symbol) { // CNY && JPY use the same symbol\r\n                CurrencyManager._indices.symbols[currency.symbol] = currency;\r\n            }\r\n        }\r\n        CurrencyManager._defaultCurrency = CurrencyManager._indices.id[1]; // USD\r\n\r\n        try {\r\n            await CurrencyManager._loadCurrency(context);\r\n            await CurrencyManager._loadRates();\r\n        } catch (e) {\r\n            console.error(\"Failed to initialize Currency\");\r\n            console.error(e);\r\n        }\r\n\r\n        CurrencyManager._isInitialized = true;\r\n    }\r\n\r\n    static then(onSuccess, onFailure) {\r\n        return CurrencyManager.init().then(onSuccess, onFailure);\r\n    }\r\n}\r\nCurrencyManager._isInitialized = false;\r\nCurrencyManager._indices = {\r\n    \"id\": {},\r\n    \"abbr\": {},\r\n    \"symbols\": {},\r\n};\r\n\r\nexport {CurrencyManager};\r\n","import {HTML} from \"../../Core/Html/Html\";\r\nimport {ExtensionResources} from \"../../Core/ExtensionResources\";\r\nimport {SyncedStorage} from \"../../Core/Storage/SyncedStorage\";\r\nimport {Localization} from \"../../Core/Localization/Localization\";\r\nimport {Background} from \"./Background\";\r\nimport {User} from \"./User\";\r\nimport {TimeUtils} from \"../../modulesCore\";\r\n\r\nclass ITAD {\r\n    static async create() {\r\n        if (!await Background.action(\"itad.isconnected\")) { return; }\r\n\r\n        HTML.afterBegin(\"#global_action_menu\",\r\n            `<div id=\"es_itad\">\r\n                <img id=\"es_itad_logo\" src=\"${ExtensionResources.getURL(\"img/itad.png\")}\">\r\n                <span id=\"es_itad_status\"></span>\r\n            </div>`);\r\n\r\n        document.querySelector(\"#es_itad\").addEventListener(\"mouseenter\", ITAD.onHover);\r\n\r\n        if (User.isSignedIn && (SyncedStorage.get(\"itad_import_library\") || SyncedStorage.get(\"itad_import_wishlist\"))) {\r\n            Background.action(\"itad.import\");\r\n        }\r\n    }\r\n\r\n    static async onHover() {\r\n\r\n        async function updateLastImport() {\r\n            const {from, to} = await Background.action(\"itad.lastimport\");\r\n\r\n            let htmlStr\r\n                = `<div>${Localization.str.itad.from}</div>\r\n                   <div>${from ? new Date(from * 1000).toLocaleString() : Localization.str.never}</div>`;\r\n\r\n            if (SyncedStorage.get(\"itad_import_library\") || SyncedStorage.get(\"itad_import_wishlist\")) {\r\n                htmlStr\r\n                    += `<div>${Localization.str.itad.to}</div>\r\n                        <div>${to ? new Date(to * 1000).toLocaleString() : Localization.str.never}</div>`;\r\n            }\r\n\r\n            HTML.inner(\".es-itad-hover__last-import\", htmlStr);\r\n        }\r\n\r\n        if (!document.querySelector(\".es-itad-hover\")) {\r\n            HTML.afterEnd(\"#es_itad_status\",\r\n                `<div class=\"es-itad-hover\">\r\n                    <div class=\"es-itad-hover__content\">\r\n                        <h4>${Localization.str.itad.last_import}</h4>\r\n                        <div class=\"es-itad-hover__last-import\"></div>\r\n                        <div class=\"es-itad-hover__sync-now\">\r\n                            <span class=\"es-itad-hover__sync-now-text\">${Localization.str.itad.sync_now}</span>\r\n                            <div class=\"loader\"></div>\r\n                            <span class=\"es-itad-hover__sync-failed\">&#10060;</span>\r\n                            <span class=\"es-itad-hover__sync-success\">&#10003;</span>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"es-itad-hover__arrow\"></div>\r\n                </div>`);\r\n\r\n            const hover = document.querySelector(\".es-itad-hover\");\r\n\r\n            const syncDiv = document.querySelector(\".es-itad-hover__sync-now\");\r\n            document.querySelector(\".es-itad-hover__sync-now-text\").addEventListener(\"click\", async() => {\r\n                syncDiv.classList.remove(\"es-itad-hover__sync-now--failed\", \"es-itad-hover__sync-now--success\");\r\n                syncDiv.classList.add(\"es-itad-hover__sync-now--loading\");\r\n                hover.style.display = \"block\";\r\n\r\n                let timeout;\r\n\r\n                try {\r\n                    await Background.action(\"itad.sync\");\r\n                    syncDiv.classList.add(\"es-itad-hover__sync-now--success\");\r\n                    await updateLastImport();\r\n\r\n                    timeout = 1000;\r\n                } catch (err) {\r\n                    syncDiv.classList.add(\"es-itad-hover__sync-now--failed\");\r\n\r\n                    console.group(\"ITAD sync\");\r\n                    console.error(\"Failed to sync with ITAD\");\r\n                    console.error(err);\r\n                    console.groupEnd();\r\n\r\n                    timeout = 3000;\r\n                } finally {\r\n                    TimeUtils.timer(timeout).then(() => { hover.style.display = \"\"; });\r\n                    syncDiv.classList.remove(\"es-itad-hover__sync-now--loading\");\r\n                }\r\n            });\r\n        }\r\n\r\n        await updateLastImport();\r\n    }\r\n\r\n    static async getAppStatus(storeIds, options) {\r\n        const opts = {\"waitlist\": true,\r\n            \"collection\": true,\r\n            ...options};\r\n\r\n        if (!opts.collection && !opts.waitlist) { return null; }\r\n\r\n        const multiple = Array.isArray(storeIds);\r\n        const promises = [];\r\n        const resolved = Promise.resolve(multiple ? {} : false);\r\n\r\n        if (await Background.action(\"itad.isconnected\")) {\r\n            if (opts.collection) {\r\n                promises.push(Background.action(\"itad.incollection\", storeIds));\r\n            } else {\r\n                promises.push(resolved);\r\n            }\r\n            if (opts.waitlist) {\r\n                promises.push(Background.action(\"itad.inwaitlist\", storeIds));\r\n            } else {\r\n                promises.push(resolved);\r\n            }\r\n        } else {\r\n            promises.push(resolved, resolved);\r\n        }\r\n\r\n        const [inCollection, inWaitlist] = await Promise.all(promises);\r\n\r\n        if (multiple) {\r\n            const result = {};\r\n            for (const id of storeIds) {\r\n                result[id] = {\r\n                    \"collected\": inCollection[id],\r\n                    \"waitlisted\": inWaitlist[id],\r\n                };\r\n            }\r\n            return result;\r\n        } else {\r\n            return {\r\n                \"collected\": inCollection,\r\n                \"waitlisted\": inWaitlist,\r\n            };\r\n        }\r\n    }\r\n}\r\n\r\nexport {ITAD};\r\n","\r\n/**\r\n * NOTE FOR ADDON REVIEWER:\r\n * This class is meant to simplify communication between extension context and page context.\r\n * Basically, we have wrapped postMessage API in this class.\r\n */\r\nclass Messenger {\r\n    static postMessage(msgID, info) {\r\n        window.postMessage({\r\n            \"type\": `es_${msgID}`,\r\n            \"information\": info\r\n        }, window.location.origin);\r\n    }\r\n\r\n    // Used for one-time events\r\n    static onMessage(msgID) {\r\n        return new Promise(resolve => {\r\n            function callback(e) {\r\n                if (e.source !== window) { return; }\r\n                if (!e.data || !e.data.type) { return; }\r\n                if (e.data.type === `es_${msgID}`) {\r\n                    resolve(e.data.information);\r\n                    window.removeEventListener(\"message\", callback);\r\n                }\r\n            }\r\n            window.addEventListener(\"message\", callback);\r\n        });\r\n    }\r\n\r\n    // Used for setting up a listener that should be able to receive more than one callback\r\n    static addMessageListener(msgID, callback) {\r\n        window.addEventListener(\"message\", e => {\r\n            if (e.source !== window) { return; }\r\n            if (!e.data || !e.data.type) { return; }\r\n            if (e.data.type === `es_${msgID}`) {\r\n                callback(e.data.information);\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nexport {Messenger};\r\n","import {CurrencyManager} from \"./CurrencyManager\";\r\n\r\nclass Price {\r\n\r\n    constructor(value = 0, currency = CurrencyManager.storeCurrency) {\r\n        this.value = value;\r\n        this.currency = currency;\r\n        Object.freeze(this);\r\n    }\r\n\r\n    formattedValue() {\r\n        return CurrencyManager.fromType(this.currency).stringify(this.value, false);\r\n    }\r\n\r\n    toString() {\r\n        return CurrencyManager.fromType(this.currency).stringify(this.value);\r\n    }\r\n\r\n    /*\r\n     * Not currently in use\r\n     * totalValue = totalValue.add(somePrice)\r\n     */\r\n    add(otherPrice) {\r\n        let _otherPrice = otherPrice;\r\n        if (otherPrice.currency !== this.currency) {\r\n            _otherPrice = otherPrice.inCurrency(this.currency);\r\n        }\r\n        return new Price(this.value + _otherPrice.value, this.currency);\r\n    }\r\n\r\n    inCurrency(desiredCurrency) {\r\n        if (this.currency === desiredCurrency) {\r\n            return new Price(this.value, this.currency);\r\n        }\r\n        const rate = CurrencyManager.getRate(this.currency, desiredCurrency);\r\n        if (!rate) {\r\n            throw new Error(`Could not establish conversion rate between ${this.currency} and ${desiredCurrency}`);\r\n        }\r\n        return new Price(this.value * rate, desiredCurrency);\r\n    }\r\n\r\n    static parseFromString(str, currencyType = CurrencyManager.storeCurrency) {\r\n        const currency = CurrencyManager.fromType(currencyType);\r\n        let value = currency.valueOf(str);\r\n        if (value !== null) {\r\n            value = new Price(value, currencyType);\r\n        }\r\n        return value;\r\n    }\r\n}\r\n\r\nexport {Price};\r\n","import {SyncedStorage} from \"../../Core/Storage/SyncedStorage\";\r\nimport {Localization} from \"../../Core/Localization/Localization\";\r\nimport {HTML} from \"../../Core/Html/Html\";\r\nimport {Background} from \"./Background\";\r\nimport {User} from \"./User\";\r\nimport {Price} from \"./Price\";\r\nimport {CurrencyManager} from \"./CurrencyManager\";\r\n\r\nclass Prices {\r\n\r\n    constructor() {\r\n        this.appids = [];\r\n        this.subids = [];\r\n        this.bundleids = [];\r\n\r\n        this.priceCallback = null;\r\n        this.bundleCallback = null;\r\n\r\n        this._bundles = [];\r\n    }\r\n\r\n    _getApiParams() {\r\n        const apiParams = {};\r\n\r\n        if (!SyncedStorage.get(\"showallstores\") && SyncedStorage.get(\"stores\").length > 0) {\r\n            apiParams.stores = SyncedStorage.get(\"stores\").join(\",\");\r\n        }\r\n\r\n        const cc = User.storeCountry;\r\n        if (cc) {\r\n            apiParams.cc = cc;\r\n        }\r\n\r\n        apiParams.appids = this.appids.join(\",\");\r\n        apiParams.subids = this.subids.join(\",\");\r\n        apiParams.bundleids = this.bundleids.join(\",\");\r\n\r\n        if (SyncedStorage.get(\"showlowestpricecoupon\")) {\r\n            apiParams.coupon = true;\r\n        }\r\n\r\n        if (!apiParams.appids && !apiParams.subids && !apiParams.bundleids) { return null; }\r\n\r\n        return apiParams;\r\n    }\r\n\r\n    /**\r\n     * @param priceData\r\n     * @param {Price} price\r\n     * @param {string} pricingStr\r\n     */\r\n    _getPricingStrings(priceData, price, pricingStr) {\r\n        let prices = price.toString();\r\n        if (CurrencyManager.customCurrency !== CurrencyManager.storeCurrency) {\r\n            const priceAlt = price.inCurrency(CurrencyManager.storeCurrency);\r\n            prices += ` (${priceAlt.toString()})`;\r\n        }\r\n        const pricesStr = `<span class=\"itad-pricing__price\">${prices}</span>`;\r\n\r\n        let cutStr = \"\";\r\n        if (priceData.cut > 0) {\r\n            cutStr = `<span class=\"itad-pricing__cut\">-${priceData.cut}%</span> `;\r\n        }\r\n\r\n        const storeStr = pricingStr.store.replace(\"__store__\", priceData.store);\r\n        return [pricesStr, cutStr, storeStr];\r\n    }\r\n\r\n    _processPrices(gameid, meta, info) {\r\n        if (!this.priceCallback) { return; }\r\n\r\n        const [type, id] = gameid.split(\"/\");\r\n\r\n        const node = document.createElement(\"div\");\r\n        node.classList.add(\"itad-pricing\");\r\n        node.id = `es_price_${id}`;\r\n\r\n        const pricingStr = Localization.str.pricing;\r\n\r\n        let hasData = false;\r\n        const priceData = info.price;\r\n        const lowestData = info.lowest;\r\n        const bundledCount = info.bundles.count;\r\n        const urlData = info.urls;\r\n\r\n        // Current best\r\n        if (priceData) {\r\n            hasData = true;\r\n\r\n            let lowest;\r\n            let voucherStr = \"\";\r\n            if (SyncedStorage.get(\"showlowestpricecoupon\") && priceData.price_voucher) {\r\n                lowest = new Price(priceData.price_voucher, meta.currency);\r\n\r\n                const voucher = HTML.escape(priceData.voucher);\r\n                voucherStr = `${pricingStr.with_voucher.replace(\r\n                    \"__voucher__\",\r\n                    `<span class=\"itad-pricing__voucher\">${voucher}</span>`\r\n                )} `;\r\n            } else {\r\n                lowest = new Price(priceData.price, meta.currency);\r\n            }\r\n\r\n            lowest = lowest.inCurrency(CurrencyManager.customCurrency);\r\n            const [pricesStr, cutStr, storeStr] = this._getPricingStrings(priceData, lowest, pricingStr);\r\n\r\n            let drmStr = \"\";\r\n            if (priceData.drm.length > 0 && priceData.store !== \"Steam\") {\r\n                drmStr = `<span class=\"itad-pricing__drm\">(${priceData.drm[0]})</span>`;\r\n            }\r\n\r\n            const infoUrl = HTML.escape(urlData.info);\r\n            const storeUrl = HTML.escape(priceData.url.toString());\r\n\r\n            HTML.beforeEnd(node, `<a href=\"${infoUrl}\" target=\"_blank\">${pricingStr.lowest_price}</a>`);\r\n            HTML.beforeEnd(node, pricesStr);\r\n            HTML.beforeEnd(\r\n                node,\r\n                `<a href=\"${storeUrl}\" class=\"itad-pricing__main\" target=\"_blank\">${cutStr}${voucherStr}${storeStr} ${drmStr}</a>`\r\n            );\r\n        }\r\n\r\n        // Historical low\r\n        if (lowestData) {\r\n            hasData = true;\r\n\r\n            const historical = new Price(lowestData.price, meta.currency).inCurrency(CurrencyManager.customCurrency);\r\n            const [pricesStr, cutStr, storeStr] = this._getPricingStrings(lowestData, historical, pricingStr);\r\n            const dateStr = new Date(lowestData.recorded * 1000).toLocaleDateString();\r\n\r\n            const infoUrl = HTML.escape(urlData.history);\r\n\r\n            HTML.beforeEnd(node, `<a href=\"${infoUrl}\" target=\"_blank\">${pricingStr.historical_low}</a>`);\r\n            HTML.beforeEnd(node, pricesStr);\r\n            HTML.beforeEnd(node, `<div class=\"itad-pricing__main\">${cutStr}${storeStr} ${dateStr}</div>`);\r\n        }\r\n\r\n        // times bundled\r\n        if (bundledCount > 0) {\r\n            hasData = true;\r\n\r\n            const bundledUrl = HTML.escape(urlData.bundles || urlData.bundle_history);\r\n            const bundledStr = pricingStr.bundle_count.replace(\"__count__\", bundledCount);\r\n\r\n            HTML.beforeEnd(node, `<a href=\"${bundledUrl}\" target=\"_blank\">${pricingStr.bundled}</a>`);\r\n            HTML.beforeEnd(node, `<div class=\"itad-pricing__bundled\">${bundledStr}</div>`);\r\n        }\r\n\r\n        if (hasData) {\r\n            this.priceCallback(type, id, node);\r\n        }\r\n    }\r\n\r\n    _processBundles(meta, info) {\r\n        if (!this.bundleCallback) { return; }\r\n\r\n        let purchase = \"\";\r\n\r\n        for (const bundle of info.bundles.live) {\r\n            const tiers = bundle.tiers;\r\n\r\n            let endDate;\r\n            if (bundle.expiry) {\r\n                endDate = new Date(bundle.expiry * 1000);\r\n            }\r\n\r\n            const currentDate = new Date().getTime();\r\n            if (endDate && currentDate > endDate) { continue; }\r\n\r\n            const bundleNormalized = JSON.stringify({\r\n                \"page\":  bundle.page || \"\",\r\n                \"title\": bundle.title || \"\",\r\n                \"url\":   bundle.url || \"\",\r\n                \"tiers\": (() => {\r\n                    const sorted = [];\r\n                    for (const t of Object.keys(tiers)) {\r\n                        sorted.push((tiers[t].games || []).sort());\r\n                    }\r\n                    return sorted;\r\n                })(),\r\n            });\r\n\r\n            if (this._bundles.indexOf(bundleNormalized) >= 0) { continue; }\r\n            this._bundles.push(bundleNormalized);\r\n\r\n            if (bundle.page) {\r\n                const bundlePage = Localization.str.buy_package.replace(\"__package__\", `${bundle.page} ${bundle.title}`);\r\n                purchase\r\n                    += `<div class=\"game_area_purchase_game\">\r\n                            <div class=\"game_area_purchase_platform\"></div>\r\n                            <h1>${bundlePage}</h1>`;\r\n            } else {\r\n                const bundleTitle = Localization.str.buy_package.replace(\"__package__\", bundle.title);\r\n                purchase\r\n                    += `<div class=\"game_area_purchase_game_wrapper\">\r\n                            <div class=\"game_area_purchase_game\"></div>\r\n                            <div class=\"game_area_purchase_platform\"></div>\r\n                            <h1>${bundleTitle}</h1>`;\r\n            }\r\n\r\n            if (endDate) {\r\n                purchase += `<p class=\"game_purchase_discount_countdown\">${Localization.str.bundle.offer_ends} ${endDate}</p>`;\r\n            }\r\n\r\n            purchase += '<p class=\"package_contents\">';\r\n\r\n            let bundlePrice;\r\n            const appName = document.querySelector(\".apphub_AppName\").textContent;\r\n\r\n            for (let i = 0; i < tiers.length; ++i) {\r\n                const tierNum = i + 1;\r\n                const tier = tiers[i];\r\n\r\n                purchase += \"<b>\";\r\n                if (tiers.length > 1) {\r\n                    const tierName = tier.note || Localization.str.bundle.tier.replace(\"__num__\", tierNum);\r\n                    const tierPrice = (new Price(tier.price, meta.currency).inCurrency(CurrencyManager.customCurrency))\r\n                        .toString();\r\n\r\n                    purchase += Localization.str.bundle.tier_includes.replace(\"__tier__\", tierName).replace(\"__price__\", tierPrice)\r\n                        .replace(\"__num__\", tier.games.length);\r\n                } else {\r\n                    purchase += Localization.str.bundle.includes.replace(\"__num__\", tier.games.length);\r\n                }\r\n                purchase += \":</b> \";\r\n\r\n                const gameList = tier.games.join(\", \");\r\n                if (gameList.includes(appName)) {\r\n                    purchase += gameList.replace(appName, `<u>${appName}</u>`);\r\n                    bundlePrice = tier.price;\r\n                } else {\r\n                    purchase += gameList;\r\n                }\r\n\r\n                purchase += \"<br>\";\r\n            }\r\n\r\n            purchase += \"</p>\";\r\n            purchase += `<div class=\"game_purchase_action\">\r\n                            <div class=\"game_purchase_action_bg\">\r\n                                <div class=\"btn_addtocart btn_packageinfo\">\r\n                                    <a class=\"btn_blue_steamui btn_medium\" href=\"${bundle.details}\" target=\"_blank\">\r\n                                        <span>${Localization.str.bundle.info}</span>\r\n                                    </a>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"game_purchase_action_bg\">`;\r\n\r\n            if (bundlePrice && bundlePrice > 0) {\r\n                bundlePrice = (new Price(bundlePrice, meta.currency).inCurrency(CurrencyManager.customCurrency))\r\n                    .toString();\r\n                purchase += `<div class=\"game_purchase_price price\" itemprop=\"price\">${bundlePrice}</div>`;\r\n            }\r\n\r\n            purchase += `<div class=\"btn_addtocart\">\r\n                            <a class=\"btn_green_steamui btn_medium\" href=\"${bundle.url}\" target=\"_blank\">\r\n                                <span>${Localization.str.buy}</span>\r\n                            </a>\r\n                        </div></div></div></div>`;\r\n        }\r\n\r\n        if (purchase) {\r\n            this.bundleCallback(purchase);\r\n        }\r\n    }\r\n\r\n    load() {\r\n        const apiParams = this._getApiParams();\r\n        if (!apiParams) { return; }\r\n\r\n        Background.action(\"prices\", apiParams).then(response => {\r\n            const meta = response[\".meta\"];\r\n\r\n            for (const [gameid, info] of Object.entries(response.data)) {\r\n                this._processPrices(gameid, meta, info);\r\n                this._processBundles(meta, info);\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nexport {Prices};\r\n","import {SyncedStorage} from \"./Core/Storage/SyncedStorage\";\r\n\r\nlet initialized = false;\r\n\r\n/**\r\n * DOMPurify setup\r\n * @see https://github.com/cure53/DOMPurify\r\n */\r\nexport default function() {\r\n\r\n    if (initialized) { return; }\r\n    initialized = true;\r\n\r\n    const allowOpenInNewTab = SyncedStorage.get(\"openinnewtab\");\r\n\r\n    /*\r\n     * NOTE FOR ADDON REVIEWER:\r\n     * We are modifying default DOMPurify settings to allow other protocols in URLs\r\n     * and to allow links to safely open in new tabs.\r\n     *\r\n     * We took the original Regex and aded chrome-extension://, moz-extension:// and steam://\r\n     * First two are needed for linking local resources from extension,\r\n     * steam:// protocol is used by Steam store to open their own client (e.g. when you want to launch a game).\r\n     *\r\n     * The addition of the `target` attribute to the allowed attributes is done in order to be able to open links in a new tab.\r\n     * We only allow target=\"_blank\" while adding rel=\"noreferrer noopener\" to prevent child window to access window.opener\r\n     * as described in https://www.jitbit.com/alexblog/256-targetblank---the-most-underestimated-vulnerability-ever/\r\n     */\r\n\r\n    const purifyConfig = {\r\n        \"ALLOWED_URI_REGEXP\": /^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|chrome-extension|moz-extension|steam):|[^a-z]|[a-z+.-]+(?:[^a-z+.\\-:]|$))/i\r\n    };\r\n\r\n    if (allowOpenInNewTab) {\r\n        purifyConfig.ADD_ATTR = [\"target\"];\r\n\r\n        DOMPurify.addHook(\"uponSanitizeAttribute\", (node, data) => {\r\n            if (data.attrName === \"target\") {\r\n                if (data.attrValue === \"_blank\") {\r\n                    node.setAttribute(\"rel\", \"noreferrer noopener\");\r\n                } else {\r\n                    data.keepAttr = false;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    DOMPurify.setConfig(purifyConfig);\r\n}\r\n","import {Info, LocalStorage, Localization, SyncedStorage} from \"../../modulesCore\";\r\nimport {\r\n    AugmentedSteam, Background,\r\n    CurrencyManager,\r\n    DOMHelper,\r\n    ITAD, Messenger, ProgressBar,\r\n    UpdateHandler,\r\n    User\r\n} from \"../modulesContent\";\r\nimport {SteamFacade} from \"../Modules/SteamFacade\";\r\nimport setup from \"../../setup\";\r\nimport config from \"../../config\";\r\n\r\n/**\r\n * Event handler for uncaught Background errors\r\n */\r\nfunction unhandledrejection(ev) {\r\n    const err = ev.reason;\r\n    if (!err || !err.error) { return; } // Not a background error\r\n    ev.preventDefault();\r\n    ev.stopPropagation();\r\n    console.group(\"An error occurred in the background context.\");\r\n    console.error(err.localStack);\r\n    console.error(err.stack);\r\n    console.groupEnd();\r\n}\r\nwindow.addEventListener(\"unhandledrejection\", unhandledrejection);\r\n\r\n/**\r\n *  Inject the Messenger, SteamFacade class into the DOM, providing the same interface for the page context side\r\n */\r\nDOMHelper.insertScript({\"content\": `window.Messenger = ${Messenger.toString()}`});\r\nDOMHelper.insertScript({\"content\": `window.SteamFacade = ${SteamFacade.toString()}`});\r\n\r\nBackground.registerErrorHandler(({name, msg}) => {\r\n    if (name !== \"LoginError\") { return false; }\r\n\r\n    AugmentedSteam.addLoginWarning(msg);\r\n    ProgressBar.finishRequest();\r\n    return true;\r\n});\r\n\r\nclass Page {\r\n\r\n    /*\r\n     * NOTE: use cautiously!\r\n     * Run script in the context of the current tab\r\n     */\r\n    static runInPageContext(fun, args, withPromise) {\r\n        const script = document.createElement(\"script\");\r\n        let promise;\r\n        const argsString = Array.isArray(args) ? JSON.stringify(args) : \"[]\";\r\n\r\n        if (withPromise) {\r\n            const msgId = `msg_${++Page._msgCounter}`;\r\n            promise = Messenger.onMessage(msgId);\r\n            script.textContent = `(async () => { Messenger.postMessage(\"${msgId}\", await (${fun})(...${argsString})); })();`;\r\n        } else {\r\n            script.textContent = `(${fun})(...${argsString});`;\r\n        }\r\n\r\n        document.documentElement.appendChild(script);\r\n        script.parentNode.removeChild(script);\r\n        return promise;\r\n    }\r\n\r\n    async run(ContextClass) {\r\n        if (!document.getElementById(\"global_header\")) { return; }\r\n\r\n        try {\r\n            // TODO What errors can be \"suppressed\" here?\r\n            try {\r\n                await SyncedStorage;\r\n                setup();\r\n            } catch (err) {\r\n                console.error(err);\r\n            }\r\n\r\n            await Promise.all([LocalStorage, Localization, User, CurrencyManager]);\r\n        } catch (err) {\r\n            console.group(\"Augmented Steam initialization\");\r\n            console.error(\"Failed to initiliaze Augmented Steam\");\r\n            console.error(err);\r\n            console.groupEnd();\r\n            return;\r\n        }\r\n\r\n        console.log(\r\n            `%c Augmented %cSteam v${Info.version} %c ${config.PublicHost}`,\r\n            \"background: #000000; color: #046eb2\",\r\n            \"background: #000000; color: #ffffff\",\r\n            \"\",\r\n        );\r\n\r\n        ProgressBar.create();\r\n        ProgressBar.loading();\r\n        AugmentedSteam.init();\r\n        UpdateHandler.checkVersion(AugmentedSteam.clearCache);\r\n        ITAD.create();\r\n        this._pageSpecificFeatures();\r\n\r\n        const context = new ContextClass();\r\n        context.applyFeatures();\r\n    }\r\n\r\n    _pageSpecificFeatures() {\r\n        // left for overrides\r\n    }\r\n}\r\nPage._msgCounter = 0;\r\n\r\nexport {Page};\r\n","\r\n/* eslint-disable camelcase,no-undef,new-cap */\r\n\r\n// noinspection JSUnresolvedFunction,JSUnresolvedVariable\r\nclass SteamFacade {\r\n\r\n    // variables\r\n\r\n    static global(name) {\r\n        return window[name];\r\n    }\r\n\r\n    static globalSet(name, value) {\r\n        window[name] = value;\r\n    }\r\n\r\n    // dialogs\r\n\r\n    static showDialog(strTitle, strDescription, rgModalParams) {\r\n        ShowDialog(strTitle, strDescription, rgModalParams);\r\n    }\r\n\r\n    static showConfirmDialog(strTitle, strDescription, strOKButton, strCancelButton, strSecondaryActionButton) {\r\n        return ShowConfirmDialog(strTitle, strDescription, strOKButton, strCancelButton, strSecondaryActionButton);\r\n    }\r\n\r\n    static showAlertDialog(strTitle, strDescription, strOKButton) {\r\n        return ShowAlertDialog(strTitle, strDescription, strOKButton);\r\n    }\r\n\r\n    static showBlockingWaitDialog(strTitle, strDescription) {\r\n        return ShowBlockingWaitDialog(strTitle, strDescription);\r\n    }\r\n\r\n    static showNicknameModal() {\r\n        return ShowNicknameModal();\r\n    }\r\n\r\n    static dismissActiveModal() {\r\n        CModal.DismissActiveModal();\r\n    }\r\n\r\n    // menu\r\n\r\n    static showMenu(elemLink, elemPopup, align, valign, bLinkHasBorder) {\r\n        return ShowMenu(elemLink, elemPopup, align, valign, bLinkHasBorder);\r\n    }\r\n\r\n    static hideMenu(elemLink, elemPopup) {\r\n        return HideMenu(elemLink, elemPopup);\r\n    }\r\n\r\n    // app pages\r\n\r\n    static collapseLongStrings(selector) {\r\n        return CollapseLongStrings(selector);\r\n    }\r\n\r\n    static adjustVisibleAppTags(selector) {\r\n        return AdjustVisibleAppTags($J(selector));\r\n    }\r\n\r\n    static updatePlaytimeFilterValues(hourMin, hourMax) {\r\n        return UpdatePlaytimeFilterValues(hourMin, hourMax);\r\n    }\r\n\r\n    // events\r\n\r\n    static bindAutoFlyoutEvents() {\r\n        return BindAutoFlyoutEvents();\r\n    }\r\n\r\n    static sliderOnChange(value) {\r\n        return g_player.SliderOnChange(value);\r\n    }\r\n\r\n    // dynamic store\r\n\r\n    static dynamicStoreInvalidateCache() {\r\n        return GDynamicStore.InvalidateCache();\r\n    }\r\n\r\n    static dynamicStoreDecorateItems(selector, bForceRecalculate) {\r\n        return GDynamicStore.DecorateDynamicItems($J(selector), bForceRecalculate);\r\n    }\r\n\r\n    static onDynamicStoreReady(callback) {\r\n        return GDynamicStore.OnReady(callback);\r\n    }\r\n\r\n    static storeItemDataBindHover(selector, unAppID, unPackageID, unBundleID, rgAdditionalParams) {\r\n        GStoreItemData.BindHoverEvents($J(selector), unAppID, unPackageID, unBundleID, rgAdditionalParams);\r\n    }\r\n\r\n    // tooltips\r\n\r\n    static vTooltip(selector, isHtml = false) {\r\n        const isStore = window.location.host === \"store.steampowered.com\";\r\n\r\n        $J(selector).v_tooltip({\r\n            \"tooltipClass\": isStore ? \"store_tooltip\" : \"community_tooltip\",\r\n            \"dataName\": isHtml ? \"tooltipHtml\" : \"tooltipText\",\r\n            \"defaultType\": isHtml ? \"html\" : \"text\",\r\n            \"replaceExisting\": false\r\n        });\r\n    }\r\n\r\n    // market\r\n\r\n    static calculateFeeAmount(amount, publisherFee) {\r\n        return CalculateFeeAmount(amount, publisherFee);\r\n    }\r\n\r\n    static vCurrencyFormat(amount, currencyCode) {\r\n        return v_currencyformat(amount, currencyCode);\r\n    }\r\n\r\n    // friends\r\n\r\n    static toggleManageFriends() {\r\n        return ToggleManageFriends();\r\n    }\r\n\r\n    static openFriendChatInWebChat(chatId) {\r\n        return OpenFriendChatInWebChat(chatId);\r\n    }\r\n\r\n    // community\r\n\r\n    static submitGuide() {\r\n        return SubmitGuide();\r\n    }\r\n\r\n    static initMiniprofileHovers() {\r\n        return InitMiniprofileHovers();\r\n    }\r\n\r\n    static inviteUserToGroup(Modal, groupID, steamIDInvitee) {\r\n        return InviteUserToGroup(Modal, groupID, steamIDInvitee);\r\n    }\r\n\r\n    static getCheckedAccounts(selector) {\r\n        return GetCheckedAccounts(selector);\r\n    }\r\n\r\n    static execFriendAction(action, navid) {\r\n        return ExecFriendAction(action, navid);\r\n    }\r\n\r\n    static scrollOffsetForceRecalc() {\r\n        CScrollOffsetWatcher.ForceRecalc();\r\n    }\r\n\r\n    static vSetCookie(strCookieName, strValue, expiryInDays, path) {\r\n        V_SetCookie(strCookieName, strValue, expiryInDays, path);\r\n    }\r\n\r\n    static checkAgeGateSubmit(callbackFunc) {\r\n        CheckAgeGateSubmit(callbackFunc);\r\n    }\r\n\r\n    static loadImageGroupOnScroll(elTarget, strGroup) {\r\n        LoadImageGroupOnScroll(elTarget, strGroup);\r\n    }\r\n\r\n    static showModalContent(url, titleBarText, titleBarURL, sizeToFit) {\r\n        ShowModalContent(url, titleBarText, titleBarURL, sizeToFit);\r\n    }\r\n\r\n    // inventory\r\n\r\n    static firstPage() {\r\n        return InventoryFirstPage();\r\n    }\r\n\r\n    static lastPage() {\r\n        return InventoryLastPage();\r\n    }\r\n\r\n    static goToPage() {\r\n        return InventoryGoToPage();\r\n    }\r\n\r\n    static reloadCommunityInventory() {\r\n        return ReloadCommunityInventory();\r\n    }\r\n\r\n    static getMarketHashName(itemDesc) {\r\n        return GetMarketHashName(itemDesc);\r\n    }\r\n\r\n    static zoomYear() {\r\n        pricehistory_zoomDays(g_plotPriceHistory, g_timePriceHistoryEarliest, g_timePriceHistoryLatest, 365);\r\n    }\r\n\r\n    static zoomYearForSellDialog() {\r\n        pricehistory_zoomDays(SellItemDialog.m_plotPriceHistory, SellItemDialog.m_timePriceHistoryEarliest, SellItemDialog.m_timePriceHistoryLatest, 365);\r\n    }\r\n\r\n    // selections\r\n\r\n    static updateSelection() {\r\n        return UpdateSelection();\r\n    }\r\n\r\n    static selectAll() {\r\n        return SelectAll();\r\n    }\r\n\r\n    static selectNone() {\r\n        return SelectNone();\r\n    }\r\n\r\n    static selectInverse() {\r\n        return SelectInverse();\r\n    }\r\n\r\n\r\n    // jQuery functions\r\n\r\n    static jq(selector) {\r\n        return $J(selector);\r\n    }\r\n\r\n    static jqOnClick(selector, callback) {\r\n        $J(selector).on(\"click\", callback);\r\n    }\r\n\r\n    static jqAjax(settings) {\r\n        return $J.ajax(settings);\r\n    }\r\n\r\n    static jqGet(url, settings) {\r\n        return $J.get(url, settings);\r\n    }\r\n\r\n    static jqPost(url, settings) {\r\n        return $J.post(url, settings);\r\n    }\r\n\r\n    static jqTrigger(selector, eventName) {\r\n        return $J(selector).trigger(eventName);\r\n    }\r\n}\r\n\r\nexport {SteamFacade};\r\n","import {Version} from \"../../Core/Version\";\r\nimport {SyncedStorage} from \"../../Core/Storage/SyncedStorage\";\r\nimport {Info} from \"../../Core/Info\";\r\nimport {ExtensionResources} from \"../../Core/ExtensionResources\";\r\nimport {Localization} from \"../../Core/Localization/Localization\";\r\nimport {BackgroundSimple} from \"../../Core/BackgroundSimple\";\r\nimport {Background} from \"./Background\";\r\nimport {LocalStorage} from \"../../Core/Storage/LocalStorage\";\r\nimport {ITAD} from \"./ITAD\";\r\nimport {Page} from \"../Features/Page\";\r\n\r\nclass UpdateHandler {\r\n\r\n    static async checkVersion(onUpdate) {\r\n        const lastVersion = Version.fromString(SyncedStorage.get(\"version\"));\r\n        const currentVersion = Version.fromString(Info.version);\r\n\r\n        if (currentVersion.isAfter(lastVersion)) {\r\n\r\n            let changelogPromise = Promise.resolve();\r\n            if (SyncedStorage.get(\"version_show\")) {\r\n                changelogPromise = this._showChangelog().catch(err => { console.error(\"Failed to show changelog: %o\", err); });\r\n            }\r\n\r\n            await Promise.all([\r\n                changelogPromise,\r\n                this._migrateSettings(lastVersion),\r\n                onUpdate(),\r\n            ]);\r\n        }\r\n\r\n        SyncedStorage.set(\"version\", Info.version);\r\n    }\r\n\r\n    static async _showChangelog() {\r\n\r\n        const changelog = await ExtensionResources.getJSON(\"changelog.json\");\r\n        const html = changelog[Info.version];\r\n        if (!html) {\r\n            throw new Error(`Can't find changelog for version ${Info.version}`);\r\n        }\r\n\r\n        const logo = ExtensionResources.getURL(\"img/logo/as128.png\");\r\n        const githubChanges = `<p><a href=\"https://github.com/IsThereAnyDeal/AugmentedSteam/compare/v${SyncedStorage.get(\"version\")}...v${Info.version}\">All changes on GitHub</a></p>`;\r\n        const dialog = `<div class=\"es_changelog\"><img src=\"${logo}\"><div>${html}${githubChanges}</div></div>`;\r\n\r\n        const connectBtn = document.querySelector(\"#itad_connect\");\r\n        function itadConnected() { connectBtn.replaceWith(\"\"); }\r\n\r\n        Page.runInPageContext(\r\n            (updatedStr, dialog) => {\r\n                window.SteamFacade.showAlertDialog(updatedStr, dialog);\r\n            },\r\n            [Localization.str.update.updated.replace(\"__version__\", Info.version), dialog]\r\n        );\r\n\r\n        if (Version.fromString(Info.version).isSame(new Version(1, 4))) {\r\n\r\n            if (await BackgroundSimple.action(\"itad.isconnected\")) {\r\n                itadConnected();\r\n            } else {\r\n                connectBtn.addEventListener(\"click\", async() => {\r\n                    await BackgroundSimple.action(\"itad.authorize\");\r\n                    ITAD.create();\r\n                    itadConnected();\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    static _migrateSettings(oldVersion) {\r\n\r\n        if (oldVersion.isSameOrBefore(\"1.3.1\")) {\r\n            BackgroundSimple.action(\"cache.clear\");\r\n\r\n            SyncedStorage.set(\"horizontalscrolling\", SyncedStorage.get(\"horizontalmediascrolling\"));\r\n            SyncedStorage.remove(\"horizontalmediascrolling\");\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"1.4\")) {\r\n            SyncedStorage.remove(\"show_sysreqcheck\");\r\n        }\r\n\r\n        if (oldVersion.isSame(\"1.4\")) {\r\n            Background.action(\"migrate.notesToSyncedStorage\");\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"1.4.1\")) {\r\n            SyncedStorage.set(\"profile_steamid\", SyncedStorage.get(\"profile_permalink\"));\r\n            SyncedStorage.remove(\"profile_permalink\");\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"1.4.3\")) {\r\n            SyncedStorage.remove(\"contscroll\");\r\n            Background.action(\"logout\");\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"1.4.7\")) {\r\n            const emoticons = LocalStorage.get(\"fav_emoticons\");\r\n            if (Array.isArray(emoticons)) {\r\n                SyncedStorage.set(\"fav_emoticons\", emoticons);\r\n            }\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"2.0.0\")) {\r\n            SyncedStorage.remove(\"showfakeccwarning\");\r\n            SyncedStorage.remove(\"hideaboutlinks\");\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"2.0.1\")) {\r\n            SyncedStorage.remove(\"hide_dlcunownedgames\");\r\n            SyncedStorage.remove(\"hide_wishlist\");\r\n            SyncedStorage.remove(\"hide_cart\");\r\n            SyncedStorage.remove(\"hide_notdiscounted\");\r\n            SyncedStorage.remove(\"hide_mixed\");\r\n            SyncedStorage.remove(\"hide_negative\");\r\n            SyncedStorage.remove(\"hide_priceabove\");\r\n            SyncedStorage.remove(\"priceabove_value\");\r\n            SyncedStorage.remove(\"hide_owned\");\r\n            SyncedStorage.remove(\"hide_ignored\");\r\n            SyncedStorage.remove(\"highlight_notdiscounted\");\r\n\r\n            SyncedStorage.remove(\"showallfriendsthatown\");\r\n\r\n            if (SyncedStorage.has(\"showusernotes\")) {\r\n                const val = SyncedStorage.get(\"showusernotes\");\r\n                SyncedStorage.set(\"user_notes_app\", val);\r\n                SyncedStorage.set(\"user_notes_wishlist\", val);\r\n                SyncedStorage.remove(\"showusernotes\");\r\n            }\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"2.1.0\")) {\r\n            SyncedStorage.remove(\"showcomparelinks\");\r\n\r\n            const links = SyncedStorage.get(\"profile_custom_link\");\r\n            for (const link of links) {\r\n                if (link.url && !link.url.includes(\"[ID]\")) {\r\n                    link.url += \"[ID]\";\r\n                }\r\n            }\r\n            SyncedStorage.set(\"profile_custom_link\", links);\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"2.2.1\")) {\r\n            Background.action(\"migrate.cachestorage\");\r\n        }\r\n    }\r\n}\r\n\r\nexport {UpdateHandler};\r\n","import {GameId, HTML, Localization, SyncedStorage} from \"../../../modulesCore\";\r\nimport {DOMHelper, DynamicStore, Feature, ITAD, Inventory} from \"../../modulesContent\";\r\nimport {Page} from \"../Page\";\r\n\r\nexport default class FHighlightsTags extends Feature {\r\n\r\n    async apply() {\r\n\r\n        await Page.runInPageContext(() => new Promise(resolve => {\r\n            window.SteamFacade.onDynamicStoreReady(() => { resolve(); });\r\n        }), null, true);\r\n\r\n        return Promise.all([\r\n            FHighlightsTags.highlightTitle(this.context.appid),\r\n            FHighlightsTags.highlightAndTag(),\r\n        ]);\r\n    }\r\n\r\n    static highlightTitle(appid) {\r\n\r\n        const title = document.querySelector(\".apphub_AppName\");\r\n        if (!title) { return null; }\r\n\r\n        title.dataset.dsAppid = appid;\r\n\r\n        return FHighlightsTags.highlightAndTag([title], false);\r\n    }\r\n\r\n    /**\r\n     * Highlights and tags DOM nodes that are owned, wishlisted, ignored, collected, waitlisted\r\n     * or that the user has a gift, a guest pass or coupon for.\r\n     *\r\n     * @param {NodeList|Array} nodes - The nodes that should get highlighted\r\n     * (defaults to all known nodes that are highlightable and taggable)\r\n     * @param {boolean} hasDsInfo - Whether or not the supplied nodes contain dynamic store info (defaults to true)\r\n     * @param {Object} options - Option overrides that should be applied\r\n     * @returns {Promise} - Resolved once the highlighting and tagging completed for the nodes\r\n     */\r\n    /* eslint-disable complexity -- FIXME */\r\n    static async highlightAndTag(nodes, hasDsInfo = true, options = {}) {\r\n\r\n        if (typeof FHighlightsTags._options === \"undefined\") {\r\n            FHighlightsTags._options = {\r\n                \"owned\": SyncedStorage.get(\"highlight_owned\") || SyncedStorage.get(\"tag_owned\"),\r\n                \"wishlisted\": SyncedStorage.get(\"highlight_wishlist\") || SyncedStorage.get(\"tag_wishlist\"),\r\n                \"ignored\": SyncedStorage.get(\"highlight_notinterested\") || SyncedStorage.get(\"tag_notinterested\"),\r\n                \"collected\": SyncedStorage.get(\"highlight_collection\") || SyncedStorage.get(\"tag_collection\"),\r\n                \"waitlisted\": SyncedStorage.get(\"highlight_waitlist\") || SyncedStorage.get(\"tag_waitlist\"),\r\n                \"gift\": SyncedStorage.get(\"highlight_inv_gift\") || SyncedStorage.get(\"tag_inv_gift\"),\r\n                \"guestPass\": SyncedStorage.get(\"highlight_inv_guestpass\") || SyncedStorage.get(\"tag_inv_guestpass\"),\r\n                \"coupon\": SyncedStorage.get(\"highlight_coupon\") || SyncedStorage.get(\"tag_coupon\"),\r\n            };\r\n        }\r\n\r\n        const opts = {...this._options, ...options};\r\n        if (!Object.values(opts).some(x => x)) { return; }\r\n\r\n        const _nodes = nodes || document.querySelectorAll(this._selector);\r\n        if (_nodes.length === 0) { return; }\r\n\r\n        const storeIdsMap = new Map();\r\n\r\n        for (const node of _nodes) {\r\n            let nodeToHighlight = node;\r\n\r\n            if (node.classList.contains(\"item\")) {\r\n                nodeToHighlight = node.querySelector(\".info\");\r\n            } else if (node.classList.contains(\"home_area_spotlight\")) {\r\n                nodeToHighlight = node.querySelector(\".spotlight_content\");\r\n            } else if (node.parentNode.classList.contains(\"steam_curator_recommendation\")\r\n                && node.parentNode.classList.contains(\"big\")) {\r\n                nodeToHighlight = node.nextElementSibling;\r\n            } else if (node.parentNode.parentNode.classList.contains(\"curations\")) {\r\n                nodeToHighlight = node.parentNode;\r\n            } else if (node.classList.contains(\"special_img_ctn\") && node.parentElement.classList.contains(\"special\")) {\r\n                nodeToHighlight = node.parentElement;\r\n            } else if (node.classList.contains(\"blotter_userstats_game\")) {\r\n\r\n                // Small game capsules on activity page (e.g. when posting a status about a game)\r\n                nodeToHighlight = node.parentElement;\r\n            }\r\n\r\n            const aNode = node.querySelector(\"a\");\r\n\r\n            const appid = GameId.getAppid(node) || GameId.getAppid(aNode) || GameId.getAppidFromId(node.id);\r\n            const subid = GameId.getSubid(node) || GameId.getSubid(aNode);\r\n            const bundleid = GameId.getBundleid(node) || GameId.getBundleid(aNode);\r\n\r\n            let storeId;\r\n            if (appid) {\r\n                storeId = `app/${appid}`;\r\n            } else if (bundleid) {\r\n                storeId = `bundle/${bundleid}`;\r\n            } else if (subid) {\r\n                storeId = `sub/${subid}`;\r\n            }\r\n\r\n            if (storeId) {\r\n                if (storeIdsMap.has(storeId)) {\r\n                    storeIdsMap.get(storeId).push(nodeToHighlight);\r\n                } else {\r\n                    storeIdsMap.set(storeId, [nodeToHighlight]);\r\n                }\r\n            }\r\n\r\n\r\n            if (hasDsInfo) {\r\n                try {\r\n                    if (opts.owned && node.querySelector(\".ds_owned_flag\") !== null) {\r\n                        this.highlightOwned(nodeToHighlight);\r\n                    }\r\n                    if (opts.wishlisted && node.querySelector(\".ds_wishlist_flag\") !== null) {\r\n                        this.highlightWishlist(nodeToHighlight);\r\n                    }\r\n                    if (opts.ignored && node.querySelector(\".ds_ignored_flag\") !== null) {\r\n                        this.highlightIgnored(nodeToHighlight);\r\n                    }\r\n                } catch (err) {\r\n                    console.error(\"Failed to highlight / tag node\", err);\r\n                }\r\n            }\r\n        }\r\n\r\n        const storeIds = Array.from(storeIdsMap.keys());\r\n        if (storeIds.length === 0) { return; }\r\n\r\n        const trimmedStoreIds = storeIds.map(id => GameId.trimStoreId(id));\r\n\r\n        const includeDsInfo = !hasDsInfo && (opts.owned || opts.wishlisted || opts.ignored);\r\n\r\n        const [dsStatus, itadStatus, invStatus] = await Promise.all([\r\n            includeDsInfo ? DynamicStore.getAppStatus(storeIds) : Promise.resolve(),\r\n            ITAD.getAppStatus(storeIds, {\r\n                \"waitlist\": opts.waitlisted,\r\n                \"collection\": opts.collected,\r\n            }),\r\n            Inventory.getAppStatus(trimmedStoreIds, {\r\n                \"giftsAndPasses\": opts.gift || opts.guestPass,\r\n                \"coupons\": opts.coupon,\r\n            }),\r\n        ]);\r\n\r\n        const it = trimmedStoreIds.values();\r\n        for (const [storeid, nodes] of storeIdsMap) {\r\n\r\n            const operations = [];\r\n\r\n            if (dsStatus) {\r\n                if (opts.owned && dsStatus[storeid].owned) {\r\n                    operations.push(this.highlightOwned);\r\n                }\r\n                if (opts.wishlisted && dsStatus[storeid].wishlisted) {\r\n                    operations.push(this.highlightWishlist);\r\n                }\r\n                if (opts.ignored && dsStatus[storeid].ignored) {\r\n                    operations.push(this.highlightIgnored);\r\n                }\r\n            }\r\n\r\n            /*\r\n             * Don't need to check for the opts object here, since the result contains\r\n             * false for every property if the highlight has been disabled\r\n             */\r\n            if (itadStatus) {\r\n                if (itadStatus[storeid].collected) {\r\n                    operations.push(this.highlightCollection);\r\n                }\r\n                if (itadStatus[storeid].waitlisted) {\r\n                    operations.push(this.highlightWaitlist);\r\n                }\r\n            }\r\n\r\n            if (invStatus) {\r\n                const trimmedId = it.next().value;\r\n                if (opts.gift && invStatus[trimmedId].gift) {\r\n                    operations.push(this.highlightInvGift);\r\n                }\r\n\r\n                if (opts.guestPass && invStatus[trimmedId].guestPass) {\r\n                    operations.push(this.highlightInvGuestpass);\r\n                }\r\n\r\n                // Same as for the ITAD highlights (don't need to check)\r\n                if (invStatus[trimmedId].coupon) {\r\n                    operations.push(this.highlightInvCoupon);\r\n                }\r\n            }\r\n\r\n            for (let operation of operations) {\r\n                operation = operation.bind(this);\r\n\r\n                for (const node of nodes) {\r\n                    try {\r\n                        operation(node);\r\n                    } catch (err) {\r\n                        console.error(\"Failed to highlight / tag node\", err);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    static _addTag(node, tag) {\r\n\r\n        if (!this._tagCssLoaded) {\r\n            this._tagCssLoaded = true;\r\n\r\n            const tagCss = [];\r\n\r\n            for (const name of this._types) {\r\n                const color = SyncedStorage.get(`tag_${name}_color`);\r\n                tagCss.push(`.es_tag_${name} { background-color: ${color}; }`);\r\n            }\r\n\r\n            DOMHelper.insertCSS(tagCss.join(\"\\n\"));\r\n        }\r\n\r\n        // Add the tags container if needed\r\n        let container = node.querySelector(\".es_tags\");\r\n        if (!container) {\r\n            container = document.createElement(\"div\");\r\n            container.classList.add(\"es_tags\");\r\n            if (SyncedStorage.get(\"tag_short\")) {\r\n                container.classList.add(\"es_tags_short\");\r\n            }\r\n\r\n            if (node.classList.contains(\"tab_item\")) {\r\n                node.querySelector(\".tab_item_details\").insertAdjacentElement(\"afterbegin\", container);\r\n            } else if (node.classList.contains(\"newonsteam_headercap\") || node.classList.contains(\"comingsoon_headercap\")) {\r\n                node.querySelector(\".discount_block\").insertAdjacentElement(\"beforebegin\", container);\r\n            } else if (node.classList.contains(\"search_result_row\")) {\r\n                node.querySelector(\".search_name > div\").insertAdjacentElement(\"afterbegin\", container);\r\n            } else if (node.classList.contains(\"browse_tag_game\")) {\r\n                node.querySelector(\".browse_tag_game_price\").insertAdjacentElement(\"afterend\", container);\r\n            } else if (node.classList.contains(\"game_area_dlc_row\")) {\r\n                node.querySelector(\".game_area_dlc_price\").insertAdjacentElement(\"afterbegin\", container);\r\n            } else if (node.classList.contains(\"wishlist_row\")) {\r\n                node.querySelector(\".addedon\").insertAdjacentElement(\"afterbegin\", container);\r\n            } else if (node.classList.contains(\"match\")) {\r\n                node.querySelector(\".match_price\").insertAdjacentElement(\"afterbegin\", container);\r\n            } else if (node.classList.contains(\"recommendation_highlight\")) {\r\n                node.querySelector(\".highlight_description\").insertAdjacentElement(\"afterbegin\", container);\r\n            } else if (node.classList.contains(\"similar_grid_item\")) {\r\n                node.querySelector(\".regular_price, .discount_block\").append(container);\r\n            } else if (node.classList.contains(\"recommendation_carousel_item\")) {\r\n                node.querySelector(\".buttons\").insertAdjacentElement(\"beforebegin\", container);\r\n            } else if (node.classList.contains(\"friendplaytime_game\")) {\r\n                node.querySelector(\".friendplaytime_buttons\").insertAdjacentElement(\"beforebegin\", container);\r\n            }\r\n        }\r\n\r\n        if (!container.querySelector(`.es_tag_${tag}`)) {\r\n            HTML.beforeEnd(container, `<span class=\"es_tag_${tag}\">${Localization.str.tag[tag]}</span>`);\r\n        }\r\n    }\r\n    /* eslint-enable complexity */\r\n\r\n    static _highlightNode(node, type) {\r\n\r\n        if (SyncedStorage.get(\"highlight_excludef2p\")) {\r\n\r\n            let _node = node.querySelector(\"[data-ds-tagids]\") || node.closest(\"[data-ds-tagids]\");\r\n            // Check for the \"Free to Play\" tag\r\n            if (_node && JSON.parse(_node.dataset.dsTagids).includes(113)) { return; }\r\n            // Check if the price is \"Free\", only works for English users\r\n            _node = node.querySelector(\".discount_final_price, .regular_price, .search_price, .game_area_dlc_price, .browse_tag_game_price\");\r\n            if (_node && /\\bFree\\b/.test(_node.textContent)) { return; }\r\n        }\r\n\r\n        node.classList.add(\"es_highlighted\", `es_highlighted_${type}`);\r\n\r\n        if (!this._highlightCssLoaded) {\r\n            this._highlightCssLoaded = true;\r\n\r\n            const hlCss = [];\r\n\r\n            for (const name of this._types) {\r\n                const color = SyncedStorage.get(`highlight_${name}_color`);\r\n                hlCss.push(\r\n                    `.es_highlighted_${name} {\r\n                        background: ${color} linear-gradient(135deg, rgba(0, 0, 0, 0.70) 10%, rgba(0, 0, 0, 0) 100%) !important;\r\n                    }\r\n                    .carousel_items .es_highlighted_${name}.price_inline, .curator_giant_capsule.es_highlighted_${name},\r\n                    .hero_capsule.es_highlighted_${name}, .blotter_userstatus_game.es_highlighted_${name} {\r\n                        outline: solid ${color};\r\n                    }\r\n                    #search_suggestion_contents .focus.es_highlighted_${name} {\r\n                        box-shadow: -5px 0 0 ${color};\r\n                    }\r\n                    .apphub_AppName.es_highlighted_${name} {\r\n                        background: none !important; color: ${color};\r\n                    }`\r\n                );\r\n            }\r\n\r\n            DOMHelper.insertCSS(hlCss.join(\"\\n\"));\r\n        }\r\n\r\n        let _node = node;\r\n\r\n        // Carousel item\r\n        if (_node.classList.contains(\"cluster_capsule\")) {\r\n            _node = _node.querySelector(\".main_cap_content\").parentNode;\r\n        } else if (_node.classList.contains(\"large_cap\")) {\r\n\r\n            // Genre Carousel items\r\n            _node = _node.querySelector(\".large_cap_content\");\r\n        } else if (_node.parentNode.classList.contains(\"steam_curator_recommendation\")\r\n            && _node.parentNode.classList.contains(\"big\")) {\r\n            _node = _node.previousElementSibling;\r\n        }\r\n\r\n        // Recommendations on front page when scrolling down\r\n        if (_node.classList.contains(\"single\")) {\r\n            _node = _node.querySelector(\".gamelink\");\r\n        }\r\n\r\n        if (_node.parentNode.parentNode.classList.contains(\"apps_recommended_by_curators_v2\")) {\r\n            let r = _node.querySelectorAll(\".ds_flag\");\r\n            r.forEach(node => node.remove());\r\n            r = _node.querySelectorAll(\".ds_flagged\");\r\n            r.forEach(node => node.classList.remove(\"ds_flagged\"));\r\n        } else {\r\n\r\n            if (_node.classList.contains(\"info\") || _node.classList.contains(\"spotlight_content\")) {\r\n                _node = _node.parentElement;\r\n            }\r\n\r\n            let r = _node.querySelector(\".ds_flag\");\r\n            if (r) { r.remove(); }\r\n            r = _node.querySelector(\".ds_flagged\");\r\n            if (r) {\r\n                r.classList.remove(\"ds_flagged\");\r\n            }\r\n        }\r\n\r\n        _node.classList.remove(\"ds_flagged\");\r\n    }\r\n\r\n    static _highlightItem(node, name) {\r\n        node.classList.add(\"es_highlight_checked\");\r\n\r\n        if (SyncedStorage.get(`highlight_${name}`)) {\r\n            this._highlightNode(node, name);\r\n        }\r\n\r\n        if (SyncedStorage.get(`tag_${name}`)) {\r\n            this._addTag(node, name);\r\n        }\r\n    }\r\n\r\n    static highlightOwned(node) {\r\n        this._highlightItem(node, \"owned\");\r\n    }\r\n\r\n    static highlightWishlist(node) {\r\n        this._highlightItem(node, \"wishlist\");\r\n    }\r\n\r\n    static highlightInvCoupon(node) {\r\n        this._highlightItem(node, \"coupon\");\r\n    }\r\n\r\n    static highlightInvGift(node) {\r\n        this._highlightItem(node, \"inv_gift\");\r\n    }\r\n\r\n    static highlightInvGuestpass(node) {\r\n        this._highlightItem(node, \"inv_guestpass\");\r\n    }\r\n\r\n    static highlightIgnored(node) {\r\n        this._highlightItem(node, \"notinterested\");\r\n    }\r\n\r\n    static highlightCollection(node) {\r\n        this._highlightItem(node, \"collection\");\r\n    }\r\n\r\n    static highlightWaitlist(node) {\r\n        this._highlightItem(node, \"waitlist\");\r\n    }\r\n}\r\n\r\nFHighlightsTags._highlightCssLoaded = false;\r\nFHighlightsTags._tagCssLoaded = false;\r\n\r\n/*\r\n * Attention, the sequence of these entries determines the precendence of the highlights!\r\n * The later it appears in the array, the higher its precedence\r\n */\r\nFHighlightsTags._types = [\r\n    \"notinterested\",\r\n    \"waitlist\",\r\n    \"wishlist\",\r\n    \"collection\",\r\n    \"owned\",\r\n    \"coupon\",\r\n    \"inv_guestpass\",\r\n    \"inv_gift\",\r\n];\r\n\r\nFHighlightsTags._selector = [\r\n    \".store_main_capsule\", // \"Featured & Recommended\"\r\n    \"a.game_area_dlc_row\", // DLC on app pages\r\n    \"a.small_cap\", // Featured storefront items and \"recommended\" section on app pages\r\n    \".home_content_item\", // Small items under \"Keep scrolling for more recommendations\"\r\n    \".home_content.single\", // Big items under \"Keep scrolling for more recommendations\"\r\n    \".home_area_spotlight\", // \"Special offers\" big items\r\n    \"a.search_result_row\", // Search result rows\r\n    \"a.match\", // Search suggestions rows\r\n    \".highlighted_app\", // For example \"Recently Recommended\" on curators page\r\n    \"div.recommendation_highlight\", // Recommendation pages\r\n    \"div.recommendation_carousel_item\", // Recommendation pages\r\n    \"div.friendplaytime_game\", // Recommendation pages\r\n    \".recommendation_row\", // \"Recent recommendations by friends\"\r\n    \".friendactivity_tab_row\", // \"Most played\" and \"Most wanted\" tabs on recommendation pages\r\n    \".friend_game_block\", // \"Friends recently bought\"\r\n    \".recommendation\", // Curator pages and the new DLC pages\r\n    \".curator_giant_capsule\",\r\n    \"div.carousel_items.curator_featured > div\", // Carousel items on Curator pages\r\n    \"div.item_ctn\", // Curator list item\r\n    \".store_capsule\", // All sorts of items on almost every page\r\n    \".newonsteam_headercap\", // explore/new/\r\n    \".comingsoon_headercap\", // explore/upcoming/\r\n    \".home_marketing_message\", // \"Updates and offers\"\r\n    \"div.dlc_page_purchase_dlc\", // DLC page rows\r\n    \"div.home_area_spotlight\", // Midweek and weekend deals\r\n    \"div.browse_tag_game\", // Tagged games\r\n    \"div.similar_grid_item\", // Items on the \"Similarly tagged\" pages\r\n    \".tab_item\", // Item rows on storefront/tag/genre pages\r\n    \".special > .special_img_ctn\", // new homepage specials\r\n    \".special.special_img_ctn\",\r\n].map(sel => `${sel}:not(.es_highlighted)`)\r\n    .join(\",\");\r\n","import {ExtensionResources, GameId, HTML, Language, Localization, SyncedStorage} from \"../../../modulesCore\";\r\nimport {Background, Feature} from \"../../modulesContent\";\r\n\r\nexport default class FEarlyAccess extends Feature {\r\n\r\n    apply() {\r\n        FEarlyAccess.show();\r\n    }\r\n\r\n    static async show(nodes) {\r\n        if (!SyncedStorage.get(\"show_early_access\")) { return; }\r\n\r\n        const _nodes = nodes || document.querySelectorAll(this._selector);\r\n        if (_nodes.length === 0) { return; }\r\n\r\n        if (!this._container) {\r\n\r\n            // TODO add missing images for supported locales\r\n            let imageName = \"img/overlay/early_access_banner_english.png\";\r\n            if (Language.isCurrentLanguageOneOf([\r\n                \"brazilian\",\r\n                \"french\",\r\n                \"italian\",\r\n                \"japanese\",\r\n                \"koreana\",\r\n                \"polish\",\r\n                \"portuguese\",\r\n                \"russian\",\r\n                \"schinese\",\r\n                \"spanish\",\r\n                \"latam\",\r\n                \"tchinese\",\r\n                \"thai\"\r\n            ])) {\r\n                imageName = `img/overlay/early_access_banner_${Language.getCurrentSteamLanguage()}.png`;\r\n            }\r\n\r\n            const imageUrl = ExtensionResources.getURL(imageName);\r\n\r\n            this._container = HTML.element(\r\n                `<span class=\"es_overlay_container\">\r\n                    <span class=\"es_overlay\">\r\n                        <img title=\"${Localization.str.early_access}\" src=\"${imageUrl}\">\r\n                    </span>\r\n                </span>`\r\n            );\r\n        }\r\n\r\n        for (const node of await this.getEaNodes(_nodes)) {\r\n\r\n            /*\r\n             * TODO It's possible a child element has been checked already, remove when not needed\r\n             * e.g. duplicate elements on the storefront (More Curator Recommendations)\r\n             * and when called with the same arguments as highlighting (observing changes in CStoreBase)\r\n             */\r\n            if (node.querySelector(\".es_overlay_container\") !== null) { continue; }\r\n\r\n            node.classList.add(\"es_early_access\");\r\n\r\n            const imgHeader = node.querySelector(\"img\");\r\n            if (!imgHeader) { continue; }\r\n\r\n            const container = this._container.cloneNode(true);\r\n            imgHeader.insertAdjacentElement(\"afterend\", container);\r\n            container.append(imgHeader);\r\n        }\r\n    }\r\n\r\n    static async getEaNodes(nodes) {\r\n\r\n        const appidsMap = new Map();\r\n\r\n        for (const node of nodes) {\r\n\r\n            node.classList.add(\"es_ea_checked\");\r\n\r\n            // Skip the live streams section since the thumbnail is shown on top\r\n            if (node.classList.contains(\"store_capsule\") && node.querySelector(\".capsule[id^=broadcast]\") !== null) {\r\n                continue;\r\n            }\r\n\r\n            let appid = GameId.getAppid(node)\r\n                || GameId.getAppid(node.querySelector(\"a\"))\r\n                || GameId.getAppidImgSrc(node.querySelector(\"img\"));\r\n\r\n            if (appid) {\r\n                appid = String(appid);\r\n                if (appidsMap.has(appid)) {\r\n                    appidsMap.get(appid).push(node);\r\n                } else {\r\n                    appidsMap.set(appid, [node]);\r\n                }\r\n            }\r\n        }\r\n\r\n        if (appidsMap.size === 0) { return []; }\r\n\r\n        const eaStatus = await Background.action(\"isea\", Array.from(appidsMap.keys()));\r\n\r\n        return Array.from(appidsMap).flatMap(([appid, nodesArray]) => {\r\n            return eaStatus[appid] ? nodesArray : [];\r\n        });\r\n    }\r\n}\r\n\r\n// TODO support React-based sales pages, curator lists, etc.\r\nFEarlyAccess._selector = [\r\n    // Store only, selectors for the Community are split into relevant contexts\r\n    \".tab_item\", // Item rows on storefront, genre, category, tags etc. pages\r\n    \".quadscreenshot_carousel a\", // Top carousel on genre, category, tags etc. pages\r\n    \".newonsteam_headercap\", // explore/new\r\n    \".comingsoon_headercap\", // explore/upcoming\r\n    \".store_capsule\",\r\n    \".dailydeal_ctn\",\r\n    \".special.special_img_ctn\", // explore/new, cart/\r\n    /*\r\n     * These use CSS backgrounds instead of img elements, unsupported for now\r\n     * \".store_main_capsule\", // Featured & Recommended\r\n     * \".home_marketing_message\", // Updates and Offers\r\n     */\r\n    \".home_area_spotlight\", // Special Offers, specials/\r\n    \".curator_giant_capsule\", // Curator Recommendations\r\n    \".home_content_item\",\r\n    \".home_content.single\",\r\n    \".highlighted_app_header\", // curators/\r\n    \"#curator_avatar_image\", // Header image on dlc pages\r\n    \".curator_featured a\", // Featured items on curator, developer, publisher, franchise, dlc etc. pages\r\n    \".search_result_row\",\r\n    \".small_cap\", // \"recommended\" section on app pages\r\n    \".browse_tag_game_cap\", // tag/browse\r\n    \".header_image\", // recommended/morelike, friendactivity header\r\n    \".similar_grid_capsule\", // recommended/morelike\r\n    \".friend_game_block a[data-ds-appid]\",\r\n    \".friendactivity_tab_row\",\r\n    \".recommendation_app\",\r\n    \".recommendation_carousel_item\",\r\n    \".app_header\",\r\n    \".friendplaytime_appheader\",\r\n].map(sel => `${sel}:not(.es_ea_checked)`)\r\n    .join(\",\");\r\n","import {HTML, SyncedStorage} from \"../../../modulesCore\";\r\nimport {ContextType, Feature} from \"../../modulesContent\";\r\n\r\nexport default class FHideTrademarks extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return SyncedStorage.get(\"hidetmsymbols\");\r\n    }\r\n\r\n    apply() {\r\n\r\n        // TODO I would try to reduce number of selectors here\r\n        let selectors = \"title, .apphub_AppName, .breadcrumbs, h1, h4\";\r\n        if (this.context.type === ContextType.STORE_DEFAULT) {\r\n            selectors\r\n                += \".game_area_already_owned, .details_block, .game_description_snippet, \"\r\n                + \".game_area_description p, .glance_details, .game_area_dlc_bubble game_area_bubble, .package_contents, \"\r\n                + \".game_area_dlc_name, .tab_desc, .tab_item_name\";\r\n        } else {\r\n            selectors\r\n                += \".game_suggestion, .appHubShortcut_Title, .apphub_CardContentNewsTitle, \"\r\n                + \".apphub_CardTextContent, .apphub_CardContentAppName, .apphub_AppName\";\r\n        }\r\n\r\n        // Replaces \"R\", \"C\" and \"TM\" signs\r\n        function replaceSymbols(node) {\r\n\r\n            // tfedor I don't trust this won't break any inline JS\r\n            if (!node || !node.innerHTML) { return; }\r\n            HTML.inner(node, node.innerHTML.replace(/[\\u00AE\\u00A9\\u2122]/g, \"\"));\r\n        }\r\n\r\n        for (const node of document.querySelectorAll(selectors)) {\r\n            replaceSymbols(node);\r\n        }\r\n\r\n        const observer = new MutationObserver(mutations => {\r\n            mutations.forEach(mutation => {\r\n                mutation.addedNodes.forEach(node => {\r\n                    replaceSymbols(node);\r\n                });\r\n            });\r\n        });\r\n\r\n        const nodes = document.querySelectorAll(\"#game_select_suggestions,#search_suggestion_contents,.tab_content_ctn\");\r\n        for (const node of nodes) {\r\n            observer.observe(node, {\"childList\": true, \"subtree\": true});\r\n        }\r\n    }\r\n}\r\n","import {ExtensionResources, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {ContextType, DOMHelper, Feature} from \"../../../modulesContent\";\r\n\r\nexport default class FAlternativeLinuxIcon extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return SyncedStorage.get(\"show_alternative_linux_icon\");\r\n    }\r\n\r\n    apply() {\r\n        const url = ExtensionResources.getURL(\"img/alternative_linux_icon.png\");\r\n\r\n        let cssText = `span.platform_img.linux { background-image: url(${url}) !important; }`;\r\n\r\n        if (this.context.type === ContextType.STORE_FRONT) {\r\n            cssText += \".tab_item.focus .tab_item_details span.platform_img.linux { filter: brightness(20%); }\";\r\n        }\r\n\r\n        DOMHelper.insertCSS(cssText);\r\n    }\r\n}\r\n","\r\nimport {User} from \"../../../Modules/User\";\r\nimport {CallbackFeature} from \"../../../Modules/Feature/CallbackFeature\";\r\nimport FHighlightsTags from \"../../Common/FHighlightsTags\";\r\n\r\nexport default class FWishlistHighlights extends CallbackFeature {\r\n\r\n    checkPrerequisites() {\r\n        return User.isSignedIn; // TODO ITAD status\r\n    }\r\n\r\n    callback(nodes) {\r\n\r\n        const options = {};\r\n        if (this.context.myWishlist) {\r\n            options.wishlisted = false;\r\n            options.waitlisted = false;\r\n        }\r\n\r\n        return FHighlightsTags.highlightAndTag(nodes, false, options);\r\n    }\r\n}\r\n","\r\nimport {SyncedStorage} from \"../../../../modulesCore\";\r\nimport {CallbackFeature} from \"../../../Modules/Feature/CallbackFeature\";\r\nimport {Prices} from \"../../../Modules/Prices\";\r\n\r\nexport default class FWishlistITADPrices extends CallbackFeature {\r\n\r\n    checkPrerequisites() {\r\n        return SyncedStorage.get(\"showlowestprice_onwishlist\");\r\n    }\r\n\r\n    setup() {\r\n\r\n        this._cachedPrices = {};\r\n\r\n        window.addEventListener(\"scroll\", () => { this._scrollResizeHandler(); });\r\n        window.addEventListener(\"resize\", () => { this._scrollResizeHandler(); });\r\n    }\r\n\r\n    _scrollResizeHandler() {\r\n\r\n        /*\r\n         * If the mouse is still inside an entry while scrolling or resizing, wishlist.js's\r\n         * event handler will put back the elements to their original position\r\n         */\r\n        const hover = document.querySelectorAll(\":hover\");\r\n        if (hover.length) {\r\n            const activeEntry = hover[hover.length - 1].closest(\".wishlist_row\");\r\n            if (activeEntry) {\r\n                const priceNode = activeEntry.querySelector(\".itad-pricing\");\r\n\r\n                if (priceNode) {\r\n                    for (const row of this._getNodesBelow(activeEntry)) {\r\n                        row.style.top = `${parseInt(row.style.top) + priceNode.getBoundingClientRect().height}px`;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    callback(nodes) {\r\n\r\n        const cachedPrices = this._cachedPrices;\r\n\r\n        for (const node of nodes) {\r\n\r\n            const appId = node.dataset.appId;\r\n            if (!appId || typeof cachedPrices[appId] !== \"undefined\") { return; }\r\n\r\n            cachedPrices[appId] = null;\r\n\r\n            node.addEventListener(\"mouseenter\", () => {\r\n                if (cachedPrices[appId] === null) {\r\n                    cachedPrices[appId] = new Promise(resolve => {\r\n                        const prices = new Prices();\r\n                        prices.appids = [appId];\r\n                        prices.priceCallback = (type, id, contentNode) => {\r\n                            node.insertAdjacentElement(\"beforeend\", contentNode);\r\n                            const priceNode = node.querySelector(\".itad-pricing\");\r\n                            priceNode.style.bottom = `${-priceNode.getBoundingClientRect().height}px`;\r\n                            resolve();\r\n                        };\r\n                        prices.load();\r\n                    });\r\n                }\r\n                cachedPrices[appId].then(() => {\r\n                    const priceNodeHeight = node.querySelector(\".itad-pricing\").getBoundingClientRect().height;\r\n                    this._getNodesBelow(node).forEach(row => { row.style.top = `${parseInt(row.style.top) + priceNodeHeight}px`; });\r\n                });\r\n            });\r\n\r\n            node.addEventListener(\"mouseleave\", () => {\r\n\r\n                // When scrolling really fast, sometimes only this event is called without the invocation of the mouseenter event\r\n                if (cachedPrices[appId]) {\r\n                    cachedPrices[appId].then(() => {\r\n                        const priceNodeHeight = node.querySelector(\".itad-pricing\").getBoundingClientRect().height;\r\n                        this._getNodesBelow(node).forEach(row => { row.style.top = `${parseInt(row.style.top) - priceNodeHeight}px`; });\r\n                    });\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    _getNodesBelow(node) {\r\n        const nodes = Array.from(document.querySelectorAll(\".wishlist_row\"));\r\n\r\n        /*\r\n         * Limit the selection to the rows that are positioned below the row\r\n         * (not including the row itself) where the price is being shown\r\n         */\r\n        return nodes.filter(row => parseInt(row.style.top) > parseInt(node.style.top));\r\n    }\r\n}\r\n","import {SyncedStorage} from \"../../modulesCore\";\r\nimport {BackgroundSimple} from \"../BackgroundSimple\";\r\n\r\nclass UserNotesAdapter {\r\n\r\n    static getAdapter() {\r\n\r\n        if (typeof UserNotesAdapter._adapter === \"undefined\") {\r\n\r\n            let Adapter = UserNotesAdapter.adapters[SyncedStorage.get(\"user_notes_adapter\")];\r\n\r\n            if (typeof Adapter === \"undefined\") {\r\n                SyncedStorage.remove(\"user_notes_adapter\");\r\n                Adapter = UserNotesAdapter.adapters[SyncedStorage.defaults.user_notes_adapter];\r\n            }\r\n\r\n            UserNotesAdapter._adapter = new Adapter();\r\n        }\r\n\r\n        return UserNotesAdapter._adapter;\r\n    }\r\n\r\n    static async changeAdapter(toType) {\r\n\r\n        const currentAdapter = UserNotesAdapter.getAdapter();\r\n        const newAdapter = new UserNotesAdapter.adapters[toType]();\r\n\r\n        await newAdapter.import(await currentAdapter.export());\r\n        await currentAdapter.clear();\r\n\r\n        UserNotesAdapter._adapter = newAdapter;\r\n        return UserNotesAdapter._adapter;\r\n    }\r\n}\r\n\r\nclass OutOfCapacityError extends Error {\r\n    constructor(ratio, ...params) {\r\n        super(...params);\r\n\r\n        this.name = this.constructor.name;\r\n\r\n        this.ratio = ratio;\r\n    }\r\n}\r\n\r\nclass CapacityInfo {\r\n    constructor(closeToFull = false, utilization = null) {\r\n        this.closeToFull = closeToFull;\r\n        this.utilization = utilization;\r\n    }\r\n}\r\n\r\nclass SyncedStorageAdapter {\r\n\r\n    constructor() {\r\n        this._notes = SyncedStorage.get(\"user_notes\");\r\n    }\r\n\r\n    get(appid) {\r\n        return this._notes[appid] || null;\r\n    }\r\n\r\n    async set(appid, note) {\r\n\r\n        const oldNote = this._notes[appid];\r\n        this._notes[appid] = note;\r\n\r\n        const storageUsage = this._getNotesSize() / SyncedStorage.QUOTA_BYTES_PER_ITEM;\r\n        if (storageUsage > 1) {\r\n            this._notes[appid] = oldNote;\r\n            throw new OutOfCapacityError(storageUsage, \"Can't set this user note, out of capacity\");\r\n        }\r\n\r\n        await SyncedStorage.set(\"user_notes\", this._notes);\r\n\r\n        return new CapacityInfo(storageUsage > 0.85, storageUsage);\r\n    }\r\n\r\n    delete(appid) {\r\n        delete this._notes[appid];\r\n        return SyncedStorage.set(\"user_notes\", this._notes);\r\n    }\r\n\r\n    export() {\r\n        return this._notes;\r\n    }\r\n\r\n    import(notes) {\r\n\r\n        const storageUsage = this._getNotesSize(notes) / SyncedStorage.QUOTA_BYTES_PER_ITEM;\r\n        if (storageUsage > 1) {\r\n            throw new OutOfCapacityError(storageUsage, \"Import to synced storage failed, too much data for this adapter\");\r\n        }\r\n\r\n        this._notes = notes;\r\n        return SyncedStorage.set(\"user_notes\", this._notes);\r\n    }\r\n\r\n    clear() {\r\n        return SyncedStorage.remove(\"user_notes\");\r\n    }\r\n\r\n    _getNotesSize(notes = this._notes) {\r\n        return \"user_notes\".length + JSON.stringify(notes).length;\r\n    }\r\n}\r\n\r\nclass IdbAdapter {\r\n\r\n    get(appid) {\r\n        return BackgroundSimple.action(\"notes.get\", appid);\r\n    }\r\n\r\n    set(appid, note) {\r\n        return BackgroundSimple.action(\"notes.set\", appid, note);\r\n    }\r\n\r\n    delete(appid) {\r\n        return BackgroundSimple.action(\"notes.delete\", appid);\r\n    }\r\n\r\n    export() {\r\n        return BackgroundSimple.action(\"notes.getall\");\r\n    }\r\n\r\n    import(notes) {\r\n        return BackgroundSimple.action(\"notes.setall\", notes);\r\n    }\r\n\r\n    clear() {\r\n        return BackgroundSimple.action(\"notes.clear\");\r\n    }\r\n}\r\n\r\n/*\r\n * TODO Implement\r\n * class ItadAdapter extends IdbAdapter {}\r\n */\r\n\r\nUserNotesAdapter.adapters = Object.freeze({\r\n    \"synced_storage\": SyncedStorageAdapter,\r\n    \"idb\": IdbAdapter,\r\n    // \"itad\": ItadAdapter,\r\n});\r\n\r\nexport {CapacityInfo, OutOfCapacityError, UserNotesAdapter};\r\n","import {Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Messenger} from \"../../../modulesContent\";\r\nimport {Page} from \"../../Page\";\r\nimport {CapacityInfo, OutOfCapacityError, UserNotesAdapter} from \"../../../../Core/Storage/UserNotesAdapter\";\r\n\r\nclass UserNotes {\r\n    constructor() {\r\n        this._str = Localization.str.user_note;\r\n        this._adapter = UserNotesAdapter.getAdapter();\r\n\r\n        this.noteModalTemplate\r\n            = `<div class=\"es_note_prompt newmodal_prompt_with_textarea gray_bevel fullwidth\">\r\n                <textarea name=\"es_note_input\" id=\"es_note_input\" rows=\"6\" cols=\"12\">__note__</textarea>\r\n            </div>`;\r\n    }\r\n\r\n    get(...args) { return this._adapter.get(...args); }\r\n\r\n    async set(...args) {\r\n\r\n        let capInfo = null;\r\n\r\n        try {\r\n            capInfo = await this._adapter.set(...args);\r\n        } catch (err) {\r\n            if (err instanceof OutOfCapacityError) {\r\n                return (await this._showDialog(true, err.ratio)) ? this.set(...args) : false;\r\n            }\r\n\r\n            throw err;\r\n        }\r\n\r\n        if (capInfo instanceof CapacityInfo && capInfo.closeToFull) {\r\n            await this._showDialog(false, capInfo.utilization);\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    delete(...args) { return this._adapter.delete(...args); }\r\n\r\n    async showModalDialog(appname, appid, noteEl, onNoteUpdate) {\r\n\r\n        let note = await this.get(appid) || \"\";\r\n\r\n        // Partly copied `ShowConfirmDialog` from shared_global.js\r\n        Page.runInPageContext((title, template, strSave, strCancel) => {\r\n            /* eslint-disable no-undef, new-cap, camelcase */\r\n\r\n            const deferred = new jQuery.Deferred();\r\n            function fnOk() {\r\n                deferred.resolve(\r\n                    document.querySelector(\"#es_note_input\").value\r\n                        .trim()\r\n                        .replace(/\\s\\s+/g, \" \")\r\n                );\r\n            }\r\n\r\n            function fnCancel() {\r\n                deferred.reject();\r\n            }\r\n\r\n            const buttons = [];\r\n\r\n            const okBtn = _BuildDialogButton(strSave, true);\r\n            okBtn.click(fnOk);\r\n            buttons.push(okBtn);\r\n\r\n            const cancelBtn = _BuildDialogButton(strCancel, false);\r\n            cancelBtn.click(fnCancel);\r\n            buttons.push(cancelBtn);\r\n\r\n            const modal = _BuildDialog(title, template, buttons, fnCancel);\r\n\r\n            _BindOnEnterKeyPressForDialog(modal, deferred, fnOk);\r\n            deferred.always(() => modal.Dismiss());\r\n\r\n            const noteInput = document.getElementById(\"es_note_input\");\r\n            noteInput.focus();\r\n            noteInput.setSelectionRange(0, noteInput.textLength);\r\n\r\n            // Native keyup handler ignores events on <textarea>'s https://github.com/SteamDatabase/SteamTracking/blob/b8f3721153355d82005e621b167969f6c1f27bdf/steamcommunity.com/public/shared/javascript/shared_global.js#L459\r\n            noteInput.addEventListener(\"keydown\", e => {\r\n                if (e.key === \"Enter\" && !e.shiftKey) {\r\n                    okBtn.trigger(\"click\");\r\n                }\r\n            });\r\n\r\n            deferred.promise(modal);\r\n\r\n            modal\r\n                .done(note => {\r\n                    window.sessionStorage.removeItem(\"es_note_autosave\");\r\n                    window.Messenger.postMessage(\"noteClosed\", note);\r\n                })\r\n                .fail(() => {\r\n                    if (noteInput.value.trim() !== \"\") {\r\n                        window.sessionStorage.setItem(\"es_note_autosave\", noteInput.value);\r\n                    }\r\n                    window.Messenger.postMessage(\"noteClosed\", null);\r\n                });\r\n\r\n            modal.Show();\r\n            /* eslint-enable no-undef, new-cap, camelcase */\r\n        },\r\n        [\r\n            this._str.add_for_game.replace(\"__gamename__\", appname),\r\n            this.noteModalTemplate.replace(\"__note__\", note || window.sessionStorage.getItem(\"es_note_autosave\") || \"\"),\r\n            Localization.str.save,\r\n            Localization.str.cancel,\r\n        ]);\r\n\r\n        const oldNote = note;\r\n\r\n        note = await Messenger.onMessage(\"noteClosed\");\r\n        if (note === null || note === oldNote) { return; }\r\n\r\n        if (note.length === 0) {\r\n            this.delete(appid);\r\n            noteEl.textContent = this._str.add;\r\n        } else {\r\n            if (!await this.set(appid, note)) {\r\n                window.sessionStorage.setItem(\"es_note_autosave\", note);\r\n                return;\r\n            }\r\n            noteEl.textContent = `\"${note}\"`;\r\n        }\r\n\r\n        onNoteUpdate(noteEl, note.length !== 0);\r\n    }\r\n\r\n    async _showDialog(exceeded, ratio) {\r\n\r\n        const str = this._str;\r\n\r\n        const desc\r\n            = `${(exceeded ? str.not_enough_space_desc : str.close_on_storage_desc).replace(\"__perc__\", (ratio * 100).toFixed(0))}\r\n            <br>\r\n            ${str.storage_warning_desc}`;\r\n\r\n        Page.runInPageContext((title, desc, strCloudStorage, strCancel, strLocalStorage) => {\r\n            const modal = window.SteamFacade.showConfirmDialog(title, desc, strLocalStorage, strCancel);\r\n\r\n            modal\r\n                .done(res => window.Messenger.postMessage(\"storageOption\", res))\r\n                .fail(() => window.Messenger.postMessage(\"storageOption\", null));\r\n        },\r\n        [\r\n            exceeded ? str.not_enough_space : str.close_on_storage,\r\n            desc,\r\n            str.save_itad,\r\n            str.save_synced_storage,\r\n            str.save_local,\r\n        ]);\r\n\r\n        const buttonPressed = await Messenger.onMessage(\"storageOption\");\r\n        let adapterType;\r\n\r\n        if (buttonPressed === \"OK\") {\r\n            adapterType = \"idb\";\r\n        } else {\r\n            return false;\r\n        }\r\n\r\n        this._adapter = await UserNotesAdapter.changeAdapter(adapterType);\r\n        await SyncedStorage.set(\"user_notes_adapter\", adapterType);\r\n        return true;\r\n    }\r\n}\r\n\r\nexport {UserNotes};\r\n","import {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {CallbackFeature} from \"../../../modulesContent\";\r\nimport {UserNotes} from \"../Common/UserNotes\";\r\n\r\nexport default class FWishlistUserNotes extends CallbackFeature {\r\n\r\n    checkPrerequisites() {\r\n        return this.context.myWishlist && SyncedStorage.get(\"user_notes_wishlist\");\r\n    }\r\n\r\n    setup() {\r\n        this._userNotes = new UserNotes();\r\n        this._noteEl = HTML.element(`<div class=\"esi-note esi-note--wishlist ellipsis\">${Localization.str.user_note.add}</div>`);\r\n\r\n        document.addEventListener(\"click\", ({target}) => {\r\n            if (!target.classList.contains(\"esi-note\")) { return; }\r\n\r\n            const row = target.closest(\".wishlist_row\");\r\n            this._userNotes.showModalDialog(\r\n                row.querySelector(\"a.title\").textContent.trim(),\r\n                Number(row.dataset.appId),\r\n                target,\r\n                (node, active) => {\r\n                    node.classList.toggle(\"esi-has-note\", active);\r\n                }\r\n            );\r\n        });\r\n    }\r\n\r\n    callback(nodes) {\r\n\r\n        const lastNode = nodes[nodes.length - 1];\r\n\r\n        for (const node of nodes) {\r\n            if (node.classList.contains(\"esi-has-note\")) { continue; }\r\n\r\n            const noteEl = this._noteEl.cloneNode(true);\r\n            const appid = Number(node.dataset.appId);\r\n\r\n            (async() => {\r\n                const note = await this._userNotes.get(appid);\r\n\r\n                if (note !== null) {\r\n                    noteEl.textContent = `\"${note}\"`;\r\n                    noteEl.classList.add(\"esi-has-note\");\r\n                }\r\n\r\n                node.querySelector(\".mid_container\").insertAdjacentElement(\"afterend\", noteEl);\r\n                node.classList.add(\"esi-has-note\");\r\n\r\n                if (node === lastNode) {\r\n                    window.dispatchEvent(new Event(\"resize\"));\r\n                }\r\n            })();\r\n        }\r\n    }\r\n}\r\n","import {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Feature, Messenger, Price} from \"../../../modulesContent\";\r\nimport {Page} from \"../../Page\";\r\n\r\nexport default class FWishlistStats extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return SyncedStorage.get(\"showwishliststats\");\r\n    }\r\n\r\n    async apply() {\r\n\r\n        this._appInfo = await Page.runInPageContext(() => window.SteamFacade.global(\"g_rgAppInfo\"), null, true);\r\n\r\n        HTML.beforeBegin(\"#wishlist_ctn\", '<div id=\"esi-wishlist-chart-content\"></div>');\r\n\r\n        Messenger.addMessageListener(\"wlUpdate\", () => { this._updateStats(); });\r\n\r\n        Page.runInPageContext(() => {\r\n            const updateOld = window.CWishlistController.prototype.Update;\r\n\r\n            window.CWishlistController.prototype.Update = function(...args) {\r\n                updateOld.call(this, args);\r\n\r\n                window.Messenger.postMessage(\"wlUpdate\");\r\n            };\r\n        });\r\n\r\n        this._updateStats();\r\n    }\r\n\r\n    async _updateStats() {\r\n\r\n        let totalPrice = 0;\r\n        let totalCount = 0;\r\n        let totalOnSale = 0;\r\n        let totalNoPrice = 0;\r\n\r\n        const visibleApps = await Page.runInPageContext(() => window.SteamFacade.global(\"g_Wishlist\").rgVisibleApps, null, true);\r\n        const appInfo = visibleApps.map(appid => this._appInfo[appid]);\r\n\r\n        for (const data of Object.values(appInfo)) {\r\n            if (data.subs.length > 0) {\r\n                totalPrice += data.subs[0].price;\r\n\r\n                if (data.subs[0].discount_pct > 0) {\r\n                    totalOnSale++;\r\n                }\r\n            } else {\r\n                totalNoPrice++;\r\n            }\r\n            totalCount++;\r\n        }\r\n        totalPrice = new Price(totalPrice / 100);\r\n\r\n        HTML.inner(\"#esi-wishlist-chart-content\",\r\n            `<div class=\"esi-wishlist-stat\"><span class=\"num\">${totalPrice}</span>${Localization.str.wl.total_price}</div>\r\n            <div class=\"esi-wishlist-stat\"><span class=\"num\">${totalCount}</span>${Localization.str.wl.in_wishlist}</div>\r\n            <div class=\"esi-wishlist-stat\"><span class=\"num\">${totalOnSale}</span>${Localization.str.wl.on_sale}</div>\r\n            <div class=\"esi-wishlist-stat\"><span class=\"num\">${totalNoPrice}</span>${Localization.str.wl.no_price}</div>`);\r\n    }\r\n}\r\n","import {Downloader, HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Clipboard, Feature} from \"../../../modulesContent\";\r\nimport {Page} from \"../../Page\";\r\n\r\nclass WishlistExporter {\r\n\r\n    constructor(wl) {\r\n        this.wl = wl;\r\n        this.notes = SyncedStorage.get(\"user_notes\") || {};\r\n    }\r\n\r\n    toJson() {\r\n        const json = {\r\n            \"version\": \"03\",\r\n            \"data\": []\r\n        };\r\n\r\n        for (const [appid, data] of this.wl) {\r\n            json.data.push({\r\n                \"gameid\": [\"steam\", `app/${appid}`],\r\n                \"title\": data.name,\r\n                \"url\": `https://store.steampowered.com/app/${appid}/`,\r\n                \"type\": data.type,\r\n                \"release_date\": data.release_string,\r\n                \"note\": this.notes[appid] || null,\r\n                \"price\": data.subs[0] ? data.subs[0].price : null,\r\n                \"discount\": data.subs[0] ? data.subs[0].discount_pct : 0,\r\n            });\r\n        }\r\n\r\n        return JSON.stringify(json, null, 4);\r\n    }\r\n\r\n    toText(format) {\r\n        const result = [];\r\n        const parser = new DOMParser();\r\n        for (const [appid, data] of this.wl) {\r\n            let price = \"N/A\";\r\n            let discount = \"0%\";\r\n            let basePrice = \"N/A\";\r\n\r\n            // if it has a price (steam always picks first sub, see https://github.com/SteamDatabase/SteamTracking/blob/f3f38deef1f1a8c6bf5707013adabde3ed873620/store.steampowered.com/public/javascript/wishlist.js#L292)\r\n            if (data.subs[0]) {\r\n                const block = parser.parseFromString(data.subs[0].discount_block, \"text/html\");\r\n                price = block.querySelector(\".discount_final_price\").innerText;\r\n\r\n                // if it is discounted\r\n                if (data.subs[0].discount_pct > 0) {\r\n                    discount = block.querySelector(\".discount_pct\").innerText;\r\n                    basePrice = block.querySelector(\".discount_original_price\").innerText;\r\n                } else {\r\n                    basePrice = block.querySelector(\".discount_final_price\").innerText;\r\n                }\r\n            }\r\n\r\n            result.push(\r\n                format\r\n                    .replace(\"%appid%\", appid)\r\n                    .replace(\"%id%\", `app/${appid}`)\r\n                    .replace(\"%url%\", `https://store.steampowered.com/app/${appid}/`)\r\n                    .replace(\"%title%\", data.name)\r\n                    .replace(\"%release_date%\", data.release_string)\r\n                    .replace(\"%price%\", price)\r\n                    .replace(\"%discount%\", discount)\r\n                    .replace(\"%base_price%\", basePrice)\r\n                    .replace(\"%type%\", data.type)\r\n                    .replace(\"%note%\", this.notes[appid] || \"\")\r\n            );\r\n        }\r\n\r\n        return result.join(\"\\n\");\r\n    }\r\n}\r\n\r\nWishlistExporter.method = Object.freeze({\"download\": Symbol(\"Download\"), \"copyToClipboard\": Symbol(\"Copy to clipboard\")});\r\n\r\n\r\nexport default class FExportWishlist extends Feature {\r\n\r\n    apply() {\r\n        HTML.afterBegin(\"#cart_status_data\", `<div class=\"es-wbtn\" id=\"es_export_wishlist\"><div>${Localization.str.export.wishlist}</div></div>`);\r\n\r\n        document.querySelector(\"#es_export_wishlist\").addEventListener(\"click\", async() => {\r\n\r\n            const wl = await Page.runInPageContext(() => {\r\n                const f = window.SteamFacade;\r\n\r\n                return f.global(\"g_Wishlist\").rgVisibleApps.map(\r\n                    appid => [appid, f.global(\"g_rgAppInfo\")[appid]]\r\n                );\r\n            }, null, true);\r\n\r\n            this._showDialog(wl);\r\n        });\r\n    }\r\n\r\n    /*\r\n     * Using Valve's CModal API here is very hard, since, when trying to copy data to the clipboard, it has to originate from\r\n     * a short-lived event handler for a user action.\r\n     * Since we'd use our Messenger class to pass information in between these two contexts, we would \"outrange\" this specific event\r\n     * handler, resulting in a denial of access to the clipboard function.\r\n     * This could be circumvented by adding the appropriate permissions, but doing so would prompt users to explicitly accept the\r\n     * changed permissions on an update.\r\n     *\r\n     * If we don't use the Messenger, we'd have to move the whole handler part (including WishlistExporter) to\r\n     * the page context side.\r\n     *\r\n     * Final solution is to query the action buttons of the dialog and adding some extra click handlers on the content script side.\r\n     */\r\n    _showDialog(wl) {\r\n\r\n        function exportWishlist(method) {\r\n            const type = document.querySelector(\"input[name='es_wexport_type']:checked\").value;\r\n            const format = document.querySelector(\"#es-wexport-format\").value;\r\n\r\n            const wishlist = new WishlistExporter(wl);\r\n\r\n            let result = \"\";\r\n            let filename = \"\";\r\n            let filetype = \"\";\r\n            if (type === \"json\") {\r\n                result = wishlist.toJson();\r\n                filename = \"wishlist.json\";\r\n                filetype = \"application/json\";\r\n            } else if (type === \"text\" && format) {\r\n                result = wishlist.toText(format);\r\n                filename = \"wishlist.txt\";\r\n                filetype = \"text/plain\";\r\n            }\r\n\r\n            if (method === WishlistExporter.method.copyToClipboard) {\r\n                Clipboard.set(result);\r\n            } else if (method === WishlistExporter.method.download) {\r\n                Downloader.download(new Blob([result], {\"type\": `${filetype};charset=UTF-8`}), filename);\r\n            }\r\n        }\r\n\r\n        Page.runInPageContext(exportStr => {\r\n            window.SteamFacade.showConfirmDialog(\r\n                exportStr.wishlist,\r\n                `<div id=\"es_export_form\">\r\n                    <div class=\"es-wexport\">\r\n                        <h2>${exportStr.type}</h2>\r\n                        <div>\r\n                            <label class=\"es-wexport__label\"><input type=\"radio\" name=\"es_wexport_type\" value=\"text\" checked> ${exportStr.text}</label>\r\n                            <label class=\"es-wexport__label\"><input type=\"radio\" name=\"es_wexport_type\" value=\"json\"> JSON</label>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"es-wexport es-wexport__format\">\r\n                        <h2>${exportStr.format}</h2>\r\n                        <div>\r\n                            <input type=\"text\" id=\"es-wexport-format\" class=\"es-wexport__input\" value=\"%title%\"><br>\r\n                            <div class=\"es-wexport__symbols\">%title%, %id%, %appid%, %url%, %release_date%, %price%, %discount%, %base_price%, %type%, %note%</div>\r\n                        </div>\r\n                    </div>\r\n                </div>`,\r\n                exportStr.download,\r\n                null, // use default \"Cancel\"\r\n                exportStr.copy_clipboard\r\n            );\r\n        }, [Localization.str.export]);\r\n\r\n        const [dlBtn, copyBtn] = document.querySelectorAll(\".newmodal_buttons > .btn_medium\");\r\n\r\n        // Update button to new style, remove when not needed\r\n        copyBtn.classList.replace(\"btn_darkblue_white_innerfade\", \"btn_blue_steamui\");\r\n\r\n        // Capture this s.t. the CModal doesn't get destroyed before we can grab this information\r\n        dlBtn.addEventListener(\"click\", () => { exportWishlist(WishlistExporter.method.download); }, true);\r\n        copyBtn.addEventListener(\"click\", () => { exportWishlist(WishlistExporter.method.copyToClipboard); }, true);\r\n\r\n        const format = document.querySelector(\".es-wexport__format\");\r\n        for (const el of document.getElementsByName(\"es_wexport_type\")) {\r\n            el.addEventListener(\"click\", ({target}) => {\r\n                format.classList.toggle(\"es-grayout\", target.value === \"json\");\r\n            });\r\n        }\r\n    }\r\n}\r\n","\r\nclass Clipboard {\r\n\r\n    static async set(content) {\r\n\r\n        try {\r\n            await navigator.clipboard.writeText(content);\r\n            return true;\r\n        } catch {\r\n            // Ignore error, use fallback\r\n        }\r\n\r\n        // Based on https://stackoverflow.com/a/12693636\r\n        function copyHandler(e) {\r\n            e.clipboardData.setData(\"text/plain\", content);\r\n            e.preventDefault();\r\n        }\r\n\r\n        document.addEventListener(\"copy\", copyHandler);\r\n        const result = document.execCommand(\"copy\");\r\n        document.removeEventListener(\"copy\", copyHandler);\r\n        return result;\r\n    }\r\n}\r\n\r\nexport {Clipboard};\r\n","\r\nclass Downloader {\r\n\r\n    static download(content, filename) {\r\n        const a = document.createElement(\"a\");\r\n        a.href = typeof content === \"string\" ? content : URL.createObjectURL(content);\r\n        a.download = filename;\r\n\r\n        // Explicitly dispatching the click event (instead of just a.click()) will make it work in FF\r\n        a.dispatchEvent(new MouseEvent(\"click\"));\r\n    }\r\n}\r\n\r\nexport {Downloader};\r\n","\r\nimport {HTML, HTMLParser, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {DynamicStore, Feature, RequestData, User} from \"../../../modulesContent\";\r\nimport FExportWishlist from \"./FExportWishlist\";\r\nimport {Page} from \"../../Page\";\r\n\r\nexport default class FEmptyWishlist extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return this.context.myWishlist && SyncedStorage.get(\"showemptywishlist\");\r\n    }\r\n\r\n    apply() {\r\n        HTML.afterBegin(\"#cart_status_data\", `<div class=\"es-wbtn\" id=\"es_empty_wishlist\">${Localization.str.empty_wishlist.title}</div>`);\r\n\r\n        document.getElementById(\"es_empty_wishlist\").addEventListener(\"click\", async() => {\r\n\r\n            await Page.runInPageContext(emptyWishlist => {\r\n                const f = window.SteamFacade;\r\n                const prompt = f.showConfirmDialog(emptyWishlist.title, emptyWishlist.confirm);\r\n\r\n                return new Promise(resolve => {\r\n                    prompt.done(result => {\r\n                        if (result === \"OK\") {\r\n                            f.showBlockingWaitDialog(\r\n                                emptyWishlist.title,\r\n                                emptyWishlist.removing\r\n                                    .replace(\"__cur__\", 1)\r\n                                    .replace(\"__total__\", f.global(\"g_rgWishlistData\").length)\r\n                            );\r\n                            resolve();\r\n                        }\r\n                    });\r\n                });\r\n            }, [Localization.str.empty_wishlist], true);\r\n\r\n            const wishlistData = HTMLParser.getVariableFromDom(\"g_rgWishlistData\", \"array\");\r\n            if (!wishlistData) {\r\n                console.warn(\"Failed to find wishlist data for this wishlist\");\r\n                return;\r\n            }\r\n\r\n            let cur = 1;\r\n            const textNode = document.querySelector(\".waiting_dialog_throbber\").nextSibling;\r\n\r\n            for (const {appid} of wishlistData) {\r\n                textNode.textContent = Localization.str.empty_wishlist.removing\r\n                    .replace(\"__cur__\", cur++)\r\n                    .replace(\"__total__\", wishlistData.length);\r\n\r\n                const formData = new FormData();\r\n                formData.append(\"sessionid\", User.sessionId);\r\n                formData.append(\"appid\", appid);\r\n\r\n                const url = `https://store.steampowered.com/wishlist/profiles/${User.steamId}/remove/`;\r\n                await RequestData.post(url, formData);\r\n            }\r\n\r\n            DynamicStore.clear();\r\n            location.reload();\r\n        });\r\n    }\r\n}\r\n\r\nFEmptyWishlist.dependencies = [FExportWishlist];\r\n","// import {SyncedStorage} from \"../../../../Core/Storage/SyncedStorage\";\r\nimport {CallbackFeature} from \"../../../Modules/Feature/CallbackFeature\";\r\nimport {Page} from \"../../Page\";\r\n\r\nexport default class FKeepEditableRanking extends CallbackFeature {\r\n\r\n    checkPrerequisites() {\r\n        return this.context.myWishlist;\r\n    }\r\n\r\n    setup() {\r\n        document.querySelector(\"#wishlist_ctn\").classList.add(\"as_show_order_input\");\r\n\r\n        Page.runInPageContext(() => {\r\n            const globalAppInfo = window.g_rgAppInfo;\r\n            const wishlist = window.g_Wishlist;\r\n            const controller = window.CWishlistController.prototype;\r\n\r\n            function sortByRank() {\r\n                // Source: https://github.com/SteamDatabase/SteamTracking/blob/2ffc58d15afb8d7d25747ff32b0bf44032c36ad4/store.steampowered.com/public/javascript/wishlist.js#L784\r\n                return Array.from(wishlist.rgAllApps).sort((a, b) => {\r\n                    if (globalAppInfo[b].priority === globalAppInfo[a].priority) { return 0; }\r\n                    if (globalAppInfo[b].priority === 0) { return -1; }\r\n                    if (globalAppInfo[a].priority === 0) { return 1; }\r\n                    return globalAppInfo[a].priority - globalAppInfo[b].priority;\r\n                });\r\n            }\r\n\r\n            for (const fnName of [\"MoveToPosition\", \"SaveOrder\"]) {\r\n                const oldFn = controller[fnName];\r\n\r\n                /*\r\n                 * MoveToPosition and SaveOrder assume that rgAllApps is sorted by \"Your rank\".\r\n                 * Otherwise, the ranking would be overwritten by the currently displayed order,\r\n                 * see https://github.com/IsThereAnyDeal/AugmentedSteam/issues/1293\r\n                 */\r\n                controller[fnName] = function(...args) {\r\n                    oldFn.call(Object.assign(wishlist, {\"rgAllApps\": sortByRank()}), ...args);\r\n                };\r\n            }\r\n        });\r\n    }\r\n\r\n    callback(nodes) {\r\n\r\n        for (const node of nodes) {\r\n\r\n            if (node.querySelector(\".as_hover_handle\") !== null) { continue; }\r\n\r\n            // Clone the hover element in order to disable drag-and-drop while filtering is active\r\n            const hoverHandle = node.querySelector(\".hover_handle\");\r\n            const newHoverHandle = hoverHandle.cloneNode(true);\r\n            newHoverHandle.classList.add(\"as_hover_handle\");\r\n            newHoverHandle.draggable = false;\r\n            newHoverHandle.querySelector(\"img\").remove();\r\n            hoverHandle.insertAdjacentElement(\"afterend\", newHoverHandle);\r\n\r\n            const input = hoverHandle.querySelector(\".order_input\");\r\n            const newInput = newHoverHandle.querySelector(\".order_input\");\r\n\r\n            // Pass events to the old input to trigger Steam's handlers\r\n            newInput.addEventListener(\"change\", () => {\r\n                input.value = newInput.value;\r\n                input.dispatchEvent(new Event(\"change\"));\r\n            });\r\n        }\r\n    }\r\n}\r\n","import {SyncedStorage} from \"../../../../Core/Storage/SyncedStorage\";\r\nimport {CallbackFeature} from \"../../../Modules/Feature/CallbackFeature\";\r\nimport {Page} from \"../../Page\";\r\n\r\nexport default class FOneClickRemoveFromWishlist extends CallbackFeature {\r\n\r\n    checkPrerequisites() {\r\n        return this.context.myWishlist && SyncedStorage.get(\"oneclickremovewl\");\r\n    }\r\n\r\n    callback(nodes) {\r\n\r\n        for (const node of nodes) {\r\n\r\n            const deleteNode = node.querySelector(\".delete\");\r\n            if (deleteNode.classList.contains(\"as-oneclickremove\")) { continue; }\r\n\r\n            // Replace the delete node in order to disable Steam's handlers\r\n            const newDeleteNode = deleteNode.cloneNode(true);\r\n            newDeleteNode.classList.add(\"as-oneclickremove\");\r\n            deleteNode.replaceWith(newDeleteNode);\r\n\r\n            // eslint-disable-next-line no-loop-func\r\n            newDeleteNode.addEventListener(\"click\", () => {\r\n\r\n                /*\r\n                 * Modified version of fnRemoveFromWishlist from wishlist.js\r\n                 * https://github.com/SteamDatabase/SteamTracking/blob/ca5145acba077bee42de2593f6b17a6ed045b5f6/store.steampowered.com/public/javascript/wishlist.js#L173\r\n                 */\r\n                Page.runInPageContext(appid => {\r\n\r\n                    const f = window.SteamFacade;\r\n\r\n                    f.jqPost(`${f.global(\"g_strWishlistBaseURL\")}remove/`, {\r\n                        appid,\r\n                        \"sessionid\": f.global(\"g_sessionID\")\r\n                    });\r\n\r\n                    f.dynamicStoreInvalidateCache();\r\n\r\n                    f.jq(\"#wishlist_ctn\").removeClass(\"sorting\");\r\n\r\n                    /* eslint-disable new-cap, no-undef, camelcase */\r\n                    delete g_rgAppInfo[appid];\r\n                    g_Wishlist.rgAllApps = Object.keys(g_rgAppInfo);\r\n                    g_Wishlist.Update(true);\r\n                    /* eslint-enable new-cap, no-undef, camelcase */\r\n                }, [node.dataset.appId]);\r\n            });\r\n        }\r\n    }\r\n}\r\n","import {StorePage} from \"../../StorePage\";\r\nimport {CWishlist} from \"./CWishlist\";\r\n\r\n(new StorePage()).run(CWishlist);\r\n","import {Page} from \"./Page\";\r\n\r\nclass StorePage extends Page {}\r\n\r\nexport {StorePage};\r\n","import {ContextType, User} from \"../../../modulesContent\";\r\nimport {CStoreBase} from \"../Common/CStoreBase\";\r\nimport FAlternativeLinuxIcon from \"../Common/FAlternativeLinuxIcon\";\r\nimport FWishlistHighlights from \"./FWishlistHighlights\";\r\nimport FWishlistITADPrices from \"./FWishlistITADPrices\";\r\nimport FWishlistUserNotes from \"./FWishlistUserNotes\";\r\nimport FWishlistStats from \"./FWishlistStats\";\r\nimport FEmptyWishlist from \"./FEmptyWishlist\";\r\nimport FExportWishlist from \"./FExportWishlist\";\r\nimport FKeepEditableRanking from \"./FKeepEditableRanking\";\r\nimport FOneClickRemoveFromWishlist from \"./FOneClickRemoveFromWishlist\";\r\nimport {TimeUtils} from \"../../../../modulesCore\";\r\n\r\nexport class CWishlist extends CStoreBase {\r\n\r\n    constructor() {\r\n        // Don't apply features on empty or private wishlists\r\n        if (document.getElementById(\"nothing_to_see_here\").style.display !== \"none\") {\r\n            super(ContextType.WISHLIST);\r\n            return;\r\n        }\r\n\r\n        super(ContextType.WISHLIST, [\r\n            FWishlistHighlights,\r\n            FWishlistITADPrices,\r\n            FWishlistUserNotes,\r\n            FWishlistStats,\r\n            FEmptyWishlist,\r\n            FExportWishlist,\r\n            FKeepEditableRanking,\r\n            FOneClickRemoveFromWishlist,\r\n            FAlternativeLinuxIcon,\r\n        ]);\r\n\r\n        if (User.isSignedIn) {\r\n            const myWishlistUrl = User.profileUrl.replace(\"steamcommunity.com/\", \"store.steampowered.com/wishlist/\").replace(/\\/$/, \"\");\r\n            const myWishlistUrlRegex = new RegExp(`^${myWishlistUrl}([/#]|$)`);\r\n            this.myWishlist = myWishlistUrlRegex.test(window.location.href) || window.location.href.includes(`/profiles/${User.steamId}`);\r\n        } else {\r\n            this.myWishlist = false;\r\n        }\r\n    }\r\n\r\n    async applyFeatures() {\r\n        const throbber = document.getElementById(\"throbber\");\r\n        if (throbber.style.display !== \"none\") {\r\n            await new Promise(resolve => {\r\n                new MutationObserver((mutations, observer) => {\r\n                    observer.disconnect();\r\n                    resolve();\r\n                }).observe(throbber, {\"attributes\": true});\r\n            });\r\n        }\r\n\r\n        await super.applyFeatures();\r\n\r\n        const alreadyLoaded = document.querySelectorAll(\".wishlist_row\");\r\n        if (alreadyLoaded.length !== 0) {\r\n            this.triggerCallbacks(alreadyLoaded);\r\n\r\n            window.dispatchEvent(new Event(\"resize\"));\r\n        }\r\n\r\n        this._registerObserver();\r\n    }\r\n\r\n    _registerObserver() {\r\n\r\n        const container = document.getElementById(\"wishlist_ctn\");\r\n        let timer = null;\r\n        const delayedWork = new Set();\r\n\r\n        new MutationObserver(mutations => {\r\n\r\n            for (const record of mutations) {\r\n                if (record.addedNodes.length === 1) {\r\n                    delayedWork.add(record.addedNodes[0]);\r\n                }\r\n            }\r\n\r\n            if (timer === null) {\r\n\r\n                timer = TimeUtils.resettableTimer(() => {\r\n\r\n                    // Valve detaches wishlist entries that aren't visible\r\n                    const arg = Array.from(delayedWork).filter(node => node.parentNode === container);\r\n                    delayedWork.clear();\r\n\r\n                    this.triggerCallbacks(arg);\r\n                }, 50);\r\n            } else {\r\n                timer.reset();\r\n            }\r\n        }).observe(container, {\"childList\": true});\r\n    }\r\n}\r\n","import {Context, ContextType} from \"../../../modulesContent\";\r\nimport FHighlightsTags from \"../../Common/FHighlightsTags\";\r\nimport FEarlyAccess from \"../../Common/FEarlyAccess\";\r\nimport FHideTrademarks from \"../../Common/FHideTrademarks\";\r\nimport FAlternativeLinuxIcon from \"./FAlternativeLinuxIcon\";\r\n\r\nexport class CStoreBase extends Context {\r\n\r\n    constructor(type = ContextType.STORE_DEFAULT, features = []) {\r\n\r\n        features.push(\r\n            FHighlightsTags,\r\n            FEarlyAccess,\r\n            FHideTrademarks,\r\n            FAlternativeLinuxIcon,\r\n        );\r\n\r\n        super(type, features);\r\n\r\n        this._observeChanges();\r\n    }\r\n\r\n    _observeChanges() {\r\n\r\n        // search box on the navigation bar\r\n        const searchBox = document.querySelector(\"#search_suggestion_contents\");\r\n        if (searchBox) {\r\n            new MutationObserver(mutations => {\r\n                this.decorateStoreCapsules(mutations[0].addedNodes);\r\n            }).observe(searchBox, {\"childList\": true});\r\n        }\r\n\r\n        // genre, category, tags etc. pages\r\n        const tabContent = document.querySelector(\".tab_content_ctn\");\r\n        if (tabContent) {\r\n            new MutationObserver(mutations => {\r\n                for (const {addedNodes} of mutations) {\r\n                    if (addedNodes.length > 1) {\r\n                        const nodes = Array.from(addedNodes)\r\n                            .filter(el => el instanceof Element && el.classList.contains(\"tab_item\"));\r\n\r\n                        this.decorateStoreCapsules(nodes);\r\n                    }\r\n                }\r\n            }).observe(tabContent, {\"childList\": true, \"subtree\": true});\r\n\r\n            return;\r\n        }\r\n\r\n        // recommended/friendactivity\r\n        const friendactivityTab = document.querySelector(\"#friendactivity_tabarea\");\r\n        if (friendactivityTab) {\r\n            new MutationObserver(mutations => {\r\n                for (const {addedNodes} of mutations) {\r\n                    if (addedNodes.length > 1) {\r\n                        const nodes = Array.from(addedNodes)\r\n                            .filter(el => el instanceof Element && el.querySelector(\".friendactivity_game_link\") !== null);\r\n\r\n                        this.decorateStoreCapsules(nodes);\r\n                    }\r\n                }\r\n            }).observe(friendactivityTab, {\"childList\": true, \"subtree\": true});\r\n\r\n            return;\r\n        }\r\n\r\n        const container = document.querySelector([\r\n            \"#tag_browse_games_ctn\", // tag/browse\r\n            \"#RecommendationsRows\", // curator, developer, publisher, franchise, dlc etc. pages\r\n            \"#CuratorsRows\", // curators/recommendedcurators\r\n        ].join(\",\"));\r\n\r\n        if (container) {\r\n            new MutationObserver(mutations => {\r\n                for (const {addedNodes} of mutations) {\r\n                    if (addedNodes.length > 0 && addedNodes[0] instanceof Element) {\r\n                        const nodes = addedNodes[0].querySelectorAll(\".browse_tag_game, .store_capsule, .recommendation\");\r\n                        this.decorateStoreCapsules(nodes);\r\n                    }\r\n                }\r\n            }).observe(container, {\"childList\": true, \"subtree\": true});\r\n        }\r\n    }\r\n\r\n    decorateStoreCapsules(nodes, hasDsInfo) {\r\n        FHighlightsTags.highlightAndTag(nodes, hasDsInfo);\r\n        FEarlyAccess.show(nodes);\r\n    }\r\n}\r\n","import {FeatureManager} from \"../Feature/FeatureManager\";\r\n\r\nclass Context {\r\n\r\n    constructor(type, features) {\r\n        this._callbacks = [];\r\n        this.type = type;\r\n        this.features = features.map(Ref => new Ref(this));\r\n    }\r\n\r\n    applyFeatures() {\r\n        return FeatureManager.apply(this.features);\r\n    }\r\n\r\n    registerCallback(fn) {\r\n        this._callbacks.push(fn);\r\n    }\r\n\r\n    triggerCallbacks(...params) {\r\n        for (const callback of this._callbacks) {\r\n            callback(...params);\r\n        }\r\n    }\r\n}\r\n\r\nexport {Context};\r\n"],"names":["LoginError","Error","constructor","type","super","this","name","ServerOutageError","msg","HTTPError","code","message","FeatureDependencyError","featureName","Errors","HTML","static","str","map","replace","m","html","template","document","createElement","innerHTML","DOMPurify","sanitize","content","fragment","firstElementChild","node","_node","console","warn","querySelector","Element","_getNode","outerHTML","wrapper","startEl","endEl","_startEl","_endEl","parentElement","lastElementChild","wrappedNodes","cur","nextElementSibling","push","_wrapper","element","replaceWith","append","position","insertAdjacentHTML","adjacent","string","text","regex","RegExp","match","parseInt","JSON","parse","dom","querySelectorAll","value","getVariableFromText","textContent","CookieStorage","defaultValue","_name","trim","cache","has","get","val","ttl","_val","set","encodeURIComponent","cookie","delete","Map","key","split","kv","decodeURIComponent","init","ContextType","Object","freeze","currentContext","browser","extension","getBackgroundPage","bgPage","window","BACKGROUND","OPTIONS","CONTENT_SCRIPT","Environment","Language","_currentSteamLanguage","script","language","URL","src","searchParams","isContentScript","languages","array","includes","getCurrentSteamLanguage","BackgroundSimple","runtime","sendMessage","requested","params","length","ExtensionResources","pathname","getURL","fetch","then","r","json","Storage","prototype","hasOwnProperty","call","defaults","_adapter","entries","remove","prefix","keys","filter","k","startsWith","force","tmp","persistent","reduce","acc","option","clear","import","area","storage","sync","caches","onChanged","addListener","changes","eventArea","assign","onDone","onCatch","promise","_initialized","Promise","resolve","stringify","Info","getManifest","version","local","QUOTA_BYTES_PER_ITEM","getJSON","_promise","currentSteamLanguage","storedSteamLanguage","deepAssign","target","source","action","getLanguageCode","codes","all","lc","loadLocalization","english","path","reverse","current","pop","LocalStorage","migrate","migrationDone","location","hostname","async","localStorage","getItem","err","error","removeItem","Timer","duration","_id","setTimeout","onSuccess","onFail","clearTimeout","ResettableTimer","reset","running","_running","TimeUtils","Math","trunc","Date","now","GameId","id","_text","HTMLElement","appid","dataset","dsAppid","parseId","href","subid","dsPackageid","bundleid","dsBundleid","storeId","Number","slice","indexOf","HTMLImageElement","hasAttribute","getAttribute","imageUrl","res","exec","ctxPermissions","Version","major","minor","patch","assert","isInteger","fromString","Array","isArray","fromArray","v","from","toString","toArray","toJSON","isCurrent","isSameOrAfter","isSame","_version","coerce","isBefore","isSameOrBefore","isAfter","ProgressBar","afterEnd","_progress","setAttribute","requests","classList","style","width","initiated","progress","completed","_value","add","warningNode","nodeError","_failedRequests","result","startRequest","finishRequest","errObj","errStr","info","serverOutage","_errorHandlers","some","handler","failed","RequestData","url","settings","responseType","_url","_settings","origin","response","protocol","_fetchFn","ok","status","statusText","formData","returnJSON","getHttp","bind","storeCountry","country","_storeCountry","substr","avatarNode","loginPromise","profileUrl","profilePath","login","isSignedIn","steamId","catch","newCountry","endsWith","getElementsByTagName","config","COUNTRY","group","groupEnd","sessionId","_sessionId","lang","appName","_appName","getJson","success","data","webapi_token","allSettled","promises","reason","DynamicStore","multiple","trimmedIds","statusList","trimStoreId","dsStatusList","i","trimmedId","owned","_fetch","Inventory","appids","options","getStatusObject","giftsAndPasses","hasCoupon","Boolean","opts","coupons","results","marketHashes","Feature","context","checkPrerequisites","apply","logError","args","CallbackFeature","registerCallback","callback","setup","_activeDropLists","_lastSelectHideTime","addEventListener","e","closest","_hide","index","bSetSelected","droplist","trigger","rgItems","item","highlightedItem","className","yOffset","offsetTop","clientHeight","curVisibleOffset","scrollTop","bScrolledDown","nMaxLoopIterations","nLoopCounter","inner","input","dispatchEvent","Event","contains","focus","_show","initialOption","changeFn","storageOption","reversed","box","getTrimmedValue","onChange","reverseEl","_onFocus","_onBlur","_onTriggerClick","ul","trimmedOption","toggle","beforeEnd","a","_highlightItem","DOMHelper","container","parent","parentNode","insertBefore","removeChild","selector","nodes","stylesheet","rel","head","appendChild","onload","isAsync","HorizontalScroller","controlLeftNode","controlRightNode","lastScroll","preventDefault","stopPropagation","deltaY","click","AugmentedSteam","afterBegin","SteamFacade","showMenu","hideMenu","clearCache","reload","btn","body","scroll","scrollY","stopShowingHandler","el","getElementById","insertAdjacentElement","currentLanguage","warningLanguage","strings","_addWarning","using_language","using_language_return","ChangeLanguage","wishlistLink","removeLinkFilter","link","URLSearchParams","search","MutationObserver","mutations","mutation","addedNodes","nodeType","Node","ELEMENT_NODE","observe","beforeBegin","logoutNode","accountName","communityName","pageHeader","test","title","getRandomApp","gamename","gameid","fullgame","playGameStr","visitStore","showConfirmDialog","done","ShowGotSteamModal","steamUrl","checked","tab","links","create","_loginWarningAdded","host","_addBackToTop","_addMenu","_addLanguageWarning","_handleInstallSteamButton","_disableLinkFilter","_skipGotSteam","_keepSteamSubscriberAgreementState","_defaultCommunityTab","_horizontalScrolling","_cartLink","_addUsernameSubmenuLinks","_addRedeemLink","_replaceAccountName","_launchRandomButton","_bindLogout","StringUtils","SteamCurrency","abbr","symbol","hint","multiplier","unit","formatPlaces","formatHidePlaces","formatSymbol","formatGroupSeparator","formatGroupSize","formatDecimalSeparator","formatPostfixSymbol","format","valueOf","price","_price","groupSeparator","decimalSeparator","parseFloat","isNaN","withSymbol","sign","decimals","s","abs","toFixed","decimalPlaces","g","j","groupSize","unshift","substring","join","hidePlacesWhenZero","postfix","placeholder","regExp","escapeRegExp","CurrencyManager","currencyNode","walletCurrency","g_rgWalletInfo","wallet_currency","currencyNumberToType","currency","_getCurrencyFromDom","_getCurrencyFromWallet","to","_rates","fromType","number","fromNumber","_indices","_defaultCurrency","storeCurrency","_getStoreCurrency","currencySetting","customCurrency","toCurrencies","_isInitialized","currencies","symbols","_loadCurrency","_loadRates","onFailure","ITAD","onHover","updateLastImport","htmlStr","toLocaleString","hover","syncDiv","timeout","display","timer","storeIds","collection","waitlist","resolved","inCollection","inWaitlist","Messenger","msgID","postMessage","information","removeEventListener","Price","formattedValue","otherPrice","_otherPrice","inCurrency","desiredCurrency","rate","getRate","currencyType","Prices","subids","bundleids","priceCallback","bundleCallback","_bundles","_getApiParams","apiParams","stores","cc","coupon","_getPricingStrings","priceData","pricingStr","prices","pricesStr","cutStr","cut","store","_processPrices","meta","hasData","lowestData","lowest","bundledCount","bundles","count","urlData","urls","voucherStr","price_voucher","voucher","escape","with_voucher","storeStr","drmStr","drm","infoUrl","storeUrl","lowest_price","historical","dateStr","recorded","toLocaleDateString","history","historical_low","bundledUrl","bundle_history","bundledStr","bundle_count","bundled","_processBundles","purchase","bundle","live","tiers","endDate","expiry","currentDate","getTime","bundleNormalized","page","sorted","t","games","sort","bundlePrice","tierNum","tier","tierName","note","tierPrice","gameList","details","load","initialized","ev","localStack","stack","insertScript","strTitle","strDescription","rgModalParams","ShowDialog","strOKButton","strCancelButton","strSecondaryActionButton","ShowConfirmDialog","ShowAlertDialog","ShowBlockingWaitDialog","ShowNicknameModal","CModal","DismissActiveModal","elemLink","elemPopup","align","valign","bLinkHasBorder","ShowMenu","HideMenu","CollapseLongStrings","AdjustVisibleAppTags","$J","hourMin","hourMax","UpdatePlaytimeFilterValues","BindAutoFlyoutEvents","g_player","SliderOnChange","GDynamicStore","InvalidateCache","bForceRecalculate","DecorateDynamicItems","OnReady","unAppID","unPackageID","unBundleID","rgAdditionalParams","GStoreItemData","BindHoverEvents","isHtml","isStore","v_tooltip","amount","publisherFee","CalculateFeeAmount","currencyCode","v_currencyformat","ToggleManageFriends","chatId","OpenFriendChatInWebChat","SubmitGuide","InitMiniprofileHovers","Modal","groupID","steamIDInvitee","InviteUserToGroup","GetCheckedAccounts","navid","ExecFriendAction","CScrollOffsetWatcher","ForceRecalc","strCookieName","strValue","expiryInDays","V_SetCookie","callbackFunc","CheckAgeGateSubmit","elTarget","strGroup","LoadImageGroupOnScroll","titleBarText","titleBarURL","sizeToFit","ShowModalContent","InventoryFirstPage","InventoryLastPage","InventoryGoToPage","ReloadCommunityInventory","itemDesc","GetMarketHashName","pricehistory_zoomDays","g_plotPriceHistory","g_timePriceHistoryEarliest","g_timePriceHistoryLatest","SellItemDialog","m_plotPriceHistory","m_timePriceHistoryEarliest","m_timePriceHistoryLatest","UpdateSelection","SelectAll","SelectNone","SelectInverse","on","ajax","post","eventName","addLoginWarning","fun","withPromise","argsString","msgId","_msgCounter","onMessage","documentElement","ContextClass","purifyConfig","ADD_ATTR","addHook","attrName","attrValue","keepAttr","setConfig","log","loading","onUpdate","lastVersion","changelogPromise","_showChangelog","_migrateSettings","dialog","connectBtn","itadConnected","updatedStr","showAlertDialog","oldVersion","emoticons","checkVersion","_pageSpecificFeatures","applyFeatures","FHighlightsTags","onDynamicStoreReady","highlightTitle","highlightAndTag","hasDsInfo","_options","values","x","_nodes","_selector","storeIdsMap","nodeToHighlight","aNode","getAppid","getAppidFromId","getSubid","getBundleid","highlightOwned","wishlisted","highlightWishlist","ignored","highlightIgnored","trimmedStoreIds","includeDsInfo","dsStatus","itadStatus","invStatus","getAppStatus","waitlisted","collected","gift","guestPass","it","storeid","operations","highlightCollection","highlightWaitlist","next","highlightInvGift","highlightInvGuestpass","highlightInvCoupon","operation","tag","_tagCssLoaded","tagCss","_types","color","insertCSS","dsTagids","_highlightCssLoaded","hlCss","previousElementSibling","forEach","_highlightNode","_addTag","sel","FEarlyAccess","show","_container","imageName","isCurrentLanguageOneOf","getEaNodes","imgHeader","cloneNode","appidsMap","getAppidImgSrc","String","size","eaStatus","flatMap","nodesArray","FHideTrademarks","selectors","replaceSymbols","observer","FAlternativeLinuxIcon","cssText","FWishlistHighlights","myWishlist","FWishlistITADPrices","_cachedPrices","_scrollResizeHandler","activeEntry","priceNode","row","_getNodesBelow","top","getBoundingClientRect","height","cachedPrices","appId","contentNode","bottom","priceNodeHeight","UserNotesAdapter","Adapter","adapters","toType","currentAdapter","getAdapter","newAdapter","export","OutOfCapacityError","ratio","CapacityInfo","closeToFull","utilization","_notes","oldNote","storageUsage","_getNotesSize","notes","UserNotes","_str","noteModalTemplate","capInfo","_showDialog","appname","noteEl","onNoteUpdate","strSave","strCancel","deferred","jQuery","Deferred","fnOk","fnCancel","reject","buttons","okBtn","_BuildDialogButton","cancelBtn","modal","_BuildDialog","_BindOnEnterKeyPressForDialog","always","Dismiss","noteInput","setSelectionRange","textLength","shiftKey","sessionStorage","fail","setItem","Show","add_for_game","exceeded","desc","not_enough_space_desc","close_on_storage_desc","storage_warning_desc","adapterType","strCloudStorage","strLocalStorage","not_enough_space","close_on_storage","save_itad","save_synced_storage","save_local","changeAdapter","FWishlistUserNotes","_userNotes","_noteEl","showModalDialog","active","lastNode","FWishlistStats","_appInfo","global","addMessageListener","_updateStats","updateOld","CWishlistController","Update","totalPrice","totalCount","totalOnSale","totalNoPrice","appInfo","rgVisibleApps","subs","discount_pct","WishlistExporter","wl","toJson","release_string","toText","parser","DOMParser","discount","basePrice","block","parseFromString","discount_block","innerText","method","Symbol","FExportWishlist","f","exportWishlist","wishlist","filename","filetype","copyToClipboard","navigator","clipboard","writeText","copyHandler","clipboardData","setData","execCommand","download","createObjectURL","MouseEvent","Blob","exportStr","copy_clipboard","dlBtn","copyBtn","getElementsByName","FEmptyWishlist","emptyWishlist","prompt","confirm","showBlockingWaitDialog","removing","wishlistData","textNode","nextSibling","FormData","dependencies","FKeepEditableRanking","globalAppInfo","g_rgAppInfo","g_Wishlist","controller","fnName","oldFn","rgAllApps","b","priority","hoverHandle","newHoverHandle","draggable","newInput","FOneClickRemoveFromWishlist","deleteNode","newDeleteNode","jqPost","dynamicStoreInvalidateCache","jq","removeClass","run","features","_callbacks","Ref","_promisesMap","_stats","feature","_generateFeatureChain","dependency","ready","dep","ftr","previousCheck","prev","weakDependency","every","fulfilled","fn","triggerCallbacks","_observeChanges","searchBox","decorateStoreCapsules","tabContent","friendactivityTab","myWishlistUrl","myWishlistUrlRegex","throbber","disconnect","alreadyLoaded","_registerObserver","delayedWork","Set","record","resettableTimer","arg"],"sourceRoot":""}