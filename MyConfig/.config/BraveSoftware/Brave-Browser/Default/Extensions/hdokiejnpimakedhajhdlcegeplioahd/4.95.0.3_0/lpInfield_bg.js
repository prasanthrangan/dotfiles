var InfieldCommands=function(){var n={};return{getPopupFillData:function(e,t){var r=o(t.tabURL,void 0,t.tabID),i=s(t.tabID),n;e({url:t.tabURL,fillData:{sites:r.sites,formFills:r.formfills,favIcons:r.favicons,bigIcons:r.bigicons},domPath:i.domPath,fieldID:i.fieldID,fieldType:i.fieldType,type:i.type,save:i.save,generate:1===i.generate,canCopyToClipboard:can_copy_to_clipboard(),userName:g_username,condensedDropdown:reduxApp.getState().settings.features.omar_infield_b,noHeaders:reduxApp.getState().settings.features.omar_infield_c})},setActiveFormData:function(e,t){var r=n[t.tabID]||{};for(var i in r)r.hasOwnProperty(i)&&(r[i].isActive=!1);r[e.active]={isActive:!0,domPath:e.active,fieldID:e.activefieldid,fieldType:e.activefieldtype,type:e.start_type,save:e.opentosave,generate:e.ask_generate},n[t.tabID]=r},copyPassword:function(e,t,r,i){sendLpImprove("copypass",{url:i.tabURL,source:"formv2",action:"sitepassword"}),sendLpImprove("sitelogin",{copy:1,shareType:getShareType(e),autologin:0,source:"formv2"},!0),copypassword(e,null,t?1:0,i.tabID)},copyUserName:function(e,t,r){copyusername(e,t?1:0,r.tabID)},copyUrl:function(e,t,r){copyurl(e,t?1:0,r.tabID)},copyProp:function(e,t,r,i,n){copyprop(e,t,r?1:0,void 0,void 0,i)},getGeneratePasswordPrefs:function(e,t){var r;e(do_popupfillgetgenerateprefs(t.tabID))},setGeneratePasswordPrefs:function(e,t){do_popupfillsetgenerateprefs(t.tabID,e)},searchVault:function(e,t,r,i){var n;r(do_searchvault(e,t,i.tabID))},searchVaultAll:function(e,t,r,i){var n;r(a(e,t,i.tabID))},fillGeneratedPassword:function(r,e,i,n){var t;LPTabs.get({tabID:n.tabID}).forEachWindow({each:function(e,t){return e.LPInfieldFrame.fillGeneratedPassword(n.tabURL,r,i,g_equivalentdomains)}}),e.action="formfill",sendLpImprove("genpassword",e,!0)},fillUserData:function(e,t,r){i(r.tabID,e,t),sendLpImprove("sitelogin",{copy:0,shareType:getShareType(e),autologin:0,source:"formv2"},!0)},editFormFill:function(e,t){reduxApp.getState().settings.features.omar_ia?openeditsecurenote(e):editprofile(e,null,t)},fillForm:function(e,t,r,i){var n=null;if(t)if(frame_and_topdoc_has_same_domain(i.tabID))reduxApp.getState().settings.features.omar_ia&&(n=!0);else{if(ftd_report_error(i.tabID,"fillform"),!lpConfirmYesNo(gs("Are you sure you want LastPass to fill your information into this site:")+"\n\n"+lp_gettld_url(ftd_get_frameparenturl(i.tabID))))return!1;n=!0}if(reduxApp.getState().settings.features.omar_ia){var s=g_securenotes[e];LegacyFillTracking.track(s.notetype,"Infield V2"),fillitem(e,null,null,t,n,r)}else fillform(e,null,null,null,t,n,r)},editSite:function(e){editAid(e)},canCopy:function(e){"function"==typeof e&&e(can_copy_to_clipboard()&&!g_isedge&&(have_binary()||!is_firefox_webext()))}};function s(e){var t=n[e]||{};for(var r in t)if(t.hasOwnProperty(r)&&t[r].isActive)return t[r]}function I(e){var t=e.filter(function(e){return"Password"===e.recordType}).map(function(e){return g_sites[e.id]}),r=e.filter(function(e){return"Password"!==e.recordType}).map(function(e){var t=addUserFriendlyDescription(g_securenotes[e.id]);return t.language=D(t),t}),i={};t.forEach(function(e){i[e.aid]=geticonurlfromrecord(e)});var n={};return t.forEach(function(e){n[e.aid]=getbigsquareiconurlfromrecord(e)}),{sites:t,formfills:r,favicons:i,bigicons:n}}function o(e,t,r){if(reduxApp.getState().settings.features.web_client_fill){var i,n=I(reduxApp.getInfieldRecords(r));return{sites:cache_usernames(n.sites),formfills:JSON.stringify(n.formfills),favicons:JSON.stringify(n.favicons),bigicons:JSON.stringify(n.bigicons)}}var s=[],o={},a={},l="",f="",c="",d="",u=new Array,g=new Array,p={};t=t||lp_gettld_url(e),s=getsites(e),s=reorderOnURL(s,e,!0);for(var _=0;_<s.length;_++)o[s[_].aid]=geticonurlfromrecord(s[_]),p[s[_].aid]=getbigsquareiconurlfromrecord(s[_]);var m=LPJSON.stringify("");if(reduxApp.getState().settings.features.omar_ia){notekeys=Object.keys(g_securenotes);for(var y=0;y<notekeys.length;y++)check_ident_aid(g_securenotes[notekeys[y]].aid)&&(-1<fillableNoteTypes.indexOf(g_securenotes[notekeys[y]].notetype)||"Custom_"===g_securenotes[notekeys[y]].notetype.substring(0,7))&&(g[y]=addUserFriendlyDescription(g_securenotes[notekeys[y]]),g[y].language=D(g[y]));g&&0<g.length&&(m=LPJSON.stringify(g))}else{for(var v=0;v<g_formfills.length;v++)if(check_ident_ffid(g_formfills[v].ffid)){u[u.length]=g_formfills[v];var b=lpmdec_acct(g_formfills[v].ccnum,!0,g_formfills[v],g_shares);if(o[g_formfills[v].ffid]=geticonCCnum(b),p[g_formfills[v].ffid]=geticonCCnum(b,!0),""!==g_formfills[v].ccnum){var h=lpmdec(g_formfills[v].ccnum);u[u.length-1].description=LPCC.getFormattedNumber(h),u[u.length-1].ccType=LPCC.getCCType(h)}}u&&0<u.length&&(m=LPJSON.stringify(u))}return d=cache_usernames(s),l=m,f=LPJSON.stringify(o),g_40fieldicon&&(c=LPJSON.stringify(p)),d&&(a.sites=d),l&&(a.formfills=l),f&&(a.favicons=f),c&&(a.bigicons=c),a}function D(e){var t=lpmdec(e.extra,!0),r=/Language:(.+)/.exec(t);return r&&1<r.length?r[1]:"en-US"}function i(e,t,r){if(!lploggedin||null!=grid_getdata("active"))return!1;if(g_last_launch[t]=(new Date).getTime(),void 0===g_sites[t])return!1;var i=!0,n=get_record(t);return r&&!n.save_all&&(i=!0),g_fillfield_confirm_perfield={},fill({tabid:e,acct:g_sites[t],docid:null,submit:!1,doconfirm:!0,docnum:"all",allowforce:!0,skip_pwprotect:!1,manualfill:i,automaticallyFill:null,skip_basicauth:null,from_iframe:r,desc:"autofillaid",source:"notrack"}),!0}function a(e,t,r){if(e=e&&e.toLowerCase().trim(),reduxApp.getState().settings.features.web_client_fill){var i=reduxApp.getInfieldRecords(r),n=reduxApp.searchInfieldRecords(e,i);return JSON.stringify(I(n))}var s={},o={},a="",l=g_popup_url_by_tabid[r];for(var f in l&&(a=lp_gettld_url(l)),g_sites)!check_ident_aid(g_sites[f].aid)||g_sites[f].tld!==a||e&&-1===g_sites[f].name.toLowerCase().indexOf(e)&&-1===g_sites[f].unencryptedUsername.toLowerCase().indexOf(e)||(s[f]=g_sites[f],g_sites[f].tld&&g_bigsquareicons[g_sites[f].tld]&&(o[f]="data:image/png;base64,"+g_bigsquareicons[g_sites[f].tld]));for(var c=Object.keys(g_securenotes),d=new Array,u=0;u<c.length;u++)check_ident_aid(g_securenotes[c[u]].aid)&&-1<fillableNoteTypes.indexOf(g_securenotes[c[u]].notetype)&&-1!==g_securenotes[c[u]].decprofilename.toLowerCase().indexOf(e)&&(d[u]=addUserFriendlyDescription(g_securenotes[c[u]]));return JSON.stringify({sites:s,bigicons:o,formfills:d})}}();