LPSiteNotification=function(){var L=!1,i=!1,a=!1,w=!1,t=500,n,r=function(e){for(var t=0;t<e.fields.length;++t)if("password"===e.fields[t].type)return!0;return!1},P=(o=!1,function(e){o||(o=!0,setTimeout(function(){o=!1},t),r(e)?(e.generatedPassword||(L=!0),bg.LPTabState.processPasswordSubmit({formData:e,callback:e.generatedPassword||LPContentScriptTools.isUnloading()?null:x})):0<e.fields.length&&(bg.LPTabState.processTextSubmit(e),bg.LPTabState.clear()))}),o,y=(u='input:not([type]),input[type="text"],input[type="email"],input[type="password"]',s=function(e){return e.value&&(e.value!==e.getAttribute("value")||1<e.value.length)&&LPContentScriptTools.isVisible(e)},c=function(e){for(var t,n=[],r=(e||document.body).querySelectorAll(u),i=0;i<r.length;++i)s(r[i])&&n.push(r[i]);return n},l=function(e){for(var t=[],n={},r={},i=e.length<1e3?e.length:1e3,o=0;o<i;++o){var a=e[o];switch(a.type){case"hidden":case"text":case"email":!a.value||"hidden"!==a.type&&LPContentScriptTools.isVisible(a)||(n.hasOwnProperty(a.value)?delete r[a.value]:n[(r[a.value]=a).value]=!0)}}var u=LPContentScriptTools.findTextNodes({searches:Object.keys(r),searchAll:!0,exactMatch:!0,allowEmails:!0}),s={};return u.filter(function(e){return!s.hasOwnProperty(e.match)&&(s[e.match]=!0)}).forEach(function(e){e.parent&&"OPTION"!==e.parent.nodeName&&LPContentScriptTools.isVisible(e.parent)&&t.push(r[e.match])}),t},f=function(e){var t={type:e.type,value:e.value,id:e.id,label:LPContentScriptTools.getLabel(e),attributes:LPContentScriptTools.getAttributes(e,["name","ng-model","data-reactid"])};return"password"!==t.type&&"disc"===LPContentScriptTools.getCSS(e,"text-security")&&(t.type="password"),t},d=function(e,t){for(var n=[],r=0;r<e.length;++r){var i=e[r];"password"!==i.inputData.type&&(i.inputData.value=W.getUnmaskedValue({input:i.input,inputValue:i.inputData.value,form:t.form})),i.inputData.formname=t.form&&t.form.getAttribute("name")||"",n.push(i.inputData)}return{url:parsePageUrl(document.location.href,proxies),top:window===top,fields:n,generatedPassword:t.generatedPassword,username:W.getUsername()}},p=function(e){if(LP_explicit_ignored(document,e))return!0;if(n&&n.length){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);for(var t=0;t<n.length;t++)if(e.matches(n[t].querySelector)&&"off"==n[t].override)return!0}return!1},function(e){if(J(e.generateFormAction))return null;var t=c(e.form);e.form&&(t=l(e.form).concat(t));for(var n=[],r=0;r<t.length;++r){var i=t[r];if(!p(i)){var o=f(i);n.push({input:i,inputData:o})}}var a=d(n,e);return e.deferred||P(a),a}),u,s,c,l,f,d,p,C=(v=null,g=function(){v=null},function(t){return function(e){if(v=!1!==e.isTrusted&&!1!==v)try{t(e)}catch(e){Raven.captureException(e)}setTimeout(g,0)}}),v,g,e=(m=function(e,t,n){var r=h(e);return!(!r||!LPContentScriptTools.isVisible(r))&&(n&&!LPContentScriptTools.isClickable(r)?!(i=!0):!t.passwordChangeForm||r.value===e.value)},h=function(e){if(e.id)return document.getElementById(e.id);for(var t in e.attributes){var n=document.querySelector("input["+t+'="'+e.attributes[t]+'"]');if(n)return n}return null},b=function(e,t){for(var n=0;n<e.fields.length;++n){var r=e.fields[n];if("password"===r.type)return m(r,e,t)}return!1},S=function(e,t){var n=h(e);n&&n.addEventListener("input",C(function(){t(!0)}))},T=function(e,t){for(var n=0;n<e.fields.length;++n){var r=e.fields[n];"password"===r.type&&S(r,t)}},function(n,t){var r=0,e=20,i=null,o=!1,a=function(e){o||(o=!(L=!1),clearInterval(i),t(e))};L?(i=setInterval(function(){var e=20==++r,t=b(n,e);t&&!e||a(t)},1e3),T(n,a)):a(b(n))}),m,h,b,T,S,E=(N=!1,function(e){if(!a&&!N){N=!0,e.postSetup=function(){Topics.get(Topics.SITE_NOTIFICATION).publish(n)};var t={css:{top:10,right:10}},n=LPFrame.openDialog("contentScriptSite",e,t);a=!0,I(e,t),n.onClose(function(){a=!1})}}),N,I=function(e,t){var n=0,r,i=6,o=setInterval(function(){n++,document.getElementsByTagName("iframe").length<1&&a&&n<=6&&(dialog=LPFrame.openDialog("contentScriptSite",e,t),clearInterval(o)),6<n&&clearInterval(o)},3e3)},x=function(e){LPContentScriptTools.isUnloading()||(Topics.get(Topics.SITE_NOTIFICATION_STATE).publish(e),e.dialogData&&!i&&(e.detectionType="inject",csTop.LPSiteNotification.showSiteNotification(e)))},O=(D=function(e){return-1<(e=e.toLowerCase()).indexOf("submit")||-1<e.indexOf("save")},A=function(e){for(var t=e.attributes,n=0;n<t.length;++n){var r=t[n];if(D(r.name)||D(r.value))return!0}return!1},function(e){if("INPUT"===e.nodeName)return"submit"===e.type||"button"===e.type&&A(e);for(var t=e;t&&0===t.getElementsByTagName("input").length;){if("BUTTON"===t.nodeName)return"submit"===t.type||A(t);if(A(t))return!0;t=t.parentElement}return!1}),D,A,_=function(e){switch(e.nodeName){case"TEXTAREA":case"SELECT":return!0;case"INPUT":switch(e.type){case"button":case"submit":return!1;default:return!0}default:return!1}},k=(q=null,F=[],V=function(e){for(var t=0;t<e.length;++t){var n=e[t];switch(n.type){case"attributes":if(n.target.getAttribute(n.attributeName)!==n.oldValue)return!0;break;default:return!0}}return!1},R=function(e){V(e)&&(F.forEach(function(e){e()}),U())},{reset:U=function(){q&&(q.disconnect(),q=null),F=[]},onChange:function(e){"undefined"!=typeof MutationObserver&&(q||(q=new MutationObserver(R)).observe(document.body,{childList:!0,attributes:!0,characterData:!0,subtree:!0,attributeOldValue:!0}),-1===F.indexOf(e)&&F.push(e),setTimeout(function(){U()},0))}}),q,F,U,V,R,M,B=(H=[],{startTracking:function(e,r){var i=function(t){if(e(t.detail)){window.removeEventListener("lprequeststart",i);var n=function(e){t.detail.requestID===e.detail.requestID&&(window.removeEventListener("lprequestend",n),r(e.detail))};window.addEventListener("lprequestend",n)}};window.addEventListener("lprequeststart",i),H.push(i)},stopTracking:function(){H.forEach(function(e){window.removeEventListener("lprequeststart",e)}),H=[]}}),H,j,G,W=function(){var t=null,n=!1,i=[];Topics.get(Topics.FILLED_GENERATED_PW).subscribe(function(e){w=!0,r({target:e.element,generatedPassword:e.password,generateFormAction:!0})}),Topics.get(Topics.CLEAR_DATA).subscribe(function(e){h()}),Topics.get(Topics.LOGIN).subscribe(function(e){bg.LPTabState.getState(function(e){e.enabled&&m(e)})});var r=function(e){if(e.form=LPContentScriptTools.getForm(e.target),!e.form){var t=document.querySelector("input[type=password]");t&&(e.form=LPContentScriptTools.getForm(t))}return y(e)},o=function(){L=!1,bg.LPTabState.clear()},a=function(e){try{return decodeURIComponent(e)}catch(e){}return null},u=function(e){var i=e&&e.formData;i&&0<i.fields.length&&(B.stopTracking(),B.startTracking(function(e){if(e&&e.data)for(var t=a(e.data),n=0;n<i.fields.length;++n){var r=i.fields[n].value;if(t&&-1<t.indexOf(r)||-1<e.data.indexOf(r))return!0}return!1},e.responseHandler))},s=(c=/^2[0-9][0-9]$/,function(e){return c.test(e)}),c,l=function(e){return 0===e},f=function(e){u({formData:e,responseHandler:function(e){s(e.statusCode)||l(e.statusCode)||o()}})},d=function(e){var t=r({target:e,deferred:!0});u({formData:t,responseHandler:function(e){s(e.statusCode)&&P(t)}})},p=LPContentScriptTools.debounce(function(e){k.reset(),f(r({target:e.target,type:e.type}))},1e3,!0),v={submit:C(function(e){p(e)}),lpsubmit:function(e){k.reset(),y({form:e.target,type:"submit"})},mouseup:C(function(e){var t=e.target;O(t)?p(e):_(t)||(L&&k.onChange(o),d(t))}),keydown:C(function(e){if(13===(e.keyCode||e.which)){var t=e.target;_(t)||O(t)?(k.reset(),f(r({target:t,type:e.type}))):(L&&k.onChange(o),d(t))}}),change:C(function(e){var t=e.target;if("INPUT"===t.nodeName&&t.value)switch(t.type){case"text":case"email":for(var n=0;n<i.length;++n)if(i[n].input===t)return void(i[n].value=t.value);i.push({input:t,value:t.value})}}),paste:C(function(e){var t=e.target;_(e.target)&&bg.LPTabState.getCopiedGeneratedPassword(function(e){t.value===e&&r({target:t,generatedPassword:e})})})},g=function(e){t=e},e=function(){if(t.usernames&&0<t.usernames.length)return LPContentScriptTools.findText({searches:t.usernames,wordMatch:!0})},m=function(e){if(should_do_lastpass_here(document)&&(g(e),!n)){for(var t in v)document.addEventListener(t,v[t],!0);n=!0}},h=function(){if(n){for(var e in v)document.removeEventListener(e,v[e],!0);n=!1}i=[]},b=function(e){return-1<e.indexOf("*")||-1<e.indexOf(String.fromCharCode(8226))},T=function(e,t){return e.value&&!b(e.value)&&e.value.length===t.length&&(e.value[0]===t[0]||e.value[e.value.length-1]===t[t.length-1])},S=function(e){if(b(e.inputValue)){var t;for(t=0;t<i.length;++t){var n=i[t];if(n.input===e.input&&n.value!==e.inputValue)return n.value}if(e.form)for(t=0;t<e.form.length;++t){var r=e.form[t];if(T(r,e.inputValue))return r.value}}return e.inputValue};return function(){var n=document.documentElement;if(n&&"HTML"===n.nodeName)if(g_ischrome||g_issafari_appext){var e=document.createElement("script");e.appendChild(document.createTextNode(LPContentScriptConstants.JS.PageWebRequestEvents)),n.appendChild(e),n.removeChild(e)}else Topics.get(Topics.INITIALIZED).subscribe(function(){var e=bg.get("extensionBaseURL");if(e){var t=document.createElement("script");t.src=e+"pageWebRequestEvents.js",n.appendChild(t),n.removeChild(t)}})}(),{setup:m,teardown:h,getUnmaskedValue:S,getUsername:e}}(),Z=LPContentScriptTools.debounce(function(){bg.LPTabState.getSiteNotification({callback:x})},1e3,!0);Topics.get(Topics.INITIALIZED).subscribe(function(){bg.LPTabState.pageLoaded=!0,bg.LPTabState.getState(function(e){e.enabled&&(W.setup(e),window===top?Z():e.formSubmittedFrame&&csTop.LPSiteNotification.getSiteNotification())});var e={host:document.location.host,pathname:document.location.pathname},t=bg.get("LPContentScriptFeatures");t&&(t.field_override_global||t.field_override_admin)&&bg.FieldOverrides.getSite(e,function(e){n=e})}),window!==top&&window.addEventListener("beforeunload",function(){L&&csTop.LPSiteNotification.getSiteNotification()},!0);var J=function(e){return!(e||!w)&&!(w=!1)};return{formExists:e,showSiteNotification:E,getSiteNotification:Z}}();